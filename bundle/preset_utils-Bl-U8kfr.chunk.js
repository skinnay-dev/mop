import{Y as e,q as t,a2 as a,bC as i,a9 as s,aY as n,T as o,a as l,r,bD as c,S as h,bB as m,a3 as d,bE as p,$ as u,bF as g,k as f,m as w,bG as y,bH as b,bI as v,bJ as S,bK as I,bL as E,bM as k,bN as C,Q as _,Z as x,bO as T,a0 as P,bP as R,b9 as D,O as N,bQ as G,P as U,bR as O,an as A,ao as L,av as V,bS as F,aL as M,bT as W,aQ as z,aU as j,M as B,d as H,a_ as q,bU as Y,b7 as K,bV as $,bb as J,bW as Z,bi as Q,bj as X,bX as ee,bx as te,bY as ae,bZ as ie,s as se,b_ as ne,b$ as oe,c0 as le,l as re,c1 as ce,f as he,G as me,c2 as de,c3 as pe,c4 as ue,c5 as ge,c6 as fe,c7 as we,c8 as ye,c9 as be,ca as ve,cb as Se,cc as Ie,cd as Ee,ce as ke,cf as Ce,cg as _e,ch as xe,ci as Te,cj as Pe,c as Re,ck as De,U as Ne,b as Ge,cl as Ue,cm as Oe,cn as Ae,u as Le,co as Ve,at as Fe,A as Me,z as We,cp as ze,cq as je,cr as Be,cs as He,ct as qe,cu as Ye,cv as Ke,aP as $e,W as Je,cw as Ze,cx as Qe,cy as Xe,cz as et,ax as tt,cA as at,X as it,cB as st,cC as nt,v as ot,cD as lt,cE as rt,cF as ct,cG as ht,cH as mt,cI as dt,cJ as pt,cK as ut,cL as gt,cM as ft,cN as wt,cO as yt,cP as bt,cQ as vt,cR as St,cS as It,cT as Et,cU as kt,cV as Ct,cW as _t,cX as xt,cY as Tt,cZ as Pt,c_ as Rt,c$ as Dt,d0 as Nt,d1 as Gt,d2 as Ut,d3 as Ot,d4 as At,d5 as Lt,d6 as Vt,d7 as Ft,d8 as Mt,d9 as Wt,da as zt,db as jt,dc as Bt,dd as Ht,de as qt,df as Yt,dg as Kt,dh as $t,di as Jt,dj as Zt,dk as Qt,dl as Xt,dm as ea,dn as ta,dp as aa,dq as ia,dr as sa,ds as na,dt as oa,du as la,dv as ra,dw as ca,dx as ha,dy as ma,dz as da,dA as pa,dB as ua,dC as ga,dD as fa,dE as wa,dF as ya,dG as ba,dH as va,dI as Sa,dJ as Ia,dK as Ea,dL as ka,dM as Ca,dN as _a,dO as xa,dP as Ta,dQ as Pa,dR as Ra,dS as Da,dT as Na,dU as Ga,dV as Ua,dW as Oa,dX as Aa,dY as La,dZ as Va,d_ as Fa,d$ as Ma,e0 as Wa,e1 as za,e2 as ja,e3 as Ba,e4 as Ha,e5 as qa,e6 as Ya,e7 as Ka,e8 as $a,e9 as Ja,ea as Za,eb as Qa,ec as Xa,ed as ei,ee as ti,ef as ai,eg as ii,eh as si,ei as ni,ej as oi,ek as li,el as ri,em as ci,en as hi,eo as mi,ep as di,eq as pi,er as ui,es as gi,et as fi,eu as wi,ev as yi,ew as bi,aB as vi,ex as Si,ey as Ii,ez as Ei,eA as ki,eB as Ci,eC as _i,aC as xi,aD as Ti,eD as Pi,eE as Ri,eF as Di,eG as Ni,eH as Gi,eI as Ui,eJ as Oi,eK as Ai,eL as Li,eM as Vi,eN as Fi,x as Mi,eO as Wi,eP as zi,ae as ji,R as Bi,D as Hi,j as qi,I as Yi,C as Ki,eQ as $i,eR as Ji,aa as Zi,eS as Qi,eT as Xi,eU as es,eV as ts,eW as as,eX as is,eY as ss,eZ as ns,e_ as os,e$ as ls,f0 as rs,g as cs,f1 as hs,f2 as ms,f3 as ds,a6 as ps,f4 as us,K as gs,_ as fs,N as ws,a5 as ys,J as bs,f5 as vs,f6 as Ss,f7 as Is,f8 as Es,f9 as ks,fa as Cs,fb as _s,fc as xs,fd as Ts,fe as Ps,ff as Rs,fg as Ds,fh as Ns,fi as Gs,fj as Us,fk as Os,fl as As,fm as Ls,fn as Vs,fo as Fs,F as Ms,af as Ws,fp as zs,fq as js,fr as Bs,fs as Hs,ft as qs,fu as Ys,fv as Ks,fw as $s,fx as Js,bf as Zs,aO as Qs,fy as Xs,fz as en,fA as tn,fB as an,fC as sn,fD as nn,H as on,fE as ln,ag as rn,ah as cn,aX as hn,fF as mn,fG as dn,fH as pn,fI as un,fJ as gn,fK as fn,fL as wn,fM as yn,fN as bn,fO as vn,fP as Sn,fQ as In,fR as En,fS as kn,fT as Cn,fU as _n,fV as xn,fW as Tn,fX as Pn,fY as Rn,L as Dn,fZ as Nn,w as Gn,E as Un,aW as On,V as An,f_ as Ln,f$ as Vn,g0 as Fn,g1 as Mn,a1 as Wn,g2 as zn,g3 as jn,bA as Bn,g4 as Hn,g5 as qn}from"./detailed_results-DjiBtJMj.chunk.js";import{M as Yn,t as Kn,i as $n,T as Jn,h as Zn,a as Qn,b as Xn}from"./index-BgswASio.chunk.js";const eo={footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class to extends e{constructor(e,i,s={disposeOnClose:!0}){super(e,"modal"),this.isOpen=!1,this.onHideCallbacks=[],this.modalConfig={...eo,...s};const n=a(),o=a(),l=a(),r=a(),c=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.appendChild(t("div",{className:`modal-dialog ${i} ${c} ${this.modalConfig.scrollContents?"modal-overflow-scroll":""}`,ref:n},t("div",{className:"modal-content"},t("div",{className:"modal-header "+(this.modalConfig.header||this.modalConfig.title?"":"p-0 border-0"),ref:o},this.modalConfig.title&&t("h5",{className:"modal-title"},this.modalConfig.title),t("button",{type:"button",className:"btn-close "+(this.modalConfig.closeButton?.fixed?"position-fixed":""),onclick:()=>this.close(),attributes:{"aria-label":"Close"}},t("i",{className:"fas fa-times fa-2xl"}))),t("div",{className:"modal-body",ref:l}),this.modalConfig.footer&&t("div",{className:"modal-footer",ref:r})))),this.dialog=n.value,this.header=o.value,this.body=l.value,this.footer=r.value,this.modal=new Yn(this.rootElem),this.modalConfig.disposeOnClose&&this.rootElem.addEventListener("hidden.bs.modal",(()=>{this.rootElem.remove(),this.dispose()}),{once:!0})}open(){const e=this.closeModalOnEscKey.bind(this),t=this.showBSFn.bind(this),a=this.hideBSFn.bind(this),i=this.hiddenBSFn.bind(this);document.addEventListener("keydown",e),this.rootElem.addEventListener("show.bs.modal",t),this.rootElem.addEventListener("hide.bs.modal",a),this.rootElem.addEventListener("hidden.bs.modal",i),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("show.bs.modal",t))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hide.bs.modal",a))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hidden.bs.modal",i))),this.modal.show(),this.isOpen=!0}close(){this.modal.hide(),this.isOpen=!1}addOnHideCallback(e){this.onHideCallbacks.push(e)}onShow(e){}onHide(e){this.onHideCallbacks.forEach((e=>e()))}async showBSFn(e){e.stopImmediatePropagation();const t=await new Promise((e=>{setTimeout((()=>{this.modal._backdrop._element&&e(this.modal._backdrop._element)}),100)}));this.rootElem.insertAdjacentElement("afterend",t),this.onShow(e)}hideBSFn(e){e.stopImmediatePropagation(),this.onHide(e)}hiddenBSFn(e){e.stopPropagation()}closeModalOnEscKey(e){"Escape"==e.key&&this.close()}}const ao={[i.ItemQualityJunk]:"text-junk",[i.ItemQualityCommon]:"text-common",[i.ItemQualityUncommon]:"text-uncommon",[i.ItemQualityRare]:"text-rare",[i.ItemQualityEpic]:"text-epic",[i.ItemQualityLegendary]:"text-legendary",[i.ItemQualityArtifact]:"text-artifact",[i.ItemQualityHeirloom]:"text-heirloom"};function io(e,t){Object.values(ao).forEach((t=>e.classList.remove(t))),t&&e.classList.add(ao[t])}class so extends s{constructor(e,t,a){super(e,"number-picker-root",t,a),this.float=a.float??!1,this.maxDecimalDigits=a.maxDecimalDigits??2,this.positive=a.positive??!1,this.showZeroes=a.showZeroes??!0,this.inputElem=document.createElement("input"),this.inputElem.id=a.id,this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&this.inputElem.addEventListener("change",(()=>{this.float?this.inputElem.value=n(Math.abs(Number(this.inputElem.value)),{minimumFractionDigits:2,maximumFractionDigits:this.maxDecimalDigits}):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()}),{signal:this.signal}),this.inputElem.addEventListener("change",(()=>{this.inputChanged(o.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.init(),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?Number(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(e){0!==e||this.showZeroes?this.float?this.inputElem.value=n(e,{useGrouping:!1,minimumFractionDigits:2,maximumFractionDigits:this.maxDecimalDigits}):this.inputElem.value=String(e):this.inputElem.value=""}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}class no extends e{constructor(e,i,s,n,h){super(e,"character-stats-root"),this.stats=s,this.player=i,this.modifyDisplayStats=n,this.overwriteDisplayStats=h;const m=document.createElement("label");m.classList.add("character-stats-label"),m.textContent="Stats",this.rootElem.appendChild(m);const d=document.createElement("table");if(d.classList.add("character-stats-table"),this.rootElem.appendChild(d),this.valueElems=[],this.stats.forEach((e=>{const s=e.getShortName(i.getClass()),n=a(),o=t("tr",{className:"character-stats-table-row"},t("td",{className:"character-stats-table-label"},s,e.equalsStat(l.StatMasteryRating)&&t(r,null,t("br",null),c.get(this.player.getSpec()))),t("td",{ref:n,className:"character-stats-table-value"},e.hasRootStat()&&this.bonusStatsLink(e)));d.appendChild(o),this.valueElems.push(n.value)})),this.shouldShowMeleeCritCap(i)){const e=a(),i=t("tr",{className:"character-stats-table-row"},t("td",{className:"character-stats-table-label"},"Melee Crit Cap"),t("td",{ref:e,className:"character-stats-table-value"}));d.appendChild(i),this.meleeCritCapValueElem=e.value}else this.meleeCritCapValueElem=void 0;this.updateStats(i),o.onAny([i.currentStatsEmitter,i.sim.changeEmitter,i.talentsChangeEmitter]).on((()=>{this.updateStats(i)}))}updateStats(e){const i=e.getCurrentStats(),s=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{},n=h.fromProto(i.baseStats),o=h.fromProto(i.gearStats),r=h.fromProto(i.talentsStats),c=h.fromProto(i.buffsStats),g=h.fromProto(i.consumesStats),f=e.getBonusStats();let w=n.add(s.base||new h),y=o.subtract(n).subtract(f).add(s.gear||new h),b=r.subtract(o).add(s.talents||new h),v=c.subtract(r).add(s.buffs||new h),S=g.subtract(c).add(s.consumes||new h),I=h.fromProto(i.finalStats).add(s.base||new h).add(s.gear||new h).add(s.talents||new h).add(s.buffs||new h).add(s.consumes||new h).add(s.final||new h);if(this.overwriteDisplayStats){const e=this.overwriteDisplayStats(this.player);e.stats&&e.stats.forEach(((t,a)=>{w=w.withStat(t,e.base.getStat(t)),y=y.withStat(t,e.gear.getStat(t)),b=b.withStat(t,e.talents.getStat(t)),v=v.withStat(t,e.buffs.getStat(t)),S=S.withStat(t,e.consumes.getStat(t)),I=I.withStat(t,e.final.getStat(t))}))}const E=this.player.getBaseMastery()+(i.finalStats?.stats[l.StatMasteryRating]||0)/m;if(this.stats.forEach(((e,i)=>{const s=e.hasRootStat()?f.getStat(e.getRootStat()):0;let n;n=0==s?"text-white":s>0?"text-success":"text-danger";const o=a(),r=t("div",{className:"stat-value-link-container"},t("button",{ref:o,className:u("stat-value-link",n)},`${this.statDisplayString(I,e,!0)} `),e.equalsStat(l.StatMasteryRating)&&t("a",{href:d.makeSpellUrl(p.get(this.player.getSpec())||0),className:u("stat-value-link-mastery",n),target:"_blank"},`${(E*this.player.getMasteryPerPointModifier()).toFixed(2)}%`)),c=o.value;this.valueElems[i].querySelector(".stat-value-link-container")?.remove(),this.valueElems[i].prepend(r);const h=t("div",null,t("div",{className:"character-stats-tooltip-row"},t("span",null,"Base:"),t("span",null,this.statDisplayString(w,e,!0))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Gear:"),t("span",null,this.statDisplayString(y,e))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Talents:"),t("span",null,this.statDisplayString(b,e))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Buffs:"),t("span",null,this.statDisplayString(v,e))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Consumes:"),t("span",null,this.statDisplayString(S,e))),0!==s&&t("div",{className:"character-stats-tooltip-row"},t("span",null,"Bonus:"),t("span",null,this.statDisplayString(f,e))),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Total:"),t("span",null,this.statDisplayString(I,e,!0))));Kn(c,{content:h})})),this.meleeCritCapValueElem){const a=e.getMeleeCritCapInfo(),i=t("button",{className:"stat-value-link"},this.meleeCritCapDisplayString(e,I)," "),s=a.playerCritCapDelta;0==s?i.classList.add("text-white"):s>0?i.classList.add("text-danger"):s<0&&i.classList.add("text-success"),this.meleeCritCapValueElem.querySelector(".stat-value-link")?.remove(),this.meleeCritCapValueElem.prepend(i);const n=t("div",null,t("div",{className:"character-stats-tooltip-row"},t("span",null,"Glancing:"),t("span",null,`${a.glancing.toFixed(2)}%`)),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Suppression:"),t("span",null,`${a.suppression.toFixed(2)}%`)),t("div",{className:"character-stats-tooltip-row"},t("span",null,"To Hit Cap:"),t("span",null,`${a.remainingMeleeHitCap.toFixed(2)}%`)),t("div",{className:"character-stats-tooltip-row"},t("span",null,"To Exp Cap:"),t("span",null,`${a.remainingExpertiseCap.toFixed(2)}%`)),0!=a.specSpecificOffset&&t("div",{className:"character-stats-tooltip-row"},t("span",null,"Spec Offsets:"),t("span",null,`${a.specSpecificOffset.toFixed(2)}%`)),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Final Crit Cap:"),t("span",null,`${a.baseCritCap.toFixed(2)}%`)),t("hr",null),t("div",{className:"character-stats-tooltip-row"},t("span",null,"Can Raise By:"),t("span",null,`${(a.remainingExpertiseCap+a.remainingMeleeHitCap).toFixed(2)}%`)));Kn(i,{content:n})}}statDisplayString(e,t,a){const i=t.hasRootStat()?e.getStat(t.getRootStat()):null;let s=t.convertDefaultUnitsToPercent(e.getUnitStat(t));t.equalsStat(l.StatMasteryRating)&&a&&(s+=this.player.getBaseMastery());const n=null===i||0===i&&null!==s,o=n?"":String(Math.round(i)),r=t.equalsStat(l.StatMasteryRating)?" Points":"%",c=null===s?"":`${s.toFixed(2)}`+r;return o+(n||null===s?c:` (${c})`)}bonusStatsLink(e){const i=e.getRootStat(),s=g(i),n=a(),o=a(),l=t("button",{ref:n,className:"add-bonus-stats text-white ms-2",dataset:{bsToggle:"popover"}},t("i",{ref:o,className:"fas fa-plus-minus"}));return Kn(o.value,{content:`Bonus ${s}`}),Kn(n.value,{interactive:!0,trigger:"click",theme:"bonus-stats-popover",placement:"right",onShow:e=>{const t=new so(null,this.player,{id:`character-bonus-stat-${i}`,label:`Bonus ${s}`,extraCssClasses:["mb-0"],changedEvent:e=>e.bonusStatsChangeEmitter,getValue:e=>e.getBonusStats().getStat(i),setValue:(t,a,s)=>{const n=a.getBonusStats().withStat(i,s);a.setBonusStats(t,n),e?.hide()}});e.setContent(t.rootElem)}}),l}shouldShowMeleeCritCap(e){return e.getPlayerSpec().isMeleeDpsSpec}meleeCritCapDisplayString(e,t){const a=e.getMeleeCritCap();if(0===a)return"Exact";return`${a>0?"Over by ":"Under by "} ${Math.abs(a).toFixed(2)}%`}}const oo=({children:e,buttonClassName:a,linkRef:i,...s})=>"href"in s&&s.href?t("a",{ref:i,href:s.href,target:"_blank",className:u(a)},e):t("button",{type:"button",ref:i,className:u(a)},e),lo=({ref:e,linkRef:a,iconRef:i,icon:s,className:n,children:o,...l})=>t("div",{ref:e,className:"sim-toolbar-item"},t(oo,{linkRef:a,className:u(n),...l},s&&t("i",{ref:i,className:s}),o)),ro=t("ul",{className:"text-start ps-3 mb-0"});class co extends e{constructor(e){super(e,"results-viewer"),this.warnings=[],this.warningsTooltip=null;const i=a(),s=a(),n=a(),o=a();this.rootElem.appendChild(t(r,null,t("div",{ref:i,className:"results-pending"},t("div",{className:"loader"})),t("div",{ref:s,className:"results-content"}),t("div",{ref:o,className:"button-zone text-center"}),t("div",{ref:n,className:"warning-zone text-center"}))),this.pendingElem=i.value,this.contentElem=s.value,this.warningElem=n.value,this.buttonElem=o.value,this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink({parent:e,tooltip:i,classes:s,text:n,...o}){const l=a();return e.appendChild(t(lo,{linkRef:l,buttonClassName:s,...o},n)),i&&(this.warningsTooltip=Kn(l.value,{appendTo:"parent",content:i,placement:"bottom",inlinePositioning:!0,plugins:[$n]})),l.value}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:ro,classes:"warning link-warning"})}addWarning(e){this.warnings.push(e),e.updateOn.on((()=>this.updateWarnings())),this.updateWarnings()}updateWarnings(){const e=this.warnings.map((e=>e.getContent())).flat().filter((e=>""!==e)),a=this.warningsTooltip?.props.content?.cloneNode(!0)||t(r,null);a&&(a.innerHTML=""),a.appendChild(t(r,null,e?.map((e=>t("li",null,e))))),this.warningsLink.parentElement?.classList?.[e.length?"remove":"add"]("hide"),this.warningsTooltip?.setContent(a)}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none",this.buttonElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(e){"string"==typeof e?this.contentElem.innerHTML=e:this.contentElem.replaceChildren(e),this.contentElem.style.display="block",this.pendingElem.style.display="none"}addAbortButton(e){this.buttonElem.replaceChildren(t("button",{className:"sim-abort-button",onclick:e},t("i",{className:"fa fa-times fa-lg me-1"}),"Stop")),this.buttonElem.style.display="block"}removeAbortButton(){this.buttonElem.replaceChildren(),this.buttonElem.style.display="none"}}class ho extends e{constructor(e,t,a){super(e,"sim-tab"),this.rootElem.classList.add(a.identifier),this.simUI=t,this.config=a,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==e.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const e=document.createElement("fragment");return e.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<button\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\ttype="button"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</button>\n\t\t\t</li>\n\t\t`,e.children[0]}buildColumn(e,t){const a=document.createElement("div");return a.classList.add("tab-panel-col",`${t}-${e}`),a}}class mo{constructor(e){const{title:t,variant:a,autoShow:i=!0,canClose:s=!0,body:n,additionalClasses:o,container:l,...r}=e||{};this.container=l||document.getElementById("toastContainer"),this.additionalClasses=o,this.title=t||"WowSims",this.variant=a||"info",this.body=n,this.canClose=s,this.element=this.template(),this.container.appendChild(this.element),this.instance=Jn.getOrCreateInstance(this.element,{delay:3e3,...r}),i&&this.instance.show(),this.element.addEventListener("hidden.bs.toast",(()=>{this.destroy()}))}destroy(){this.instance.dispose(),this.element.remove()}show(){this.instance.show()}hide(){this.instance.hide()}getVariantIcon(){switch(this.variant){case"info":return"fa-info-circle";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";case"warning":return"fa-triangle-exclamation"}}template(){return t("div",{className:u("toast position-relative bottom-0 end-0",`toast--${this.variant}`,this.additionalClasses),attributes:{role:"alert","aria-live":"assertive","aria-atomic":"true"}},t("div",{className:"toast-header"},t("i",{className:u("d-block fas fa-2xl me-2",this.getVariantIcon())}),t("strong",{className:"me-auto"},this.title),this.canClose&&t("button",{className:"btn-close",attributes:{"aria-label":"Close"},dataset:{bsDismiss:"toast"},"aria-label":"Close"},t("i",{className:u("fas fa-times fa-1xl",this.getVariantIcon())}))),t("div",{className:"toast-body"},this.body))}}class po extends e{constructor(e,t,a){super(e,"content-block",a.rootElem),this.config=a,this.rootElem.classList.add(t),a.extraCssClasses&&this.rootElem.classList.add(...a.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),a.bodyClasses?.forEach((e=>{this.bodyElement.classList.add(e)}))}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){const e=this.config.header.titleTag||"h6",i=a(),s=t("div",{className:"content-block-header"},t(e,{ref:i,className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&s.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&Kn(i.value,{content:this.config.header.tooltip}),this.rootElem.appendChild(s),s}return null}buildBody(){const e=t("div",{className:"content-block-body"});return this.rootElem.appendChild(e),e}}const uo=()=>t("p",{className:"mb-0"},"Want to help out by providing additional information? Contact us on our Discord!"),go=t("p",{className:"mb-0"},"Please select a random suffix"),fo=t(r,null,t("p",null,"This item ",t("span",{className:"fw-bold"},"is")," implemented, but detailed proc behavior will be confirmed on PTR."),t(uo,null)),wo=t(r,null,"The equip/use effect on this item will not be implemented!"),yo=new Map([...[68983,69149,77981,77209,78001,77976,77199,77996,78485,77196,78476].map((e=>[e,{[f.SpecUnknown]:wo}])),...[72900,72897,72901,72899].map((e=>[e,{[f.SpecUnknown]:fo}]))]),bo=new Map([[2,"Not yet implemented"],[4,"Not yet implemented"]]),vo=new Map([[928,null],[933,null],[935,null],[938,null],[1004,null],[1009,null],[1011,null],[1014,null],[1056,null],[1060,null],[1066,null],[1069,new Map([[2,"Not implemented"]])]]);let So=null;async function Io(e){return(await(null==So&&(So=fetch("/mop/assets/enchants/descriptions.json").then((e=>e.json())).then((e=>{const t={};for(const a in e)t[parseInt(a)]=e[a];return t}))),So))[e.effectId]||e.name}function Eo(e){return e.effectId+"-"+e.type}class ko extends e{constructor(e,t){super(null,"item-notice"),this.tooltip=null,this.rootElem.classList.add("d-inline"),this.itemId=t.itemId,this.player=e,this.additionalNoticeData=t.additionalNoticeData,this.hasNotice&&this.template&&this.rootElem.appendChild(this.template),this.addOnDisposeCallback((()=>{this.tooltip?.destroy(),this.rootElem?.remove()}))}get hasNotice(){return yo.has(this.itemId)||!!this.additionalNoticeData}get noticeContent(){if(!this.hasNotice)return null;const e=yo.get(this.itemId),a=e?.[f.SpecUnknown],i=e?.[this.player.getSpec()],s=[];return i?s.push(i?.cloneNode(!0)):a&&s.push(a?.cloneNode(!0)),this.additionalNoticeData&&s.push(this.additionalNoticeData.cloneNode(!0)),s.length?t(r,null,s.map((e=>e))):null}get template(){if(!this.hasNotice)return null;const e=this.noticeContent;if(!e)return null;const i=a(),s=t("button",{ref:i,className:"warning fa fa-exclamation-triangle fa-xl me-2"});return this.tooltip=Kn(i.value,{content:e}),s}static registerSetBonusNotices(e){vo.forEach(((a,i)=>{const s=a||bo,n=t(r,null,t("p",{className:"mb-1"}," This item set has the following warnings:"),t("ul",{className:"mb-0"},Array.from(s.keys()).map((e=>t("li",null,e.toFixed(0),"-piece: ",s.get(e))))));for(const t of e.getItemIdsForSet(i))yo.set(t,{[f.SpecUnknown]:n})}))}}class Co{constructor(e){this.tooltip=null,this.config=e,this.item=e.item,this.attachTooltip()}attachTooltip(){const e={trigger:"mouseenter",triggerTarget:this.config.tippyElement,interactive:!0,interactiveBorder:10,offset:[0,5],animation:!1,placement:"bottom",theme:"tooltip-quick-swap",content:()=>this.buildList(),onCreate:e=>{e.popper.addEventListener("click",(()=>e.hide()))},onShow:e=>{Zn({exclude:e})},...this.config.tippyConfig};this.tooltip=Kn(this.config.tippyElement,e)}update(e){this.config={...this.config,...e},e.item&&(this.item=e.item),this.tooltip?.setContent(this.buildList())}buildList(){return _o(this.config)}}const _o=e=>{const i=e.getItems(e.item);return t(r,null,t("h3",{className:"tooltip-quick-swap__title h6 text-center"},e.title),i.length?t("ul",{className:"tooltip-quick-swap__list"},i.map((i=>{const s=a(),n=a(),o=a(),l=t("li",{className:"tooltip-quick-swap__list-item"},t("a",{ref:s,href:"javascript:void(0)",className:"tooltip-quick-swap__anchor d-flex align-items-center "+(i.active?" active":""),onclick:t=>{t?.preventDefault(),e.onItemClick(i.item)}},t("img",{ref:n,alt:i.item.name,className:"tooltip-quick-swap__icon gem-icon flex-shrink-0"}),t("span",{ref:o,className:"tooltip-quick-swap__label text-start"},i.item.name)));return o.value&&io(o.value,i.item.quality),("spellId"in i.item?d.fromSpellId(i.item.spellId):d.fromItemId(i.item.id)).fill().then((e=>{e.setWowheadHref(s.value),n.value.src=e.iconUrl})),l}))):t("p",{className:"tooltip-quick-swap__empty"},e.emptyMessage),e.footerButton&&t("div",{className:"tooltip-quick-swap__footer d-flex justify-content-center"},t("button",{onclick:e.footerButton.onClick,className:"btn btn-sm btn-primary"},e.footerButton.label)))},xo={[w.ItemSlotHead]:"/mop/assets/item_slots/head.jpg",[w.ItemSlotNeck]:"/mop/assets/item_slots/neck.jpg",[w.ItemSlotShoulder]:"/mop/assets/item_slots/shoulders.jpg",[w.ItemSlotBack]:"/mop/assets/item_slots/shirt.jpg",[w.ItemSlotChest]:"/mop/assets/item_slots/chest.jpg",[w.ItemSlotWrist]:"/mop/assets/item_slots/wrists.jpg",[w.ItemSlotHands]:"/mop/assets/item_slots/hands.jpg",[w.ItemSlotWaist]:"/mop/assets/item_slots/waist.jpg",[w.ItemSlotLegs]:"/mop/assets/item_slots/legs.jpg",[w.ItemSlotFeet]:"/mop/assets/item_slots/feet.jpg",[w.ItemSlotFinger1]:"/mop/assets/item_slots/finger.jpg",[w.ItemSlotFinger2]:"/mop/assets/item_slots/finger.jpg",[w.ItemSlotTrinket1]:"/mop/assets/item_slots/trinket.jpg",[w.ItemSlotTrinket2]:"/mop/assets/item_slots/trinket.jpg",[w.ItemSlotMainHand]:"/mop/assets/item_slots/mainhand.jpg",[w.ItemSlotOffHand]:"/mop/assets/item_slots/offhand.jpg"};function To(e){return xo[e]}const Po=()=>t("span",{className:"heroic-label"},"[H]"),Ro=(e,i,s)=>{const n=a(),o=a(),l=t("a",{ref:o,className:"gem-socket-container",href:"javascript:void(0)",dataset:{socketIdx:s}},t("img",{ref:n,className:"gem-icon "+(i?"":"hide")}),t("img",{className:"socket-icon",src:y(e)}));return i&&d.fromItemId(i.id).fill().then((e=>{e.setWowheadHref(o.value),n.value.src=e.iconUrl})),l};class Do extends e{constructor(e,i,s){super(e,"gear-picker-root");const n=a(),o=a();this.rootElem.appendChild(t(r,null,t("div",{ref:n,className:"gear-picker-left tab-panel-col"}),t("div",{ref:o,className:"gear-picker-right tab-panel-col"})));const l=[w.ItemSlotHead,w.ItemSlotNeck,w.ItemSlotShoulder,w.ItemSlotBack,w.ItemSlotChest,w.ItemSlotWrist,w.ItemSlotMainHand,w.ItemSlotOffHand].map((e=>new Go(n.value,this,i,s,e))),c=[w.ItemSlotHands,w.ItemSlotWaist,w.ItemSlotLegs,w.ItemSlotFeet,w.ItemSlotFinger1,w.ItemSlotFinger2,w.ItemSlotTrinket1,w.ItemSlotTrinket2].map((e=>new Go(o.value,this,i,s,e)));this.itemPickers=l.concat(c).sort(((e,t)=>e.slot-t.slot)),this.selectorModal=new Tu(i.rootElem,i,s,this,{id:"gear-picker-selector-modal"})}}class No extends e{constructor(e,i,s){super(e,"item-picker-root",i),this.notice=null,this.socketsElem=[],this.player=s;const n=a(),o=a(),l=a(),c=a(),h=a(),m=a(),d=a();this.rootElem.appendChild(t(r,null,t("div",{className:"item-picker-icon-wrapper"},t("span",{className:"item-picker-ilvl",ref:c}),t("a",{ref:n,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}}),t("div",{ref:d,className:"item-picker-sockets-container"})),t("div",{className:"item-picker-labels-container"},t("div",{ref:o,className:"item-picker-name-row d-flex gap-1"},t("a",{ref:l,className:"item-picker-name-container",href:"javascript:void(0)",attributes:{role:"button"}})),t("a",{ref:h,className:"item-picker-enchant hide",href:"javascript:void(0)",attributes:{role:"button"}}),t("a",{ref:m,className:"item-picker-reforge hide",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=n.value,this.nameContainerElem=o.value,this.nameElem=l.value,this.ilvlElem=c.value,this.reforgeElem=m.value,this.enchantElem=h.value,this.socketsContainerElem=d.value}clear(e){this.abortController?.abort(),this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.notice?.dispose(),this.notice=null,this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.enchantElem.classList.add("hide"),this.reforgeElem.classList.add("hide"),this.iconElem.style.backgroundImage=`url('${To(e)}')`,this.enchantElem.replaceChildren(),this.reforgeElem.replaceChildren(),this.socketsContainerElem.replaceChildren(),this.nameElem.replaceChildren(),this.ilvlElem.replaceChildren(),this.socketsElem=[]}update(e){this.abortController=new AbortController,this.signal=this.abortController.signal;const a=t("span",{className:"item-picker-name"},e.item.name),i=!!e.hasRandomSuffixOptions(),s=!!e.randomSuffix;this.nameElem.replaceChildren(a),this.ilvlElem.replaceChildren(t(r,null,e.ilvl.toString(),!(e.upgrade===b.ChallengeMode||!e.ilvlFromBase)&&t("span",{className:"item-quality-uncommon"},"+",e.ilvlFromBase))),s&&(a.textContent+=" "+e.randomSuffix.name),e.item.heroic&&this.nameElem.appendChild(Po()),this.notice=new ko(this.player,{itemId:e.item.id,additionalNoticeData:i&&!s?go:void 0}),this.notice.hasNotice&&this.nameContainerElem.appendChild(this.notice.rootElem);const n=e.getReforgeData();if(n){const e=v.get(n.reforge?.fromStat),t=v.get(n.reforge?.toStat);this.reforgeElem.innerText=`Reforged ${Math.abs(n.fromAmount)} ${e} → ${n.toAmount} ${t}`,this.reforgeElem.classList.remove("hide")}else this.reforgeElem.innerText="",this.reforgeElem.classList.add("hide");io(this.nameElem,e.item.quality),this.player.setWowheadData(e,this.iconElem),this.player.setWowheadData(e,this.nameElem),e.asActionId().fill(void 0,{signal:this.signal}).then((e=>{this.signal?.aborted||(e.setBackgroundAndHref(this.iconElem),e.setWowheadHref(this.nameElem))})),e.enchant?(Io(e.enchant).then((e=>{this.enchantElem.textContent=e})),e.enchant.spellId?(this.enchantElem.href=d.makeSpellUrl(e.enchant.spellId),d.makeSpellTooltipData(e.enchant.spellId).then((e=>{this.enchantElem.dataset.wowhead=e}))):(this.enchantElem.href=d.makeItemUrl(e.enchant.itemId),d.makeItemTooltipData(e.enchant.itemId).then((e=>{this.enchantElem.dataset.wowhead=e}))),this.enchantElem.dataset.whtticon="false",this.enchantElem.classList.remove("hide")):this.enchantElem.classList.add("hide"),e.allSocketColors().forEach(((t,a)=>{const i=Ro(t,e.gems[a],a);if(a===e.numPossibleSockets-1&&[S.ItemTypeWrist,S.ItemTypeHands].includes(e.item.type)){const e=()=>{i.classList[this.player.isBlacksmithing()?"remove":"add"]("hide")};this.player.professionChangeEmitter.on(e),e()}this.socketsElem.push(i),this.socketsContainerElem.appendChild(i)}))}}class Go extends e{constructor(e,t,a,i,s){super(e,"item-picker-root"),this.onUpdateCallbacks=[],this._equippedItem=null,this.quickSwapEnchantPopover=null,this.quickSwapGemPopover=[],this.gearPicker=t,this.simUI=a,this.player=i,this.slot=s,this.itemElem=new No(e,this.rootElem,i),this.item=i.getEquippedItem(s),i.sim.waitForInit().then((()=>{const e=e=>{e.preventDefault(),this.openSelectorModal(xu.Items)};this.itemElem.iconElem.addEventListener("click",e),this.itemElem.nameElem.addEventListener("click",e),this.itemElem.reforgeElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(xu.Reforging)})),this.addQuickEnchantHelpers()})),i.gearChangeEmitter.on((()=>{this.item=this.player.getEquippedItem(this.slot),this._equippedItem&&(this._equippedItem!==this.quickSwapEnchantPopover?.item&&this.quickSwapEnchantPopover?.update({item:this._equippedItem}),this.addQuickGemHelpers())})),i.sim.filtersChangeEmitter.on((()=>{this._equippedItem&&(this.quickSwapEnchantPopover?.update({item:this._equippedItem}),this.quickSwapGemPopover.forEach((e=>e.update({item:this._equippedItem}))))})),i.sim.showQuickSwapChangeEmitter.on((()=>{this.quickSwapEnchantPopover?.tooltip?.[this.player.sim.getShowQuickSwap()?"enable":"disable"](),this.quickSwapGemPopover.forEach((e=>e.tooltip?.[this.player.sim.getShowQuickSwap()?"enable":"disable"]()))})),i.professionChangeEmitter.on((()=>{this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)}))}createGearData(){return{equipItem:(e,t)=>{this.player.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.getEquippedItem(this.slot)?.withChallengeMode(this.player.getChallengeModeEnabled()).withDynamicStats()||null,changeEvent:this.player.gearChangeEmitter}}get item(){return this._equippedItem}set item(e){this.itemElem.clear(this.slot),this.quickSwapGemPopover=[],this.itemElem.nameElem.textContent=I.get(this.slot)??"",io(this.itemElem.nameElem,null),e&&this.itemElem.update(e),this._equippedItem=e,this.onUpdateCallbacks.forEach((e=>e()))}onUpdate(e){this.onUpdateCallbacks.push(e)}openSelectorModal(e){this.gearPicker.selectorModal.openTab(this.slot,e,this.createGearData())}addQuickGemHelpers(){if(!this._equippedItem)return;const e=e=>this.openSelectorModal(`Gem${e+1}`);this.itemElem.socketsElem?.forEach((t=>{const a=Number(t.dataset.socketIdx)||0;t.addEventListener("click",(t=>{t.preventDefault(),e(0)}));const i=((e,t,a,i,s,n)=>new Co({title:"Favorite gems",emptyMessage:"Add favorite gems.",tippyElement:t,tippyConfig:{appendTo:document.querySelector(".sim-ui")},item:a,getItems:t=>{const a=e.sim.getFilters().favoriteGems,i=t.curSocketColors(e.isBlacksmithing())[s];return e.getGems(i).filter((e=>a.includes(e.id))).sort(((e,t)=>e.color>t.color?1:-1)).map((e=>({item:e,active:t.gems[s]?.id===e.id})))},onItemClick:t=>{e.equipItem(o.nextEventID(),i,a.withGem(t,s))},footerButton:{label:"Open Gems",onClick:n}}))(this.player,t,this._equippedItem,this.slot,a,(()=>e(a)));this.player.sim.getShowQuickSwap()||i.tooltip?.disable(),this.quickSwapGemPopover.push(i)}))}addQuickEnchantHelpers(){if(!this._equippedItem)return;const e=()=>this.openSelectorModal(xu.Enchants);var t,a,i,s,n;this.itemElem.enchantElem.addEventListener("click",(t=>{t?.preventDefault(),e()})),this.quickSwapEnchantPopover=(t=this.player,a=this.itemElem.enchantElem,i=this._equippedItem,s=this.slot,n=e,new Co({title:"Favorite Enchants",emptyMessage:"Add favorite Enchants",tippyElement:a,tippyConfig:{appendTo:document.querySelector(".sim-ui")},item:i,getItems:e=>{const a=t.sim.db.getEnchants(s),i=t.sim.getFilters().favoriteEnchants,n=i?.map((e=>{const[t,i]=e.split("-").map(Number);return a.find((e=>e.effectId===t&&e.type===i))})).filter((e=>!!e));return n.map((t=>({item:t,active:e.enchant?.effectId===t.effectId})))},onItemClick:e=>{t.equipItem(o.nextEventID(),s,i.withEnchant(e))},footerButton:{label:"Open Enchants",onClick:n}})),this.player.sim.getShowQuickSwap()||this.quickSwapEnchantPopover.tooltip?.disable()}}class Uo extends e{constructor(e,t,a,i,s,n){super(e,"bulk-item-picker"),this.simUI=t,this.bulkUI=a,this.bulkSlot=s,this.index=n,this.item=i,this.itemElem=new No(e,this.rootElem,t.player),this.abortController=new AbortController,this.signal=this.abortController.signal,this.isEditable()||(this.rootElem.classList.add("bulk-item-picker-equipped"),e.insertAdjacentElement("afterbegin",this.rootElem)),this.addActions(),this.simUI.sim.waitForInit().then((()=>this.setItem(i))),this.addOnDisposeCallback((()=>this.rootElem.remove()))}setItem(e){this.itemElem.clear(w.ItemSlotHead),this.itemElem.update(e),this.item=e,this.setupHandlers()}isEditable(){return this.index>=0}setupHandlers(){const e=E(this.item.item)[0],t=!!this.simUI.sim.db.getEnchants(e).length,a=this.item?.item?this.simUI.player.getAvailableReforgings(this.item):[],i=t=>{t.preventDefault(),this.isEditable()&&this.bulkUI.selectorModal.openTab(e,xu.Items,this.createGearData())},s=(t,a)=>{if(t.preventDefault(),!this.isEditable())return;let i=xu.Gem1;1===a&&(i=xu.Gem2),2===a&&(i=xu.Gem3),this.bulkUI.selectorModal.openTab(e,i,this.createGearData())};this.itemElem.iconElem.addEventListener("click",i,{signal:this.signal}),this.itemElem.nameElem.addEventListener("click",i,{signal:this.signal}),this.itemElem.enchantElem.addEventListener("click",(a=>{a.preventDefault(),this.isEditable()&&t&&this.bulkUI.selectorModal.openTab(e,xu.Enchants,this.createGearData())}),{signal:this.signal}),this.itemElem.reforgeElem.addEventListener("click",(t=>{t.preventDefault(),this.isEditable()&&a.length&&this.bulkUI.selectorModal.openTab(e,xu.Reforging,this.createGearData())}),{signal:this.signal}),this.itemElem.socketsElem.forEach(((e,t)=>e.addEventListener("click",(e=>s(e,t)),{signal:this.signal})))}createGearData(){const e=new o;return{equipItem:(t,a)=>{a&&(this.bulkUI.updateItem(this.index,a.asSpec()),e.emit(o.nextEventID()))},getEquippedItem:()=>this.item,changeEvent:e}}addActions(){const e=a(),i=a();this.itemElem.rootElem.appendChild(t("div",{className:"item-picker-actions-container"},t("button",{className:"btn btn-link item-picker-actions-btn",ref:e},t("i",{className:"fas fa-copy"})),this.isEditable()&&t("button",{className:"btn btn-link link-danger item-picker-actions-btn",ref:i},t("i",{className:"fas fa-times"}))));const s=e.value;Kn(s,{content:"Make an editable copy of this item."});const n=()=>this.bulkUI.addItemToSlot(this.item.asSpec(),this.bulkSlot);if(s.addEventListener("click",n),this.addOnDisposeCallback((()=>s.removeEventListener("click",n))),i.value){const e=i.value;Kn(e,{content:"Remove this item from the batch."});const t=()=>this.bulkUI.removeItemByIndex(this.index);e.addEventListener("click",t),this.addOnDisposeCallback((()=>e.removeEventListener("click",t)))}}}var Oo=(e=>(e[e.ItemSlotHead=0]="ItemSlotHead",e[e.ItemSlotNeck=1]="ItemSlotNeck",e[e.ItemSlotShoulder=2]="ItemSlotShoulder",e[e.ItemSlotBack=3]="ItemSlotBack",e[e.ItemSlotChest=4]="ItemSlotChest",e[e.ItemSlotWrist=5]="ItemSlotWrist",e[e.ItemSlotHands=6]="ItemSlotHands",e[e.ItemSlotWaist=7]="ItemSlotWaist",e[e.ItemSlotLegs=8]="ItemSlotLegs",e[e.ItemSlotFeet=9]="ItemSlotFeet",e[e.ItemSlotFinger=10]="ItemSlotFinger",e[e.ItemSlotTrinket=11]="ItemSlotTrinket",e[e.ItemSlotMainHand=12]="ItemSlotMainHand",e[e.ItemSlotOffHand=13]="ItemSlotOffHand",e[e.ItemSlotHandWeapon=14]="ItemSlotHandWeapon",e))(Oo||{});const Ao=new Map([[0,"Head"],[1,"Neck"],[2,"Shoulders"],[3,"Back"],[4,"Chest"],[5,"Wrist"],[6,"Hands"],[7,"Waist"],[8,"Legs"],[9,"Feet"],[10,"Rings"],[11,"Trinkets"],[12,"Main Hand"],[13,"Off Hand"],[14,"Weapons"]]),Lo=new Map([[w.ItemSlotHead,0],[w.ItemSlotNeck,1],[w.ItemSlotShoulder,2],[w.ItemSlotBack,3],[w.ItemSlotChest,4],[w.ItemSlotWrist,5],[w.ItemSlotHands,6],[w.ItemSlotWaist,7],[w.ItemSlotLegs,8],[w.ItemSlotFeet,9],[w.ItemSlotFinger1,10],[w.ItemSlotFinger2,10],[w.ItemSlotTrinket1,11],[w.ItemSlotTrinket2,11],[w.ItemSlotMainHand,12],[w.ItemSlotOffHand,13]]),Vo=(e,t)=>t&&[w.ItemSlotMainHand,w.ItemSlotOffHand].includes(e)?14:Lo.get(e);class Fo extends po{constructor(e,t,a,i){const s=Ao.get(i);super(e,"bulk-item-picker-group-root",{header:{title:s}}),this.pickers=new Map,this.rootElem.classList.add(`gear-group-${s.split(" ").join("-")}`),this.simUI=t,this.bulkUI=a,this.bulkSlot=i,this.addEmptyElement()}has(e){return!!this.pickers.get(e)}add(e,t){if(this.pickers.size||this.bodyElement.replaceChildren(),this.pickers.has(e)){this.pickers.get(e).dispose(),this.pickers.delete(e)}this.pickers.set(e,new Uo(this.bodyElement,this.simUI,this.bulkUI,t,this.bulkSlot,e))}update(e,t){const a=this.pickers.get(e);a?a.setItem(t):new mo({variant:"error",body:"Failed to update item, please report this issue."})}remove(e){const t=this.pickers.get(e);t?(t.dispose(),this.pickers.delete(e),this.pickers.size||this.addEmptyElement()):new mo({variant:"error",body:"Failed to remove item, please report this issue."})}addEmptyElement(){this.bodyElement.appendChild(t("span",null,"No items selected."))}}class Mo extends po{constructor(e,i,s){super(e,"bulk-item-search-root",{header:{title:"Item Search"}}),this.filtersChangeEmitter=new o,this.allItems=[],this._searchString="",this.minIlvl=0,this.maxIlvl=0,this.simUI=i,this.bulkUI=s,this.abortController=new AbortController,this.signal=this.abortController.signal;const n=a(),l=a(),r=a(),c=a(),h=a();this.bodyElement.appendChild(t("div",{className:"bulk-gear-search-container",ref:n},t("div",{className:"d-flex flex-column"},t("label",{className:"form-label",htmlFor:"bulkGearSearch"},"Name"),t("div",{className:"input-group"},t("input",{id:"bulkGearSearch",className:"form-control",type:"text",placeholder:"Search...",ref:l}),t("button",{className:"btn btn-link cancel-bulk-gear-search-btn hide",ref:r,type:"button"},t("i",{className:"fas fa-times"}))),t("ul",{ref:c,className:"bulk-gear-search-results dropdown-menu no-hover"})),t("div",{className:"bulk-gear-search-ilvl-filters",ref:h}))),this.inputElem=l.value,this.cancelSearchElem=r.value,this.searchResultElem=c.value,Kn(this.cancelSearchElem,{content:"Clear search"}),this.cancelSearchElem.addEventListener("click",(()=>{this.searchString=""})),new so(h.value,this,{id:"bulkGearSearchMinIlvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>this.filtersChangeEmitter,getValue:e=>this.minIlvl,setValue:(e,t,a)=>{this.minIlvl=a,this.filtersChangeEmitter.emit(e)}}),h.value.appendChild(t("span",{className:"ilvl-filters-separator"},"-")),new so(h.value,this,{id:"bulkGearSearchMaxIlvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>this.filtersChangeEmitter,getValue:e=>this.maxIlvl,setValue:(e,t,a)=>{this.maxIlvl=a,this.filtersChangeEmitter.emit(e)}}),this.simUI.sim.waitForInit().then((()=>{this.allItems=this.simUI.sim.db.getAllItems().filter((e=>k(e,this.simUI.player.getPlayerSpec(),void 0))).sort(((e,t)=>{const a=e.scalingOptions?.[b.Base].ilvl||e.ilvl,i=t.scalingOptions?.[b.Base].ilvl||t.ilvl;return a<i?1:i<a?-1:0})),this.filtersChangeEmitter.on((()=>{this.performSearch()})),l.value.addEventListener("input",(()=>{this.searchString=l.value.value}))}))}get searchString(){return this._searchString}set searchString(e){this._searchString=e,this.inputElem.value=e,this.filtersChangeEmitter.emit(o.nextEventID())}performSearch(){if(!this.searchString.length)return this.cancelSearchElem.classList.add("hide"),void this.searchResultElem.classList.remove("show");const e=this.searchString.split(" "),i=t(r,null);let s=0;this.allItems.forEach((n=>{const o=n.scalingOptions?.[b.Base].ilvl||n.ilvl;if(0!=this.maxIlvl&&this.maxIlvl<o)return!1;if(0!=this.minIlvl&&this.minIlvl>o)return!1;let l=!0;const c=n.name.toLowerCase(),h=n.setName.toLowerCase();if(e.forEach((e=>{const t=e.toLowerCase();return!(!c.includes(t)&&!h.includes(t))||(l=!1,!1)})),l&&s++,l&&s<=21){const e=a(),s=a(),l=a();i.appendChild(t("li",null,t("a",{className:"dropdown-item bulk-item-search-item",dataset:{itemId:n.id.toString()},ref:e,target:"_blank"},t("div",{className:"bulk-item-search-item-icon-wrapper"},t("span",{className:"item-picker-ilvl"},o),t("div",{className:"bulk-item-search-item-icon",ref:s})),t("div",{className:"d-flex flex-column ps-2"},t("div",{className:"d-flex"},t("span",{ref:l},n.name),n.heroic&&Po(),n.factionRestriction===C.HORDE_ONLY&&t("span",{className:"faction-horde"},"(H)"),n.factionRestriction===C.ALLIANCE_ONLY&&t("span",{className:"faction-alliance"},"(A)")),t("small",null,Ao.get(Lo.get(E(n)[0]))))))),d.fromItem(n).fill().then((t=>{t.setBackground(s.value),t.setWowheadHref(e.value)})),io(l.value,n.quality),e.value.addEventListener("click",(e=>{e.preventDefault(),this.bulkUI.addItem(_.create({id:n.id})),new mo({delay:1e3,variant:"success",body:t(r,null,t("strong",null,n.name)," was added to the batch.")})}),{signal:this.signal})}})),this.searchResultElem.replaceChildren(t(r,null,i,s>21&&t("li",{className:"bulk-item-search-item bulk-item-search-results-note"},"Showing ",21," of ",s," total results."),0===s&&t("li",{className:"bulk-item-search-item bulk-item-search-results-note"},"No results found."))),this.searchResultElem.classList.add("show"),this.cancelSearchElem.classList.remove("hide")}}class Wo extends e{constructor(e,i,s,n,l){super(e,"bulk-sim-result-root"),this.simUI=i,s.simTalents||this.rootElem.classList.add("bulk-sim-result-no-talents");const c=n.unitMetrics.dps.avg-l.unitMetrics.dps.avg,h=a(),m=a(),d=a();if(this.rootElem.appendChild(t(r,null,t("div",{className:"results-sim"},t("div",{className:"results-sim-dps damage-metrics"},t("span",{className:"topline-result-avg"},this.formatDps(n.unitMetrics.dps.avg)),t("div",{className:"results-reference"},t("span",{ref:m,className:u("results-reference-diff",c>=0?"positive":"negative")})))),t("div",{ref:d,className:"bulk-gear-combo"}),s.simTalents&&t("div",{className:"bulk-talent-loadout"},t("span",null,n.talentLoadout&&"object"==typeof n.talentLoadout?`Talents: ${n.talentLoadout.name}`:"Current Talents")),t("div",{className:"bulk-results-actions"},t("button",{ref:h,className:u("btn btn-primary bulk-equip-btn",!n.itemsAdded?.length&&"d-none")},"Equip")))),x(m.value,l.unitMetrics.dps.avg,n.unitMetrics.dps.avg,2,void 0,void 0,!0),n.itemsAdded?.length){h.value?.addEventListener("click",(()=>{n.itemsAdded.forEach((e=>{if(e.item){const t=i.sim.db.lookupItemSpec(e.item);i.player.equipItem(o.nextEventID(),e.slot,t),i.simHeader.activateTab("gear-tab")}})),new mo({variant:"success",body:"Batch gear equipped!"})}));const e=t(r,null);for(const a of n.itemsAdded){const s=t("div",{className:"bulk-result-item"}),n=new No(e,s,i.player);if(a.item&&0!=a.item.id){const e=i.sim.db.lookupItemSpec(a.item);n.update(e)}else n.clear(a.slot);e.appendChild(s)}d.value.appendChild(e)}else n.talentLoadout&&"object"==typeof n.talentLoadout||(m.value?.classList.add("hide"),d.value.appendChild(t("p",{className:"mb-0"},"Current Gear")))}formatDps(e){return(Math.round(100*e)/100).toFixed(2)}}class zo extends to{constructor(e,i,s,n,o){super(e,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.simUI=i,this.onSelect=n,this.onRemove=o,this.socketColor=s,this.ilist=null,window.scrollTo({top:0}),this.header.insertAdjacentElement("afterbegin",t("h6",{className:"selector-modal-title mb-3"},"Choose Default Gem"));const l=a();this.body.appendChild(t("div",{ref:l,className:"tab-content selector-modal-tab-content"})),this.contentElem=l.value}show(){if(!this.ilist){this.ilist=new _u("bulk-tab-gem-selector",this.contentElem,this.simUI,w.ItemSlotHead,xu.Gem1,this.simUI.player,xu.Gem1,{equipItem:(e,t)=>{},getEquippedItem:()=>null,changeEvent:new o},this.simUI.player.getGems(this.socketColor).map((e=>({item:e,id:e.id,actionId:d.fromItemId(e.id),name:e.name,quality:e.quality,phase:e.phase,heroic:!1,baseEP:this.simUI.player.computeStatsEP(new h(e.stats)),ignoreEPFilter:!0,onEquip:T}))),this.socketColor,(e=>this.simUI.player.computeGemEP(e)),(()=>null),this.onRemove,this.onSelect),this.ilist.sizeRefresh();const e=()=>this.ilist?.applyFilters(),t=this.simUI.sim.phaseChangeEmitter.on(e),a=this.simUI.sim.filtersChangeEmitter.on(e);this.addOnDisposeCallback((()=>{t.dispose(),a.dispose(),this.ilist?.dispose()}))}this.open()}}var jo=(e=>(e[e.Gear=0]="Gear",e[e.Talents=1]="Talents",e[e.Rotation=2]="Rotation",e[e.Consumes=3]="Consumes",e[e.Miscellaneous=4]="Miscellaneous",e[e.External=5]="External",e[e.Encounter=6]="Encounter",e[e.UISettings=7]="UISettings",e))(jo||{});const Bo=(()=>{const e=new Map;return e.set(0,"g"),e.set(1,"t"),e.set(2,"r"),e.set(3,"c"),e.set(4,"m"),e.set(5,"x"),e.set(6,"e"),e.set(7,"u"),e})();class Ho extends to{constructor(e,i){super(e,"importer",{title:i.title,footer:!0,disposeOnClose:!1}),this.allowFileUpload=i.allowFileUpload||!1;const s="upload-input-"+i.title.toLowerCase().replaceAll(" ","-"),n=a(),o=a(),l=a(),c=a();this.body.replaceChildren(t(r,null,t("div",{ref:n,className:"import-description"}),t("textarea",{ref:o,className:"importer-textarea form-control",attributes:{spellcheck:!1}}))),this.footer.appendChild(t(r,null,this.allowFileUpload&&t(r,null,t("label",{htmlFor:s,className:"importer-button btn btn-primary upload-button me-2"},t("i",{className:"fas fa-file-arrow-up me-1"}),"Upload File"),t("input",{ref:c,type:"file",id:s,className:"importer-upload-input d-none",hidden:!0})),t("button",{ref:l,className:"importer-button btn btn-primary import-button"},t("i",{className:"fa fa-download me-1"}),"Import"))),this.descriptionElem=n.value,this.textElem=o.value,this.allowFileUpload&&c.value&&c.value.addEventListener("change",(async e=>{this.textElem.textContent=await e.target.files[0].text()})),this.importButton=l.value,this.importButton.addEventListener("click",(async e=>{try{await this.onImport(this.textElem.value||"")}catch(t){new mo({variant:"error",body:`Import error: ${t?.message||t}`})}}))}}const qo=class extends Ho{constructor(e,t,a){super(e,a),this.simUI=t}async finishIndividualImport(e,t,a,i,s,n,l){if(t!=e.player.getClass())throw new Error(`Wrong Class! Expected ${e.player.getPlayerClass().friendlyName} but found ${R.get(t)}!`);await D.loadLeftoversIfNecessary(i);const r=e.sim.db.lookupEquipmentSpec(i),c=i.items.map((e=>e.enchant)),h=r.asSpec().items.map((e=>e.enchant)),m=c.filter((e=>0!=e&&!h.includes(e))),d=i.items.map((e=>e.id)),p=r.asSpec().items.map((e=>e.id)),u=d.filter((e=>!p.includes(e))),g=o.nextEventID();o.freezeAllAndDo((()=>{e.player.setRace(g,a),e.player.setGear(g,r),s&&"--"!=s&&e.player.setTalentsString(g,s),n&&e.player.setGlyphs(g,n),l.length>0&&e.player.setProfessions(g,l)})),this.close(),0==u.length&&0==m.length?new mo({variant:"success",body:"Import successful!"}):new mo({variant:"info",body:"Import successful, but the following IDs were not found in the sim database:"+(0==u.length?"":"\n\nItems: "+u.join(", "))+(0==m.length?"":"\n\nEnchants: "+m.join(", "))})}};qo.DEFAULT_CATEGORIES=P(jo).filter((e=>e!=jo.UISettings)),qo.CATEGORY_PARAM="i";let Yo=qo;class Ko extends Yo{constructor(e,a,i){super(e,a,{title:"Bag Item Import",allowFileUpload:!0}),this.bulkUI=i,this.descriptionElem.appendChild(t(r,null,t("p",null,"Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn."),t("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){try{const t=N.fromJsonString(e,{ignoreUnknownFields:!0});if(t?.items?.length>0){const e=await D.loadLeftoversIfNecessary(t),a=t.items.filter((t=>t.id>0&&e.lookupItemSpec(t)));a.length>0&&this.bulkUI.addItems(a)}this.close()}catch(t){console.warn(t),alert(t.toString())}}}class $o extends e{constructor(e,i){const s=a();super(e,"copy-button",t("button",{className:`btn ${i.extraCssClasses?.join(" ")??""}`,ref:s},t("i",{className:"fas fa-copy me-1"}),i.text??"Copy to Clipboard")),this.config=i;const n=s.value;let o=!1;n.addEventListener("click",(()=>{if(o)return;const e=this.config.getContent();if(null==navigator.clipboard)alert(e);else{o=!0,navigator.clipboard.writeText(e);const t=n.innerHTML;n.innerHTML='<i class="fas fa-check me-1"></i>Copied',setTimeout((()=>{n.innerHTML=t,o=!1}),1500)}})),i.tooltip&&Kn(n,{content:i.tooltip})}}const Jo={id:0,name:"Empty",description:"",iconUrl:"https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg",quality:null,spellId:0};class Zo extends e{constructor(e,t,a){super(e,"glyphs-picker-root"),this.majorGlyphPickers=[],this.minorGlyphPickers=[],this.glyphsConfig=a,this.player=t;const i=Object.keys(a.majorGlyphs).map((e=>Number(e))),s=Object.keys(a.minorGlyphs).map((e=>Number(e))),n=new po(this.rootElem,"major-glyphs",{header:{title:"Major Glyphs",extraCssClasses:["border-0"]}}),o=new po(this.rootElem,"minor-glyphs",{header:{title:"Minor Glyphs",extraCssClasses:["border-0"]}});this.selectorModal=new Xo(this.rootElem.closest(".individual-sim-ui")),D.get().then((e=>{const a=i.map((t=>this.getGlyphData(t,e))),l=s.map((t=>this.getGlyphData(t,e)));a.sort(((e,t)=>G(e.name,t.name))),l.sort(((e,t)=>G(e.name,t.name))),this.majorGlyphPickers=["major1","major2","major3"].map((e=>new Qo(n.bodyElement,{label:"Major",player:t,selectorModal:this.selectorModal,glyphOptions:a,glyphField:e}))),this.minorGlyphPickers=["minor1","minor2","minor3"].map((e=>new Qo(o.bodyElement,{label:"Minor",player:t,selectorModal:this.selectorModal,glyphOptions:l,glyphField:e})))}))}getGlyphData(e,t){const a=this.glyphsConfig.majorGlyphs[e]||this.glyphsConfig.minorGlyphs[e];return{id:e,name:a.name,description:a.description,iconUrl:a.iconUrl,quality:i.ItemQualityCommon,spellId:t.glyphItemToSpellId(e)}}}class Qo extends s{constructor(e,{player:i,selectorModal:s,glyphOptions:n,glyphField:o}){super(e,"glyph-picker-root",i,{id:`glyph-picker-glyph-${o}`,inline:!0,changedEvent:e=>e.glyphsChangeEmitter,getValue:e=>e.getGlyphs()[o],setValue:(e,t,a)=>{const i=t.getGlyphs();i[o]=a,t.setGlyphs(e,i)}}),this.rootElem.classList.add("item-picker-root"),this.player=i,this.glyphOptions=n,this.selectedGlyph=Jo;const l=a(),r=a(),c=a();this.rootElem.appendChild(t("a",{ref:l,attributes:{role:"button"},className:"glyph-link"},t("img",{ref:r,className:"item-picker-icon"}),t("div",{className:"item-picker-labels-container"},t("span",{ref:c,className:"item-picker-name-container"})))),this.anchorElem=l.value,this.iconElem=r.value,this.nameElem=c.value,this.anchorElem.addEventListener("click",(e=>{e.preventDefault(),s.openTab(this,n)}),{signal:this.signal}),this.init()}getInputElem(){return this.iconElem}getInputValue(){return this.selectedGlyph?.id??0}setInputValue(e){this.selectedGlyph=this.glyphOptions.find((t=>t.id==e)),this.selectedGlyph?(this.selectedGlyph.spellId?(this.anchorElem.href=d.makeSpellUrl(this.selectedGlyph.spellId),d.makeSpellTooltipData(this.selectedGlyph.spellId).then((e=>{this.anchorElem.dataset.wowhead=e,this.anchorElem.dataset.whtticon="false"}))):(this.anchorElem.href=d.makeItemUrl(this.selectedGlyph.id),d.makeItemTooltipData(this.selectedGlyph.id).then((e=>{this.anchorElem.dataset.wowhead=e,this.anchorElem.dataset.whtticon="false"}))),this.iconElem.src=this.selectedGlyph.iconUrl,this.nameElem.textContent=this.selectedGlyph.name.replace(/Glyph of /,"")):this.clear()}clear(){this.anchorElem.removeAttribute("data-wowhead"),this.anchorElem.removeAttribute("href"),this.iconElem.src=Jo.iconUrl,this.nameElem.textContent=Jo.name}}class Xo extends to{constructor(e){super(e,"glyph-modal",{title:"Glyphs",disposeOnClose:!1}),this.listItems=[],this.glyphOptions=[],this.glyphPicker=null;const i=a(),s=a();this.body.appendChild(t(r,null,t("div",{className:"input-root"},t("input",{ref:s,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."})),t("ul",{ref:i,className:"selector-modal-list"}))),this.list=i.value,this.search=s.value,this.search.addEventListener("input",(()=>this.applyFilters()))}openTab(e,t){this.setData(e,t),this.applyFilters(),this.open()}setData(e,i){this.glyphPicker=e,this.list.innerHTML="",this.listItems=[],this.glyphOptions=[Jo,...i];const s=this.glyphOptions.map(((e,i)=>{const s=a(),n=a(),l=a(),r=t("li",{className:"selector-modal-list-item",dataset:{idx:String(i)}},t("a",{ref:s,className:"selector-modal-list-item-link"},t("img",{ref:n,className:"selector-modal-list-item-icon"}),t("label",{ref:l,className:"selector-modal-list-item-name"},e.name),t("span",{className:"selector-modal-list-item-description"},e.description)));return s.value&&(e.spellId?s.value.href=d.makeSpellUrl(e.spellId):s.value.href=d.makeItemUrl(e.id),s.value.addEventListener("click",(t=>{t.preventDefault(),this.glyphPicker?.setValue(o.nextEventID(),e.id)}))),n.value&&(n.value.src=e.iconUrl),l.value&&io(l.value,e.quality),r}));this.listItems=s,this.list.appendChild(t(r,null,this.listItems)),this.glyphPicker.player.glyphsChangeEmitter.on((()=>{this.applyFilters()}))}applyFilters(){if(!this.glyphPicker)return;const e=this.glyphPicker.selectedGlyph?.id??0;this.listItems.forEach((t=>{const a=parseInt(t.dataset.idx),i=this.glyphOptions[a];t.classList[i.id==e?"add":"remove"]("active")})),this.listItems.map((e=>{const t=parseInt(e.dataset.idx),a=this.glyphOptions[t];let i="remove";if(this.search.value.length>0){const e=this.search.value.toLowerCase().split(" "),t=a.name.toLowerCase();e.forEach((e=>{t.includes(e)||"remove"!==i||(i="add")}))}e.classList[i]("d-none")}))}}class el extends s{constructor(e,i,s){super(e,"talents-picker-root",i,{...s}),this.modObject=i,this.config=s;const n=a(),o=a(),l=a();this.rootElem.appendChild(t("div",{className:"talents-picker-inner",ref:n},t("div",{className:"talents-picker-header"},t("div",{className:"talents-picker-actions",ref:o})),t("div",{id:"talents",className:"talents-picker-list",ref:l})));const r=l.value;new $o(o.value,{extraCssClasses:["btn-sm","btn-outline-primary","copy-talents"],getContent:()=>i.getTalentsString(),text:"Copy",tooltip:"Copy talent string"}),this.tree=new tl(r,this.config.tree,this,s.playerSpec),this.tree.rows.forEach((e=>e.forEach((e=>e.setSelected(!1))))),this.isPlayer()&&new Zo(this.rootElem,this.modObject,xl[this.modObject.getClass()]),this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.tree.getTalentsString()}setInputValue(e){this.tree.setTalentsString(e)}isPlayer(){return!!this.modObject?.playerClass}}class tl extends e{constructor(e,i,s,n){super(e,"talent-tree-picker-root"),this.picker=s;const o=a();this.rows=i.talents.reduce(((e,t)=>(e[t.location.rowIdx]||(e[t.location.rowIdx]=[]),e[t.location.rowIdx][t.location.colIdx]=new al(null,t,this),e)),[]),this.rootElem.replaceChildren(t(r,null,t("div",{className:"talent-tree-header"},t("img",{src:this.getTreeIcon(n),className:"talent-tree-icon"}),t("span",{className:"talent-tree-title"},U.fromProto(n).friendlyName),t("button",{ref:o,className:"talent-tree-reset btn link-danger"},t("i",{className:"fa fa-times"}))),t("div",{className:"talent-tree-background",style:{backgroundImage:`url('${i.backgroundUrl}')`}}),t("div",{className:"talent-tree-main"},this.rows.map(((e,a)=>t("div",{className:"talent-tree-row"},t("div",{className:"talent-tree-level"},15*(a+1)),e.map((e=>e.rootElem))))))));const l=o.value;Kn(l,{content:"Reset talent points"}),l.addEventListener("click",(e=>this.resetPoints()))}getTalent(e){const t=this.rows[e.rowIdx].find((t=>t.getCol()==e.colIdx));if(!t)throw new Error("No talent found with location: "+e);return t}getTalentsString(){return Array.from(Array(6),((e,t)=>{const a=this.rows[t].find((e=>e.getRow()==t&&e.isSelected()));return a?a.getCol()+1:0})).join("")}setTalentsString(e){const t=e.split("").map(Number);this.rows.forEach(((e,a)=>e.forEach((e=>{e.setSelected(e.getCol()+1===t[a])}))))}resetPoints(){this.rows.forEach((e=>e.forEach((e=>e.setSelected(!1))))),this.picker.inputChanged(o.nextEventID())}getTreeIcon(e){return U.fromProto(e).getIcon("medium")}}class al extends e{constructor(e,i,s){super(e,"talent-picker-root",document.createElement("a")),this.config=i,this.tree=s,this.zIdx=0;const n=a();this.rootElem.replaceChildren(t(r,null,t("div",{ref:n,className:"talent-picker-icon"}),t("div",{className:"talent-picker-label",dataset:{whtticon:!1}},i.fancyName))),this.icon=n.value,this.rootElem.addEventListener("click",(e=>{e.preventDefault()})),this.rootElem.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.rootElem.addEventListener("touchmove",(e=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)})),this.rootElem.addEventListener("touchstart",(e=>{e.preventDefault(),this.longTouchTimer=window.setTimeout((()=>{this.setSelected(!1),this.tree.picker.inputChanged(o.nextEventID()),this.longTouchTimer=void 0}),750)})),this.rootElem.addEventListener("touchend",(e=>{e.preventDefault(),null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0,this.setSelected(!0),this.tree.picker.inputChanged(o.nextEventID()))})),this.rootElem.addEventListener("mousedown",(e=>{const t=!O(e);this.setSelected(t),this.tree.picker.inputChanged(o.nextEventID())}))}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(this.zIdx)}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}isSelected(){return"true"===this.rootElem.dataset.selected}setSelected(e){if(e){const e=this.tree.rows[this.getRow()].find((e=>e.getCol()!==this.getCol()&&e.isSelected()));e?.isSelected()&&e.setSelected(!1)}this.rootElem.dataset.selected=String(e),d.fromSpellId(this.config.spellId).fill().then((e=>{e.setWowheadHref(this.rootElem),this.icon.style.backgroundImage=`url('${e.iconUrl}')`}))}}function il(e){return e.talents.forEach(((t,a)=>{if(0!=a){const i=e.talents[a-1];if(t.location.rowIdx<i.location.rowIdx||t.location.rowIdx==i.location.rowIdx&&t.location.colIdx<=i.location.colIdx)throw new Error(`Out-of-order talent: ${String(t.fancyName)}`)}})),e}const sl=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"roilingBlood",fancyName:"Roiling Blood",location:{rowIdx:0,colIdx:0},spellId:108170},{fieldName:"plagueLeech",fancyName:"Plague Leech",location:{rowIdx:0,colIdx:1},spellId:123693},{fieldName:"unholyBlight",fancyName:"Unholy Blight",location:{rowIdx:0,colIdx:2},spellId:115989},{fieldName:"lichborne",fancyName:"Lichborne",location:{rowIdx:1,colIdx:0},spellId:49039},{fieldName:"antimagicZone",fancyName:"Anti-Magic Zone",location:{rowIdx:1,colIdx:1},spellId:51052},{fieldName:"purgatory",fancyName:"Purgatory",location:{rowIdx:1,colIdx:2},spellId:114556},{fieldName:"deathsAdvance",fancyName:"Death's Advance",location:{rowIdx:2,colIdx:0},spellId:96268},{fieldName:"chilblains",fancyName:"Chilblains",location:{rowIdx:2,colIdx:1},spellId:50041},{fieldName:"asphyxiate",fancyName:"Asphyxiate",location:{rowIdx:2,colIdx:2},spellId:108194},{fieldName:"deathPact",fancyName:"Death Pact",location:{rowIdx:3,colIdx:0},spellId:48743},{fieldName:"deathSiphon",fancyName:"Death Siphon",location:{rowIdx:3,colIdx:1},spellId:108196},{fieldName:"conversion",fancyName:"Conversion",location:{rowIdx:3,colIdx:2},spellId:119975},{fieldName:"bloodTap",fancyName:"Blood Tap",location:{rowIdx:4,colIdx:0},spellId:45529},{fieldName:"runicEmpowerment",fancyName:"Runic Empowerment",location:{rowIdx:4,colIdx:1},spellId:81229},{fieldName:"runicCorruption",fancyName:"Runic Corruption",location:{rowIdx:4,colIdx:2},spellId:51462},{fieldName:"gorefiendsGrasp",fancyName:"Gorefiend's Grasp",location:{rowIdx:5,colIdx:0},spellId:108199},{fieldName:"remorselessWinter",fancyName:"Remorseless Winter",location:{rowIdx:5,colIdx:1},spellId:108200},{fieldName:"desecratedGround",fancyName:"Desecrated Ground",location:{rowIdx:5,colIdx:2},spellId:108201}]}),nl={majorGlyphs:{[A.GlyphOfAntiMagicShell]:{name:"Glyph of Anti-Magic Shell",description:"Causes your Anti-Magic Shell to absorb all incoming magical damage, up to the absorption limit.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antimagicshell.jpg"},[A.GlyphOfUnholyFrenzy]:{name:"Glyph of Unholy Frenzy",description:"Causes your Unholy Frenzy to no longer deal damage to the affected target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unholyfrenzy.jpg"},[A.GlyphOfIceboundFortitude]:{name:"Glyph of Icebound Fortitude",description:"Reduces the cooldown of your Icebound Fortitude by 50%, but also reduces its duration by 75%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_iceboundfortitude.jpg"},[A.GlyphOfChainsOfIce]:{name:"Glyph of Chains of Ice",description:"Your Chains of Ice also causes 143 Frost damage, with additional damage depending on your attack power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg"},[A.GlyphOfDeathGrip]:{name:"Glyph of Death Grip",description:"Increases the range of your Death Grip ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_strangulate.jpg"},[A.GlyphOfDeathAndDecay]:{name:"Glyph of Death and Decay",description:"Your Death and Decay also reduces the movement speed of enemies within its radius by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathanddecay.jpg"},[A.GlyphOfShiftingPresences]:{name:"Glyph of Shifting Presences",description:"You retain 70% of your Runic Power when switching Presences.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_bloodpresence.jpg"},[A.GlyphOfIcyTouch]:{name:"Glyph of Icy Touch",description:"Your Icy Touch dispels one helpful Magic effect from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_icetouch.jpg"},[A.GlyphOfEnduringInfection]:{name:"Glyph of Enduring Infection",description:"Your diseases are undispellable, but their damage dealt is reduced by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_creature_disease_05.jpg"},[A.GlyphOfPestilence]:{name:"Glyph of Pestilence",description:"Increases the radius of your Pestilence effect by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_plaguecloud.jpg"},[A.GlyphOfMindFreeze]:{name:"Glyph of Mind Freeze",description:"Reduces the cooldown of your Mind Freeze ability by 1 sec, but also raises its cost by 10 Runic Power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_mindfreeze.jpg"},[A.GlyphOfStrangulate]:{name:"Glyph of Strangulate",description:"Increases the Silence duration of your Strangulate ability by 2 sec when used on a target who is casting a spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_soulleech_3.jpg"},[A.GlyphOfPillarOfFrost]:{name:"Glyph of Pillar of Frost",description:"Empowers your Pillar of Frost, making you immune to all effects that cause loss of control of your character, but also reduces your movement speed by 70% while the ability is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_pillaroffrost.jpg"},[A.GlyphOfVampiricBlood]:{name:"Glyph of Vampiric Blood",description:"Increases the bonus healing received while your Vampiric Blood is active by an additional 15%, but your Vampiric Blood no longer grants you health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"},[A.GlyphOfUnholyCommand]:{name:"Glyph of Unholy Command",description:"Immediately finishes the cooldown of your Death Grip upon dealing a killing blow to a target that grants experience or honor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_skull.jpg"},[A.GlyphOfOutbreak]:{name:"Glyph of Outbreak",description:"Your Outbreak spell no longer has a cooldown, but now costs 30 Runic Power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathvortex.jpg"},[A.GlyphOfDancingRuneWeapon]:{name:"Glyph of Dancing Rune Weapon",description:"Increases your threat generation by 100% while your Dancing Rune Weapon is active, but reduces its damage dealt by 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_sword_07.jpg"},[A.GlyphOfDarkSimulacrum]:{name:"Glyph of Dark Simulacrum",description:"Reduces the cooldown of Dark Simulacrum by 30 sec and increases its duration by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_consumemagic.jpg"},[A.GlyphOfDeathCoil]:{name:"Glyph of Death Coil",description:"Your Death Coil spell is now usable on all allies. When cast on a non-undead ally, Death Coil shrouds them with a protective barrier that absorbs up to 168 damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg"},[A.GlyphOfDarkSuccor]:{name:"Glyph of Dark Succor",description:"When you kill an enemy that yields experience or honor, while in Frost or Unholy Presence, your next Death Strike within 15s is free and will restore at least 20% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_butcher2.jpg"},[A.GlyphOfSwiftDeath]:{name:"Glyph of Swift Death",description:"The haste effect granted by Soul Reaper now also increases your movement speed by 30% for the duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_soulreaper.jpg"},[A.GlyphOfLoudHorn]:{name:"Glyph of Loud Horn",description:"Your Horn of Winter now generates an additional 10 Runic Power, but the cooldown is increased by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_horn_04.jpg"},[A.GlyphOfRegenerativeMagic]:{name:"Glyph of Regenerative Magic",description:"If Anti-Magic Shell expires after its full duration, the cooldown is reduced by up to 50%, based on the amount of damage absorbtion remaining.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antimagicshell.jpg"},[A.GlyphOfFesteringBlood]:{name:"Glyph of Festering Blood",description:"Blood Boil will now treat all targets as though they have Blood Plague or Frost Fever applied.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_yorsahj_bloodboil_green.jpg"}},minorGlyphs:{[L.GlyphOfTheGeist]:{name:"Glyph of the Geist",description:"Your Raise Dead spell summons a geist instead of a ghoul.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_animatedead.jpg"},[L.GlyphOfDeathsEmbrace]:{name:"Glyph of Death's Embrace",description:"Your Death Coil refunds 20 Runic Power when used to heal an allied minion, but will no longer trigger Blood Tap when used this way.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg"},[L.GlyphOfHornOfWinter]:{name:"Glyph of Horn of Winter",description:"When used outside of combat, your Horn of Winter ability causes a brief, localized snow flurry.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_horn_02.jpg"},[L.GlyphOfArmyOfTheDead]:{name:"Glyph of Army of the Dead",description:"The ghouls summoned by your Army of the Dead no longer taunt their target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_armyofthedead.jpg"},[L.GlyphOfFoulMenagerie]:{name:"Glyph of Foul Menagerie",description:"Causes your Army of the Dead spell to summon an assortment of undead minions.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_armyofthedead.jpg"},[L.GlyphOfPathOfFrost]:{name:"Glyph of Path of Frost",description:"Your Path of Frost ability allows you to fall from a greater distance without suffering damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_pathoffrost.jpg"},[L.GlyphOfResilientGrip]:{name:"Glyph of Resilient Grip",description:"When your Death Grip ability fails because its target is immune, its cooldown is reset.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/warlock_curse_shadow.jpg"},[L.GlyphOfDeathGate]:{name:"Glyph of Death Gate",description:"Reduces the cast time of your Death Gate spell by 60%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_teleportundercity.jpg"},[L.GlyphOfCorpseExplosion]:{name:"Glyph of Corpse Explosion",description:"Teaches you the ability Corpse Explosion.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_corpseexplode.jpg"},[L.GlyphOfTranquilGrip]:{name:"Glyph of Tranquil Grip",description:"Your Death Grip spell no longer taunts the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_envelopingshadows.jpg"},[L.GlyphOfTheSkeleton]:{name:"Glyph of the Skeleton",description:"Your Raise Dead spell summons a skeleton instead of a ghoul.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bone_humanskull_01.jpg"},[L.GlyphOfTheLongWinter]:{name:"Glyph of the Long Winter",description:"The effect of your Horn of Winter now lasts for 1 hour.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_remorselesswinters.jpg"}}},ol=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"felineSwiftness",fancyName:"Feline Swiftness",location:{rowIdx:0,colIdx:0},spellId:131768},{fieldName:"displacerBeast",fancyName:"Displacer Beast",location:{rowIdx:0,colIdx:1},spellId:102280},{fieldName:"wildCharge",fancyName:"Wild Charge",location:{rowIdx:0,colIdx:2},spellId:102401},{fieldName:"yserasGift",fancyName:"Ysera's Gift",location:{rowIdx:1,colIdx:0},spellId:145108},{fieldName:"renewal",fancyName:"Renewal",location:{rowIdx:1,colIdx:1},spellId:108238},{fieldName:"cenarionWard",fancyName:"Cenarion Ward",location:{rowIdx:1,colIdx:2},spellId:102351},{fieldName:"faerieSwarm",fancyName:"Faerie Swarm",location:{rowIdx:2,colIdx:0},spellId:106707},{fieldName:"massEntanglement",fancyName:"Mass Entanglement",location:{rowIdx:2,colIdx:1},spellId:102359},{fieldName:"typhoon",fancyName:"Typhoon",location:{rowIdx:2,colIdx:2},spellId:132469},{fieldName:"soulOfTheForest",fancyName:"Soul of the Forest",location:{rowIdx:3,colIdx:0},spellId:114107},{fieldName:"incarnation",fancyName:"Incarnation",location:{rowIdx:3,colIdx:1},spellId:106731},{fieldName:"forceOfNature",fancyName:"Force of Nature",location:{rowIdx:3,colIdx:2},spellId:106737},{fieldName:"disorientingRoar",fancyName:"Disorienting Roar",location:{rowIdx:4,colIdx:0},spellId:99},{fieldName:"ursolsVortex",fancyName:"Ursol's Vortex",location:{rowIdx:4,colIdx:1},spellId:102793},{fieldName:"mightyBash",fancyName:"Mighty Bash",location:{rowIdx:4,colIdx:2},spellId:5211},{fieldName:"heartOfTheWild",fancyName:"Heart of the Wild",location:{rowIdx:5,colIdx:0},spellId:108288},{fieldName:"dreamOfCenarius",fancyName:"Dream of Cenarius",location:{rowIdx:5,colIdx:1},spellId:108373},{fieldName:"naturesVigil",fancyName:"Nature's Vigil",location:{rowIdx:5,colIdx:2},spellId:124974}]}),ll={majorGlyphs:{[V.GlyphOfFrenziedRegeneration]:{name:"Glyph of Frenzied Regeneration",description:"For 6s after activating Frenzied Regeneration, healing effects on you are 40% more powerful. However, your Frenzied Regeneration now always costs 50 Rage and no longer converts Rage into health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_bullrush.jpg"},[V.GlyphOfMaul]:{name:"Glyph of Maul",description:"Your Maul ability now hits 1 additional target for 50% damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_maul.jpg"},[V.GlyphOfOmens]:{name:"Glyph of Omens",description:"While you are not in an Eclipse, the following abilities now grant 10 Solar or Lunar Energy: Entangling Roots, Cyclone, Faerie Fire, Faerie Swarm, Mass Entanglement, Typhoon, Disorienting Roar, Ursol's Vortex, and Mighty Bash.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_vehicle_sonicshockwave.jpg"},[V.GlyphOfShred]:{name:"Glyph of Shred",description:"While Berserk or Tiger's Fury is active, Shred has no positional requirement.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_vampiricaura.jpg"},[V.GlyphOfProwl]:{name:"Glyph of Prowl",description:"Reduces the movement penalty of Prowl by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_prowl.jpg"},[V.GlyphOfPounce]:{name:"Glyph of Pounce",description:"Increases the range of your Pounce by 8 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_supriseattack.jpg"},[V.GlyphOfStampede]:{name:"Glyph of Stampede",description:"You can now cast Stampeding Roar without being in Bear Form or Cat Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_druid_stampedingroar_cat.jpg"},[V.GlyphOfInnervate]:{name:"Glyph of Innervate",description:"When Innervate is cast on a target other than the caster, both the caster and target will benefit, but at 40% reduced effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg"},[V.GlyphOfRebirth]:{name:"Glyph of Rebirth",description:"Players resurrected by Rebirth are returned to life with 100% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_reincarnation.jpg"},[V.GlyphOfRegrowth]:{name:"Glyph of Regrowth",description:"Increases the critical strike chance of your Regrowth by 40%, but removes the periodic component of the spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_resistnature.jpg"},[V.GlyphOfRejuvenation]:{name:"Glyph of Rejuvenation",description:"When you have Rejuvenation active on three or more targets, the cast time of your Nourish spell is reduced by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_rejuvenation.jpg"},[V.GlyphOfHealingTouch]:{name:"Glyph of Healing Touch",description:"When you cast Healing Touch, the cooldown on your Nature's Swiftness is reduced by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg"},[V.GlyphOfEfflorescence]:{name:"Glyph of Efflorescence",description:"The Efflorescence effect is now caused by your Wild Mushroom instead of by Swiftmend, and lasts as long as the Wild Mushroom is active. Additionally, increases the healing done by Swiftmend by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg"},[V.GlyphOfGuidedStars]:{name:"Glyph of Guided Stars",description:"Your Starfall only hits targets affected by your Moonfire or Sunfire.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_arcanebarrage.jpg"},[V.GlyphOfHurricane]:{name:"Glyph of Hurricane",description:"Your Hurricane and Astral Storm abilities now also slow the movement speed of their victims by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_cyclone.jpg"},[V.GlyphOfSkullBash]:{name:"Glyph of Skull Bash",description:"Increases the duration of your Skull Bash interrupt by 2 sec, but increases the cooldown by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bone_taurenskull_01.jpg"},[V.GlyphOfNaturesGrasp]:{name:"Glyph of Nature's Grasp",description:"Reduces the cooldown of Nature's Grasp by 45 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_natureswrath.jpg"},[V.GlyphOfSavagery]:{name:"Glyph of Savagery",description:"Savage Roar can now be used with 0 combo points, resulting in a 12s duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_skinteeth.jpg"},[V.GlyphOfEntanglingRoots]:{name:"Glyph of Entangling Roots",description:"Reduces the cast time of your Entangling Roots by 0.2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_stranglevines.jpg"},[V.GlyphOfBlooming]:{name:"Glyph of Blooming",description:"Increases the bloom heal of your Lifebloom when it expires by 50%, but its duration is reduced by 5 sec and your Healing Touch, Nourish, and Regrowth abilities no longer refresh the duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_protectionformnature.jpg"},[V.GlyphOfDash]:{name:"Glyph of Dash",description:"Reduces the cooldown of your Dash ability by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_dash.jpg"},[V.GlyphOfMasterShapeshifter]:{name:"Glyph of Master Shapeshifter",description:"Reduces the mana cost of all shapeshifts by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_mastershapeshifter.jpg"},[V.GlyphOfSurvivalInstincts]:{name:"Glyph of Survival Instincts",description:"Reduces the cooldown of Survival Instincts by 60 sec, but reduces its duration by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_tigersroar.jpg"},[V.GlyphOfWildGrowth]:{name:"Glyph of Wild Growth",description:"Wild Growth can affect 1 additional target, but its cooldown is increased by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_flourish.jpg"},[V.GlyphOfMightOfUrsoc]:{name:"Glyph of Might of Ursoc",description:"Increases the health gain from Might of Ursoc by 20%, but increases the cooldown by 2 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_druid_mightofursoc.jpg"},[V.GlyphOfStampedingRoar]:{name:"Glyph of Stampeding Roar",description:"Increases the radius of Stampeding Roar by 30 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_druid_stamedingroar.jpg"},[V.GlyphOfCyclone]:{name:"Glyph of Cyclone",description:"Increases the range of your Cyclone spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_earthbind.jpg"},[V.GlyphOfBarkskin]:{name:"Glyph of Barkskin",description:"Reduces the chance you'll be critically hit by 25% while Barkskin is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_stoneclawtotem.jpg"},[V.GlyphOfFerociousBite]:{name:"Glyph of Ferocious Bite",description:"Your Ferocious Bite ability heals you for 2% of your maximum health for each 10 Energy used.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg"},[V.GlyphOfFaeSilence]:{name:"Glyph of Fae Silence",description:"Faerie Fire used in Bear Form also silences the target for 3s, but triggers a 15 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_challangingroar.jpg"},[V.GlyphOfFaerieFire]:{name:"Glyph of Faerie Fire",description:"Increases the range of your Faerie Fire by 10 yds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_faeriefire.jpg"},[V.GlyphOfCatForm]:{name:"Glyph of Cat Form",description:"Increases healing done to you by 20% while in Cat Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_catform.jpg"}},minorGlyphs:{[F.GlyphOfTheStag]:{name:"Glyph of the Stag",description:"Your Travel Form can now be used as a mount by party members. This glyph is disabled while Glyph of the Cheetah is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_archaeology_antleredcloakclasp.jpg"},[F.GlyphOfTheOrca]:{name:"Glyph of the Orca",description:"Your Aquatic Form now appears as an Orca.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_aquaticform.jpg"},[F.GlyphOfAquaticForm]:{name:"Glyph of Aquatic Form",description:"Increases your swim speed by 50% while in Aquatic Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_enchant_essencemagiclarge.jpg"},[F.GlyphOfGrace]:{name:"Glyph of Grace",description:"Feline Grace reduces falling damage even while not in Cat Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_feather_01.jpg"},[F.GlyphOfTheChameleon]:{name:"Glyph of the Chameleon",description:"Each time you shapeshift into Cat Form or Bear Form, your shapeshifted form will have a random hair color.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_mastershapeshifter.jpg"},[F.GlyphOfCharmWoodlandCreature]:{name:"Glyph of Charm Woodland Creature",description:"Teaches you the ability Charm Woodland Creature.\r\n\r\n Allows the Druid to befriend an ambient creature, which will follow the Druid for 0ms.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_rabbit.jpg"},[F.GlyphOfStars]:{name:"Glyph of Stars",description:"Your Moonkin Form now appears as Astral Form, conferring all the same benefits, but appearing as an astrally enhanced version of your normal humanoid form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_boss_algalon_01.jpg"},[F.GlyphOfThePredator]:{name:"Glyph of the Predator",description:"Your Track Humanoids ability now also tracks beasts.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_tracking.jpg"},[F.GlyphOfTheTreant]:{name:"Glyph of the Treant",description:"Teaches you the ability Treant Form.\r\n\r\n Shapeshift into Treant Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_treeoflife.jpg"},[F.GlyphOfTheCheetah]:{name:"Glyph of the Cheetah",description:"Your Travel Form appears as a Cheetah. This glyph will prevent Glyph of the Stag from functioning.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_catlikereflexes.jpg"},[F.GlyphOfFocus]:{name:"Glyph of Focus",description:"Reduces Starfall's radius by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_arcanepotency.jpg"},[F.GlyphOfTheSproutingMushroom]:{name:"Glyph of the Sprouting Mushroom",description:"Your Wild Mushroom spell can now be placed on the ground instead of underneath a target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_druid_wildmushroom.jpg"},[F.GlyphOfOneWithNature]:{name:"Glyph of One with Nature",description:"Grants you the ability to teleport to a random natural location.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_manatree.jpg"}}},rl=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"posthaste",fancyName:"Posthaste",location:{rowIdx:0,colIdx:0},spellId:109215},{fieldName:"narrowEscape",fancyName:"Narrow Escape",location:{rowIdx:0,colIdx:1},spellId:109298},{fieldName:"crouchingTigerHiddenChimera",fancyName:"Crouching Tiger, Hidden Chimera",location:{rowIdx:0,colIdx:2},spellId:118675},{fieldName:"bindingShot",fancyName:"Binding Shot",location:{rowIdx:1,colIdx:0},spellId:109248},{fieldName:"wyvernSting",fancyName:"Wyvern Sting",location:{rowIdx:1,colIdx:1},spellId:19386},{fieldName:"intimidation",fancyName:"Intimidation",location:{rowIdx:1,colIdx:2},spellId:19577},{fieldName:"exhilaration",fancyName:"Exhilaration",location:{rowIdx:2,colIdx:0},spellId:109304},{fieldName:"aspectOfTheIronHawk",fancyName:"Aspect of the Iron Hawk",location:{rowIdx:2,colIdx:1},spellId:109260},{fieldName:"spiritBond",fancyName:"Spirit Bond",location:{rowIdx:2,colIdx:2},spellId:109212},{fieldName:"fervor",fancyName:"Fervor",location:{rowIdx:3,colIdx:0},spellId:82726},{fieldName:"direBeast",fancyName:"Dire Beast",location:{rowIdx:3,colIdx:1},spellId:120679},{fieldName:"thrillOfTheHunt",fancyName:"Thrill of the Hunt",location:{rowIdx:3,colIdx:2},spellId:109306},{fieldName:"aMurderOfCrows",fancyName:"A Murder of Crows",location:{rowIdx:4,colIdx:0},spellId:131894},{fieldName:"blinkStrikes",fancyName:"Blink Strikes",location:{rowIdx:4,colIdx:1},spellId:130392},{fieldName:"lynxRush",fancyName:"Lynx Rush",location:{rowIdx:4,colIdx:2},spellId:120697},{fieldName:"glaiveToss",fancyName:"Glaive Toss",location:{rowIdx:5,colIdx:0},spellId:117050},{fieldName:"powershot",fancyName:"Powershot",location:{rowIdx:5,colIdx:1},spellId:109259},{fieldName:"barrage",fancyName:"Barrage",location:{rowIdx:5,colIdx:2},spellId:120360}]}),cl={majorGlyphs:{[M.GlyphOfCamouflage]:{name:"Glyph of Camouflage",description:"Your Camouflage ability now provides stealth even while moving, but your movement speed while Camouflage is active is reduced by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_displacement.jpg"},[M.GlyphOfLiberation]:{name:"Glyph of Liberation",description:"When you Disengage, you are healed for 5% of your total health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_bg_returnxflags_def_wsg.jpg"},[M.GlyphOfMending]:{name:"Glyph of Mending",description:"Your Mend Pet now heals every 1 sec, and heals for an additional 25% of your pet's health over its duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bandage_15.jpg"},[M.GlyphOfDistractingShot]:{name:"Glyph of Distracting Shot",description:"Your Distracting Shot now distracts the target to attack your pet instead of you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[M.GlyphOfEndlessWrath]:{name:"Glyph of Endless Wrath",description:"While Bestial Wrath is active, your pet cannot be killed, but can still be damaged.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg"},[M.GlyphOfDeterrence]:{name:"Glyph of Deterrence",description:"Increases the damage reduction granted by Deterrence by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_whirlwind.jpg"},[M.GlyphOfDisengage]:{name:"Glyph of Disengage",description:"Increases the distance you travel when you Disengage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg"},[M.GlyphOfFreezingTrap]:{name:"Glyph of Freezing Trap",description:"When your Freezing Trap breaks, the victim's movement speed is reduced by 70% for 0ms.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg"},[M.GlyphOfIceTrap]:{name:"Glyph of Ice Trap",description:"Increases the radius of the effect from your Ice Trap by 2 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_hunter_icetrap.jpg"},[M.GlyphOfMisdirection]:{name:"Glyph of Misdirection",description:"When you use Misdirection on your pet, the cooldown on your Misdirection is reset.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_misdirection.jpg"},[M.GlyphOfExplosiveTrap]:{name:"Glyph of Explosive Trap",description:"Your Explosive Trap no longer deals damage, instead knocking enemies back from the trap when it explodes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_selfdestruct.jpg"},[M.GlyphOfAnimalBond]:{name:"Glyph of Animal Bond",description:"While your pet is active, all healing done to you and your pet is increased by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_demoralizingroar.jpg"},[M.GlyphOfNoEscape]:{name:"Glyph of No Escape",description:"Increases the ranged critical strike chance of all of your attacks on targets affected by your Freezing Trap by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_pointofnoescape.jpg"},[M.GlyphOfPathfinding]:{name:"Glyph of Pathfinding",description:"Increases the speed bonus of your Aspect of the Cheetah and Aspect of the Pack by 8%, and increases your speed while mounted by 10%. The mounted movement speed increase does not stack with other effects.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_pathfinding2.jpg"},[M.GlyphOfSnakeTrap]:{name:"Glyph of Snake Trap",description:"Snakes from your Snake Trap take 90% reduced damage from area of effect attacks.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_snaketrap.jpg"},[M.GlyphOfAimedShot]:{name:"Glyph of Aimed Shot",description:"Your Aimed Shot can now be used while moving.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_spear_07.jpg"},[M.GlyphOfMendPet]:{name:"Glyph of Mend Pet",description:"Gives your Mend Pet ability a 100% chance of cleansing 1 Curse, Disease, Magic or Poison effect from your pet each tick.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_mendpet.jpg"},[M.GlyphOfSolace]:{name:"Glyph of Solace",description:"Your Freezing Trap and Scatter Shot also remove all damage over time effects from their targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostshock.jpg"},[M.GlyphOfChimeraShot]:{name:"Glyph of Chimera Shot",description:"Increases the healing you receive from Chimera Shot by an additional 2% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_chimerashot2.jpg"},[M.GlyphOfTranquilizingShot]:{name:"Glyph of Tranquilizing Shot",description:"Your Tranquilizing Shot no longer costs Focus, but has a 10 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_drowsy.jpg"},[M.GlyphOfMastersCall]:{name:"Glyph of Master's Call",description:"Increases the duration of your Master's Call by 4.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_masterscall.jpg"},[M.GlyphOfScatterShot]:{name:"Glyph of Scatter Shot",description:"Increases the range of Scatter Shot by 3 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_golemstormbolt.jpg"},[M.GlyphOfMirroredBlades]:{name:"Glyph of Mirrored Blades",description:"When attacked by a spell while in Deterrence, you have a 100% chance to reflect it back at the attacker.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_weapon_shortblade_99.jpg"},[M.GlyphOfBlackIce]:{name:"Glyph of Black Ice",description:"While you move through the area affected by your Ice Trap you gain 50% movement speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_hunter_blackicetrap.jpg"},[M.GlyphOfTheLeanPack]:{name:"Glyph of the Lean Pack",description:"Reduces the radius of Aspect of the Pack by 33 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectmastery.jpg"},[M.GlyphOfEnduringDeceit]:{name:"Glyph of Enduring Deceit",description:"Camouflage also reduces spell damage taken by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_camouflage.jpg"}},minorGlyphs:{[W.GlyphOfAspects]:{name:"Glyph of Aspects",description:"Each time you activate a new Aspect, an animal companion representing that Aspect will follow you for 0ms.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectmastery.jpg"},[W.GlyphOfTameBeast]:{name:"Glyph of Tame Beast",description:"Reduces the time required to complete Tame Beast by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_beasttaming.jpg"},[W.GlyphOfRevivePet]:{name:"Glyph of Revive Pet",description:"Reduces the pushback suffered from damaging attacks while casting Revive Pet by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_beastsoothe.jpg"},[W.GlyphOfLesserProportion]:{name:"Glyph of Lesser Proportion",description:"Slightly reduces the size of your pet.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_bestialdiscipline.jpg"},[W.GlyphOfFireworks]:{name:"Glyph of Fireworks",description:"Teaches you the ability Fireworks.\r\n\r\n Launch fireworks from your gun, bow or crossbow.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_missilelargecluster_red.jpg"},[W.GlyphOfAspectOfThePack]:{name:"Glyph of Aspect of the Pack",description:"Increases the range of your Aspect of the Pack ability by 15 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_whitetiger.jpg"},[W.GlyphOfStampedeHunter]:{name:"Glyph of Stampede",description:"Your Stampede no longer summons pets from your stable, and instead uses copies of your current pet.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_bestialdiscipline.jpg"},[W.GlyphOfAspectOfTheCheetah]:{name:"Glyph of Aspect of the Cheetah",description:"Your Aspect of the Cheetah no longer causes you to be dazed when struck. Instead, the effect is cancelled and all your Aspects are placed on a 4 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_jungletiger.jpg"},[W.GlyphOfAspectOfTheBeast]:{name:"Glyph of Aspect of the Beast",description:"Teaches you the ability Aspect of the Beast.\r\n\r\n The Hunter takes on the aspects of a beast, becoming untrackable. Only one Aspect can be active at a time.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_pinktiger.jpg"},[W.GlyphOfDirection]:{name:"Glyph of Direction",description:"Causes your Misdirection target to appear larger.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_markedfordeath.jpg"},[W.GlyphOfMarking]:{name:"Glyph of Marking",description:"Your Hunter's Mark ability now places a bullseye on your target instead of its usual visual.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_mastermarksman.jpg"},[W.GlyphOfFetch]:{name:"Glyph of Fetch",description:"Teaches you the ability Fetch.\r\n\r\n Command your pet to retrieve the loot from a nearby corpse within 40 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bone_01.jpg"},[W.GlyphOfFocusedFire]:{name:"Glyph of Focused Fire",description:"Focus Fire charges apply a visual to you for each charge active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectmastery.jpg"},[W.GlyphOfChameleon]:{name:"Glyph of Chameleon",description:"Focus Fire charges apply a visual to you for each charge active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectmastery.jpg"}}},hl=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"presenceOfMind",fancyName:"Presence of Mind",location:{rowIdx:0,colIdx:0},spellId:12043},{fieldName:"blazingSpeed",fancyName:"Blazing Speed",location:{rowIdx:0,colIdx:1},spellId:108843},{fieldName:"iceFloes",fancyName:"Ice Floes",location:{rowIdx:0,colIdx:2},spellId:108839},{fieldName:"temporalShield",fancyName:"Temporal Shield",location:{rowIdx:1,colIdx:0},spellId:115610},{fieldName:"flameglow",fancyName:"Flameglow",location:{rowIdx:1,colIdx:1},spellId:140468},{fieldName:"iceBarrier",fancyName:"Ice Barrier",location:{rowIdx:1,colIdx:2},spellId:11426},{fieldName:"ringOfFrost",fancyName:"Ring of Frost",location:{rowIdx:2,colIdx:0},spellId:113724},{fieldName:"iceWard",fancyName:"Ice Ward",location:{rowIdx:2,colIdx:1},spellId:111264},{fieldName:"frostjaw",fancyName:"Frostjaw",location:{rowIdx:2,colIdx:2},spellId:102051},{fieldName:"greaterInvisibility",fancyName:"Greater Invisibility",location:{rowIdx:3,colIdx:0},spellId:110959},{fieldName:"cauterize",fancyName:"Cauterize",location:{rowIdx:3,colIdx:1},spellId:86949},{fieldName:"coldSnap",fancyName:"Cold Snap",location:{rowIdx:3,colIdx:2},spellId:11958},{fieldName:"netherTempest",fancyName:"Nether Tempest",location:{rowIdx:4,colIdx:0},spellId:114923},{fieldName:"livingBomb",fancyName:"Living Bomb",location:{rowIdx:4,colIdx:1},spellId:44457},{fieldName:"frostBomb",fancyName:"Frost Bomb",location:{rowIdx:4,colIdx:2},spellId:112948},{fieldName:"invocation",fancyName:"Invocation",location:{rowIdx:5,colIdx:0},spellId:114003},{fieldName:"runeOfPower",fancyName:"Rune of Power",location:{rowIdx:5,colIdx:1},spellId:116011},{fieldName:"incantersWard",fancyName:"Incanter's Ward",location:{rowIdx:5,colIdx:2},spellId:1463}]}),ml={majorGlyphs:{[z.GlyphOfArcaneExplosion]:{name:"Glyph of Arcane Explosion",description:"Increases the radius of your Arcane Explosion by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_wispsplode.jpg"},[z.GlyphOfBlink]:{name:"Glyph of Blink",description:"Increases the distance you travel with the Blink spell by 8 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[z.GlyphOfEvocation]:{name:"Glyph of Evocation",description:"Your Evocation ability also causes you to regain 60% of your health over its duration.\r\n\r\n With the Invocation talent, you instead gain 10% of your health upon completing an Evocation.\r\n\r\n With the Rune of Power talent, you gain 1% of your health per second while standing in your own Rune of Power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_purge.jpg"},[z.GlyphOfCombustion]:{name:"Glyph of Combustion",description:"Increases the direct damage, the duration of the damage over time effect and the cooldown of Combustion by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_sealoffire.jpg"},[z.GlyphOfFrostNova]:{name:"Glyph of Frost Nova",description:"Reduces the cooldown of Frost Nova by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostnova.jpg"},[z.GlyphOfIceBlock]:{name:"Glyph of Ice Block",description:"When Ice Block terminates, it triggers an instant free Frost Nova and makes you immune to all spells for 3s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frost.jpg"},[z.GlyphOfSplittingIce]:{name:"Glyph of Splitting Ice",description:"Your Ice Lance and Icicles now hit 1 additional target for 50% damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostblast.jpg"},[z.GlyphOfConeOfCold]:{name:"Glyph of Cone of Cold",description:"Increases the damage done by Cone of Cold by 200%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_glacier.jpg"},[z.GlyphOfRapidDisplacement]:{name:"Glyph of Rapid Displacement",description:"Blink now has 2 charges, gaining a charge every 15 sec, but no longer frees the caster from stuns and bonds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[z.GlyphOfManaGem]:{name:"Glyph of Mana Gem",description:"Your Conjure Mana Gem spell now creates a Brilliant Mana Gem, which holds up to 10 charges.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_jewelcrafting_gem_05.jpg"},[z.GlyphOfPolymorph]:{name:"Glyph of Polymorph",description:"Your Polymorph spell also removes all damage over time effects from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_polymorph.jpg"},[z.GlyphOfIcyVeins]:{name:"Glyph of Icy Veins",description:"Your Icy Veins causes your Frostbolt, Frostfire Bolt, Ice Lance, and your Water Elemental's Waterbolt spells to split into 3 smaller bolts that each do 40% damage, instead of increasing spell casting speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_coldhearted.jpg"},[z.GlyphOfSpellsteal]:{name:"Glyph of Spellsteal",description:"Spellsteal now also heals you for 5% of your maximum health when it successfully steals a spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_arcane02.jpg"},[z.GlyphOfFrostfireBolt]:{name:"Glyph of Frostfire Bolt",description:"Reduces the cast time of Frostfire Bolt by 0.5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_frostfirebolt.jpg"},[z.GlyphOfRemoveCurse]:{name:"Glyph of Remove Curse",description:"Increases the damage you deal by 5% for 0ms after you successfully remove a curse.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_removecurse.jpg"},[z.GlyphOfArcanePower]:{name:"Glyph of Arcane Power",description:"Increases the duration and cooldown of Arcane Power by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg"},[z.GlyphOfWaterElemental]:{name:"Glyph of Water Elemental",description:"Increases the health of your Water Elemental by 40%, and allows it to cast while moving. When in Assist mode and in combat, commanding your Water Elemental to Follow will cause it to stay near you and autocast Waterbolt when your target is in range.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_summonwaterelemental_2.jpg"},[z.GlyphOfSlow]:{name:"Glyph of Slow",description:"Your Arcane Blast spell applies the Slow spell to any target it damages if no target is currently affected by your Slow.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg"},[z.GlyphOfDeepFreeze]:{name:"Glyph of Deep Freeze",description:"Your Deep Freeze spell is no longer on the global cooldown, but its duration is reduced by 1 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_deepfreeze.jpg"},[z.GlyphOfCounterspell]:{name:"Glyph of Counterspell",description:"Your Counterspell can now be cast while casting or channeling other spells, but its cooldown is increased by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_iceshock.jpg"},[z.GlyphOfInfernoBlast]:{name:"Glyph of Inferno Blast",description:"Your Inferno Blast spell spreads Pyroblast, Ignite, and Combustion to 1 additional target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_mage_infernoblast.jpg"},[z.GlyphOfArmors]:{name:"Glyph of Armors",description:"Reduces the cast time of your Frost Armor, Mage Armor, and Molten Armor spells by 1.5 sec, and increases the defensive effect of each Armor by an additional 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostarmor02.jpg"}},minorGlyphs:{[j.GlyphOfLooseMana]:{name:"Glyph of Loose Mana",description:"Your Mana Gem now restores mana over 6 sec, rather than instantly.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_gem_sapphire_02.jpg"},[j.GlyphOfMomentum]:{name:"Glyph of Momentum",description:"Your Blink spell teleports you in the direction you are moving instead of the direction you are facing.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[j.GlyphOfCrittermorph]:{name:"Glyph of Crittermorph",description:"When cast on critters, your Polymorph spells now last 1440min and can be cast on multiple targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_doublepolymorph2.jpg"},[j.GlyphOfThePorcupine]:{name:"Glyph of the Porcupine",description:"Your Polymorph spell polymorphs the target into a porcupine instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_polymorphpig.jpg"},[j.GlyphOfConjureFamiliar]:{name:"Glyph of Conjure Familiar",description:"Teaches you the ability Conjure Familiar.\r\n\r\n Conjures a familiar stone, containing either an Arcane, Fiery, or Icy Familiar.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_elementalabsorption.jpg"},[j.GlyphOfTheMonkey]:{name:"Glyph of the Monkey",description:"Your Polymorph spell polymorphs the target into a monkey instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectofthemonkey.jpg"},[j.GlyphOfThePenguin]:{name:"Glyph of the Penguin",description:"Your Polymorph spell polymorphs the target into a penguin instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_penguinpet.jpg"},[j.GlyphOfTheBearCub]:{name:"Glyph of the Bear Cub",description:"Your Polymorph spell polymorphs the target into a polar bear cub instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_pet_babyblizzardbear.jpg"},[j.GlyphOfArcaneLanguage]:{name:"Glyph of Arcane Language",description:"Your Arcane Brilliance spell allows you to comprehend your allies' racial languages.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_fish_68.jpg"},[j.GlyphOfIllusion]:{name:"Glyph of Illusion",description:"Teaches you the ability Illusion.\r\n\r\n Transforms the Mage to look like someone else for 0ms.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_mask_01.jpg"},[j.GlyphOfMirrorImage]:{name:"Glyph of Mirror Image",description:"Your Mirror Images cast Arcane Blast or Fireball instead of Frostbolt depending on your primary talent tree.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg"},[j.GlyphOfRapidTeleportation]:{name:"Glyph of Rapid Teleportation",description:"After casting a Mage Teleport spell, or entering a Mage Portal, your movement speed is increased by 70% for 1min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_portaldalaran.jpg"},[j.GlyphOfDiscreetMagic]:{name:"Glyph of Discreet Magic",description:"Your Nether Tempest, Living Bomb, Frost Bomb, Arcane Barrage, and Inferno Blast no longer affect targets more than 5 yds away from their primary target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_enchant_essencemagicsmall.jpg"},[j.GlyphOfTheUnboundElemental]:{name:"Glyph of the Unbound Elemental",description:"Your Water Elemental is replaced by an Unbound Water Elemental.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_summonwaterelemental.jpg"},[j.GlyphOfEvaporation]:{name:"Glyph of Evaporation",description:"Reduces the size of your Water Elemental by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_elemental_mote_water01.jpg"},[j.GlyphOfCondensation]:{name:"Glyph of Condensation",description:"Increases the size of your Water Elemental by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_volatilewater.jpg"}}},dl=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"celerity",fancyName:"Celerity",location:{rowIdx:0,colIdx:0},spellId:115173},{fieldName:"tigersLust",fancyName:"Tiger's Lust",location:{rowIdx:0,colIdx:1},spellId:116841},{fieldName:"momentum",fancyName:"Momentum",location:{rowIdx:0,colIdx:2},spellId:115174},{fieldName:"chiWave",fancyName:"Chi Wave",location:{rowIdx:1,colIdx:0},spellId:115098},{fieldName:"zenSphere",fancyName:"Zen Sphere",location:{rowIdx:1,colIdx:1},spellId:124081},{fieldName:"chiBurst",fancyName:"Chi Burst",location:{rowIdx:1,colIdx:2},spellId:123986},{fieldName:"powerStrikes",fancyName:"Power Strikes",location:{rowIdx:2,colIdx:0},spellId:121817},{fieldName:"ascension",fancyName:"Ascension",location:{rowIdx:2,colIdx:1},spellId:115396},{fieldName:"chiBrew",fancyName:"Chi Brew",location:{rowIdx:2,colIdx:2},spellId:115399},{fieldName:"ringOfPeace",fancyName:"Ring of Peace",location:{rowIdx:3,colIdx:0},spellId:116844},{fieldName:"chargingOxWave",fancyName:"Charging Ox Wave",location:{rowIdx:3,colIdx:1},spellId:119392},{fieldName:"legSweep",fancyName:"Leg Sweep",location:{rowIdx:3,colIdx:2},spellId:119381},{fieldName:"healingElixirs",fancyName:"Healing Elixirs",location:{rowIdx:4,colIdx:0},spellId:122280},{fieldName:"dampenHarm",fancyName:"Dampen Harm",location:{rowIdx:4,colIdx:1},spellId:122278},{fieldName:"diffuseMagic",fancyName:"Diffuse Magic",location:{rowIdx:4,colIdx:2},spellId:122783},{fieldName:"rushingJadeWind",fancyName:"Rushing Jade Wind",location:{rowIdx:5,colIdx:0},spellId:116847},{fieldName:"invokeXuenTheWhiteTiger",fancyName:"Invoke Xuen, the White Tiger",location:{rowIdx:5,colIdx:1},spellId:123904},{fieldName:"chiTorpedo",fancyName:"Chi Torpedo",location:{rowIdx:5,colIdx:2},spellId:115008}]}),pl={majorGlyphs:{[B.GlyphOfRapidRolling]:{name:"Glyph of Rapid Rolling",description:"For 5s seconds after using Roll or Chi Torpedo, your next Roll or Chi Torpedo will go 30% farther.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_roll.jpg"},[B.GlyphOfTranscendence]:{name:"Glyph of Transcendence",description:"Reduces the cooldown of your Transcendence: Transfer spell by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/monk_ability_transcendence.jpg"},[B.GlyphOfBreathOfFire]:{name:"Glyph of Breath of Fire",description:"When you use Breath of Fire on targets afflicted with your Dizzying Haze, they become Disoriented for 3s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_breathoffire.jpg"},[B.GlyphOfClash]:{name:"Glyph of Clash",description:"Increases the range of your Clash ability by 10 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_clashingoxcharge.jpg"},[B.GlyphOfEnduringHealingSphere]:{name:"Glyph of Enduring Healing Sphere",description:"Increases the duration of your Healing Spheres by 3 minutes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_healthsphere.jpg"},[B.GlyphOfGuard]:{name:"Glyph of Guard",description:"Increases the amount your Guard absorbs by 10%, but your Guard can only absorb magical damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_guard.jpg"},[B.GlyphOfManaTea]:{name:"Glyph of Mana Tea",description:"Your Mana Tea is instant instead of channeled and consumes two stacks when used, but causes a 10 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/monk_ability_cherrymanatea.jpg"},[B.GlyphOfZenMeditation]:{name:"Glyph of Zen Meditation",description:"You can now channel Zen Meditation while moving.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_zenmeditation.jpg"},[B.GlyphOfRenewingMists]:{name:"Glyph of Renewing Mists",description:"Your Renewing Mist travels to the furthest injured target within 40 yards rather than the closest injured target within 20 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_renewingmists.jpg"},[B.GlyphOfSpinningCraneKick]:{name:"Glyph of Spinning Crane Kick",description:"You move at full speed while channeling Spinning Crane Kick.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_cranekick_new.jpg"},[B.GlyphOfSurgingMist]:{name:"Glyph of Surging Mist",description:"Your Surging Mist no longer requires a target, and instead heals the lowest health target within 40 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_surgingmist.jpg"},[B.GlyphOfTouchOfDeath]:{name:"Glyph of Touch of Death",description:"Your Touch of Death no longer has a Chi cost, but the cooldown is increased by 2 minutes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_touchofdeath.jpg"},[B.GlyphOfNimbleBrew]:{name:"Glyph of Nimble Brew",description:"Clearing an effect with Nimble Brew heals you for 10% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_monk_nimblebrew.jpg"},[B.GlyphOfAfterlife]:{name:"Glyph of Afterlife",description:"Increases the chance to summon a Healing Sphere when you kill an enemy while gaining experience or honor to 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_finalprayer.jpg"},[B.GlyphOfFistsOfFury]:{name:"Glyph of Fists of Fury",description:"When channeling Fists of Fury, your parry chance is increased by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/monk_ability_fistoffury.jpg"},[B.GlyphOfFortifyingBrew]:{name:"Glyph of Fortifying Brew",description:"Your Fortifying Brew reduces damage taken by an additional 5%, but increases your health by 10% rather than 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_fortifyingale_new.jpg"},[B.GlyphOfLeerOfTheOx]:{name:"Glyph of Leer of the Ox",description:"Teaches you the spell Leer of the Ox.\r\n\r\n |CFFFFFFFFLeer of the Ox|R\r\n Your Ox Statue stirs hatred in the target, reducing their movement speed by 50% and causing them to attack your Black Ox Statue for 8s. The statue must be within 40 yards of the target.\r\n\r\n Requires Black Ox Statue to be active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_leeroftheox.jpg"},[B.GlyphOfLifeCocoon]:{name:"Glyph of Life Cocoon",description:"Life Cocoon can now be cast while stunned.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_chicocoon.jpg"},[B.GlyphOfFortuitousSpheres]:{name:"Glyph of Fortuitous Spheres",description:"Falling below 25% health will automatically summon a healing sphere near you at no cost. This effect cannot occur more often than once every 30 seconds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_healthsphere.jpg"},[B.GlyphOfParalysis]:{name:"Glyph of Paralysis",description:"Your Paralysis ability also removes all damage over time effects from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_paralysis.jpg"},[B.GlyphOfSparring]:{name:"Glyph of Sparring",description:"While Sparring, you also have a 5% chance to deflect spells from attackers in front of you, stacking up to 3 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_sparring.jpg"},[B.GlyphOfDetox]:{name:"Glyph of Detox",description:"Detox heals your target for 5% when it successfully removes a harmful effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_dispelmagic.jpg"},[B.GlyphOfTouchOfKarma]:{name:"Glyph of Touch of Karma",description:"Your Touch of Karma now has a 25 yard range.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_touchofkarma.jpg"},[B.GlyphOfTargetedExpulsion]:{name:"Glyph of Targeted Expulsion",description:"Expel Harm can now be used on other allies, but the healing is reduced by 50% on them.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_expelharm.jpg"}},minorGlyphs:{[H.GlyphOfSpinningFireBlossom]:{name:"Glyph of Spinning Fire Blossom",description:"Your Spinning Fire Blossom requires an enemy target rather than traveling in front of you, but is no longer capable of rooting targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_explodingjadeblossom.jpg"},[H.GlyphOfCracklingTigerLightning]:{name:"Glyph of Crackling Tiger Lightning",description:"Your Crackling Jade Lightning visual is altered to the color of the White Tiger celestial.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_cracklingjadelightning.jpg"},[H.GlyphOfFlyingSerpentKick]:{name:"Glyph of Flying Serpent Kick",description:"Your Flying Serpent Kick automatically ends when you fly into an enemy, triggering the area of effect damage and snare.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_flyingdragonkick.jpg"},[H.GlyphOfHonor]:{name:"Glyph of Honor",description:"You honorably bow after each successful Touch of Death.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/pandarenracial_innerpeace.jpg"},[H.GlyphOfJab]:{name:"Glyph of Jab",description:"You always will attack with hands and fist with Jab, even with non-fist weapons equipped.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_jab.jpg"},[H.GlyphOfRisingTigerKick]:{name:"Glyph of Rising Tiger Kick",description:"Your Rising Sun Kick's visual is altered to the color of the White Tiger.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_risingsunkick.jpg"},[H.GlyphOfSpiritRoll]:{name:"Glyph of Spirit Roll",description:"You can cast Roll or Chi Torpedo while dead as a spirit.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_guardianspirit.jpg"},[H.GlyphOfFightingPose]:{name:"Glyph of Fighting Pose",description:"Your spirit now appears in a fighting pose when using Transcendence.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_dpsstance.jpg"},[H.GlyphOfWaterRoll]:{name:"Glyph of Water Roll",description:"You can Roll or Chi Torpedo over water.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_roll.jpg"},[H.GlyphOfZenFlight]:{name:"Glyph of Zen Flight",description:"Teaches you the spell Zen Flight. Zen Flight requires a Flight Master's License in order to be cast.\r\n\r\n |CFFFFFFFFZen Flight|R\r\n You fly through the air at a quick speed on a meditative cloud.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_zenflight.jpg"},[H.GlyphOfBlackoutKick]:{name:"Glyph of Blackout Kick",description:"Your Blackout Kick always deals 20% additional damage over 4s regardless of positioning but you're unable to trigger the healing effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_blackoutkick.jpg"}}},ul=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"speedOfLight",fancyName:"Speed of Light",location:{rowIdx:0,colIdx:0},spellId:85499},{fieldName:"longArmOfTheLaw",fancyName:"Long Arm of the Law",location:{rowIdx:0,colIdx:1},spellId:87172},{fieldName:"pursuitOfJustice",fancyName:"Pursuit of Justice",location:{rowIdx:0,colIdx:2},spellId:26023},{fieldName:"fistOfJustice",fancyName:"Fist of Justice",location:{rowIdx:1,colIdx:0},spellId:105593},{fieldName:"repentance",fancyName:"Repentance",location:{rowIdx:1,colIdx:1},spellId:20066},{fieldName:"evilIsAPointOfView",fancyName:"Evil is a Point of View",location:{rowIdx:1,colIdx:2},spellId:110301},{fieldName:"selflessHealer",fancyName:"Selfless Healer",location:{rowIdx:2,colIdx:0},spellId:85804},{fieldName:"eternalFlame",fancyName:"Eternal Flame",location:{rowIdx:2,colIdx:1},spellId:114163},{fieldName:"sacredShield",fancyName:"Sacred Shield",location:{rowIdx:2,colIdx:2},spellId:20925},{fieldName:"handOfPurity",fancyName:"Hand of Purity",location:{rowIdx:3,colIdx:0},spellId:114039},{fieldName:"unbreakableSpirit",fancyName:"Unbreakable Spirit",location:{rowIdx:3,colIdx:1},spellId:114154},{fieldName:"clemency",fancyName:"Clemency",location:{rowIdx:3,colIdx:2},spellId:105622},{fieldName:"holyAvenger",fancyName:"Holy Avenger",location:{rowIdx:4,colIdx:0},spellId:105809},{fieldName:"sanctifiedWrath",fancyName:"Sanctified Wrath",location:{rowIdx:4,colIdx:1},spellId:53376},{fieldName:"divinePurpose",fancyName:"Divine Purpose",location:{rowIdx:4,colIdx:2},spellId:86172},{fieldName:"holyPrism",fancyName:"Holy Prism",location:{rowIdx:5,colIdx:0},spellId:114165},{fieldName:"lightsHammer",fancyName:"Light's Hammer",location:{rowIdx:5,colIdx:1},spellId:114158},{fieldName:"executionSentence",fancyName:"Execution Sentence",location:{rowIdx:5,colIdx:2},spellId:114157}]}),gl={majorGlyphs:{[q.GlyphOfDoubleJeopardy]:{name:"Glyph of Double Jeopardy",description:"Judging a target increases the damage of your next Judgment by 20%, but only if used on a different second target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousfury.jpg"},[q.GlyphOfDevotionAura]:{name:"Glyph of Devotion Aura",description:"Devotion Aura no longer affects party or raid members, but the cooldown is reduced by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_auramastery.jpg"},[q.GlyphOfHolyWrath]:{name:"Glyph of Holy Wrath",description:"Your Holy Wrath now also stuns Elementals, Dragonkin, and Aberrations.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_weaponmastery.jpg"},[q.GlyphOfDivineProtection]:{name:"Glyph of Divine Protection",description:"Reduces the magical damage reduction of your Divine Protection to 20% but adds 20% physical damage reduction.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_divineprotection.jpg"},[q.GlyphOfTemplarsVerdict]:{name:"Glyph of Templar's Verdict",description:"You take 10% less damage for 6s after dealing damage with Templar's Verdict or Exorcism.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_paladin_templarsverdict.jpg"},[q.GlyphOfAvengingWrath]:{name:"Glyph of Avenging Wrath",description:"While Avenging Wrath is active, you are healed for 1% of your maximum health every 0.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_avenginewrath.jpg"},[q.GlyphOfConsecration]:{name:"Glyph of Consecration",description:"You can now target Consecration anywhere within 25 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg"},[q.GlyphOfFocusedShield]:{name:"Glyph of Focused Shield",description:"Your Avenger's Shield hits 2 fewer targets, but for 30% more damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg"},[q.GlyphOfBurdenOfGuilt]:{name:"Glyph of Burden of Guilt",description:"Your Judgment hits fill your target with doubt and remorse, reducing movement speed by 50% for 2s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_bg_topdps.jpg"},[q.GlyphOfBlindingLight]:{name:"Glyph of Blinding Light",description:"Your Blinding Light now knocks down targets for 0ms instead of Blinding them.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_blindinglight.jpg"},[q.GlyphOfFinalWrath]:{name:"Glyph of Final Wrath",description:"Your Holy Wrath does an additional 50% damage to targets with less than 20% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_blessedresillience.jpg"},[q.GlyphOfWordOfGlory]:{name:"Glyph of Word of Glory",description:"Increases your damage by 3% per Holy Power spent after you cast Word of Glory or Eternal Flame on a friendly target. Lasts 6s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_helmet_96.jpg"},[q.GlyphOfIllumination]:{name:"Glyph of Illumination",description:"Your Holy Shock criticals grant 1% mana return, but Holy Insight returns 10% less mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_pureofheart.jpg"},[q.GlyphOfHarshWords]:{name:"Glyph of Harsh Words",description:"Your Word of Glory can now also be used on enemy targets, causing Holy damage approximately equal to the amount it would have healed.\r\n\r\n Does not work with Eternal Flame.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_helmet_96.jpg"},[q.GlyphOfDivinity]:{name:"Glyph of Divinity",description:"Increases the cooldown of your Lay on Hands by 0 min but causes it to give you 10% of your maximum mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg"},[q.GlyphOfLightOfDawn]:{name:"Glyph of Light of Dawn",description:"Light of Dawn affects 2 fewer targets, but heals each target for 25% more.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_paladin_lightofdawn.jpg"},[q.GlyphOfBlessedLife]:{name:"Glyph of Blessed Life",description:"You have a 50% chance to gain a charge of Holy Power whenever you are affected by a Stun, Fear or Immobilize effect.\r\n\r\n This effect cannot occur more than once every 20 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingaura.jpg"},[q.GlyphOfFlashOfLight]:{name:"Glyph of Flash of Light",description:"When you Flash of Light a target, it increases your next heal done to that target within 7s by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_flashheal.jpg"},[q.GlyphOfDenounce]:{name:"Glyph of Denounce",description:"Your Holy Shocks reduce the cast time of your next Denounce by 0.5 sec. This effect stacks up to 3 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_purifyingpower.jpg"},[q.GlyphOfDazingShield]:{name:"Glyph of Dazing Shield",description:"Your Avenger's Shield now also dazes targets for 10s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg"},[q.GlyphOfImmediateTruth]:{name:"Glyph of Immediate Truth",description:"Increases the instant damage done by Seal of Truth by 40%, but decreases the damage done by Censure by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg"},[q.GlyphOfBeaconOfLight]:{name:"Glyph of Beacon of Light",description:"Removes the global cooldown on Beacon of Light.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_beaconoflight.jpg"},[q.GlyphOfHammerOfTheRighteous]:{name:"Glyph of Hammer of the Righteous",description:"The physical damage reduction caused by Hammer of the Righteous now lasts 50% longer.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_hammeroftherighteous.jpg"},[q.GlyphOfDivineStorm]:{name:"Glyph of Divine Storm",description:"Your Divine Storm also heals you for 5% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_divinestorm.jpg"},[q.GlyphOfTheAlabasterShield]:{name:"Glyph of the Alabaster Shield",description:"Your successful blocks increase the damage of your next Shield of the Righteous by 10%. Stacks up to 1 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_archaeology_stoneshield.jpg"},[q.GlyphOfDivinePlea]:{name:"Glyph of Divine Plea",description:"Divine Plea returns 50% less mana but has a 50% shorter cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_aspiration.jpg"},[q.GlyphOfHolyShock]:{name:"Glyph of Holy Shock",description:"Decreases the healing of Holy Shock by 50% but increases its damage by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_searinglight.jpg"},[q.GlyphOfInquisition]:{name:"Glyph of Inquisition",description:"When you land a killing blow on an opponent that yields experience or honor, the duration of your Inquisition is increased by 30 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_paladin_inquisition.jpg"},[q.GlyphOfProtectorOfTheInnocent]:{name:"Glyph of Protector of the Innocent",description:"When you use Word of Glory to heal another target, it also heals you for 20% of the amount.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_protectoroftheinnocent.jpg"},[q.GlyphOfTheBattleHealer]:{name:"Glyph of the Battle Healer",description:"Melee attacks from Seal of Insight heal the most wounded member of your raid or party for 30% of the normal heal instead of you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_vindication.jpg"},[q.GlyphOfMassExorcism]:{name:"Glyph of Mass Exorcism",description:"Reduces the range of Exorcism to melee range, but causes 25% damage to all enemies within 8 yards of the primary target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism_02.jpg"},[q.GlyphOfDivineShield]:{name:"Glyph of Divine Shield",description:"Removing harmful effects with Divine Shield heals you for 10% for each effect removed. This heal cannot exceed 50% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_divineshield.jpg"},[q.GlyphOfHandOfSacrifice]:{name:"Glyph of Hand of Sacrifice",description:"Hand of Sacrifice no longer redirects damage to the Paladin.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofsacrifice.jpg"}},minorGlyphs:{[Y.GlyphOfTheLuminousCharger]:{name:"Glyph of the Luminous Charger",description:"Your Paladin class mounts glow with holy light.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusaderaura.jpg"},[Y.GlyphOfTheMountedKing]:{name:"Glyph of the Mounted King",description:"Mounting one of your Paladin class mounts automatically casts Blessing of Kings on you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_greaterblessingofkings.jpg"},[Y.GlyphOfContemplation]:{name:"Glyph of Contemplation",description:"Teaches you the ability Contemplation.\r\n\r\n Allows you a moment of peace as you kneel in quiet contemplation to ponder the nature of the Light.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_relics_libramofhope.jpg"},[Y.GlyphOfWingedVengeance]:{name:"Glyph of Winged Vengeance",description:"Your Avenging Wrath depicts 4 wings.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_revivechampion.jpg"},[Y.GlyphOfSealOfBlood]:{name:"Glyph of Seal of Blood",description:"Your Seal of Truth now uses the Seal of Blood visual.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg"},[Y.GlyphOfFireFromTheHeavens]:{name:"Glyph of Fire From the Heavens",description:"Your Judgment and Hammer of Wrath criticals call down fire from the sky.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_firestarter.jpg"},[Y.GlyphOfFocusedWrath]:{name:"Glyph of Focused Wrath",description:"Holy Wrath only affects one target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_weaponmastery.jpg"},[Y.GlyphOfTheFallingAvenger]:{name:"Glyph of the Falling Avenger",description:"You slow fall during Avenging Wrath.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_featherfall.jpg"},[Y.GlyphOfTheRighteousRetreat]:{name:"Glyph of the Righteous Retreat",description:"During Divine Shield, you can invoke your Hearthstone 50% faster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_guildperk_hastyhearth.jpg"},[Y.GlyphOfBladedJudgment]:{name:"Glyph of Bladed Judgment",description:"Your Judgment spell depicts an axe or sword instead of a hammer, if you have an axe or sword equipped.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_axe_1h_cataclysm_c_01.jpg"},[Y.GlyphOfRighteousRetreat]:{name:"Glyph of Righteous Retreat",description:"During Divine Shield, you can invoke your Hearthstone 50% faster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_guildperk_hastyhearth.jpg"},[Y.GlyphOfTheExorcist]:{name:"Glyph of the Exorcist",description:"Exorcism will now appear to remove the evil from its target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism.jpg"},[Y.GlyphOfPillarOfLight]:{name:"Glyph of Pillar of Light",description:"Critical heals on other players display a small pillar of light at their location briefly.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_surgeoflight.jpg"}}},fl=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"voidTendrils",fancyName:"Void Tendrils",location:{rowIdx:0,colIdx:0},spellId:108920},{fieldName:"psyfiend",fancyName:"Psyfiend",location:{rowIdx:0,colIdx:1},spellId:108921},{fieldName:"dominateMind",fancyName:"Dominate Mind",location:{rowIdx:0,colIdx:2},spellId:605},{fieldName:"bodyAndSoul",fancyName:"Body and Soul",location:{rowIdx:1,colIdx:0},spellId:64129},{fieldName:"angelicFeather",fancyName:"Angelic Feather",location:{rowIdx:1,colIdx:1},spellId:121536},{fieldName:"phantasm",fancyName:"Phantasm",location:{rowIdx:1,colIdx:2},spellId:108942},{fieldName:"fromDarknessComesLight",fancyName:"From Darkness, Comes Light",location:{rowIdx:2,colIdx:0},spellId:109186},{fieldName:"mindbender",fancyName:"Mindbender",location:{rowIdx:2,colIdx:1},spellId:123040},{fieldName:"solaceAndInsanity",fancyName:"Solace and Insanity",location:{rowIdx:2,colIdx:2},spellId:139139},{fieldName:"desperatePrayer",fancyName:"Desperate Prayer",location:{rowIdx:3,colIdx:0},spellId:19236},{fieldName:"spectralGuise",fancyName:"Spectral Guise",location:{rowIdx:3,colIdx:1},spellId:112833},{fieldName:"angelicBulwark",fancyName:"Angelic Bulwark",location:{rowIdx:3,colIdx:2},spellId:108945},{fieldName:"twistOfFate",fancyName:"Twist of Fate",location:{rowIdx:4,colIdx:0},spellId:109142},{fieldName:"powerInfusion",fancyName:"Power Infusion",location:{rowIdx:4,colIdx:1},spellId:10060},{fieldName:"divineInsight",fancyName:"Divine Insight",location:{rowIdx:4,colIdx:2},spellId:109175},{fieldName:"cascade",fancyName:"Cascade",location:{rowIdx:5,colIdx:0},spellId:121135},{fieldName:"divineStar",fancyName:"Divine Star",location:{rowIdx:5,colIdx:1},spellId:110744},{fieldName:"halo",fancyName:"Halo",location:{rowIdx:5,colIdx:2},spellId:120517}]}),wl={majorGlyphs:{[K.GlyphOfCircleOfHealing]:{name:"Glyph of Circle of Healing",description:"Your Circle of Healing spell heals 1 additional target, but its mana cost is increased by 35%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_circleofrenewal.jpg"},[K.GlyphOfPurify]:{name:"Glyph of Purify",description:"Your Purify spell also heals your target for 5% of maximum health when you successfully dispel a magical effect or disease.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_dispelmagic.jpg"},[K.GlyphOfFade]:{name:"Glyph of Fade",description:"Your Fade ability now also reduces all damage taken by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg"},[K.GlyphOfFearWard]:{name:"Glyph of Fear Ward",description:"Reduces the cooldown of Fear Ward by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism.jpg"},[K.GlyphOfInnerSanctum]:{name:"Glyph of Inner Sanctum",description:"Spell damage taken is reduced by 6% while within Inner Fire, and the movement speed bonus of your Inner Will is increased by 6%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/priest_icon_innewill.jpg"},[K.GlyphOfHolyNova]:{name:"Glyph of Holy Nova",description:"Teaches you the ability Holy Nova.\r\n\r\n Causes an explosion of holy light around the caster, causing 2477 Holy damage to all enemy targets within 10 yards and healing up to 5 targets within 10 yards for 525.\r\n\r\n Healing is divided among the number of targets healed. These effects cause no threat.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_holynova.jpg"},[K.GlyphOfInnerFire]:{name:"Glyph of Inner Fire",description:"Increases the armor gained from your Inner Fire spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg"},[K.GlyphOfDeepWells]:{name:"Glyph of Deep Wells",description:"Increases the total amount of charges of your Lightwell by 2.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg"},[K.GlyphOfMassDispel]:{name:"Glyph of Mass Dispel",description:"Causes your Mass Dispel to be potent enough to remove Magic effects that are normally undispellable.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_massdispel.jpg"},[K.GlyphOfPsychicHorror]:{name:"Glyph of Psychic Horror",description:"Reduces the cooldown of your Psychic Horror by -10.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychichorrors.jpg"},[K.GlyphOfHolyFire]:{name:"Glyph of Holy Fire",description:"Increases the range of your Holy Fire, Smite, and Power Word: Solace spells by 10 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_searinglight.jpg"},[K.GlyphOfWeakenedSoul]:{name:"Glyph of Weakened Soul",description:"Reduces the duration of the Weakened Soul effect caused by Power Word: Shield by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_ashestoashes.jpg"},[K.GlyphOfPowerWordShield]:{name:"Glyph of Power Word: Shield",description:"20% of the absorb from your Power Word: Shield spell is converted into healing.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_powerwordshield.jpg"},[K.GlyphOfSpiritOfRedemption]:{name:"Glyph of Spirit of Redemption",description:"Increases the duration of Spirit of Redemption by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_enchant_essenceeternallarge.jpg"},[K.GlyphOfPsychicScream]:{name:"Glyph of Psychic Scream",description:"Targets of your Psychic Scream and your Psyfiend's Psychic Terror now tremble in place instead of fleeing in fear.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychicscream.jpg"},[K.GlyphOfRenew]:{name:"Glyph of Renew",description:"Your Renew heals for 33% more each time it heals, but its duration is reduced by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_renew.jpg"},[K.GlyphOfScourgeImprisonment]:{name:"Glyph of Scourge Imprisonment",description:"Reduces the cast time of your Shackle Undead by 1.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusade.jpg"},[K.GlyphOfMindBlast]:{name:"Glyph of Mind Blast",description:"When you critically hit with your Mind Blast, you cause the target to be unable to move for 4s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unholyfrenzy.jpg"},[K.GlyphOfDispelMagic]:{name:"Glyph of Dispel Magic",description:"Your Dispel Magic spell also damages your target for 4937 Holy damage when you successfully dispel a magical effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_nullifydisease.jpg"},[K.GlyphOfSmite]:{name:"Glyph of Smite",description:"Your Smite spell inflicts an additional 20% damage against targets afflicted by Power Word: Solace, but that additional damage does not get transferred by Atonement.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_holysmite.jpg"},[K.GlyphOfPrayerOfMending]:{name:"Glyph of Prayer of Mending",description:"The first charge of your Prayer of Mending heals for an additional 100% but your Prayer of Mending has 1 fewer 0: charges;.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofmendingtga.jpg"},[K.GlyphOfLevitate]:{name:"Glyph of Levitate",description:"Increases your movement speed while Levitating and for 10 sec afterward by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_pathofdevout.jpg"},[K.GlyphOfReflectiveShield]:{name:"Glyph of Reflective Shield",description:"Causes 70% of the damage you absorb with Power Word: Shield to reflect back at the attacker. This damage causes no threat.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_priest_reflectiveshield.jpg"},[K.GlyphOfDispersion]:{name:"Glyph of Dispersion",description:"Reduces the cooldown on Dispersion by 15 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_dispersion.jpg"},[K.GlyphOfLeapOfFaith]:{name:"Glyph of Leap of Faith",description:"Your Leap of Faith spell now also clears all movement impairing effects from your target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/priest_spell_leapoffaith_a.jpg"},[K.GlyphOfPenance]:{name:"Glyph of Penance",description:"Increases the mana cost of Penance by 20% but allows Penance to be cast while moving.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_penance.jpg"},[K.GlyphOfFocusedMending]:{name:"Glyph of Focused Mending",description:"Causes your Prayer of Mending to only bounce between the target and the caster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingfocus.jpg"},[K.GlyphOfMindSpike]:{name:"Glyph of Mind Spike",description:"Your successful non-instant Mind Spikes, reduce the cast time of your next Mind Blast within 9s by 50%. This effect can stack up to 2 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_mindspike.jpg"},[K.GlyphOfBindingHeal]:{name:"Glyph of Binding Heal",description:"Your Binding Heal spell now heals a third friendly target within 20 yards, but costs 35% more mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_blindingheal.jpg"},[K.GlyphOfMindFlay]:{name:"Glyph of Mind Flay",description:"Your Mind Flay spell no longer slows your victim's movement speed. Instead, each time Mind Flay deals damage you will be granted 15% increased movement speed for 5s, stacking up to 3 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_siphonmana.jpg"},[K.GlyphOfShadowWordDeath]:{name:"Glyph of Shadow Word: Death",description:"Your Shadow Word: Death can now be cast at any time, but deals 25% damage against targets above 20% health and does not generate a Shadow Orb when used against them.\r\n\r\n Casting Shadow Word: Death now also does damage to you equivalent to the damage it would do to an enemy above 20% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonicfortitude.jpg"},[K.GlyphOfVampiricEmbrace]:{name:"Glyph of Vampiric Embrace",description:"Your Vampiric Embrace converts an additional 50% of the damage you deal into healing, but the duration is reduced by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unsummonbuilding.jpg"},[K.GlyphOfLightspring]:{name:"Glyph of Lightspring",description:"Your Lightwell no longer automatically heals nearby targets, but can be clicked by players to deal 50% more healing than normal.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg"},[K.GlyphOfLightwell]:{name:"Glyph of Lightwell",description:"Your Lightwell no longer automatically heals nearby targets, but can be clicked by players to deal 50% more healing than normal.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg"}},minorGlyphs:{[$.GlyphOfShadowRavens]:{name:"Glyph of Shadow Ravens",description:"Your Shadow Orbs now appear as Shadow Ravens.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_shadoworbs.jpg"},[$.GlyphOfBorrowedTime]:{name:"Glyph of Borrowed Time",description:"Your Borrowed Time is now displayed visually.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_borrowedtime.jpg"},[$.GlyphOfShackleUndead]:{name:"Glyph of Shackle Undead",description:"Changes the appearance of your Shackle Undead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg"},[$.GlyphOfDarkArchangel]:{name:"Glyph of Dark Archangel",description:"When you apply Devouring Plague to a target, you take on the form of a Dark Archangel for 8s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonvoidwalker.jpg"},[$.GlyphOfShadow]:{name:"Glyph of Shadow",description:"Alters the appearance of your Shadowform to be less transparent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowform.jpg"},[$.GlyphOfTheHeavens]:{name:"Glyph of the Heavens",description:"Your Levitate targets will appear to be riding on a cloud for the duration of the spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_elemental_primal_air.jpg"},[$.GlyphOfConfession]:{name:"Glyph of Confession",description:"Teaches you the ability Confession.\r\n\r\n Compels a friendly target to confess a secret.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_soothingkiss.jpg"},[$.GlyphOfHolyResurrection]:{name:"Glyph of Holy Resurrection",description:"Your resurrection target appears bathed in holy light for the duration of the Resurrection cast.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_surgeoflight.jpg"},[$.GlyphOfTheValkyr]:{name:"Glyph of the Val'kyr",description:"While Spirit of Redemption is active, you now appear as a Val'kyr.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_boss_svalasorrowgrave.jpg"},[$.GlyphOfShadowyFriends]:{name:"Glyph of Shadowy Friends",description:"Your Shadowform extends to your non-combat pets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antishadow.jpg"},[$.GlyphOfAngels]:{name:"Glyph of Angels",description:"Your heal spells momentarily grant you angelic wings.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_priest_archangel.jpg"},[$.GlyphOfTheSha]:{name:"Glyph of the Sha",description:"Transforms your Shadowfiend and Mindbender into a Sha Beast.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_hand_1h_shaclaw.jpg"},[$.GlyphOfShiftedAppearances]:{name:"Glyph of Shifted Appearances",description:"Void Shift causes you and your target to exchange appearances for several seconds.\r\n\r\n Does not affect mounted players.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_priest_voidshift.jpg"},[$.GlyphOfInspiredHymns]:{name:"Glyph of Inspired Hymns",description:"While channeling Hymns, a spirit appears above you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_divinehymn.jpg"}}},yl=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"nightstalker",fancyName:"Nightstalker",location:{rowIdx:0,colIdx:0},spellId:14062},{fieldName:"subterfuge",fancyName:"Subterfuge",location:{rowIdx:0,colIdx:1},spellId:108208},{fieldName:"shadowFocus",fancyName:"Shadow Focus",location:{rowIdx:0,colIdx:2},spellId:108209},{fieldName:"deadlyThrow",fancyName:"Deadly Throw",location:{rowIdx:1,colIdx:0},spellId:26679},{fieldName:"nerveStrike",fancyName:"Nerve Strike",location:{rowIdx:1,colIdx:1},spellId:108210},{fieldName:"combatReadiness",fancyName:"Combat Readiness",location:{rowIdx:1,colIdx:2},spellId:74001},{fieldName:"cheatDeath",fancyName:"Cheat Death",location:{rowIdx:2,colIdx:0},spellId:31230},{fieldName:"leechingPoison",fancyName:"Leeching Poison",location:{rowIdx:2,colIdx:1},spellId:108211},{fieldName:"elusiveness",fancyName:"Elusiveness",location:{rowIdx:2,colIdx:2},spellId:79008},{fieldName:"cloakAndDagger",fancyName:"Cloak and Dagger",location:{rowIdx:3,colIdx:0},spellId:138106},{fieldName:"shadowstep",fancyName:"Shadowstep",location:{rowIdx:3,colIdx:1},spellId:36554},{fieldName:"burstOfSpeed",fancyName:"Burst of Speed",location:{rowIdx:3,colIdx:2},spellId:108212},{fieldName:"preyOnTheWeak",fancyName:"Prey on the Weak",location:{rowIdx:4,colIdx:0},spellId:131511},{fieldName:"paralyticPoison",fancyName:"Paralytic Poison",location:{rowIdx:4,colIdx:1},spellId:108215},{fieldName:"dirtyTricks",fancyName:"Dirty Tricks",location:{rowIdx:4,colIdx:2},spellId:108216},{fieldName:"shurikenToss",fancyName:"Shuriken Toss",location:{rowIdx:5,colIdx:0},spellId:114014},{fieldName:"markedForDeath",fancyName:"Marked for Death",location:{rowIdx:5,colIdx:1},spellId:137619},{fieldName:"anticipation",fancyName:"Anticipation",location:{rowIdx:5,colIdx:2},spellId:114015}]}),bl={majorGlyphs:{[J.GlyphOfShadowWalk]:{name:"Glyph of Shadow Walk",description:"Your Shadow Walk ability also increases your stealth detection while active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_envelopingshadows.jpg"},[J.GlyphOfAmbush]:{name:"Glyph of Ambush",description:"Increases the range of Ambush by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_ambush.jpg"},[J.GlyphOfBladeFlurry]:{name:"Glyph of Blade Flurry",description:"Your attacks have a 30% higher chance of applying Non-Lethal poisons while Blade Flurry is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_punishingblow.jpg"},[J.GlyphOfSharpKnives]:{name:"Glyph of Sharp Knives",description:"Your Fan of Kinves also damages the armor of its victims, applying 1 application of the Weakened Armor effect to each target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_stone_sharpeningstone_05.jpg"},[J.GlyphOfRecuperate]:{name:"Glyph of Recuperate",description:"Increases the healing of your Recuperate ability by an additional 1.0% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_recuperate.jpg"},[J.GlyphOfEvasion]:{name:"Glyph of Evasion",description:"Increases the duration of Evasion by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowward.jpg"},[J.GlyphOfRecovery]:{name:"Glyph of Recovery",description:"While Recuperate is active, you receive 20% increased healing from other sources.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sturdyrecuperate.jpg"},[J.GlyphOfExposeArmor]:{name:"Glyph of Expose Armor",description:"Your Expose Armor ability causes three applications of Weakened Armor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_riposte.jpg"},[J.GlyphOfFeint]:{name:"Glyph of Feint",description:"Increases the duration of Feint by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg"},[J.GlyphOfGarrote]:{name:"Glyph of Garrote",description:"Increases the duration of your Garrote ability's silence effect by 1.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_garrote.jpg"},[J.GlyphOfGouge]:{name:"Glyph of Gouge",description:"Your Gouge ability no longer requires that the target be facing you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_gouge.jpg"},[J.GlyphOfSmokeBomb]:{name:"Glyph of Smoke Bomb",description:"Increases the duration of your Smoke Bomb by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_smoke.jpg"},[J.GlyphOfCheapShot]:{name:"Glyph of Cheap Shot",description:"Increases the duration of your Cheap Shot by 0.5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_cheapshot.jpg"},[J.GlyphOfHemorraghingVeins]:{name:"Glyph of Hemorraghing Veins",description:"Your Sanguinary Veins ability now also increases damage done to targets affected by your Hemorrhage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofsacrifice.jpg"},[J.GlyphOfKick]:{name:"Glyph of Kick",description:"Increases the cooldown of your Kick ability by 4 sec, but this cooldown is reduced by 6 sec when your Kick successfully interrupts a spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_kick.jpg"},[J.GlyphOfRedirect]:{name:"Glyph of Redirect",description:"Reduces the cooldown of Redirect by 50 seconds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_redirect.jpg"},[J.GlyphOfShiv]:{name:"Glyph of Shiv",description:"Reduces the cooldown of your Shiv ability by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_throwingknife_04.jpg"},[J.GlyphOfSprint]:{name:"Glyph of Sprint",description:"Increases the movement speed of your Sprint ability by an additional 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg"},[J.GlyphOfVendetta]:{name:"Glyph of Vendetta",description:"Reduces the damage bonus of your Vendetta ability by 5% but increases its duration by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_deadliness.jpg"},[J.GlyphOfStealth]:{name:"Glyph of Stealth",description:"Reduces the cooldown of your Stealth ability by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_stealth.jpg"},[J.GlyphOfDeadlyMomentum]:{name:"Glyph of Deadly Momentum",description:"When you land a killing blow on an opponent that yields experience or honor, your Slice and Dice and Recuperate abilities are refreshed to their original duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_deadlymomentum.jpg"},[J.GlyphOfCloakOfShadows]:{name:"Glyph of Cloak of Shadows",description:"While Cloak of Shadows is active, you take 40% less physical damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_nethercloak.jpg"},[J.GlyphOfVanish]:{name:"Glyph of Vanish",description:"Increases the duration of your Vanish effect by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_vanish.jpg"},[J.GlyphOfBlind]:{name:"Glyph of Blind",description:"Your Blind ability also removes all damage over time effects from the target that would cause Blind to break early.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_mindsteal.jpg"}},minorGlyphs:{[Z.GlyphOfDecoy]:{name:"Glyph of Decoy",description:"When you Vanish, you leave behind a brief illusion that very closely resembles you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_vanish.jpg"},[Z.GlyphOfDetection]:{name:"Glyph of Detection",description:"Teaches you the ability Detection.\r\n\r\n Focus intently on trying to detect certain creatures.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_spy.jpg"},[Z.GlyphOfHemorrhage]:{name:"Glyph of Hemorrhage",description:"Your Hemorrhage ability only causes lingering damage over time to targets that were already afflicted by a Bleed effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"},[Z.GlyphOfPickPocket]:{name:"Glyph of Pick Pocket",description:"Increases the range of your Pick Pocket ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bag_11.jpg"},[Z.GlyphOfDistract]:{name:"Glyph of Distract",description:"Increases the range of your Distract ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_distract.jpg"},[Z.GlyphOfPickLock]:{name:"Glyph of Pick Lock",description:"Reduces the cast time of your Pick Lock ability by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_moonkey.jpg"},[Z.GlyphOfSafeFall]:{name:"Glyph of Safe Fall",description:"Increases the distance your Safe Fall ability allows you to fall without taking damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_feather_01.jpg"},[Z.GlyphOfBlurredSpeed]:{name:"Glyph of Blurred Speed",description:"Enables you to walk on water while your Sprint ability is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg"},[Z.GlyphOfPoisons]:{name:"Glyph of Poisons",description:"You apply poisons to your weapons 50% faster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_brewpoison.jpg"},[Z.GlyphOfKillingSpree]:{name:"Glyph of Killing Spree",description:"Your Killing Spree returns you to your starting location when the effect ends.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_murderspree.jpg"},[Z.GlyphOfTricksOfTheTrade]:{name:"Glyph of Tricks of the Trade",description:"Your Tricks of the Trade ability no longer costs Energy, but also no longer increases the damage dealt by the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_tricksofthetrade.jpg"},[Z.GlyphOfDisguise]:{name:"Glyph of Disguise",description:"When you Pick Pocket a humanoid enemy, you also copy their appearance for 0ms. Your disguise will unravel upon entering combat.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_disguise.jpg"},[Z.GlyphOfHeadhunting]:{name:"Glyph of Headhunting",description:"Your Throw and Deadly Throw abilities will now throw axes regardless of your currently equipped weapon.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_throwingaxe_03.jpg"},[Z.GlyphOfImprovedDistraction]:{name:"Glyph of Improved Distraction",description:"Distract now summons a decoy at the target location.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_distract.jpg"}}},vl=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"naturesGuardian",fancyName:"Nature's Guardian",location:{rowIdx:0,colIdx:0},spellId:30884},{fieldName:"stoneBulwarkTotem",fancyName:"Stone Bulwark Totem",location:{rowIdx:0,colIdx:1},spellId:108270},{fieldName:"astralShift",fancyName:"Astral Shift",location:{rowIdx:0,colIdx:2},spellId:108271},{fieldName:"frozenPower",fancyName:"Frozen Power",location:{rowIdx:1,colIdx:0},spellId:63374},{fieldName:"earthgrabTotem",fancyName:"Earthgrab Totem",location:{rowIdx:1,colIdx:1},spellId:51485},{fieldName:"windwalkTotem",fancyName:"Windwalk Totem",location:{rowIdx:1,colIdx:2},spellId:108273},{fieldName:"callOfTheElements",fancyName:"Call of the Elements",location:{rowIdx:2,colIdx:0},spellId:108285},{fieldName:"totemicPersistence",fancyName:"Totemic Persistence",location:{rowIdx:2,colIdx:1},spellId:108284},{fieldName:"totemicProjection",fancyName:"Totemic Projection",location:{rowIdx:2,colIdx:2},spellId:108287},{fieldName:"elementalMastery",fancyName:"Elemental Mastery",location:{rowIdx:3,colIdx:0},spellId:16166},{fieldName:"ancestralSwiftness",fancyName:"Ancestral Swiftness",location:{rowIdx:3,colIdx:1},spellId:16188},{fieldName:"echoOfTheElements",fancyName:"Echo of the Elements",location:{rowIdx:3,colIdx:2},spellId:108283},{fieldName:"rushingStreams",fancyName:"Rushing Streams",location:{rowIdx:4,colIdx:0},spellId:147074},{fieldName:"ancestralGuidance",fancyName:"Ancestral Guidance",location:{rowIdx:4,colIdx:1},spellId:108281},{fieldName:"conductivity",fancyName:"Conductivity",location:{rowIdx:4,colIdx:2},spellId:108282},{fieldName:"unleashedFury",fancyName:"Unleashed Fury",location:{rowIdx:5,colIdx:0},spellId:117012},{fieldName:"primalElementalist",fancyName:"Primal Elementalist",location:{rowIdx:5,colIdx:1},spellId:117013},{fieldName:"elementalBlast",fancyName:"Elemental Blast",location:{rowIdx:5,colIdx:2},spellId:117014}]}),Sl={majorGlyphs:{[Q.GlyphOfUnstableEarth]:{name:"Glyph of Unstable Earth",description:"Causes your Earthquake spell to also reduce the movement speed of affected targets by 40% for 3s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_earthquake.jpg"},[Q.GlyphOfChainLightning]:{name:"Glyph of Chain Lightning",description:"",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_chainlightning.jpg"},[Q.GlyphOfSpiritWalk]:{name:"Glyph of Spirit Walk",description:"Reduces the cooldown of your Spirit Walk ability by 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_tracking.jpg"},[Q.GlyphOfCapacitorTotem]:{name:"Glyph of Capacitor Totem",description:"Reduces the charging time of your Capacitor Totem by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_brilliance.jpg"},[Q.GlyphOfPurge]:{name:"Glyph of Purge",description:"Your Purge dispels 1 additional Magic effect but has a 6 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_purge.jpg"},[Q.GlyphOfFireElementalTotem]:{name:"Glyph of Fire Elemental Totem",description:"Reduces the cooldown and duration of your Fire Elemental Totem by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_elemental_totem.jpg"},[Q.GlyphOfFireNova]:{name:"Glyph of Fire Nova",description:"Increases the radius of your Fire Nova spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_firenova.jpg"},[Q.GlyphOfFlameShock]:{name:"Glyph of Flame Shock",description:"When your Flame Shock deals damage, it heals you for 30% of the damage dealt.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_flameshock.jpg"},[Q.GlyphOfWindShear]:{name:"Glyph of Wind Shear",description:"Increases the school lockout duration of Wind Shear by 1 sec, but also increases the cooldown by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_cyclone.jpg"},[Q.GlyphOfHealingStreamTotem]:{name:"Glyph of Healing Stream Totem",description:"When your Healing Stream Totem heals an ally, it also reduces their Fire, Frost, and Nature damage taken by 10% for 0ms.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_spear_04.jpg"},[Q.GlyphOfHealingWave]:{name:"Glyph of Healing Wave",description:"Your Healing Wave also heals you for 20% of the healing effect when you heal someone else.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg"},[Q.GlyphOfTotemicRecall]:{name:"Glyph of Totemic Recall",description:"Causes your Totemic Recall ability to return the full mana cost of any recalled totems.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_totemrecall.jpg"},[Q.GlyphOfTelluricCurrents]:{name:"Glyph of Telluric Currents",description:"Causes your Lightning Bolt to restore 2% of your mana when it strikes an enemy.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_lightning_lightningbolt01.jpg"},[Q.GlyphOfGroundingTotem]:{name:"Glyph of Grounding Totem",description:"Instead of absorbing a spell, your Grounding Totem reflects the next harmful spell back at its caster, but the cooldown of your Grounding Totem is increased by 20 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_groundingtotem.jpg"},[Q.GlyphOfSpiritwalkersGrace]:{name:"Glyph of Spiritwalker's Grace",description:"Increases the duration of your Spiritwalker's Grace by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_spiritwalkersgrace.jpg"},[Q.GlyphOfWaterShield]:{name:"Glyph of Water Shield",description:"Increases the mana generated reactively by your Water Shield when you are attacked by 50%, but reduces the passive mana generation by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_watershield.jpg"},[Q.GlyphOfCleansingWaters]:{name:"Glyph of Cleansing Waters",description:"When you dispel a harmful Magic or Curse effect from an ally, you also heal the target for 5% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_regeneration_02.jpg"},[Q.GlyphOfFrostShock]:{name:"Glyph of Frost Shock",description:"Decreases the cooldown incurred by your Frost Shock by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostshock.jpg"},[Q.GlyphOfChaining]:{name:"Glyph of Chaining",description:"Increases the jump distance of your Chain Heal spell by 100%, but gives the spell a 2 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_empoweredtouch.jpg"},[Q.GlyphOfHealingStorm]:{name:"Glyph of Healing Storm",description:"Each application of Maelstrom Weapon also increases your direct healing done by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_maelstromweapon.jpg"},[Q.GlyphOfGhostWolf]:{name:"Glyph of Ghost Wolf",description:"While in Ghost Wolf form, you are less hindered by effects that would reduce movement speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_spiritwolf.jpg"},[Q.GlyphOfThunder]:{name:"Glyph of Thunder",description:"Reduces the cooldown on Thunderstorm by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg"},[Q.GlyphOfFeralSpirit]:{name:"Glyph of Feral Spirit",description:"Increases the healing done by your Feral Spirits' Spirit Hunt by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_feralspirit.jpg"},[Q.GlyphOfRiptide]:{name:"Glyph of Riptide",description:"Removes the cooldown of Riptide, but reduces the initial direct healing by 75%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_riptide.jpg"},[Q.GlyphOfShamanisticRage]:{name:"Glyph of Shamanistic Rage",description:"Activating your Shamanistic Rage ability also cleanses you of all dispellable harmful Magic effects.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_shamanrage.jpg"},[Q.GlyphOfHex]:{name:"Glyph of Hex",description:"Reduces the cooldown of your Hex spell by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_hex.jpg"},[Q.GlyphOfTotemicVigor]:{name:"Glyph of Totemic Vigor",description:"Increases the health of your totems by 5% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_relics_totemofrebirth.jpg"},[Q.GlyphOfLightningShield]:{name:"Glyph of Lightning Shield",description:"When your Lightning Shield is triggered, you take 10% less damage for 6s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightningshield.jpg"},[Q.GlyphOfPurging]:{name:"Glyph of Purging",description:"Successfully Purging a target now grants a stack of Maelstrom Weapon.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_improvedreincarnation.jpg"},[Q.GlyphOfEternalEarth]:{name:"Glyph of Eternal Earth",description:"Your Lightning Bolt has a chance to add a charge to your currently active Earth Shield. This cannot cause Earth Shield to exceed 9 charges.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_improvedearthshield.jpg"}},minorGlyphs:{[X.GlyphOfTheLakestrider]:{name:"Glyph of the Lakestrider",description:"You automatically gain Water Walking while you are in Ghost Wolf form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_windwalkon.jpg"},[X.GlyphOfLavaLash]:{name:"Glyph of Lava Lash",description:"Your Lava Lash ability no longer spreads Flame Shock to nearby targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_lavalash.jpg"},[X.GlyphOfAstralRecall]:{name:"Glyph of Astral Recall",description:"Reduces the cooldown of your Astral Recall spell by 5 minutes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_astralrecal.jpg"},[X.GlyphOfFarSight]:{name:"Glyph of Far Sight",description:"Your Far Sight spell may be used indoors.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_farsight.jpg"},[X.GlyphOfTheSpectralWolf]:{name:"Glyph of the Spectral Wolf",description:"Alters the appearance of your Ghost Wolf transformation, causing it to resemble a large, spectral wolf.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_whitedirewolf.jpg"},[X.GlyphOfTotemicEncirclement]:{name:"Glyph of Totemic Encirclement",description:"When you cast a totem spell, you also place unempowered totems for any elements that are not currently active. These totems have 5 health and produce no other effects.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_totemrelocation.jpg"},[X.GlyphOfThunderstorm]:{name:"Glyph of Thunderstorm",description:"Removes the knockback effect from your Thunderstorm spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg"},[X.GlyphOfDeluge]:{name:"Glyph of Deluge",description:"Your Chain Heal now has a watery appearance.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg"},[X.GlyphOfSpiritRaptors]:{name:"Glyph of Spirit Raptors",description:"Your Spirit Wolves are replaced with Spirit Raptors.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_archaeology_dinosaurskeleton.jpg"},[X.GlyphOfLingeringAncestors]:{name:"Glyph of Lingering Ancestors",description:"Resurrecting someone with Ancestral Spirit causes a ghostly ancestor to follow them around for a short time.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_ancestralawakening.jpg"},[X.GlyphOfSpiritWolf]:{name:"Glyph of Spirit Wolf",description:"Ghost Wolf can be now be used while you are a ghost.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_spiritwolf.jpg"},[X.GlyphOfFlamingSerpent]:{name:"Glyph of Flaming Serpent",description:"Your Searing Totem now resembles Vol'jin's Serpent Ward.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_guardianward.jpg"},[X.GlyphOfTheCompy]:{name:"Glyph of the Compy",description:"Your Hex now transforms enemies into a Compy.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_pet_raptor.jpg"},[X.GlyphOfElementalFamiliars]:{name:"Glyph of Elemental Familiars",description:"Summons a random Fire, Water, or Nature familiar. Familiars of different types have a tendency to fight each other.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_pet_pandarenelemental.jpg"},[X.GlyphOfAstralFixation]:{name:"Glyph of Astral Fixation",description:"Astral Recall now takes you to your capital's Earthshrine.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_astralrecalgroup.jpg"},[X.GlyphOfRainOfFrogs]:{name:"Glyph of Rain of Frogs",description:"You summon a rain storm of frogs at your targeted location.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_pet_toad_blue.jpg"}}},Il=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"darkRegeneration",fancyName:"Dark Regeneration",location:{rowIdx:0,colIdx:0},spellId:108359},{fieldName:"soulLeech",fancyName:"Soul Leech",location:{rowIdx:0,colIdx:1},spellId:108370},{fieldName:"harvestLife",fancyName:"Harvest Life",location:{rowIdx:0,colIdx:2},spellId:108371},{fieldName:"demonicBreath",fancyName:"Demonic Breath",location:{rowIdx:1,colIdx:0},spellId:47897},{fieldName:"mortalCoil",fancyName:"Mortal Coil",location:{rowIdx:1,colIdx:1},spellId:6789},{fieldName:"shadowfury",fancyName:"Shadowfury",location:{rowIdx:1,colIdx:2},spellId:30283},{fieldName:"soulLink",fancyName:"Soul Link",location:{rowIdx:2,colIdx:0},spellId:108415},{fieldName:"sacrificialPact",fancyName:"Sacrificial Pact",location:{rowIdx:2,colIdx:1},spellId:108416},{fieldName:"darkBargain",fancyName:"Dark Bargain",location:{rowIdx:2,colIdx:2},spellId:110913},{fieldName:"bloodHorror",fancyName:"Blood Horror",location:{rowIdx:3,colIdx:0},spellId:111397},{fieldName:"burningRush",fancyName:"Burning Rush",location:{rowIdx:3,colIdx:1},spellId:111400},{fieldName:"unboundWill",fancyName:"Unbound Will",location:{rowIdx:3,colIdx:2},spellId:108482},{fieldName:"grimoireOfSupremacy",fancyName:"Grimoire of Supremacy",location:{rowIdx:4,colIdx:0},spellId:108499},{fieldName:"grimoireOfService",fancyName:"Grimoire of Service",location:{rowIdx:4,colIdx:1},spellId:108501},{fieldName:"grimoireOfSacrifice",fancyName:"Grimoire of Sacrifice",location:{rowIdx:4,colIdx:2},spellId:108503},{fieldName:"archimondesDarkness",fancyName:"Archimonde's Darkness",location:{rowIdx:5,colIdx:0},spellId:108505},{fieldName:"kiljaedensCunning",fancyName:"Kil'jaeden's Cunning",location:{rowIdx:5,colIdx:1},spellId:137587},{fieldName:"mannorothsFury",fancyName:"Mannoroth's Fury",location:{rowIdx:5,colIdx:2},spellId:108508}]}),El={majorGlyphs:{[ee.GlyphOfConflagrate]:{name:"Glyph of Conflagrate",description:"Conflagrate no longer requires Immolate to snare the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_fireball.jpg"},[ee.GlyphOfSiphonLife]:{name:"Glyph of Siphon Life",description:"Your Immolate spell will heal you for 0.5% of your maximum health when dealing periodic damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_requiem.jpg"},[ee.GlyphOfFear]:{name:"Glyph of Fear",description:"Your Fear causes the target to tremble in place instead of fleeing in fear.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_possession.jpg"},[ee.GlyphOfDemonTraining]:{name:"Glyph of Demon Training",description:"Improves your demon's special abilities:\r\n\r\n Your Fel Imp 's Firebolt cast time is reduced by 50% and fires in bursts of three.\r\n\r\n Increases your Voidlord 's total armor by 10%.\r\n\r\n Your Shivarra 's Mesmerizes ability also removes all damage over time effects from the target.\r\n\r\n When your Observer uses Clone Magic, you will also be healed for that amount.\r\n\r\n Increases your Wrathguard 's total health by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelhunter.jpg"},[ee.GlyphOfHealthstone]:{name:"Glyph of Healthstone",description:"You receive 100% more healing from using a healthstone, but the health is restored over 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_stone_04.jpg"},[ee.GlyphOfCurseOfTheElements]:{name:"Glyph of Curse of the Elements",description:"Curse of the Elements hits 2 additional nearby targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/warlock_curse_shadow.jpg"},[ee.GlyphOfImpSwarm]:{name:"Glyph of Imp Swarm",description:"Teaches you the ability Imp Swarm.\r\n Requires Demonology.\r\n\r\n |Tinterface/icons/ability_warlock_impoweredimp.blp:24|t Imp Swarm\r\n Summons 4 Wild Imps from the Twisting Nether to attack the target.\r\n\r\n The Wild Imps passive effect is disabled while Imp Swarm is on cooldown. Imp Swarm's cooldown is reduced by spell haste. Also increases Wild Imp's cooldown by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_impoweredimp.jpg"},[ee.GlyphOfHavoc]:{name:"Glyph of Havoc",description:"Havoc gains 3 additional charges, but the cooldown is increased by 35 seconds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_baneofhavoc.jpg"},[ee.GlyphOfSoulstone]:{name:"Glyph of Soulstone",description:"Players resurrected by Soulstone are returned to life with 100% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_04.jpg"},[ee.GlyphOfUnstableAffliction]:{name:"Glyph of Unstable Affliction",description:"Reduces the cast time of Unstable Affliction by 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unstableaffliction_3.jpg"},[ee.GlyphOfSoulConsumption]:{name:"Glyph of Soul Consumption",description:"Your Drain Soul restores 20% of your total health after you kill a target that yields experience or honor. You restore 20% of your total health after you kill a target in Demon Form that yields experience or honor. You restore 20% of your total health after you kill a target with Chaos Bolt that yields experience or honor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_soulsiphon.jpg"},[ee.GlyphOfCurseOfExhaustion]:{name:"Glyph of Curse of Exhaustion",description:"Curse of Exhaustion now reduces the targets movement speed by 30%, lasts half as long and has a 10 second cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_grimward.jpg"},[ee.GlyphOfDrainLife]:{name:"Glyph of Drain Life",description:"Increases the healing of your Drain Life by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain02.jpg"},[ee.GlyphOfDemonHunting]:{name:"Glyph of Demon Hunting",description:"Requires Demonology.\r\n\r\n Teaches you the ability Dark Apotheosis.\r\n\r\n Dark Apotheosis\r\n You imbue yourself with demonic energies, reducing physical damage taken by 10.00%, reduces magic damage taken by 15%, and allows the use of various demonic abilities.\r\n\r\n In addition, Soulshatter becomes Provocation which taunts your target, Twilight Ward becomes Fury Ward which will absorb all schools of damage, Shadow Bolt becomes Demonic Slash, and Fear becomes Sleep.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_metamorphosis.jpg"},[ee.GlyphOfEmberTap]:{name:"Glyph of Ember Tap",description:"Ember Tap heals you for an additional 5% of your health, but the health is restored over 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_ember.jpg"},[ee.GlyphOfDemonicCircle]:{name:"Glyph of Demonic Circle",description:"Reduces the cooldown on Demonic Circle by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demoniccircleteleport.jpg"},[ee.GlyphOfUnendingResolve]:{name:"Glyph of Unending Resolve",description:"The damage reduction of Unending Resolve is reduced by 20%, but the cooldown is reduced by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonictactics.jpg"},[ee.GlyphOfLifeTap]:{name:"Glyph of Life Tap",description:"Your Life Tap no longer consumes health, but instead absorbs 0 healing received. This effect stacks.\r\n\r\n The absorb lasts 30 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_burningspirit.jpg"},[ee.GlyphOfEternalResolve]:{name:"Glyph of Eternal Resolve",description:"Unending Resolve can no longer be activated, but passively provides 10% damage reduction from all sources.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonictactics.jpg"},[ee.GlyphOfSupernova]:{name:"Glyph of Supernova",description:"When you are killed, all enemies within 8 yards take damage equal to 10% of your maximum health per Burning Ember held.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_ragnaros_supernova.jpg"}},minorGlyphs:{[te.GlyphOfHandOfGuldan]:{name:"Glyph of Hand of Gul'dan",description:"Your Hand of Gul'dan can now be targeted at a location.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_handofguldan.jpg"},[te.GlyphOfVerdantSpheres]:{name:"Glyph of Verdant Spheres",description:"Your Soul Shards are transformed into Verdant Spheres.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_enchantedpearlb.jpg"},[te.GlyphOfNightmares]:{name:"Glyph of Nightmares",description:"Your Felsteed and Dreadsteed can cross water while running and leave a trail of flames.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_nightmarehorse.jpg"},[te.GlyphOfFelguard]:{name:"Glyph of Felguard",description:"Your Felguard will equip a random two-handed axe, sword or polearm from your backpack.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelguard.jpg"},[te.GlyphOfHealthFunnel]:{name:"Glyph of Health Funnel",description:"Your Health Funnel instantly restores 15% of your demon's health, but has a 10 sec. cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"},[te.GlyphOfSubtlety]:{name:"Glyph of Subtlety",description:"Your Soul Shards no longer display while out of combat.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_masterofsubtlety.jpg"},[te.GlyphOfShadowBolt]:{name:"Glyph of Shadow Bolt",description:"Splits your Shadow Bolt into three smaller attacks.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowbolt.jpg"},[te.GlyphOfCarrionSwarm]:{name:"Glyph of Carrion Swarm",description:"Your Carrion Swarm no longer knocks targets back.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_demonicpower.jpg"},[te.GlyphOfFallingMeteor]:{name:"Glyph of Falling Meteor",description:"If you use Demonic Leap while falling, you slam into the ground rapidly and will not die from falling damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_meteorstorm.jpg"},[te.GlyphOfUnendingBreath]:{name:"Glyph of Unending Breath",description:"Increases the swim speed of targets affected by your Unending Breath spell by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonbreath.jpg"},[te.GlyphOfEyeOfKilrogg]:{name:"Glyph of Eye of Kilrogg",description:"Your Eye of Kilrogg is no longer stealthed and can now place your Demonic Circle. The casting Warlock must be within line of sight of the Eye of Kilrogg to place the Demonic Circle.\r\n\r\n In addition, the movement speed of your Eye of Kilrogg is increased by 50% and allows it to fly in areas where flying mounts are enabled.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_evileye.jpg"},[te.GlyphOfSubjugateDemon]:{name:"Glyph of Subjugate Demon",description:"Reduces the cast time of your Subjugate Demon spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_enslavedemon.jpg"},[te.GlyphOfSoulwell]:{name:"Glyph of Soulwell",description:"Your soulwell glows with an eerie light.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadesofdarkness.jpg"},[te.GlyphOfCrimsonBanish]:{name:"Glyph of Crimson Banish",description:"Your Banish spell is now red.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_cripple.jpg"},[te.GlyphOfGatewayAttunement]:{name:"Glyph of Gateway Attunement",description:"Demonic Gateways will automatically activate when you step near them.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_warlock_demonicportal_green.jpg"}}},kl=il({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"juggernaut",fancyName:"Juggernaut",location:{rowIdx:0,colIdx:0},spellId:103826},{fieldName:"doubleTime",fancyName:"Double Time",location:{rowIdx:0,colIdx:1},spellId:103827},{fieldName:"warbringer",fancyName:"Warbringer",location:{rowIdx:0,colIdx:2},spellId:103828},{fieldName:"enragedRegeneration",fancyName:"Enraged Regeneration",location:{rowIdx:1,colIdx:0},spellId:55694},{fieldName:"secondWind",fancyName:"Second Wind",location:{rowIdx:1,colIdx:1},spellId:29838},{fieldName:"impendingVictory",fancyName:"Impending Victory",location:{rowIdx:1,colIdx:2},spellId:103840},{fieldName:"staggeringShout",fancyName:"Staggering Shout",location:{rowIdx:2,colIdx:0},spellId:107566},{fieldName:"piercingHowl",fancyName:"Piercing Howl",location:{rowIdx:2,colIdx:1},spellId:12323},{fieldName:"disruptingShout",fancyName:"Disrupting Shout",location:{rowIdx:2,colIdx:2},spellId:102060},{fieldName:"bladestorm",fancyName:"Bladestorm",location:{rowIdx:3,colIdx:0},spellId:46924},{fieldName:"shockwave",fancyName:"Shockwave",location:{rowIdx:3,colIdx:1},spellId:46968},{fieldName:"dragonRoar",fancyName:"Dragon Roar",location:{rowIdx:3,colIdx:2},spellId:118e3},{fieldName:"massSpellReflection",fancyName:"Mass Spell Reflection",location:{rowIdx:4,colIdx:0},spellId:114028},{fieldName:"safeguard",fancyName:"Safeguard",location:{rowIdx:4,colIdx:1},spellId:114029},{fieldName:"vigilance",fancyName:"Vigilance",location:{rowIdx:4,colIdx:2},spellId:114030},{fieldName:"avatar",fancyName:"Avatar",location:{rowIdx:5,colIdx:0},spellId:107574},{fieldName:"bloodbath",fancyName:"Bloodbath",location:{rowIdx:5,colIdx:1},spellId:12292},{fieldName:"stormBolt",fancyName:"Storm Bolt",location:{rowIdx:5,colIdx:2},spellId:107570}]}),Cl={majorGlyphs:{[ae.GlyphOfLongCharge]:{name:"Glyph of Long Charge",description:"Increases the range of your Charge ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_charge.jpg"},[ae.GlyphOfUnendingRage]:{name:"Glyph of Unending Rage",description:"Increases your maximum Rage by 20.0.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_intensifyrage.jpg"},[ae.GlyphOfEnragedSpeed]:{name:"Glyph of Enraged Speed",description:"While Enraged, you move 20% faster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_racial_bloodrage.jpg"},[ae.GlyphOfHinderingStrikes]:{name:"Glyph of Hindering Strikes",description:"Your Heroic Strike and Cleave now also reduce the target's movement speed by 50% for 8s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_cleave.jpg"},[ae.GlyphOfHeavyRepercussions]:{name:"Glyph of Heavy Repercussions",description:"While your Shield Block is active, your Shield Slam hits for an additional 50% damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_defend.jpg"},[ae.GlyphOfBloodthirst]:{name:"Glyph of Bloodthirst",description:"Increases the healing of Bloodthirst by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_bloodlust.jpg"},[ae.GlyphOfRudeInterruption]:{name:"Glyph of Rude Interruption",description:"Successfully interrupting a spell with Pummel increases your damage by 6% for 20s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_commandingshout.jpg"},[ae.GlyphOfGagOrder]:{name:"Glyph of Gag Order",description:"Your Pummel and Heroic Throw also silence the target for 3s. Does not work against players.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_axe_66.jpg"},[ae.GlyphOfBlitz]:{name:"Glyph of Blitz",description:"Your Charge also roots and snares an additional 2 nearby targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_victoryrush.jpg"},[ae.GlyphOfMortalStrike]:{name:"Glyph of Mortal Strike",description:"When your Mortal Strike is affecting a target, healing effects on you are increased by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_savageblow.jpg"},[ae.GlyphOfDieByTheSword]:{name:"Glyph of Die by the Sword",description:"While Die by the Sword is active, using Overpower increases its duration by 1 sec and using Wild Strike increases its duration by 0.5 sec per use.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_challange.jpg"},[ae.GlyphOfHamstring]:{name:"Glyph of Hamstring",description:"When you spend Rage to apply Hamstring, the Rage cost of your next Hamstring is reduced by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shockwave.jpg"},[ae.GlyphOfHoldTheLine]:{name:"Glyph of Hold the Line",description:"Improves the damage of your next Revenge by 50% following a successful parry.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_revenge.jpg"},[ae.GlyphOfShieldSlam]:{name:"Glyph of Shield Slam",description:"Your Shield Slam now dispels 1 magical effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_shield_05.jpg"},[ae.GlyphOfHoarseVoice]:{name:"Glyph of Hoarse Voice",description:"Reduces the cooldown and Rage generation of your Battle and Commanding Shout by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_battleshout.jpg"},[ae.GlyphOfSweepingStrikes]:{name:"Glyph of Sweeping Strikes",description:"When you hit a target with Sweeping Strikes, you gain 1.0 Rage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_slicedice.jpg"},[ae.GlyphOfResonatingPower]:{name:"Glyph of Resonating Power",description:"Increases the damage and cooldown of Thunder Clap by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_thunderclap.jpg"},[ae.GlyphOfVictoryRush]:{name:"Glyph of Victory Rush",description:"Increases the total healing provided by your Victory Rush by 50%.\r\n This glyph has no effect if combined with the Impending Victory talent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg"},[ae.GlyphOfRagingWind]:{name:"Glyph of Raging Wind",description:"Your Raging Blow hits increase the damage of your next Whirlwind by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_swiftstrike.jpg"},[ae.GlyphOfWhirlwind]:{name:"Glyph of Whirlwind",description:"Increases the radius of Whirlwind by 4 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_whirlwind.jpg"},[ae.GlyphOfDeathFromAbove]:{name:"Glyph of Death From Above",description:"Reduces the cooldown on Heroic Leap by 15 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_heroicleap.jpg"},[ae.GlyphOfVictoriousThrow]:{name:"Glyph of Victorious Throw",description:"Increases the range of Victory Rush and Impending Victory by 15 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_warrior_wildstrike.jpg"},[ae.GlyphOfSpellReflection]:{name:"Glyph of Spell Reflection",description:"Reduces the cooldown on Spell Reflection by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldreflection.jpg"},[ae.GlyphOfShieldWall]:{name:"Glyph of Shield Wall",description:"Shield Wall now reduces damage taken by an additional 20%, but its cooldown is increased by 2 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldwall.jpg"},[ae.GlyphOfColossusSmash]:{name:"Glyph of Colossus Smash",description:"Your Colossus Smash also applies the Sunder Armor effect to your target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_colossussmash.jpg"},[ae.GlyphOfBullRush]:{name:"Glyph of Bull Rush",description:"Your Charge generates 15 additional Rage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_tauren_male.jpg"},[ae.GlyphOfRecklessness]:{name:"Glyph of Recklessness",description:"Decreases the critical chance of Recklessness by 12% but increases its duration by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_criticalstrike.jpg"},[ae.GlyphOfIncite]:{name:"Glyph of Incite",description:"Using Demoralizing Shout makes your next 3 Heroic Strike or Cleave abilities free.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_incite.jpg"},[ae.GlyphOfImpalingThrows]:{name:"Glyph of Impaling Throws",description:"Heroic Throw now leaves an axe in the target, which can be retrieved by moving within 5 yards of the target to finish the cooldown of Heroic Throw. This effect will only occur when Heroic Throw is cast from more than 10 yards away from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_axe_05.jpg"},[ae.GlyphOfTheExecutor]:{name:"Glyph of the Executor",description:"Killing an enemy with Execute grants you 30 rage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/warrior_talent_icon_lambstotheslaughter.jpg"}},minorGlyphs:{[ie.GlyphOfMysticShout]:{name:"Glyph of Mystic Shout",description:"Your Battle Shout and Commanding Shout cause you to hover in the air for 1s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_battleshout.jpg"},[ie.GlyphOfBloodcurdlingShout]:{name:"Glyph of Bloodcurdling Shout",description:"Your Battle Shout and Commanding Shout terrify small animals.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_furiousresolve.jpg"},[ie.GlyphOfGushingWound]:{name:"Glyph of Gushing Wound",description:"Your Deep Wounds are even bloodier than normal.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_backstab.jpg"},[ie.GlyphOfMightyVictory]:{name:"Glyph of Mighty Victory",description:"When your Victory Rush or Impending Victory heal you, you grow slightly larger.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg"},[ie.GlyphOfBloodyHealing]:{name:"Glyph of Bloody Healing",description:"Increases the healing you receive from bandages by 20% while your Deep Wounds is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_backstab.jpg"},[ie.GlyphOfIntimidatingShout]:{name:"Glyph of Intimidating Shout",description:"All targets of your Intimidating Shout now tremble in place instead of fleeing in fear.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_golemthunderclap.jpg"},[ie.GlyphOfThunderStrike]:{name:"Glyph of Thunder Strike",description:"Your Thunder Clap visual includes a lightning strike.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_thunderclap.jpg"},[ie.GlyphOfCrowFeast]:{name:"Glyph of Crow Feast",description:"Your Execute critical strikes summon a flock of carrion birds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_sword_48.jpg"},[ie.GlyphOfBurningAnger]:{name:"Glyph of Burning Anger",description:"You get so angry when Enraged that you catch on fire.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unholyfrenzy.jpg"},[ie.GlyphOfTheBlazingTrail]:{name:"Glyph of the Blazing Trail",description:"Your Charge leaves a trail of fire in its wake. If you're going to Charge why not do it with some style?",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_burningspeed.jpg"},[ie.GlyphOfTheRagingWhirlwind]:{name:"Glyph of the Raging Whirlwind",description:"Whirlwind gives you 15 rage over 6s, but for that time you no longer generate rage from autoattacks.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_unleashedrage.jpg"},[ie.GlyphOfTheSubtleDefender]:{name:"Glyph of the Subtle Defender",description:"Removes the threat generation bonus from Defensive Stance.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldguard.jpg"},[ie.GlyphOfTheWatchfulEye]:{name:"Glyph of the Watchful Eye",description:"Intervene will now target the party or raid member with the lowest health within 25 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_bloodyeye.jpg"},[ie.GlyphOfTheWeaponmaster]:{name:"Glyph of the Weaponmaster",description:"Your Shout abilities cause the appearance of your weapon to change to that of a random weapon from your primary bag for 0ms.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_weaponmastery.jpg"}}},_l={[se.ClassUnknown]:null,[se.ClassDeathKnight]:sl,[se.ClassDruid]:ol,[se.ClassShaman]:vl,[se.ClassHunter]:rl,[se.ClassMage]:hl,[se.ClassMonk]:dl,[se.ClassRogue]:yl,[se.ClassPaladin]:ul,[se.ClassPriest]:fl,[se.ClassWarlock]:Il,[se.ClassWarrior]:kl},xl={[se.ClassUnknown]:{majorGlyphs:[],minorGlyphs:[]},[se.ClassDeathKnight]:nl,[se.ClassDruid]:ll,[se.ClassShaman]:Sl,[se.ClassHunter]:cl,[se.ClassMage]:ml,[se.ClassMonk]:pl,[se.ClassRogue]:bl,[se.ClassPaladin]:gl,[se.ClassPriest]:wl,[se.ClassWarlock]:El,[se.ClassWarrior]:Cl};function Tl(e,t){return function(e,t,a){const{talents:i}=a,s=t.split("").map(Number);return i.forEach((t=>{e[t.fieldName]=!1})),s.forEach(((t,a)=>{const s=Number(t),n=i.find((e=>e.location.rowIdx==a&&e.location.colIdx==s));n&&(e[n.fieldName]=!0)})),e}(ne[e.specID].talentsCreate(),t,_l[e.classID])}class Pl extends Yo{constructor(e,i){super(e,i,{title:"Addon Import",allowFileUpload:!0});const s=a();this.descriptionElem.appendChild(t(r,null,t("p",null,"Import settings from the"," ",t("a",{href:"https://www.curseforge.com/wow/addons/wowsimsexporter",target:"_blank"},"WoWSims Exporter In-Game Addon"),"."),t("p",null,"This feature imports gear, race, talents, glyphs, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),t("p",null,"To import, paste the output from the addon below and click, 'Import'."),t("div",{ref:s}))),s.value&&new mo({title:"Reforging issues",body:t(r,null,"There are known issues with Reforging when using the WSE addon.",t("br",null),"Always make sure to double check your reforges after importing."),additionalClasses:["toast-import-warning"],container:s.value,variant:"warning",canClose:!1,autoShow:!0,autohide:!1})}async onImport(e){let t;try{t=JSON.parse(e)}catch{throw new Error("Please use a valid Addon export.")}const a=oe(t.class||"");if(a==se.ClassUnknown)throw new Error("Could not parse Class!");const i=le(t.race||"");if(i==re.RaceUnknown)throw new Error("Could not parse Race!");const s=t.professions.map((e=>ce(e.name)));s.forEach(((e,a)=>{if(e==he.ProfessionUnknown)throw new Error(`Could not parse profession '${t.professions[a]}'`)}));const n=t.talents||"",o=xl[a],l=await D.get(),r=t.glyphs.major.map((e=>Rl(e,l,o.majorGlyphs))),c=t.glyphs.minor.map((e=>Rl(e,l,o.minorGlyphs))),h=me.create({major1:r[0]||0,major2:r[1]||0,major3:r[2]||0,minor1:c[0]||0,minor2:c[1]||0,minor3:c[2]||0}),m=t.gear;m.items=m.items.filter((e=>null!=e)),delete m.version,m.items.forEach((e=>{e.gems&&(e.gems=e.gems.map((e=>e||0)))}));const d=N.fromJson(m);this.finishIndividualImport(this.simUI,a,i,d,n,h,s)}}function Rl(e,t,a){return"string"==typeof e?function(e,t){if(!e)return 0;for(const a in t)if(t[a].name==e)return parseInt(a);throw new Error(`Unknown glyph name '${e}'`)}(e,a):t.glyphSpellToItemId(e.spellID)}class Dl extends Yo{constructor(e,a){super(e,a,{title:"JSON Import",allowFileUpload:!0}),this.descriptionElem.appendChild(t(r,null,t("p",null,"Import settings from a JSON file, which can be created using the JSON Export feature."),t("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){let t=null;try{t=de.fromJsonString(e,{ignoreUnknownFields:!0})}catch{throw new Error("Please use a valid JSON object.")}t.player?.equipment&&await D.loadLeftoversIfNecessary(t.player.equipment),this.simUI.isWithinRaidSim?t.player&&this.simUI.player.fromProto(o.nextEventID(),t.player):this.simUI.fromProto(o.nextEventID(),t),this.close()}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Nl(e){let t=e.length;for(;--t>=0;)e[t]=0}const Gl=256,Ul=286,Ol=30,Al=15,Ll=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),Vl=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),Fl=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),Ml=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Wl=new Array(576);Nl(Wl);const zl=new Array(60);Nl(zl);const jl=new Array(512);Nl(jl);const Bl=new Array(256);Nl(Bl);const Hl=new Array(29);Nl(Hl);const ql=new Array(Ol);function Yl(e,t,a,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}let Kl,$l,Jl;function Zl(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Nl(ql);const Ql=e=>e<256?jl[e]:jl[256+(e>>>7)],Xl=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},er=(e,t,a)=>{e.bi_valid>16-a?(e.bi_buf|=t<<e.bi_valid&65535,Xl(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=a-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=a)},tr=(e,t,a)=>{er(e,a[2*t],a[2*t+1])},ar=(e,t)=>{let a=0;do{a|=1&e,e>>>=1,a<<=1}while(--t>0);return a>>>1},ir=(e,t,a)=>{const i=new Array(16);let s,n,o=0;for(s=1;s<=Al;s++)o=o+a[s-1]<<1,i[s]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=ar(i[t]++,t))}},sr=e=>{let t;for(t=0;t<Ul;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Ol;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},nr=e=>{e.bi_valid>8?Xl(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},or=(e,t,a,i)=>{const s=2*t,n=2*a;return e[s]<e[n]||e[s]===e[n]&&i[t]<=i[a]},lr=(e,t,a)=>{const i=e.heap[a];let s=a<<1;for(;s<=e.heap_len&&(s<e.heap_len&&or(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!or(t,i,e.heap[s],e.depth));)e.heap[a]=e.heap[s],a=s,s<<=1;e.heap[a]=i},rr=(e,t,a)=>{let i,s,n,o,l=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+l++],i+=(255&e.pending_buf[e.sym_buf+l++])<<8,s=e.pending_buf[e.sym_buf+l++],0===i?tr(e,s,t):(n=Bl[s],tr(e,n+Gl+1,t),o=Ll[n],0!==o&&(s-=Hl[n],er(e,s,o)),i--,n=Ql(i),tr(e,n,a),o=Vl[n],0!==o&&(i-=ql[n],er(e,i,o)))}while(l<e.sym_next);tr(e,256,t)},cr=(e,t)=>{const a=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,l,r,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==a[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):a[2*o+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=c<2?++c:0,a[2*r]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=i[2*r+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)lr(e,a,o);r=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],lr(e,a,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,a[2*r]=a[2*o]+a[2*l],e.depth[r]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,a[2*o+1]=a[2*l+1]=r,e.heap[1]=r++,lr(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const a=t.dyn_tree,i=t.max_code,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,r=t.stat_desc.max_length;let c,h,m,d,p,u,g=0;for(d=0;d<=Al;d++)e.bl_count[d]=0;for(a[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)h=e.heap[c],d=a[2*a[2*h+1]+1]+1,d>r&&(d=r,g++),a[2*h+1]=d,h>i||(e.bl_count[d]++,p=0,h>=l&&(p=o[h-l]),u=a[2*h],e.opt_len+=u*(d+p),n&&(e.static_len+=u*(s[2*h+1]+p)));if(0!==g){do{for(d=r-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[r]--,g-=2}while(g>0);for(d=r;0!==d;d--)for(h=e.bl_count[d];0!==h;)m=e.heap[--c],m>i||(a[2*m+1]!==d&&(e.opt_len+=(d-a[2*m+1])*a[2*m],a[2*m+1]=d),h--)}})(e,t),ir(a,c,e.bl_count)},hr=(e,t,a)=>{let i,s,n=-1,o=t[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),t[2*(a+1)+1]=65535,i=0;i<=a;i++)s=o,o=t[2*(i+1)+1],++l<r&&s===o||(l<c?e.bl_tree[2*s]+=l:0!==s?(s!==n&&e.bl_tree[2*s]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,n=s,0===o?(r=138,c=3):s===o?(r=6,c=3):(r=7,c=4))},mr=(e,t,a)=>{let i,s,n=-1,o=t[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),i=0;i<=a;i++)if(s=o,o=t[2*(i+1)+1],!(++l<r&&s===o)){if(l<c)do{tr(e,s,e.bl_tree)}while(0!=--l);else 0!==s?(s!==n&&(tr(e,s,e.bl_tree),l--),tr(e,16,e.bl_tree),er(e,l-3,2)):l<=10?(tr(e,17,e.bl_tree),er(e,l-3,3)):(tr(e,18,e.bl_tree),er(e,l-11,7));l=0,n=s,0===o?(r=138,c=3):s===o?(r=6,c=3):(r=7,c=4)}};let dr=!1;const pr=(e,t,a,i)=>{er(e,0+(i?1:0),3),nr(e),Xl(e,a),Xl(e,~a),a&&e.pending_buf.set(e.window.subarray(t,t+a),e.pending),e.pending+=a};var ur={_tr_init:e=>{dr||((()=>{let e,t,a,i,s;const n=new Array(16);for(a=0,i=0;i<28;i++)for(Hl[i]=a,e=0;e<1<<Ll[i];e++)Bl[a++]=i;for(Bl[a-1]=i,s=0,i=0;i<16;i++)for(ql[i]=s,e=0;e<1<<Vl[i];e++)jl[s++]=i;for(s>>=7;i<Ol;i++)for(ql[i]=s<<7,e=0;e<1<<Vl[i]-7;e++)jl[256+s++]=i;for(t=0;t<=Al;t++)n[t]=0;for(e=0;e<=143;)Wl[2*e+1]=8,e++,n[8]++;for(;e<=255;)Wl[2*e+1]=9,e++,n[9]++;for(;e<=279;)Wl[2*e+1]=7,e++,n[7]++;for(;e<=287;)Wl[2*e+1]=8,e++,n[8]++;for(ir(Wl,287,n),e=0;e<Ol;e++)zl[2*e+1]=5,zl[2*e]=ar(e,5);Kl=new Yl(Wl,Ll,257,Ul,Al),$l=new Yl(zl,Vl,0,Ol,Al),Jl=new Yl(new Array(0),Fl,0,19,7)})(),dr=!0),e.l_desc=new Zl(e.dyn_ltree,Kl),e.d_desc=new Zl(e.dyn_dtree,$l),e.bl_desc=new Zl(e.bl_tree,Jl),e.bi_buf=0,e.bi_valid=0,sr(e)},_tr_stored_block:pr,_tr_flush_block:(e,t,a,i)=>{let s,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,a=4093624447;for(t=0;t<=31;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Gl;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),cr(e,e.l_desc),cr(e,e.d_desc),o=(e=>{let t;for(hr(e,e.dyn_ltree,e.l_desc.max_code),hr(e,e.dyn_dtree,e.d_desc.max_code),cr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*Ml[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=s&&(s=n)):s=n=a+5,a+4<=s&&-1!==t?pr(e,t,a,i):4===e.strategy||n===s?(er(e,2+(i?1:0),3),rr(e,Wl,zl)):(er(e,4+(i?1:0),3),((e,t,a,i)=>{let s;for(er(e,t-257,5),er(e,a-1,5),er(e,i-4,4),s=0;s<i;s++)er(e,e.bl_tree[2*Ml[s]+1],3);mr(e,e.dyn_ltree,t-1),mr(e,e.dyn_dtree,a-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),rr(e,e.dyn_ltree,e.dyn_dtree)),sr(e),i&&nr(e)},_tr_tally:(e,t,a)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=a,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(Bl[a]+Gl+1)]++,e.dyn_dtree[2*Ql(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{er(e,2,3),tr(e,256,Wl),(e=>{16===e.bi_valid?(Xl(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var gr=(e,t,a,i)=>{let s=65535&e,n=e>>>16&65535,o=0;for(;0!==a;){o=a>2e3?2e3:a,a-=o;do{s=s+t[i++]|0,n=n+s|0}while(--o);s%=65521,n%=65521}return s|n<<16};const fr=new Uint32Array((()=>{let e,t=[];for(var a=0;a<256;a++){e=a;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());var wr=(e,t,a,i)=>{const s=fr,n=i+a;e^=-1;for(let o=i;o<n;o++)e=e>>>8^s[255&(e^t[o])];return~e},yr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},br={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:vr,_tr_stored_block:Sr,_tr_flush_block:Ir,_tr_tally:Er,_tr_align:kr}=ur,{Z_NO_FLUSH:Cr,Z_PARTIAL_FLUSH:_r,Z_FULL_FLUSH:xr,Z_FINISH:Tr,Z_BLOCK:Pr,Z_OK:Rr,Z_STREAM_END:Dr,Z_STREAM_ERROR:Nr,Z_DATA_ERROR:Gr,Z_BUF_ERROR:Ur,Z_DEFAULT_COMPRESSION:Or,Z_FILTERED:Ar,Z_HUFFMAN_ONLY:Lr,Z_RLE:Vr,Z_FIXED:Fr,Z_DEFAULT_STRATEGY:Mr,Z_UNKNOWN:Wr,Z_DEFLATED:zr}=br,jr=258,Br=262,Hr=42,qr=113,Yr=666,Kr=(e,t)=>(e.msg=yr[t],t),$r=e=>2*e-(e>4?9:0),Jr=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Zr=e=>{let t,a,i,s=e.w_size;t=e.hash_size,i=t;do{a=e.head[--i],e.head[i]=a>=s?a-s:0}while(--t);t=s,i=t;do{a=e.prev[--i],e.prev[i]=a>=s?a-s:0}while(--t)};let Qr=(e,t,a)=>(t<<e.hash_shift^a)&e.hash_mask;const Xr=e=>{const t=e.state;let a=t.pending;a>e.avail_out&&(a=e.avail_out),0!==a&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+a),e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))},ec=(e,t)=>{Ir(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Xr(e.strm)},tc=(e,t)=>{e.pending_buf[e.pending++]=t},ac=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},ic=(e,t,a,i)=>{let s=e.avail_in;return s>i&&(s=i),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),a),1===e.state.wrap?e.adler=gr(e.adler,t,s,a):2===e.state.wrap&&(e.adler=wr(e.adler,t,s,a)),e.next_in+=s,e.total_in+=s,s)},sc=(e,t)=>{let a,i,s=e.max_chain_length,n=e.strstart,o=e.prev_length,l=e.nice_match;const r=e.strstart>e.w_size-Br?e.strstart-(e.w_size-Br):0,c=e.window,h=e.w_mask,m=e.prev,d=e.strstart+jr;let p=c[n+o-1],u=c[n+o];e.prev_length>=e.good_match&&(s>>=2),l>e.lookahead&&(l=e.lookahead);do{if(a=t,c[a+o]===u&&c[a+o-1]===p&&c[a]===c[n]&&c[++a]===c[n+1]){n+=2,a++;do{}while(c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&n<d);if(i=jr-(d-n),n=d-jr,i>o){if(e.match_start=t,o=i,i>=l)break;p=c[n+o-1],u=c[n+o]}}}while((t=m[t&h])>r&&0!=--s);return o<=e.lookahead?o:e.lookahead},nc=e=>{const t=e.w_size;let a,i,s;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Br)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),Zr(e),i+=t),0===e.strm.avail_in)break;if(a=ic(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=a,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=Qr(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=Qr(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Br&&0!==e.strm.avail_in)},oc=(e,t)=>{let a,i,s,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,l=e.strm.avail_in;do{if(a=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,i=e.strstart-e.block_start,a>i+e.strm.avail_in&&(a=i+e.strm.avail_in),a>s&&(a=s),a<n&&(0===a&&t!==Tr||t===Cr||a!==i+e.strm.avail_in))break;o=t===Tr&&a===i+e.strm.avail_in?1:0,Sr(e,0,0,o),e.pending_buf[e.pending-4]=a,e.pending_buf[e.pending-3]=a>>8,e.pending_buf[e.pending-2]=~a,e.pending_buf[e.pending-1]=~a>>8,Xr(e.strm),i&&(i>a&&(i=a),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,a-=i),a&&(ic(e.strm,e.strm.output,e.strm.next_out,a),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a)}while(0===o);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Cr&&t!==Tr&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(ic(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,n=s>e.w_size?e.w_size:s,i=e.strstart-e.block_start,(i>=n||(i||t===Tr)&&t!==Cr&&0===e.strm.avail_in&&i<=s)&&(a=i>s?s:i,o=t===Tr&&0===e.strm.avail_in&&a===i?1:0,Sr(e,e.block_start,a,o),e.block_start+=a,Xr(e.strm)),o?3:1)},lc=(e,t)=>{let a,i;for(;;){if(e.lookahead<Br){if(nc(e),e.lookahead<Br&&t===Cr)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=Qr(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-Br&&(e.match_length=sc(e,a)),e.match_length>=3)if(i=Er(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Qr(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Qr(e,e.ins_h,e.window[e.strstart+1]);else i=Er(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(ec(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Tr?(ec(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ec(e,!1),0===e.strm.avail_out)?1:2},rc=(e,t)=>{let a,i,s;for(;;){if(e.lookahead<Br){if(nc(e),e.lookahead<Br&&t===Cr)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=Qr(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-Br&&(e.match_length=sc(e,a),e.match_length<=5&&(e.strategy===Ar||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=Er(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=Qr(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(ec(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=Er(e,0,e.window[e.strstart-1]),i&&ec(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Er(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Tr?(ec(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ec(e,!1),0===e.strm.avail_out)?1:2};function cc(e,t,a,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=i,this.func=s}const hc=[new cc(0,0,0,0,oc),new cc(4,4,8,4,lc),new cc(4,5,16,8,lc),new cc(4,6,32,32,lc),new cc(4,4,16,16,rc),new cc(8,16,32,32,rc),new cc(8,16,128,128,rc),new cc(8,32,128,256,rc),new cc(32,128,258,1024,rc),new cc(32,258,258,4096,rc)];function mc(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=zr,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Jr(this.dyn_ltree),Jr(this.dyn_dtree),Jr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Jr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Jr(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const dc=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Hr&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==qr&&t.status!==Yr?1:0},pc=e=>{if(dc(e))return Kr(e,Nr);e.total_in=e.total_out=0,e.data_type=Wr;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Hr:qr,e.adler=2===t.wrap?0:1,t.last_flush=-2,vr(t),Rr},uc=e=>{const t=pc(e);var a;return t===Rr&&((a=e.state).window_size=2*a.w_size,Jr(a.head),a.max_lazy_match=hc[a.level].max_lazy,a.good_match=hc[a.level].good_length,a.nice_match=hc[a.level].nice_length,a.max_chain_length=hc[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),t},gc=(e,t,a,i,s,n)=>{if(!e)return Nr;let o=1;if(t===Or&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),s<1||s>9||a!==zr||i<8||i>15||t<0||t>9||n<0||n>Fr||8===i&&1!==o)return Kr(e,Nr);8===i&&(i=9);const l=new mc;return e.state=l,l.strm=e,l.status=Hr,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=n,l.method=a,uc(e)};var fc={deflateInit:(e,t)=>gc(e,t,zr,15,8,Mr),deflateInit2:gc,deflateReset:uc,deflateResetKeep:pc,deflateSetHeader:(e,t)=>dc(e)||2!==e.state.wrap?Nr:(e.state.gzhead=t,Rr),deflate:(e,t)=>{if(dc(e)||t>Pr||t<0)return e?Kr(e,Nr):Nr;const a=e.state;if(!e.output||0!==e.avail_in&&!e.input||a.status===Yr&&t!==Tr)return Kr(e,0===e.avail_out?Ur:Nr);const i=a.last_flush;if(a.last_flush=t,0!==a.pending){if(Xr(e),0===e.avail_out)return a.last_flush=-1,Rr}else if(0===e.avail_in&&$r(t)<=$r(i)&&t!==Tr)return Kr(e,Ur);if(a.status===Yr&&0!==e.avail_in)return Kr(e,Ur);if(a.status===Hr&&0===a.wrap&&(a.status=qr),a.status===Hr){let t=zr+(a.w_bits-8<<4)<<8,i=-1;if(i=a.strategy>=Lr||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=i<<6,0!==a.strstart&&(t|=32),t+=31-t%31,ac(a,t),0!==a.strstart&&(ac(a,e.adler>>>16),ac(a,65535&e.adler)),e.adler=1,a.status=qr,Xr(e),0!==a.pending)return a.last_flush=-1,Rr}if(57===a.status)if(e.adler=0,tc(a,31),tc(a,139),tc(a,8),a.gzhead)tc(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),tc(a,255&a.gzhead.time),tc(a,a.gzhead.time>>8&255),tc(a,a.gzhead.time>>16&255),tc(a,a.gzhead.time>>24&255),tc(a,9===a.level?2:a.strategy>=Lr||a.level<2?4:0),tc(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(tc(a,255&a.gzhead.extra.length),tc(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=wr(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(tc(a,0),tc(a,0),tc(a,0),tc(a,0),tc(a,0),tc(a,9===a.level?2:a.strategy>=Lr||a.level<2?4:0),tc(a,3),a.status=qr,Xr(e),0!==a.pending)return a.last_flush=-1,Rr;if(69===a.status){if(a.gzhead.extra){let t=a.pending,i=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+i>a.pending_buf_size;){let s=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+s),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>t&&(e.adler=wr(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex+=s,Xr(e),0!==a.pending)return a.last_flush=-1,Rr;t=0,i-=s}let s=new Uint8Array(a.gzhead.extra);a.pending_buf.set(s.subarray(a.gzindex,a.gzindex+i),a.pending),a.pending+=i,a.gzhead.hcrc&&a.pending>t&&(e.adler=wr(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let t,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(e.adler=wr(e.adler,a.pending_buf,a.pending-i,i)),Xr(e),0!==a.pending)return a.last_flush=-1,Rr;i=0}t=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,tc(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>i&&(e.adler=wr(e.adler,a.pending_buf,a.pending-i,i)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let t,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(e.adler=wr(e.adler,a.pending_buf,a.pending-i,i)),Xr(e),0!==a.pending)return a.last_flush=-1,Rr;i=0}t=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,tc(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>i&&(e.adler=wr(e.adler,a.pending_buf,a.pending-i,i))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(Xr(e),0!==a.pending))return a.last_flush=-1,Rr;tc(a,255&e.adler),tc(a,e.adler>>8&255),e.adler=0}if(a.status=qr,Xr(e),0!==a.pending)return a.last_flush=-1,Rr}if(0!==e.avail_in||0!==a.lookahead||t!==Cr&&a.status!==Yr){let i=0===a.level?oc(a,t):a.strategy===Lr?((e,t)=>{let a;for(;;){if(0===e.lookahead&&(nc(e),0===e.lookahead)){if(t===Cr)return 1;break}if(e.match_length=0,a=Er(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(ec(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Tr?(ec(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ec(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===Vr?((e,t)=>{let a,i,s,n;const o=e.window;for(;;){if(e.lookahead<=jr){if(nc(e),e.lookahead<=jr&&t===Cr)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,i=o[s],i===o[++s]&&i===o[++s]&&i===o[++s])){n=e.strstart+jr;do{}while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<n);e.match_length=jr-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(a=Er(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=Er(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(ec(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Tr?(ec(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ec(e,!1),0===e.strm.avail_out)?1:2})(a,t):hc[a.level].func(a,t);if(3!==i&&4!==i||(a.status=Yr),1===i||3===i)return 0===e.avail_out&&(a.last_flush=-1),Rr;if(2===i&&(t===_r?kr(a):t!==Pr&&(Sr(a,0,0,!1),t===xr&&(Jr(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),Xr(e),0===e.avail_out))return a.last_flush=-1,Rr}return t!==Tr?Rr:a.wrap<=0?Dr:(2===a.wrap?(tc(a,255&e.adler),tc(a,e.adler>>8&255),tc(a,e.adler>>16&255),tc(a,e.adler>>24&255),tc(a,255&e.total_in),tc(a,e.total_in>>8&255),tc(a,e.total_in>>16&255),tc(a,e.total_in>>24&255)):(ac(a,e.adler>>>16),ac(a,65535&e.adler)),Xr(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?Rr:Dr)},deflateEnd:e=>{if(dc(e))return Nr;const t=e.state.status;return e.state=null,t===qr?Kr(e,Gr):Rr},deflateSetDictionary:(e,t)=>{let a=t.length;if(dc(e))return Nr;const i=e.state,s=i.wrap;if(2===s||1===s&&i.status!==Hr||i.lookahead)return Nr;if(1===s&&(e.adler=gr(e.adler,t,a,0)),i.wrap=0,a>=i.w_size){0===s&&(Jr(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(a-i.w_size,a),0),t=e,a=i.w_size}const n=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=a,e.next_in=0,e.input=t,nc(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=Qr(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,nc(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=o,e.input=l,e.avail_in=n,i.wrap=s,Rr},deflateInfo:"pako deflate (from Nodeca project)"};const wc=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var yc={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const t in a)wc(a,t)&&(e[t]=a[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const a=new Uint8Array(t);for(let i=0,s=0,n=e.length;i<n;i++){let t=e[i];a.set(t,s),s+=t.length}return a}};let bc=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Ju){bc=!1}const vc=new Uint8Array(256);for(let Zu=0;Zu<256;Zu++)vc[Zu]=Zu>=252?6:Zu>=248?5:Zu>=240?4:Zu>=224?3:Zu>=192?2:1;vc[254]=vc[254]=1;var Sc={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,a,i,s,n,o=e.length,l=0;for(s=0;s<o;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<o&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),s++)),l+=a<128?1:a<2048?2:a<65536?3:4;for(t=new Uint8Array(l),n=0,s=0;n<l;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<o&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),s++)),a<128?t[n++]=a:a<2048?(t[n++]=192|a>>>6,t[n++]=128|63&a):a<65536?(t[n++]=224|a>>>12,t[n++]=128|a>>>6&63,t[n++]=128|63&a):(t[n++]=240|a>>>18,t[n++]=128|a>>>12&63,t[n++]=128|a>>>6&63,t[n++]=128|63&a);return t},buf2string:(e,t)=>{const a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,s;const n=new Array(2*a);for(s=0,i=0;i<a;){let t=e[i++];if(t<128){n[s++]=t;continue}let o=vc[t];if(o>4)n[s++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<a;)t=t<<6|63&e[i++],o--;o>1?n[s++]=65533:t<65536?n[s++]=t:(t-=65536,n[s++]=55296|t>>10&1023,n[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&bc)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let a="";for(let i=0;i<t;i++)a+=String.fromCharCode(e[i]);return a})(n,s)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return a<0||0===a?t:a+vc[e[a]]>t?a:t}};var Ic=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Ec=Object.prototype.toString,{Z_NO_FLUSH:kc,Z_SYNC_FLUSH:Cc,Z_FULL_FLUSH:_c,Z_FINISH:xc,Z_OK:Tc,Z_STREAM_END:Pc,Z_DEFAULT_COMPRESSION:Rc,Z_DEFAULT_STRATEGY:Dc,Z_DEFLATED:Nc}=br;function Gc(e){this.options=yc.assign({level:Rc,method:Nc,chunkSize:16384,windowBits:15,memLevel:8,strategy:Dc},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ic,this.strm.avail_out=0;let a=fc.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==Tc)throw new Error(yr[a]);if(t.header&&fc.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Sc.string2buf(t.dictionary):"[object ArrayBuffer]"===Ec.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=fc.deflateSetDictionary(this.strm,e),a!==Tc)throw new Error(yr[a]);this._dict_set=!0}}function Uc(e,t){const a=new Gc(t);if(a.push(e,!0),a.err)throw a.msg||yr[a.err];return a.result}Gc.prototype.push=function(e,t){const a=this.strm,i=this.options.chunkSize;let s,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?xc:kc,"string"==typeof e?a.input=Sc.string2buf(e):"[object ArrayBuffer]"===Ec.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(n===Cc||n===_c)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(s=fc.deflate(a,n),s===Pc)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),s=fc.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Tc;if(0!==a.avail_out){if(n>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},Gc.prototype.onData=function(e){this.chunks.push(e)},Gc.prototype.onEnd=function(e){e===Tc&&(this.result=yc.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Oc={Deflate:Gc,deflate:Uc,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Uc(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Uc(e,t)},constants:br};const Ac=16209;var Lc=function(e,t){let a,i,s,n,o,l,r,c,h,m,d,p,u,g,f,w,y,b,v,S,I,E,k,C;const _=e.state;a=e.next_in,k=e.input,i=a+(e.avail_in-5),s=e.next_out,C=e.output,n=s-(t-e.avail_out),o=s+(e.avail_out-257),l=_.dmax,r=_.wsize,c=_.whave,h=_.wnext,m=_.window,d=_.hold,p=_.bits,u=_.lencode,g=_.distcode,f=(1<<_.lenbits)-1,w=(1<<_.distbits)-1;e:do{p<15&&(d+=k[a++]<<p,p+=8,d+=k[a++]<<p,p+=8),y=u[d&f];t:for(;;){if(b=y>>>24,d>>>=b,p-=b,b=y>>>16&255,0===b)C[s++]=65535&y;else{if(!(16&b)){if(64&b){if(32&b){_.mode=16191;break e}e.msg="invalid literal/length code",_.mode=Ac;break e}y=u[(65535&y)+(d&(1<<b)-1)];continue t}for(v=65535&y,b&=15,b&&(p<b&&(d+=k[a++]<<p,p+=8),v+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=k[a++]<<p,p+=8,d+=k[a++]<<p,p+=8),y=g[d&w];;){if(b=y>>>24,d>>>=b,p-=b,b=y>>>16&255,16&b){if(S=65535&y,b&=15,p<b&&(d+=k[a++]<<p,p+=8,p<b&&(d+=k[a++]<<p,p+=8)),S+=d&(1<<b)-1,S>l){e.msg="invalid distance too far back",_.mode=Ac;break e}if(d>>>=b,p-=b,b=s-n,S>b){if(b=S-b,b>c&&_.sane){e.msg="invalid distance too far back",_.mode=Ac;break e}if(I=0,E=m,0===h){if(I+=r-b,b<v){v-=b;do{C[s++]=m[I++]}while(--b);I=s-S,E=C}}else if(h<b){if(I+=r+h-b,b-=h,b<v){v-=b;do{C[s++]=m[I++]}while(--b);if(I=0,h<v){b=h,v-=b;do{C[s++]=m[I++]}while(--b);I=s-S,E=C}}}else if(I+=h-b,b<v){v-=b;do{C[s++]=m[I++]}while(--b);I=s-S,E=C}for(;v>2;)C[s++]=E[I++],C[s++]=E[I++],C[s++]=E[I++],v-=3;v&&(C[s++]=E[I++],v>1&&(C[s++]=E[I++]))}else{I=s-S;do{C[s++]=C[I++],C[s++]=C[I++],C[s++]=C[I++],v-=3}while(v>2);v&&(C[s++]=C[I++],v>1&&(C[s++]=C[I++]))}break}if(64&b){e.msg="invalid distance code",_.mode=Ac;break e}y=g[(65535&y)+(d&(1<<b)-1)]}}break}}while(a<i&&s<o);v=p>>3,a-=v,p-=v<<3,d&=(1<<p)-1,e.next_in=a,e.next_out=s,e.avail_in=a<i?i-a+5:5-(a-i),e.avail_out=s<o?o-s+257:257-(s-o),_.hold=d,_.bits=p};const Vc=15,Fc=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Mc=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Wc=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),zc=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var jc=(e,t,a,i,s,n,o,l)=>{const r=l.bits;let c,h,m,d,p,u,g=0,f=0,w=0,y=0,b=0,v=0,S=0,I=0,E=0,k=0,C=null;const _=new Uint16Array(16),x=new Uint16Array(16);let T,P,R,D=null;for(g=0;g<=Vc;g++)_[g]=0;for(f=0;f<i;f++)_[t[a+f]]++;for(b=r,y=Vc;y>=1&&0===_[y];y--);if(b>y&&(b=y),0===y)return s[n++]=20971520,s[n++]=20971520,l.bits=1,0;for(w=1;w<y&&0===_[w];w++);for(b<w&&(b=w),I=1,g=1;g<=Vc;g++)if(I<<=1,I-=_[g],I<0)return-1;if(I>0&&(0===e||1!==y))return-1;for(x[1]=0,g=1;g<Vc;g++)x[g+1]=x[g]+_[g];for(f=0;f<i;f++)0!==t[a+f]&&(o[x[t[a+f]]++]=f);if(0===e?(C=D=o,u=20):1===e?(C=Fc,D=Mc,u=257):(C=Wc,D=zc,u=0),k=0,f=0,g=w,p=n,v=b,S=0,m=-1,E=1<<b,d=E-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){T=g-S,o[f]+1<u?(P=0,R=o[f]):o[f]>=u?(P=D[o[f]-u],R=C[o[f]-u]):(P=96,R=0),c=1<<g-S,h=1<<v,w=h;do{h-=c,s[p+(k>>S)+h]=T<<24|P<<16|R}while(0!==h);for(c=1<<g-1;k&c;)c>>=1;if(0!==c?(k&=c-1,k+=c):k=0,f++,0==--_[g]){if(g===y)break;g=t[a+o[f]]}if(g>b&&(k&d)!==m){for(0===S&&(S=b),p+=w,v=g-S,I=1<<v;v+S<y&&(I-=_[v+S],!(I<=0));)v++,I<<=1;if(E+=1<<v,1===e&&E>852||2===e&&E>592)return 1;m=k&d,s[m]=b<<24|v<<16|p-n}}return 0!==k&&(s[p+k]=g-S<<24|64<<16),l.bits=b,0};const{Z_FINISH:Bc,Z_BLOCK:Hc,Z_TREES:qc,Z_OK:Yc,Z_STREAM_END:Kc,Z_NEED_DICT:$c,Z_STREAM_ERROR:Jc,Z_DATA_ERROR:Zc,Z_MEM_ERROR:Qc,Z_BUF_ERROR:Xc,Z_DEFLATED:eh}=br,th=16180,ah=16190,ih=16191,sh=16192,nh=16194,oh=16199,lh=16200,rh=16206,ch=16209,hh=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function mh(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const dh=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<th||t.mode>16211?1:0},ph=e=>{if(dh(e))return Jc;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=th,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Yc},uh=e=>{if(dh(e))return Jc;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,ph(e)},gh=(e,t)=>{let a;if(dh(e))return Jc;const i=e.state;return t<0?(a=0,t=-t):(a=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Jc:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=a,i.wbits=t,uh(e))},fh=(e,t)=>{if(!e)return Jc;const a=new mh;e.state=a,a.strm=e,a.window=null,a.mode=th;const i=gh(e,t);return i!==Yc&&(e.state=null),i};let wh,yh,bh=!0;const vh=e=>{if(bh){wh=new Int32Array(512),yh=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(jc(1,e.lens,0,288,wh,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;jc(2,e.lens,0,32,yh,0,e.work,{bits:5}),bh=!1}e.lencode=wh,e.lenbits=9,e.distcode=yh,e.distbits=5},Sh=(e,t,a,i)=>{let s;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),i>=n.wsize?(n.window.set(t.subarray(a-n.wsize,a),0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>i&&(s=i),n.window.set(t.subarray(a-i,a-i+s),n.wnext),(i-=s)?(n.window.set(t.subarray(a-i,a),0),n.wnext=i,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0};var Ih={inflateReset:uh,inflateReset2:gh,inflateResetKeep:ph,inflateInit:e=>fh(e,15),inflateInit2:fh,inflate:(e,t)=>{let a,i,s,n,o,l,r,c,h,m,d,p,u,g,f,w,y,b,v,S,I,E,k=0;const C=new Uint8Array(4);let _,x;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(dh(e)||!e.output||!e.input&&0!==e.avail_in)return Jc;a=e.state,a.mode===ih&&(a.mode=sh),o=e.next_out,s=e.output,r=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,c=a.hold,h=a.bits,m=l,d=r,E=Yc;e:for(;;)switch(a.mode){case th:if(0===a.wrap){a.mode=sh;break}for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(2&a.wrap&&35615===c){0===a.wbits&&(a.wbits=15),a.check=0,C[0]=255&c,C[1]=c>>>8&255,a.check=wr(a.check,C,2,0),c=0,h=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",a.mode=ch;break}if((15&c)!==eh){e.msg="unknown compression method",a.mode=ch;break}if(c>>>=4,h-=4,I=8+(15&c),0===a.wbits&&(a.wbits=I),I>15||I>a.wbits){e.msg="invalid window size",a.mode=ch;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&c?16189:ih,c=0,h=0;break;case 16181:for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(a.flags=c,(255&a.flags)!==eh){e.msg="unknown compression method",a.mode=ch;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=ch;break}a.head&&(a.head.text=c>>8&1),512&a.flags&&4&a.wrap&&(C[0]=255&c,C[1]=c>>>8&255,a.check=wr(a.check,C,2,0)),c=0,h=0,a.mode=16182;case 16182:for(;h<32;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.head&&(a.head.time=c),512&a.flags&&4&a.wrap&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,a.check=wr(a.check,C,4,0)),c=0,h=0,a.mode=16183;case 16183:for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.head&&(a.head.xflags=255&c,a.head.os=c>>8),512&a.flags&&4&a.wrap&&(C[0]=255&c,C[1]=c>>>8&255,a.check=wr(a.check,C,2,0)),c=0,h=0,a.mode=16184;case 16184:if(1024&a.flags){for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.length=c,a.head&&(a.head.extra_len=c),512&a.flags&&4&a.wrap&&(C[0]=255&c,C[1]=c>>>8&255,a.check=wr(a.check,C,2,0)),c=0,h=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(p=a.length,p>l&&(p=l),p&&(a.head&&(I=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(i.subarray(n,n+p),I)),512&a.flags&&4&a.wrap&&(a.check=wr(a.check,i,p,n)),l-=p,n+=p,a.length-=p),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===l)break e;p=0;do{I=i[n+p++],a.head&&I&&a.length<65536&&(a.head.name+=String.fromCharCode(I))}while(I&&p<l);if(512&a.flags&&4&a.wrap&&(a.check=wr(a.check,i,p,n)),l-=p,n+=p,I)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===l)break e;p=0;do{I=i[n+p++],a.head&&I&&a.length<65536&&(a.head.comment+=String.fromCharCode(I))}while(I&&p<l);if(512&a.flags&&4&a.wrap&&(a.check=wr(a.check,i,p,n)),l-=p,n+=p,I)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(4&a.wrap&&c!==(65535&a.check)){e.msg="header crc mismatch",a.mode=ch;break}c=0,h=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=ih;break;case 16189:for(;h<32;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}e.adler=a.check=hh(c),c=0,h=0,a.mode=ah;case ah:if(0===a.havedict)return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,a.hold=c,a.bits=h,$c;e.adler=a.check=1,a.mode=ih;case ih:if(t===Hc||t===qc)break e;case sh:if(a.last){c>>>=7&h,h-=7&h,a.mode=rh;break}for(;h<3;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}switch(a.last=1&c,c>>>=1,h-=1,3&c){case 0:a.mode=16193;break;case 1:if(vh(a),a.mode=oh,t===qc){c>>>=2,h-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=ch}c>>>=2,h-=2;break;case 16193:for(c>>>=7&h,h-=7&h;h<32;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",a.mode=ch;break}if(a.length=65535&c,c=0,h=0,a.mode=nh,t===qc)break e;case nh:a.mode=16195;case 16195:if(p=a.length,p){if(p>l&&(p=l),p>r&&(p=r),0===p)break e;s.set(i.subarray(n,n+p),o),l-=p,n+=p,r-=p,o+=p,a.length-=p;break}a.mode=ih;break;case 16196:for(;h<14;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(a.nlen=257+(31&c),c>>>=5,h-=5,a.ndist=1+(31&c),c>>>=5,h-=5,a.ncode=4+(15&c),c>>>=4,h-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=ch;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;h<3;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.lens[T[a.have++]]=7&c,c>>>=3,h-=3}for(;a.have<19;)a.lens[T[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,_={bits:a.lenbits},E=jc(0,a.lens,0,19,a.lencode,0,a.work,_),a.lenbits=_.bits,E){e.msg="invalid code lengths set",a.mode=ch;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;k=a.lencode[c&(1<<a.lenbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(y<16)c>>>=f,h-=f,a.lens[a.have++]=y;else{if(16===y){for(x=f+2;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(c>>>=f,h-=f,0===a.have){e.msg="invalid bit length repeat",a.mode=ch;break}I=a.lens[a.have-1],p=3+(3&c),c>>>=2,h-=2}else if(17===y){for(x=f+3;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}c>>>=f,h-=f,I=0,p=3+(7&c),c>>>=3,h-=3}else{for(x=f+7;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}c>>>=f,h-=f,I=0,p=11+(127&c),c>>>=7,h-=7}if(a.have+p>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=ch;break}for(;p--;)a.lens[a.have++]=I}}if(a.mode===ch)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=ch;break}if(a.lenbits=9,_={bits:a.lenbits},E=jc(1,a.lens,0,a.nlen,a.lencode,0,a.work,_),a.lenbits=_.bits,E){e.msg="invalid literal/lengths set",a.mode=ch;break}if(a.distbits=6,a.distcode=a.distdyn,_={bits:a.distbits},E=jc(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,_),a.distbits=_.bits,E){e.msg="invalid distances set",a.mode=ch;break}if(a.mode=oh,t===qc)break e;case oh:a.mode=lh;case lh:if(l>=6&&r>=258){e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,a.hold=c,a.bits=h,Lc(e,d),o=e.next_out,s=e.output,r=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,c=a.hold,h=a.bits,a.mode===ih&&(a.back=-1);break}for(a.back=0;k=a.lencode[c&(1<<a.lenbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(w&&!(240&w)){for(b=f,v=w,S=y;k=a.lencode[S+((c&(1<<b+v)-1)>>b)],f=k>>>24,w=k>>>16&255,y=65535&k,!(b+f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}c>>>=b,h-=b,a.back+=b}if(c>>>=f,h-=f,a.back+=f,a.length=y,0===w){a.mode=16205;break}if(32&w){a.back=-1,a.mode=ih;break}if(64&w){e.msg="invalid literal/length code",a.mode=ch;break}a.extra=15&w,a.mode=16201;case 16201:if(a.extra){for(x=a.extra;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.length+=c&(1<<a.extra)-1,c>>>=a.extra,h-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;k=a.distcode[c&(1<<a.distbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(!(240&w)){for(b=f,v=w,S=y;k=a.distcode[S+((c&(1<<b+v)-1)>>b)],f=k>>>24,w=k>>>16&255,y=65535&k,!(b+f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}c>>>=b,h-=b,a.back+=b}if(c>>>=f,h-=f,a.back+=f,64&w){e.msg="invalid distance code",a.mode=ch;break}a.offset=y,a.extra=15&w,a.mode=16203;case 16203:if(a.extra){for(x=a.extra;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.offset+=c&(1<<a.extra)-1,c>>>=a.extra,h-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=ch;break}a.mode=16204;case 16204:if(0===r)break e;if(p=d-r,a.offset>p){if(p=a.offset-p,p>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=ch;break}p>a.wnext?(p-=a.wnext,u=a.wsize-p):u=a.wnext-p,p>a.length&&(p=a.length),g=a.window}else g=s,u=o-a.offset,p=a.length;p>r&&(p=r),r-=p,a.length-=p;do{s[o++]=g[u++]}while(--p);0===a.length&&(a.mode=lh);break;case 16205:if(0===r)break e;s[o++]=a.length,r--,a.mode=lh;break;case rh:if(a.wrap){for(;h<32;){if(0===l)break e;l--,c|=i[n++]<<h,h+=8}if(d-=r,e.total_out+=d,a.total+=d,4&a.wrap&&d&&(e.adler=a.check=a.flags?wr(a.check,s,d,o-d):gr(a.check,s,d,o-d)),d=r,4&a.wrap&&(a.flags?c:hh(c))!==a.check){e.msg="incorrect data check",a.mode=ch;break}c=0,h=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;h<32;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(4&a.wrap&&c!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=ch;break}c=0,h=0}a.mode=16208;case 16208:E=Kc;break e;case ch:E=Zc;break e;case 16210:return Qc;default:return Jc}return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,a.hold=c,a.bits=h,(a.wsize||d!==e.avail_out&&a.mode<ch&&(a.mode<rh||t!==Bc))&&Sh(e,e.output,e.next_out,d-e.avail_out),m-=e.avail_in,d-=e.avail_out,e.total_in+=m,e.total_out+=d,a.total+=d,4&a.wrap&&d&&(e.adler=a.check=a.flags?wr(a.check,s,d,e.next_out-d):gr(a.check,s,d,e.next_out-d)),e.data_type=a.bits+(a.last?64:0)+(a.mode===ih?128:0)+(a.mode===oh||a.mode===nh?256:0),(0===m&&0===d||t===Bc)&&E===Yc&&(E=Xc),E},inflateEnd:e=>{if(dh(e))return Jc;let t=e.state;return t.window&&(t.window=null),e.state=null,Yc},inflateGetHeader:(e,t)=>{if(dh(e))return Jc;const a=e.state;return 2&a.wrap?(a.head=t,t.done=!1,Yc):Jc},inflateSetDictionary:(e,t)=>{const a=t.length;let i,s,n;return dh(e)?Jc:(i=e.state,0!==i.wrap&&i.mode!==ah?Jc:i.mode===ah&&(s=1,s=gr(s,t,a,0),s!==i.check)?Zc:(n=Sh(e,t,a,a),n?(i.mode=16210,Qc):(i.havedict=1,Yc)))},inflateInfo:"pako inflate (from Nodeca project)"};var Eh=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const kh=Object.prototype.toString,{Z_NO_FLUSH:Ch,Z_FINISH:_h,Z_OK:xh,Z_STREAM_END:Th,Z_NEED_DICT:Ph,Z_STREAM_ERROR:Rh,Z_DATA_ERROR:Dh,Z_MEM_ERROR:Nh}=br;function Gh(e){this.options=yc.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ic,this.strm.avail_out=0;let a=Ih.inflateInit2(this.strm,t.windowBits);if(a!==xh)throw new Error(yr[a]);if(this.header=new Eh,Ih.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Sc.string2buf(t.dictionary):"[object ArrayBuffer]"===kh.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=Ih.inflateSetDictionary(this.strm,t.dictionary),a!==xh)))throw new Error(yr[a])}function Uh(e,t){const a=new Gh(t);if(a.push(e),a.err)throw a.msg||yr[a.err];return a.result}Gh.prototype.push=function(e,t){const a=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let n,o,l;if(this.ended)return!1;for(o=t===~~t?t:!0===t?_h:Ch,"[object ArrayBuffer]"===kh.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),n=Ih.inflate(a,o),n===Ph&&s&&(n=Ih.inflateSetDictionary(a,s),n===xh?n=Ih.inflate(a,o):n===Dh&&(n=Ph));a.avail_in>0&&n===Th&&a.state.wrap>0&&0!==e[a.next_in];)Ih.inflateReset(a),n=Ih.inflate(a,o);switch(n){case Rh:case Dh:case Ph:case Nh:return this.onEnd(n),this.ended=!0,!1}if(l=a.avail_out,a.next_out&&(0===a.avail_out||n===Th))if("string"===this.options.to){let e=Sc.utf8border(a.output,a.next_out),t=a.next_out-e,s=Sc.buf2string(a.output,e);a.next_out=t,a.avail_out=i-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(s)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==xh||0!==l){if(n===Th)return n=Ih.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},Gh.prototype.onData=function(e){this.chunks.push(e)},Gh.prototype.onEnd=function(e){e===xh&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=yc.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Oh={Inflate:Gh,inflate:Uh,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Uh(e,t)},ungzip:Uh,constants:br};const{Deflate:Ah,deflate:Lh,deflateRaw:Vh,gzip:Fh}=Oc,{Inflate:Mh,inflate:Wh,inflateRaw:zh,ungzip:jh}=Oh;var Bh={Deflate:Ah,deflate:Lh,deflateRaw:Vh,gzip:Fh,Inflate:Mh,inflate:Wh,inflateRaw:zh,ungzip:jh,constants:br};class Hh{static tryParseUrlLocation(e){let t=e.hash;if(t.length<=1)return null;t=t.substring(1);const a=atob(t),i=new Uint8Array(a.length);for(let r=0;r<i.length;r++)i[r]=a.charCodeAt(r);const s=Bh.inflate(i),n=de.fromBinary(s);let o=Yo.DEFAULT_CATEGORIES;const l=new URLSearchParams(window.location.search);if(l.has(Yo.CATEGORY_PARAM)){o=l.get(Yo.CATEGORY_PARAM).split("").map((e=>[...Bo.entries()].find((t=>t[1]==e)))).filter((e=>e)).map((e=>e[0]))}return{settings:n,categories:o}}}const qh="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function Yh(e){if(!e.length)return 0;let t=0,a=1,i=e[0];for(;(32&i)>0;)a++,i<<=1;const s=63>>a;let n=e.shift()&s;a--;for(let o=1;o<=a;o++)t+=1<<5*o,n=n<<6|(e.shift()||0);return n+t}function Kh(e){const t={};if(e.match(/^#?~(-?\d+)$/))return t;const a=/^([a-z-]+)\/([a-z-]+)(?:\/([a-zA-Z0-9_-]+))?$/.exec(e);if(!a)return t;t.class=a[1],t.race=a[2];let i=a[3];if(!i)return t;const s=qh.indexOf(i.substring(0,1));if(i=i.substring(1),!i.length)return t;const n=[];for(let o=0;o<i.length;o++)n.push(qh.indexOf(i.substring(o,o+1)));if(s>1)return t;{const e=Yh(n)-1;e>=0&&(t.genderId=e)}{const e=Yh(n);e&&(t.level=e)}{const e=function(e){let t="";for(let a=0;a<3;a++){let a=Yh(e);for(;a>0;){let i="",s=Yh(e);for(;a>0&&i.length<7;){const e=7&s;s>>=3,i=`${e}${i}`,a--}t+=i}t+="-"}return t.replace(/-+$/,"")}(n),a=Yh(n),i=n.splice(0,a).map((e=>qh[e])).join(""),s=e+(a?`_${i}`:"");if(""!==s&&(t.talentHash=s),t.talentHash){const e=function(e){const[t,a]=e.split("_"),i=t;let s=[];a&&(s=function(e){const t=Array(9).fill(0),a="0123456789abcdefghjkmnpqrstvwxyz";let i=1;for(;i<e.length;){const s=e[i],n=a.indexOf(s);if(i++,n<0||n>=t.length)continue;if(i+4>e.length)break;const o=a.indexOf(e[i]),l=a.indexOf(e[i+1]),r=a.indexOf(e[i+2]),c=a.indexOf(e[i+3]);if(i+=4,o<0||l<0||r<0||c<0)continue;const h=o<<15|l<<10|r<<5|c;t[n]=h}return t}(a));return{talents:i,glyphs:s}}(t.talentHash);t.talents=e.talents,t.glyphs=e.glyphs}}{let e=Yh(n);for(t.items=[];e--;){const e={};let a;if(s<1){a=n.shift();const e=a>>5&1;a&=31,e&&(a|=64)}else a=Yh(n);if(e.slotId=Yh(n),e.itemId=Yh(n),a>>6&1){let t=Yh(n);const a=1&t;t>>=1,a&&(t*=-1),e.randomEnchantId=t}a>>5&1&&(e.reforge=Yh(n));{let t=a>>2&7;for(;t--;)e.gemItemIds||(e.gemItemIds=[]),e.gemItemIds.push(Yh(n))}{let t=3&a;for(;t--;)e.enchantIds||(e.enchantIds=[]),e.enchantIds.push(Yh(n))}t.items.push(e)}}return t}const $h=class e extends Yo{constructor(e,i){super(e,i,{title:"Wowhead Import",allowFileUpload:!0});const s=a();this.descriptionElem.appendChild(t(r,null,t("p",null,"Import settings from"," ",t("a",{href:"https://www.wowhead.com/mop-classic/gear-planner",target:"_blank"},"Wowhead Gear Planner"),"."),t("p",null,"This feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),t("p",null,"To import, paste the gear planner link below and click, 'Import'."),t("div",{ref:s}))),s.value&&new mo({title:"Tinker issues",body:t(r,null,"There are known issues importing tinkers from Wowhead.",t("br",null),"Always make sure to double check your tinkers after importing."),additionalClasses:["toast-import-warning"],container:s.value,variant:"warning",canClose:!1,autoShow:!0,autohide:!1})}async onImport(t){if(!t.match(/www\.wowhead\.com\/mop-classic\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/))throw new Error(`Invalid WCL URL ${t}, must look like "https://www.wowhead.com/mop-classic/gear-planner/CLASS/RACE/XXXX"`);console.log(t);const a=function(e){const t=e.match(/mop-classic\/gear-planner\/(.+)/);if(!t)throw new Error(`Invalid WCL URL ${e}, must look like "https://www.wowhead.com/mop-classic/gear-planner/CLASS/RACE/XXXX"`);return Kh(t[1])}(t);console.log(a);const i=a.glyphs,s=oe(a.class.replaceAll("-",""));if(s==se.ClassUnknown)throw new Error("Could not parse Class: "+a.class);const n=le(a.race.replaceAll("-",""));if(n==re.RaceUnknown)throw new Error("Could not parse Race: "+a.race);const o=N.create();a.items.forEach((t=>{const a=_.create(),i=t.slotId,s=t.enchantIds?.length>0;a.id=t.itemId,s&&(a.enchant=this.simUI.sim.db.enchantSpellIdToEffectId(t.enchantIds[0])),t.gemItemIds&&(a.gems=t.gemItemIds),t.randomEnchantId&&(a.randomSuffix=t.randomEnchantId),t.reforge&&(a.reforging=t.reforge);null!=Object.entries(e.slotIDs).find((e=>e[1]==i))&&o.items.push(a)}));const l=me.create({major1:this.simUI.sim.db.glyphSpellToItemId(i[3]),major2:this.simUI.sim.db.glyphSpellToItemId(i[4]),major3:this.simUI.sim.db.glyphSpellToItemId(i[5]),minor1:this.simUI.sim.db.glyphSpellToItemId(i[6]),minor2:this.simUI.sim.db.glyphSpellToItemId(i[7]),minor3:this.simUI.sim.db.glyphSpellToItemId(i[8])});this.finishIndividualImport(this.simUI,s,n,o,a.talents??"",l,[])}};$h.slotIDs={[w.ItemSlotHead]:1,[w.ItemSlotNeck]:2,[w.ItemSlotShoulder]:3,[w.ItemSlotBack]:15,[w.ItemSlotChest]:5,[w.ItemSlotWrist]:9,[w.ItemSlotHands]:10,[w.ItemSlotWaist]:6,[w.ItemSlotLegs]:7,[w.ItemSlotFeet]:8,[w.ItemSlotFinger1]:11,[w.ItemSlotFinger2]:12,[w.ItemSlotTrinket1]:13,[w.ItemSlotTrinket2]:14,[w.ItemSlotMainHand]:16,[w.ItemSlotOffHand]:17};let Jh=$h;class Zh extends ho{constructor(e,i){super(e,i,{identifier:"bulk-tab",title:'Batch (<span class="text-success">New</span>)'}),this.itemsChangedEmitter=new o,this.settingsChangedEmitter=new o,this.items=new Array,this.pickerGroups=new Map,this.combinations=0,this.iterations=0,this.simUI=i,this.playerCanDualWield=this.simUI.player.getPlayerSpec().canDualWield,this.playerIsFuryWarrior=this.simUI.player.getSpec()===f.SpecFuryWarrior;const s=a(),n=a(),l=a(),c=a(),h=a(),m=a(),d=a(),p=a();this.contentContainer.appendChild(t(r,null,t("div",{className:"bulk-tab-left tab-panel-left"},t("div",{className:"bulk-tab-tabs"},t("ul",{className:"nav nav-tabs",attributes:{role:"tablist"}},t("li",{className:"nav-item",attributes:{role:"presentation"}},t("button",{className:"nav-link active",type:"button",attributes:{role:"tab","aria-controls":"bulkSetupTab","aria-selected":!0},dataset:{bsToggle:"tab",bsTarget:"#bulkSetupTab"},ref:s},"Setup")),t("li",{className:"nav-item",attributes:{role:"presentation"}},t("button",{className:"nav-link",type:"button",attributes:{role:"tab","aria-controls":"bulkResultsTab","aria-selected":!1},dataset:{bsToggle:"tab",bsTarget:"#bulkResultsTab"},ref:l},"Results"))),t("div",{className:"tab-content"},t("div",{id:"bulkSetupTab",className:"tab-pane fade active show",ref:n}),t("div",{id:"bulkResultsTab",className:"tab-pane fade show",ref:c},t("div",{className:"d-flex align-items-center justify-content-center p-gap"},"Run a simulation to view results"))))),t("div",{className:"bulk-tab-right tab-panel-right"},t("div",{className:"bulk-settings-outer-container"},t("div",{className:"bulk-settings-container",ref:h},t("div",{className:"bulk-combinations-count h4",ref:m}),t("button",{className:"btn btn-primary bulk-settings-btn",ref:d},"Simulate Batch"),t("div",{className:"bulk-boolean-settings-container",ref:p}))),","))),this.setupTabElem=n.value,this.resultsTabElem=c.value,this.pendingDiv=t("div",{className:"results-pending-overlay"}),this.combinationsElem=m.value,this.bulkSimButton=d.value,this.settingsContainer=h.value,this.booleanSettingsContainer=p.value,this.setupTab=new Qn(s.value),this.resultsTab=new Qn(l.value),this.pendingResults=new co(this.pendingDiv),this.pendingResults.hideAll(),this.selectorModal=new Tu(this.simUI.rootElem,this.simUI,this.simUI.player,void 0,{id:"bulk-selector-modal"}),this.doCombos=!0,this.fastMode=!0,this.autoGem=!0,this.autoEnchant=!0,this.savedTalents=[],this.simTalents=!1,this.defaultGems=[pe.create(),pe.create(),pe.create(),pe.create()],this.gemIconElements=[],this.buildTabContent(),this.simUI.sim.waitForInit().then((()=>{this.loadSettings();const e=()=>{for(const e of this.pickerGroups.values())e.has(-1)&&e.remove(-1),e.has(-2)&&e.remove(-2);this.simUI.player.getEquippedItems().forEach(((e,t)=>{const a=Vo(t,this.playerCanDualWield),i=this.pickerGroups.get(a),s=this.isSecondaryItemSlot(t)?-2:-1;e&&i.add(s,e)}))};e(),o.onAny([this.simUI.player.challengeModeChangeEmitter,this.simUI.player.gearChangeEmitter]).on((()=>e())),this.itemsChangedEmitter.on((()=>this.storeSettings())),o.onAny([this.itemsChangedEmitter,this.settingsChangedEmitter,this.simUI.sim.iterationsChangeEmitter]).on((()=>{this.getCombinationsCount().then((e=>this.combinationsElem.replaceChildren(e)))})),this.getCombinationsCount().then((e=>this.combinationsElem.replaceChildren(e)))}))}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const e=window.localStorage.getItem(this.getSettingsKey());if(null!=e){const t=ue.fromJsonString(e,{ignoreUnknownFields:!0});this.addItems(t.items),this.doCombos=t.combinations,this.fastMode=t.fastMode,this.autoEnchant=t.autoEnchant,this.savedTalents=t.talentsToSim,this.autoGem=t.autoGem,this.simTalents=t.simTalents,this.defaultGems=new Array(ge.create({id:t.defaultRedGem}),ge.create({id:t.defaultYellowGem}),ge.create({id:t.defaultBlueGem}),ge.create({id:t.defaultMetaGem})),this.defaultGems.forEach(((e,t)=>{d.fromItemId(e.id).fill().then((a=>{e.id&&(this.gemIconElements[t].src=a.iconUrl,this.gemIconElements[t].classList.remove("hide"))}))}))}}storeSettings(){const e=this.createBulkSettings(),t=ue.toJsonString(e,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey(),t)}createBulkSettings(){return ue.create({items:this.getItems(),combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,autoGem:this.autoGem,simTalents:this.simTalents,talentsToSim:this.savedTalents,defaultRedGem:this.defaultGems[0].id,defaultYellowGem:this.defaultGems[1].id,defaultBlueGem:this.defaultGems[2].id,defaultMetaGem:this.defaultGems[3].id,iterationsPerCombo:this.getDefaultIterationsCount()})}getDefaultIterationsCount(){return fe()?1e3:this.simUI.sim.getIterations()}createBulkItemsDatabase(){const e=we.create();for(const t of this.items.values()){if(!t)continue;const a=this.simUI.sim.db.lookupItemSpec(t);if(!a)throw new Error(`item with ID ${t.id} not found in database`);e.items.push(ye.fromJson(be.toJson(a.item),{ignoreUnknownFields:!0})),a.enchant&&e.enchants.push(ve.fromJson(Se.toJson(a.enchant),{ignoreUnknownFields:!0})),a.randomSuffix&&e.randomSuffixes.push(Ie.fromJson(Ie.toJson(a.randomSuffix),{ignoreUnknownFields:!0})),a.reforge&&e.reforgeStats.push(Ee.fromJson(Ee.toJson(a.reforge),{ignoreUnknownFields:!0}));for(const t of a.gems)t&&e.gems.push(ge.fromJson(pe.toJson(t),{ignoreUnknownFields:!0}))}for(const t of this.defaultGems)t.id>0&&e.gems.push(t);return e}addItem(e){this.addItems([e])}addItems(e){e.forEach((e=>{const t=this.simUI.sim.db.lookupItemSpec(e)?.withChallengeMode(this.simUI.player.getChallengeModeEnabled()).withDynamicStats();t&&E(t.item,this.playerIsFuryWarrior).forEach((a=>{if(this.isSecondaryItemSlot(a))return;const i=this.items.push(e)-1,s=Vo(a,this.playerCanDualWield);this.pickerGroups.get(s).add(i,t)}))})),this.itemsChangedEmitter.emit(o.nextEventID())}addItemToSlot(e,t){const a=this.simUI.sim.db.lookupItemSpec(e)?.withChallengeMode(this.simUI.player.getChallengeModeEnabled()).withDynamicStats();if(a){const i=E(a.item,this.playerIsFuryWarrior);if(!k(a.item,this.simUI.player.getPlayerSpec(),i[0]))return;const s=this.items.push(e)-1;this.pickerGroups.get(t).add(s,a),this.itemsChangedEmitter.emit(o.nextEventID())}}updateItem(e,t){const a=this.simUI.sim.db.lookupItemSpec(t)?.withChallengeMode(this.simUI.player.getChallengeModeEnabled()).withDynamicStats();a&&(this.items[e]=t,E(a.item,this.playerIsFuryWarrior).forEach((t=>{if(this.isSecondaryItemSlot(t))return;const i=Vo(t,this.playerCanDualWield);this.pickerGroups.get(i).update(e,a)}))),this.itemsChangedEmitter.emit(o.nextEventID())}removeItem(e){this.items.forEach(((t,a)=>{t&&t.id===e.id&&this.removeItemByIndex(a)}))}removeItemByIndex(e){if(e<0||this.items.length<e||!this.items[e])return void new mo({variant:"error",body:"Failed to remove item, please report this issue."});const t=this.items[e],a=this.simUI.sim.db.lookupItemSpec(t);a&&(this.items[e]=null,E(a.item,this.playerIsFuryWarrior).forEach((t=>{const a=Vo(t,this.playerCanDualWield);this.pickerGroups.get(a).remove(e)})),this.itemsChangedEmitter.emit(o.nextEventID()))}clearItems(){for(let e=0;e<this.items.length;e++)this.removeItemByIndex(e);this.items=new Array,this.itemsChangedEmitter.emit(o.nextEventID())}hasItem(e){return this.items.some((t=>!!t&&_.equals(t,e)))}getItems(){const e=new Array;return this.items.forEach((t=>{t&&e.push(_.clone(t))})),e}setCombinations(e){this.doCombos=e,this.settingsChangedEmitter.emit(o.nextEventID())}setFastMode(e){this.fastMode=e,this.settingsChangedEmitter.emit(o.nextEventID())}async runBulkSim(e){this.pendingResults.setPending();try{const t=await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),e);t.error?.type==ke.ErrorOutcomeAborted&&new mo({variant:"info",body:"Bulk sim cancelled."})}catch(t){this.isPending=!1,this.simUI.handleCrash(t)}}async calculateBulkCombinations(){try{const e=await this.simUI.sim.calculateBulkCombinations(this.createBulkSettings(),this.createBulkItemsDatabase());this.combinations=e?.numCombinations??0,this.iterations=e?.numIterations??0}catch(e){this.simUI.handleCrash(e)}}buildTabContent(){this.buildSetupTabContent(),this.buildResultsTabContent(),this.buildBatchSettings()}buildSetupTabContent(){const e=a(),i=a(),s=a();this.setupTabElem.appendChild(t(r,null,t("p",{className:"mb-0"},t("span",{className:"bold"},"Batch Simming")," is a new feature akin to the ",t("span",{className:"bold"},"Top Gear")," sim on"," ",t("a",{href:"https://raidbots.com",target:"_blank"},"Raidbots.com")," ","that allows you to select multiple items and sim them find the best combinations.",t("br",null),"This is an ",t("span",{className:"text-brand"},"Alpha")," feature, so if you have feedback or find a bug, please report it!"),fe()&&t("p",{className:"mb-0"},t("a",{href:Ce,target:"_blank"},t("i",{className:"fas fa-gauge-high me-1"}),"Download the local sim for faster results.")),t("div",{className:"bulk-gear-actions"},t("button",{className:"btn btn-secondary",ref:e},t("i",{className:"fa fa-download me-1"})," Import From Bags"),t("button",{className:"btn btn-secondary",ref:i},t("i",{className:"fa fa-download me-1"})," Import Favorites"),t("button",{className:"btn btn-danger ms-auto",ref:s},t("i",{className:"fas fa-times me-1"}),"Clear Items"))));const n=e.value,o=i.value,l=s.value;n.addEventListener("click",(()=>new Ko(this.simUI.rootElem,this.simUI,this).open())),o.addEventListener("click",(()=>{const e=this.simUI.player.sim.getFilters().favoriteItems.map((e=>_.create({id:e})));this.addItems(e)})),l.addEventListener("click",(()=>this.clearItems())),new Mo(this.setupTabElem,this.simUI,this);const c=t("div",{className:"bulk-gear-combo"});this.setupTabElem.appendChild(c),P(Oo).forEach((e=>{this.playerCanDualWield&&[Oo.ItemSlotMainHand,Oo.ItemSlotOffHand].includes(e)||(this.playerCanDualWield||e!==Oo.ItemSlotHandWeapon)&&this.pickerGroups.set(e,new Fo(c,this.simUI,this,e))}))}buildResultsTabContent(){this.simUI.sim.bulkSimStartEmitter.on((()=>this.resultsTabElem.replaceChildren())),this.simUI.sim.bulkSimResultEmitter.on(((e,t)=>{for(const a of t.results)new Wo(this.resultsTabElem,this.simUI,this,a,t.equippedGearResult);this.isPending=!1,this.resultsTab.show()}))}isSecondaryItemSlot(e){return _e(e)||this.playerCanDualWield&&e===w.ItemSlotOffHand}set isPending(e){e?(this.simUI.rootElem.classList.add("blurred"),this.simUI.rootElem.insertAdjacentElement("afterend",this.pendingDiv)):(this.simUI.rootElem.classList.remove("blurred"),this.pendingDiv.remove(),this.pendingResults.hideAll())}buildBatchSettings(){let e=!1;this.bulkSimButton.addEventListener("click",(async()=>{if(e)return;e=!0,this.bulkSimButton.disabled=!0,this.isPending=!0;let t=!1;try{await this.simUI.sim.signalManager.abortType(xe.All),this.pendingResults.addAbortButton((async()=>{if(!t)try{t=!0,await this.simUI.sim.signalManager.abortType(xe.BulkSim)}catch(a){console.error("Error on bulk sim abort!"),console.error(a)}finally{t=!1,e||(this.bulkSimButton.disabled=!1)}}));let a=(new Date).getTime(),i=0,s=0,n=0,o=0;await this.runBulkSim((e=>{const t=(new Date).getTime()-a,l=e.completedIterations/(t/1e3);0===o&&(o=e.totalSims),this.fastMode&&(0===s&&e.totalSims>0&&(s=Math.ceil(Math.log(e.totalSims/20)/Math.log(2))+1,n=1),e.totalSims<i&&(n+=1,a=(new Date).getTime())),this.setSimProgress(e,l,n,s,o),i=e.totalSims}))}catch(a){console.error(a)}finally{e=!1,t||(this.bulkSimButton.disabled=!1),this.isPending=!1}})),fe()||new Te(this.booleanSettingsContainer,this,{id:"bulk-fast-mode",label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.fastMode,setValue:(e,t,a)=>{this.setFastMode(a)}}),new Te(this.booleanSettingsContainer,this,{id:"bulk-combinations",label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations because they each have two slots to fill.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.doCombos,setValue:(e,t,a)=>{this.setCombinations(a)}}),new Te(this.booleanSettingsContainer,this,{id:"bulk-auto-enchant",label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.autoEnchant,setValue:(e,t,a)=>{t.autoEnchant=a}});const i=a(),s=t("div",{className:u("default-gem-container",!this.autoGem&&"hide")},t("h6",null,"Default Gems"),t("div",{ref:i,className:"sockets-container"})),n=a(),l=t("div",{className:u("talents-picker-container",!this.simTalents&&"hide")},t("h6",null,"Talents to Sim"),t("div",{ref:n,className:"talents-container"}));new Te(this.booleanSettingsContainer,this,{id:"bulk-auto-gem",label:"Auto Gem",labelTooltip:"When checked bulk simulator will fill any un-filled gem sockets with default gems.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.autoGem,setValue:(e,t,a)=>{t.autoGem=a,s.classList[a?"remove":"add"]("hide")}}),new Te(this.booleanSettingsContainer,this,{id:"bulk-sim-talents",label:"Sim Talents",labelTooltip:"When checked bulk simulator will sim chosen talent setups. Warning, it might cause the bulk sim to run for a lot longer",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.simTalents,setValue:(e,t,a)=>{t.simTalents=a,l.classList[a?"remove":"add"]("hide")}}),this.settingsContainer.appendChild(t(r,null,s,l)),Array(Pe.GemColorRed,Pe.GemColorYellow,Pe.GemColorBlue,Pe.GemColorMeta).forEach(((e,s)=>{const n=a(),o=a(),l=a();let r;i.value.appendChild(t("div",{ref:n,className:"gem-socket-container"},t("img",{ref:o,className:"gem-icon hide"}),t("img",{ref:l,className:"socket-icon"}))),this.gemIconElements.push(o.value),l.value.src=y(e);const c=e=>{this.defaultGems[s]=e.item,this.storeSettings(),d.fromItemId(e.id).fill().then((t=>{e.id&&(this.gemIconElements[s].src=t.iconUrl,this.gemIconElements[s].classList.remove("hide"))})),r.close()},h=()=>{this.defaultGems[s]=pe.create(),this.storeSettings(),this.gemIconElements[s].classList.add("hide"),this.gemIconElements[s].src="",r.close()},m=()=>{r||(r=new zo(this.simUI.rootElem,this.simUI,e,c,h)),r.show()};this.gemIconElements[s].addEventListener("click",m),n.value?.addEventListener("click",m)}));const c=window.localStorage.getItem(this.simUI.getSavedTalentsStorageKey());let h;try{null!==c&&(h=JSON.parse(c))}catch(g){console.warn("Invalid json for local storage value: "+c)}const m=(e,t)=>{if(this.savedTalents.some((e=>e.name===t.name))){const a=this.savedTalents.findIndex((e=>e.name===t.name));this.savedTalents.splice(a,1),e?.classList.remove("active")}else this.savedTalents.push(t),e?.classList.add("active");this.settingsChangedEmitter.emit(o.nextEventID())},p=this.simUI.individualConfig.presets.talents.map((e=>({talentsString:e.data.talentsString,glyphs:e.data.glyphs,name:e.name})));for(const t in h)try{const e=Re.fromJson(h[t]);p.push({talentsString:e.talentsString,glyphs:e.glyphs,name:t})}catch(g){console.log(g),console.warn("Failed parsing saved data: "+h[t])}p.forEach((e=>{const i=this.savedTalents.findIndex((t=>JSON.stringify(t)===JSON.stringify(e))),s=a(),o=a();n.value.appendChild(t("div",{ref:s,className:u("saved-data-set-chip badge rounded-pill",-1!==i&&"active")},t("button",{ref:o,className:"saved-data-set-name"},e.name))),o.value.addEventListener("click",(()=>m(s.value,e)))}))}async getCombinationsCount(){await this.calculateBulkCombinations();const e=a(),i=t(r,null,t("span",{className:u(this.showIterationsWarning()&&"text-danger")},1===this.combinations?"1 Combination":`${this.combinations} Combinations`,t("br",null),t("small",null,this.iterations," Iterations")),this.showIterationsWarning()&&t("button",{className:"warning link-warning",ref:e},t("i",{className:"fas fa-exclamation-triangle fa-2x"})));return e.value&&Kn(e.value,{content:"Simming over 50000 iterations in the web sim will take a long time or may not run at all.\n\t\t\t\t\tFor larger batch sims we recommend using Fast Mode or downloading the executable and running on your machine.",placement:"left",popperOptions:{modifiers:[{name:"flip",options:{fallbackPlacements:["auto"]}}]}}),i}showIterationsWarning(){return this.iterations>this.getIterationsLimit()}getIterationsLimit(){return fe()?5e4:1e6}setSimProgress(e,a,i,s,n){const o=((e.totalIterations-e.completedIterations)/a).toFixed();isNaN(Number(o))||this.pendingResults.setContent(t("div",{className:"results-sim"},t("div",null,n," total combinations."),t("div",null,s>0&&t(r,null,i," / ",s," refining rounds")),t("div",null,e.completedSims," / ",e.totalSims,t("br",null),"simulations complete"),t("div",null,e.completedIterations," / ",e.totalIterations,t("br",null),"iterations complete"),t("div",null,o," seconds remaining.")))}}class Qh extends to{constructor(e,i){if(super(e,"exporter",{title:i.title,header:!0,footer:!0}),this.changedEvent=new o,this.textElem=t("textarea",{spellcheck:!1,className:"exporter-textarea form-control"}),this.body.append(this.textElem),new $o(this.footer,{extraCssClasses:["btn-primary","me-2"],getContent:()=>this.textElem.innerHTML,text:"Copy",tooltip:"Copy to clipboard"}),i.allowDownload){const e=a();this.footer.appendChild(t("button",{className:"exporter-button btn btn-primary download-button",ref:e},t("i",{className:"fa fa-download me-1"}),"Download"));e.value.addEventListener("click",(e=>{const t=this.textElem.textContent;De(t,"wowsims.json")}))}}open(){super.open(),this.init()}init(){this.changedEvent.on((()=>this.updateContent())),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const Xh=class e extends Qh{constructor(a,i,s){super(a,s),this.simUI=i;const n={};if(P(jo).forEach((e=>n[e]=Yo.DEFAULT_CATEGORIES.includes(e))),this.exportCategories=n,s.selectCategories){const a=t("div",{className:"exporter-category-pickers"});this.body.prepend(a),e.exportPickerConfigs.forEach((e=>{const t=e.category;new Te(a,this,{id:`link-exporter-${t}`,label:e.label,labelTooltip:e.labelTooltip,inline:!0,getValue:()=>this.exportCategories[t],setValue:(e,a,i)=>{this.exportCategories[t]=i,this.changedEvent.emit(e)},changedEvent:()=>this.changedEvent})}))}}};Xh.exportPickerConfigs=[{category:jo.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:jo.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:jo.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:jo.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:jo.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:jo.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:jo.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}];let em=Xh;const tm=class e extends em{constructor(e,t){super(e,t,{title:"Sixty Upgrades Cataclysm EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,a=t.getEpWeights(),i=Ne.getAll(),s={};return i.forEach((t=>{const i=e.getName(t),n=a.getUnitStat(t);0!=n&&""!=i&&(s[i]?s[i]+=n:s[i]=n)})),`https://sixtyupgrades.com/mop/ep/import?name=${encodeURIComponent(`${t.getPlayerSpec().friendlyName} WoWSims Weights`)}`+Object.keys(s).map((e=>`&${e}=${s[e].toFixed(3)}`)).join("")}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};tm.statNames={[l.StatStrength]:"strength",[l.StatAgility]:"agility",[l.StatStamina]:"stamina",[l.StatIntellect]:"intellect",[l.StatSpirit]:"spirit",[l.StatSpellPower]:"spellDamage",[l.StatMP5]:"mp5",[l.StatHitRating]:"hitRating",[l.StatCritRating]:"critRating",[l.StatHasteRating]:"hasteRating",[l.StatSpellPenetration]:"spellPen",[l.StatAttackPower]:"attackPower",[l.StatMasteryRating]:"masteryRating",[l.StatExpertiseRating]:"expertiseRating",[l.StatMana]:"mana",[l.StatArmor]:"armor",[l.StatRangedAttackPower]:"attackPower",[l.StatDodgeRating]:"dodgeRating",[l.StatParryRating]:"parryRating",[l.StatResilienceRating]:"resilienceRating",[l.StatHealth]:"health",[l.StatArcaneResistance]:"arcaneResistance",[l.StatFireResistance]:"fireResistance",[l.StatFrostResistance]:"frostResistance",[l.StatNatureResistance]:"natureResistance",[l.StatShadowResistance]:"shadowResistance",[l.StatBonusArmor]:"armorBonus"},tm.pseudoStatNames={[Ge.PseudoStatMainHandDps]:"dps",[Ge.PseudoStatRangedDps]:"rangedDps"};class am extends em{constructor(e,t){super(e,t,{title:"CLI Export",allowDownload:!0})}getData(){const e=Ue.toJson(this.simUI.sim.makeRaidSimRequest(!1));return delete e.raid?.parties[0]?.players[0]?.database,JSON.stringify(e,null,2)}}class im extends em{constructor(e,t){super(e,t,{title:"JSON Export",allowDownload:!0,selectCategories:!0})}getData(){return im.getData(this.simUI,P(jo).filter((e=>this.exportCategories[e])))}static getData(e,t){return t||(t=Yo.DEFAULT_CATEGORIES),Oe(de.toJson(e.toProto(t)),2,((e,t)=>!!["stats","pseudoStats"].includes(t[t.length-1])||(["player","equipment","items"].every(((e,a)=>t[a]==e))||!("player"!=t[0]||"rotation"!=t[1]||!["prepullActions","priorityList"].includes(t[2])))&&t.length>3))}}class sm extends em{constructor(e,t){super(e,t,{title:"Shareable Link",selectCategories:!0})}getData(){return sm.createLink(this.simUI,P(jo).filter((e=>this.exportCategories[e])))}static createLink(e,t){t||(t=Yo.DEFAULT_CATEGORIES);const a=e.toProto(t),i=de.toBinary(a),s=Bh.deflate(i,{to:"string"}),n=btoa(String.fromCharCode(...s)),o=new URL(window.location.href);if(o.hash=n,Ae(t,Yo.DEFAULT_CATEGORIES))o.searchParams.delete(Yo.CATEGORY_PARAM);else{const e=t.map((e=>Bo.get(e))).join("");o.searchParams.set(Yo.CATEGORY_PARAM,e)}return o.toString()}}const nm=class e extends em{constructor(e,t){super(e,t,{title:"Pawn EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,a=t.getEpWeights(),i=Ne.getAll(),s={};return i.forEach((t=>{const i=e.getName(t),n=a.getUnitStat(t);0!=n&&""!=i&&(s[i]?s[i]+=n:s[i]=n)})),`( Pawn: v1: "${t.getPlayerSpec().friendlyName} WoWSims Weights": Class=${t.getPlayerClass().friendlyName},`+Object.keys(s).map((e=>`${e}=${s[e].toFixed(3)}`)).join(",")+" )"}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};nm.statNames={[l.StatStrength]:"Strength",[l.StatAgility]:"Agility",[l.StatStamina]:"Stamina",[l.StatIntellect]:"Intellect",[l.StatSpirit]:"Spirit",[l.StatSpellPower]:"SpellDamage",[l.StatMP5]:"Mp5",[l.StatHitRating]:"HitRating",[l.StatCritRating]:"CritRating",[l.StatHasteRating]:"HasteRating",[l.StatSpellPenetration]:"SpellPen",[l.StatAttackPower]:"Ap",[l.StatMasteryRating]:"MasteryRating",[l.StatExpertiseRating]:"ExpertiseRating",[l.StatMana]:"Mana",[l.StatArmor]:"Armor",[l.StatRangedAttackPower]:"Ap",[l.StatDodgeRating]:"DodgeRating",[l.StatParryRating]:"ParryRating",[l.StatResilienceRating]:"ResilienceRating",[l.StatHealth]:"Health",[l.StatArcaneResistance]:"ArcaneResistance",[l.StatFireResistance]:"FireResistance",[l.StatFrostResistance]:"FrostResistance",[l.StatNatureResistance]:"NatureResistance",[l.StatShadowResistance]:"ShadowResistance",[l.StatBonusArmor]:"Armor2"},nm.pseudoStatNames={[Ge.PseudoStatMainHandDps]:"MeleeDps",[Ge.PseudoStatRangedDps]:"RangedDps"};let om=nm;const lm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function rm(e){let t=e,a=0;const i=[];for(let s=1;s<=5;s++){const e=5*s;if(t<1<<e){const e=[];for(;e.length<s;){const a=63&t;t>>=6,e.unshift(a)}return e[0]=e[0]|a,i.push(...e),i}t-=1<<e,a=(64|a)>>1}throw new Error("Value too large to encode.")}function cm(e){let t="";const a=[];t+=lm[1],a.push(0),a.push(...rm(e.level??0));const i=function(e){const t=[],a=e.split("-");for(let i=0;i<3;i++){const e=a[i]||"";t.push(...rm(e.length));let s=0;for(;s<e.length;){let a=0,i=0;for(;i<7&&s<e.length;)a=a<<3|parseInt(e[s],10),s++,i++;t.push(...rm(a))}}return t}(e.talents.join("-"));a.push(...i);const s=function(e){const t="0123456789abcdefghjkmnpqrstvwxyz";let a="0";for(let i=0;i<e.length;i++){const s=e[i];if(s){const e=t[i],n=s>>15&31,o=s>>10&31,l=s>>5&31,r=31&s;if(n<0||o<0||l<0||r<0)continue;a+=e+t[n]+t[o]+t[l]+t[r]}}return a}(e.glyphs??[]).split("").map((e=>lm.indexOf(e)));a.push(...rm(s.length)),a.push(...s);const n=e.items??[];a.push(...rm(n.length));for(const l of n){let e=0;const t=[];l.randomEnchantId&&(e|=64),l.reforge&&(e|=32);const i=Math.min((l.gemItemIds??[]).length,7);e|=i<<2;const s=Math.min((l.enchantIds??[]).length,3);if(e|=s,t.push(...rm(l.slotId??0)),t.push(...rm(l.itemId??0)),l.randomEnchantId){let e=l.randomEnchantId;const a=e<0?1:0;a&&(e*=-1),e=e<<1|a,t.push(...rm(e))}l.reforge&&t.push(...rm(l.reforge));const n=l.gemItemIds??[];for(let a=0;a<i;a++)t.push(...rm(n[a]));const o=l.enchantIds??[];for(let a=0;a<s;a++)t.push(...rm(o[a]));a.push(...rm(e)),a.push(...t)}let o="";for(const l of a)o+=lm.charAt(l);return o&&(t+=o),t}class hm extends em{constructor(e,t){super(e,t,{title:"Wowhead Export",allowDownload:!0})}getData(){const e=this.simUI.player,t=`https://www.wowhead.com/mop-classic/gear-planner/${e.getPlayerClass().friendlyName.replaceAll(/\s/g,"-").toLowerCase()}/${Le.get(e.getRace()).replaceAll(/\s/g,"-").toLowerCase()}/`,a=e=>{const t=this.simUI.sim.db.glyphItemToSpellId(e);return t||0},i=e.getGlyphs(),s={level:Ve,talents:e.getTalentsString().split("-"),glyphs:[a(i.major1),a(i.major2),a(i.major3),a(i.minor1),a(i.minor2),a(i.minor3)],items:[]},n=e.getGear();n.getItemSlots().sort(((e,t)=>Jh.slotIDs[e]-Jh.slotIDs[t])).forEach((e=>{const t=n.getEquippedItem(e);if(!t)return;const a={slotId:Jh.slotIDs[e],itemId:t.id};t._randomSuffix?.id&&(a.randomEnchantId=t._randomSuffix.id),t._enchant&&(a.enchantIds=[t._enchant.spellId]),w.ItemSlotHands,t._gems&&(a.gemItemIds=t._gems.map((e=>e?.id??0))),t._reforge&&(a.reforge=t._reforge.id),s.items.push(a)}));const o=function(e){return""+cm(e)}(s);return t+o}}class mm extends e{constructor(e,i,s){super(e,"saved-data-manager-root"),this.modObject=i,this.config=s,this.userData=[],this.presets=[],this.frozen=!1,s.extraCssClasses&&this.rootElem.classList.add(...s.extraCssClasses);const n=new po(this.rootElem,"saved-data",{header:s.header}),o=a(),l=a(),r=a();n.bodyElement.replaceChildren(t("div",{ref:o,className:"saved-data-container"},t("div",{ref:l,className:"saved-data-presets hide"}),t("div",{ref:r,className:"saved-data-custom hide"}))),this.savedDataDiv=o.value,this.presetDataDiv=l.value,this.customDataDiv=r.value,s.presetsOnly||this.config.loadOnly||n.bodyElement.appendChild(this.buildCreateContainer())}addSavedData(e){const t=this.makeSavedData(e),a=e.isPreset?this.presets:this.userData,i=a.findIndex((t=>t.name===e.name));-1===i?(e.isPreset?(this.presetDataDiv.classList.remove("hide"),this.presetDataDiv.appendChild(t.elem)):(this.customDataDiv.classList.remove("hide"),this.customDataDiv.appendChild(t.elem)),a.push(t)):(a[i].elem.replaceWith(t.elem),a[i]=t)}makeSavedData(e){const i=a(),s=t("div",{className:"saved-data-set-chip badge rounded-pill"},t("button",{className:"saved-data-set-name"},e.name),!this.config.loadOnly&&!e.isPreset&&t("button",{ref:i,className:"saved-data-set-delete"},t("i",{className:"fa fa-times fa-lg"})));if(s?.addEventListener("click",(()=>{this.config.setData(o.nextEventID(),this.modObject,e.data),e.onLoad?.(this.modObject),this.saveInput&&(this.saveInput.value=e.name)})),!this.config.loadOnly&&!e.isPreset&&i.value){const t=Kn(i.value,{content:`Delete saved ${this.config.label}`});i.value.addEventListener("click",(a=>{a.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${e.name}'?`))return;t.destroy();const i=this.userData.findIndex((t=>t.name===e.name));this.userData[i].elem.remove(),this.userData.splice(i,1),this.saveUserData()}))}e.tooltip&&Kn(s,{content:e.tooltip,placement:"bottom"});const n=()=>{this.config.equals(e.data,this.config.getData(this.modObject))?(s.classList.add("active"),this.saveInput&&(this.saveInput.value=e.name)):s.classList.remove("active"),e.enableWhen&&!e.enableWhen(this.modObject)?s.classList.add("disabled"):s.classList.remove("disabled")};n();const l=this.config.changeEmitters.map((e=>e.on(n)));return this.addOnDisposeCallback((()=>l.map((e=>e.dispose())))),{name:e.name,data:e.data,elem:s,enableWhen:e.enableWhen,onLoad:e.onLoad}}saveUserData(){const e={};this.userData.forEach((t=>{e[t.name]=this.config.toJson(t.data)})),this.presets.length||this.presetDataDiv.classList.add("hide"),this.userData.length||this.customDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey,JSON.stringify(e))}loadUserData(){const e=window.localStorage.getItem(this.config.storageKey);if(!e)return;let t;try{t=JSON.parse(e)}catch(a){console.warn("Invalid json for local storage value: "+e)}for(const i in t)try{this.addSavedData({name:i,data:this.config.fromJson(t[i])})}catch(a){console.warn("Failed parsing saved data: "+t[i])}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){const e=a(),i=a(),s=t("div",{className:"saved-data-create-container"},t("label",{className:"form-label"},this.config.label," Name"),t("input",{ref:i,className:"saved-data-save-input form-control",type:"text",placeholder:"Name"}),t("button",{ref:e,className:"saved-data-save-button btn btn-primary"},"Save ",this.config.label));return this.saveInput=i.value,e.value?.addEventListener("click",(()=>{if(this.frozen)return;const e=this.saveInput?.value;e?e in this.presets?alert(`${this.config.label} with name ${e} already exists.`):(this.addSavedData({name:e,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)})),s}}class dm extends e{constructor(e,t,a){super(e,"summary-table-root"),this.simUI=t,this.player=a,this.container=new po(this.rootElem,"summary-table-container",{header:{title:"Gem Summary",extraCssClasses:["summary-table--gems"]},extraCssClasses:["summary-table--gems"]}),a.gearChangeEmitter.on((()=>this.updateTable()))}updateTable(){const e=t(r,null),i=this.player.getGear().getAllGems(this.player.isBlacksmithing()),s=!!i.length;if(this.rootElem.classList[s?"remove":"add"]("hide"),s){const s={};for(const e of i)s[e.name]?s[e.name].count+=1:s[e.name]={gem:e,count:1};for(const i of Object.keys(s)){const n=s[i],o=a(),l=a(),r=t("div",{className:"summary-table-row d-flex align-items-center"},t("a",{ref:o,className:"summary-table-link","data-whtticon":"false",target:"_blank"},t("img",{ref:l,className:"gem-icon"}),t("div",null,i)),t("div",null,n.count.toFixed(0)));e.appendChild(r);const c=o.value,h=l.value;io(c,n.gem.quality),d.fromItemId(n.gem.id).fill().then((e=>{h.src=e.iconUrl,e.setWowheadHref(c)}))}if(this.container.bodyElement.replaceChildren(e),!this.container.headerElement)return;const n=this.container.headerElement.querySelector(".summary-table-reset-button"),l=t("button",{className:"btn btn-sm btn-link btn-reset summary-table-reset-button",onclick:()=>{this.player.setGear(o.nextEventID(),this.player.getGear().withoutGems())}},t("i",{className:"fas fa-times me-1"}),"Reset gems");n?this.container.headerElement.replaceChild(l,n):this.container.headerElement.appendChild(l)}}}class pm extends e{constructor(e,i,s){if(super(e,"preset-configuration-picker-root"),this.rootElem.classList.add("saved-data-manager-root"),this.simUI=i,this.builds=(this.simUI.individualConfig.presets.builds??[]).filter((e=>Object.keys(e).some((t=>s?.includes(t)&&!!e[t])))),!this.builds.length)return void this.rootElem.classList.add("hide");const n=new po(this.rootElem,"saved-data",{header:{title:"Preset Configurations",tooltip:"Preset configurations can apply an optimal combination of gear, talents, rotation and encounter settings."}}),l=a(),c=t("div",{className:"saved-data-container"},t("div",{className:"saved-data-presets",ref:l}));this.simUI.sim.waitForInit().then((()=>{this.builds.forEach((e=>{const i=a();l.value.appendChild(t("button",{className:"saved-data-set-chip badge rounded-pill",ref:i},t("span",{className:"saved-data-set-name",attributes:{role:"button"},onclick:()=>this.applyBuild(e)},e.name))),Kn(i.value,{content:t(r,null,t("p",{className:"mb-1"},"This preset affects the following settings:"),t("ul",{className:"mb-0 text-capitalize"},Object.keys(e).filter((e=>"name"!==e)).map((a=>e[a]?t("li",null,a):void 0))))});const s=()=>i.value.classList[this.isBuildActive(e)?"add":"remove"]("active");s(),o.onAny([this.simUI.player.changeEmitter,this.simUI.sim.settingsChangeEmitter,this.simUI.sim.raid.changeEmitter,this.simUI.sim.encounter.changeEmitter]).on(s)})),n.bodyElement.replaceChildren(c)}))}applyBuild({gear:e,itemSwap:t,rotation:a,rotationType:i,talents:s,epWeights:n,encounter:l,race:r}){const c=o.nextEventID();o.freezeAllAndDo((()=>{e&&this.simUI.player.setGear(c,this.simUI.sim.db.lookupEquipmentSpec(e.gear)),r&&this.simUI.player.setRace(c,r),t?this.simUI.player.itemSwapSettings.setItemSwapSettings(c,!0,this.simUI.sim.db.lookupItemSwap(t.itemSwap),h.fromProto(t.itemSwap.prepullBonusStats)):this.simUI.player.itemSwapSettings.setEnableItemSwap(c,!1),s&&(this.simUI.player.setTalentsString(c,s.data.talentsString),s.data.glyphs&&this.simUI.player.setGlyphs(c,s.data.glyphs)),i?(this.simUI.player.aplRotation.type=i,this.simUI.player.rotationChangeEmitter.emit(c)):a?.rotation.rotation&&this.simUI.player.setAplRotation(c,a.rotation.rotation),n&&this.simUI.player.setEpWeights(c,n.epWeights),l&&(l.encounter&&this.simUI.sim.encounter.fromProto(c,l.encounter),l.healingModel&&this.simUI.player.setHealingModel(c,l.healingModel),l.tanks&&this.simUI.sim.raid.setTanks(c,l.tanks),l.buffs&&this.simUI.player.setBuffs(c,l.buffs),l.debuffs&&this.simUI.sim.raid.setDebuffs(c,l.debuffs),l.raidBuffs&&this.simUI.sim.raid.setBuffs(c,l.raidBuffs),l.consumes&&this.simUI.player.setConsumes(c,l.consumes))}))}isBuildActive({gear:e,rotation:t,rotationType:a,talents:i,epWeights:s,encounter:n,race:o}){const l=!e||N.equals(e.gear,this.simUI.player.getGear().asSpec()),r="number"!=typeof o||o===this.simUI.player.getRace(),c=!i||Re.equals(i.data,Re.create({talentsString:this.simUI.player.getTalentsString(),glyphs:this.simUI.player.getGlyphs()}));let h=!0;if(a)h=a===this.simUI.player.getRotationType();else if(t){const e=this.simUI.player.getResolvedAplRotation();e.type===Fe.TypeAuto&&(e.type=Fe.TypeAPL),h=t.rotation?.rotation?.type===Fe.TypeSimple&&t.rotation.rotation?.simple?.specRotationJson?this.simUI.player.specTypeFunctions.rotationEquals(this.simUI.player.specTypeFunctions.rotationFromJson(JSON.parse(t.rotation.rotation.simple.specRotationJson)),this.simUI.player.getSimpleRotation()):Me.equals(t.rotation.rotation,e)}const m=!s||this.simUI.player.getEpWeights().equals(s.epWeights),d=!n?.encounter||We.equals(n.encounter,this.simUI.sim.encounter.toProto()),p=!n?.healingModel||ze.equals(n.healingModel,this.simUI.player.getHealingModel());return l&&r&&c&&h&&m&&d&&p}}class um extends e{constructor(e,t,a){super(e,"summary-table-root"),this.simUI=t,this.player=a,this.container=new po(this.rootElem,"summary-table-container",{header:{title:"Reforge Summary"},extraCssClasses:["summary-table--reforge"]}),a.gearChangeEmitter.on((()=>this.updateTable()))}updateTable(){const e=t(r,null),a=this.player.getGear().getAllReforges(),i={};for(const[t,n]of a){const{fromStat:e,toStat:t,fromAmount:a,toAmount:s}=n;"number"!=typeof i[e]&&(i[e]=0),"number"!=typeof i[t]&&(i[t]=0),a&&(i[e]+=a),s&&(i[t]+=s)}const s=!!Object.keys(i).length;if(this.rootElem.classList[s?"remove":"add"]("hide"),s){if(Object.keys(i).forEach((a=>{const s=Number(a),n=i[s];n&&e.appendChild(t("div",{className:"summary-table-row d-flex align-items-center"},t("div",null,v.get(s)),t("div",{className:""+(0===n?"":n>0?"positive":"negative")},n)))})),this.container.bodyElement.replaceChildren(e),!this.container.headerElement)return;const a=this.container.headerElement.querySelector(".summary-table-reset-button"),s=t("button",{className:"btn btn-sm btn-link btn-reset summary-table-reset-button",onclick:()=>{const e=this.player.getGear().withoutReforges(this.player.canDualWield2H());this.player.setGear(o.nextEventID(),e)}},t("i",{className:"fas fa-times me-1"}),"Reset Reforges");a?this.container.headerElement.replaceChild(s,a):this.container.headerElement.appendChild(s)}}}class gm extends ho{constructor(e,t){super(e,t,{identifier:"gear-tab",title:"Gear"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildSummaryTablesContainer(),this.buildPresetConfigurationPicker(),this.buildSavedGearsetPicker()}buildSummaryTablesContainer(){const e=document.createElement("div");e.classList.add("summary-tables-container"),this.leftPanel.appendChild(e),new dm(e,this.simUI,this.simUI.player),new um(e,this.simUI,this.simUI.player)}buildGearPickers(){new Do(this.leftPanel,this.simUI,this.simUI.player)}buildPresetConfigurationPicker(){new pm(this.rightPanel,this.simUI,["gear"])}buildSavedGearsetPicker(){const e=new mm(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:e=>je.create({gear:e.getGear().asSpec(),bonusStatsStats:e.getBonusStats().toProto()}),setData:(e,t,a)=>{o.freezeAllAndDo((()=>{t.setGear(e,this.simUI.sim.db.lookupEquipmentSpec(a.gear||N.create())),t.setBonusStats(e,h.fromProto(a.bonusStatsStats||Be.create()))}))},changeEmitters:[this.simUI.player.changeEmitter],equals:(e,t)=>je.equals(e,t),toJson:e=>je.toJson(e),fromJson:e=>je.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.gear.forEach((t=>{e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:je.create({gear:this.simUI.sim.db.lookupEquipmentSpec(t.gear).asSpec(),bonusStatsStats:(new h).toProto()}),enableWhen:t.enableWhen,onLoad:t.onLoad})}))}))}}function fm(e,t,a){return{inputs:e,label:t,categoryId:a,showWhen:t=>e.filter((e=>!e.showWhen||e.showWhen(t))).length>0}}function wm(e){const t=e.getModObject;return{id:e.id,type:"boolean",label:e.label,labelTooltip:e.labelTooltip,description:e.description,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0,extraCssClasses:e.extraCssClasses}}function ym(e){return wm({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function bm(e){return wm({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function vm(e){return wm({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Sm(e){const t=e.getModObject;return{id:e.id,type:"number",label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0,extraCssClasses:e.extraCssClasses}}const Im=(e,t)=>Number(n(e/100,{maximumFractionDigits:t.maxDecimalDigits,useGrouping:!1})),Em=(e,t)=>Number(n(100*e,{maximumFractionDigits:t.maxDecimalDigits,useGrouping:!1}));function km(e){const t={id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>Em(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Im(s,e))}return Sm(t)}function Cm(e){const t={id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>Em(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Im(s,e))}return Sm(t)}function _m(e){const t={id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>Em(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Im(s,e))}return Sm(t)}function xm(e){const t=e.getModObject;return{id:e.id,type:"enum",label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0}}function Tm(e){return xm({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function Pm(e){return xm({id:`${String(e.fieldName)||He()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function Rm(e){const t=e.getModObject;return{type:"icon",actionId:e.actionId,states:e.states,changedEvent:a=>e.changedEvent(t(a)),showWhen:a=>!e.showWhen||e.showWhen(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),extraCssClasses:e.extraCssClasses}}function Dm(e,t,a,i){return Rm({getModObject:e.getModObject,actionId:t,states:2,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:e.getFieldValue||(t=>i?e.getValue(t)[a]==i:e.getValue(t)[a]),setValue:e.setFieldValue||((t,s,n)=>{const o=e.getValue(s);i?n?o[a]=i:o[a]==i&&(o[a]=0):o[a]=n,e.setValue(t,s,o)}),extraCssClasses:e.extraCssClasses})}function Nm(e){return Dm({getModObject:e=>e,getValue:e=>e.getClassOptions(),setValue:(e,t,a)=>t.setClassOptions(e,a),changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses,getFieldValue:e.getValue,setFieldValue:e.setValue},e.id,e.fieldName,e.value)}function Gm(e,t,a,i){return Rm({getModObject:e.getModObject,actionId:t,states:0,changedEvent:e.changeEmitter,getValue:t=>e.getValue(t)[a],setValue:(t,s,n)=>{const o=e.getValue(s);if(i){const e=n-o[a];n+=(i-1)*e}n<0&&(n=0),o[a]=n,e.setValue(t,s,o)}})}function Um(e,t,a,i,s){const n=Gm(e,t,i,s);return n.states=a,n}function Om(e){const t=e.getModObject;return{type:"iconEnum",numColumns:e.numColumns,values:e.values.map((e=>{if(e.showWhen){const a=e.showWhen;e.showWhen=e=>a(t(e))}return e})),equals:e.equals,showWhen:a=>!e.showWhen||e.showWhen(t(a)),zeroValue:e.zeroValue,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),extraCssClasses:e.extraCssClasses}}function Am(e){return Om({numColumns:e.numColumns||1,values:e.values,equals:(e,t)=>e==t,showWhen:e.showWhen,zeroValue:0,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses})}function Lm(e){return Om({numColumns:e.numColumns||1,values:e.values,equals:(e,t)=>e==t,showWhen:e.showWhen,zeroValue:0,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses})}class Vm extends s{constructor(e,i,s){super(e,"icon-enum-picker-root",i,s),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??"vertical")?"dropdown":"dropend"),this.config=s,this.currentValue=this.config.zeroValue;const n=this.config.changedEvent(this.modObject).on((()=>{this.showWhen()?(this.restoreValue(),this.rootElem.classList.remove("hide")):(this.storeValue(),this.rootElem.classList.add("hide"))}));if(this.addOnDisposeCallback((()=>n.dispose())),s.tooltip){const e=Kn(this.rootElem,{content:s.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}const l=a(),c=a(),h=a();this.rootElem.appendChild(t(r,null,t("a",{ref:l,href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),t("ul",{ref:c,className:"dropdown-menu",style:{gridTemplateColumns:this.config.numColumns?`repeat(${this.config.numColumns}, 1fr)`:void 0,gridAutoFlow:"Horizontal"==this.config.direction?"column":void 0}}),t("label",{ref:h,className:"form-label"}))),this.buttonElem=l.value,this.buttonText=h.value;const m=c.value;this.config.values.forEach((e=>{const t=document.createElement("li");t.classList.add("icon-dropdown-option","dropdown-option"),m.appendChild(t);const a=document.createElement("a");a.classList.add("icon-picker-button"),a.dataset.whtticon="false",a.dataset.disableWowheadTouchTooltip="true",t.appendChild(a);const i=()=>{this.setImage(a,e),this.showValueWhen(e)?t.classList.remove("hide"):(t.classList.add("hide"),this.currentValue==e.value&&(this.setInputValue(this.config.zeroValue),this.inputChanged(o.nextEventID())))},s=this.config.changedEvent(this.modObject).on(i);if(i(),a.addEventListener("click",(t=>{t.preventDefault(),this.currentValue=e.value,this.storedValue=void 0,this.inputChanged(o.nextEventID())}),{signal:this.signal}),this.addOnDisposeCallback((()=>s.dispose())),e.tooltip){const t=Kn(a,{content:e.tooltip});this.addOnDisposeCallback((()=>t.destroy()))}})),this.init()}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(o.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(o.nextEventID()),this.storedValue=void 0)}setActionImage(e,t){t.fillAndSet(e,!0,!0)}setImage(e,t){if(t.showWhen&&!t.showWhen(this.modObject))return void e.removeAttribute("href");const a=t.actionId;a?(this.setActionImage(e,a),e.style.filter=""):t.iconUrl?(e.style.backgroundImage=`url(${t.iconUrl})`,e.style.filter="grayscale(1)"):(e.style.backgroundImage="",e.style.filter="",e.style.backgroundColor=t.color)}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(e){this.currentValue=e,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const t=this.config.values.find((e=>this.config.equals(e.value,this.currentValue)));if(t)this.setImage(this.buttonElem,t),null!=t.text&&(this.buttonText.style.display="block",this.buttonText.textContent=t.text);else if(this.config.backupIconUrl){const e=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,e),this.setActive(!1)}}setActive(e){e?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}showWhen(){return(!this.config.showWhen||this.config.showWhen(this.modObject))&&!!this.config.values.find((e=>e.actionId&&null!=e.actionId&&(!e.showWhen||e.showWhen(this.modObject))))}showValueWhen(e){return(!e.actionId||null!=e.actionId)&&(!e.showWhen||e.showWhen(this.modObject))}}class Fm extends s{constructor(e,i,s){super(e,"icon-picker-root",i,s),this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=s,this.currentValue=0,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const n=Boolean(this.config.improvedId);n&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!n&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");const o=a(),l=a(),r=a();this.rootAnchor.appendChild(t("div",{className:"icon-input-level-container"},t("a",{ref:o,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),t("a",{ref:l,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),t("span",{ref:r,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=o.value,this.improvedAnchor2=l.value,this.counterElem=r.value,this.updateButtonImage();const c=this.config.changedEvent(this.modObject).on((()=>{this.updateButtonImage(),this.showWhen()?(this.rootElem.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootElem.classList.add("hide"))}));this.init(),this.rootAnchor.addEventListener("click",(e=>{e.preventDefault(),this.handleLeftClick()}),{signal:this.signal}),this.rootAnchor.addEventListener("contextmenu",(e=>{e.preventDefault()}),{signal:this.signal}),this.rootAnchor.addEventListener("mousedown",(e=>{O(e)&&(e.preventDefault(),this.handleRightClick())}),{signal:this.signal}),this.addOnDisposeCallback((()=>c.dispose()))}updateButtonImage(){this.config.actionId.fillAndSet(this.rootAnchor,!0,!0),this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0,{signal:this.signal}),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0,{signal:this.signal})}handleLeftClick(){0==this.config.states||this.currentValue+1<this.config.states?(this.currentValue++,this.inputChanged(o.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(o.nextEventID()))}handleRightClick(){this.currentValue>0?this.currentValue--:0===this.config.states?this.currentValue=1:this.currentValue=this.config.states-1,this.inputChanged(o.nextEventID())}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const e=Number(this.config.getValue(this.modObject));return 0==e?null:1==e?this.config.actionId:2==e&&this.config.improvedId?this.config.improvedId:3==e&&this.config.improvedId2?this.config.improvedId2:this.config.actionId}setInputValue(e){this.currentValue=Number(e),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(o.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(o.nextEventID()),this.storedValue=void 0)}showWhen(){return null!=this.config.actionId&&(!this.config.showWhen||this.config.showWhen(this.modObject))}}const Mm=(e,t,a)=>{if("icon"==a.type)return new Fm(e,t,a);if("iconEnum"==a.type)return new Vm(e,t,a);throw new Error("Unsupported input type")};function Wm(e){return Dm({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,a)=>t.getRaid().setBuffs(e,a),changeEmitter:e=>o.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function zm(e){return Dm({getModObject:e=>e,getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,a)=>t.getRaid().setDebuffs(e,a),changeEmitter:e=>o.onAny([e.getRaid().debuffsChangeEmitter])},e.actionId,e.fieldName,e.value)}function jm(e){return Um({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,a)=>t.getRaid().setBuffs(e,a),changeEmitter:e=>o.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier)}function Bm(e){return Um({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,a)=>t.setBuffs(e,a),changeEmitter:e=>o.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier)}class Hm extends s{constructor(e,t,a){super(e,"enum-picker-root",t,a),this.selectElem=document.createElement("select"),this.selectElem.id=a.id,this.selectElem.classList.add("enum-picker-selector","form-select"),a.values.forEach((e=>{const t=document.createElement("option");t.value=String(e.value),t.textContent=e.name,this.selectElem.appendChild(t),e.tooltip&&(t.title=e.tooltip)})),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",(()=>{this.inputChanged(o.nextEventID())}),{signal:this.signal})}getInputElem(){return this.selectElem}getInputValue(){return Number(this.selectElem.value)}setInputValue(e){this.selectElem.value=String(e)}}const qm={actions:{create:{useIcon:!1}}};let Ym=null;const Km=class e extends s{constructor(a,i,s){if(s.isCompact&&(s.extraCssClasses=[...s.extraCssClasses||[],"list-picker-compact"]),super(a,"list-picker-root",i,s),this.config={...qm,...s},this.itemPickerPairs=[],this.rootElem.appendChild(t(r,null,s.title&&t("label",{className:"list-picker-title form-label"},s.title),t("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){const e=Kn(this.rootElem.querySelector(".list-picker-title"),{content:this.config.titleTooltip});this.addOnDisposeCallback((()=>e?.destroy()))}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let a=null,i=null;this.config.actions?.create?.useIcon?(a=e.makeActionElem("link-success","fa-plus"),i=Kn(a,{allowHTML:!1,content:`New ${s.itemLabel}`}),this.addOnDisposeCallback((()=>i?.destroy()))):a=t("button",{className:"btn btn-primary"},"New ",s.itemLabel),a.classList.add("list-picker-new-button"),a.addEventListener("click",(()=>{const e=this.config.newItem(),t=this.config.getValue(this.modObject).concat([e]);this.config.setValue(o.nextEventID(),this.modObject,t),i&&i.hide()}),{signal:this.signal}),this.rootElem.appendChild(a)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map((e=>e.picker.getInputValue()))}setInputValue(e){if(e.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(e.length).forEach((e=>e.elem.remove())),this.itemPickerPairs=this.itemPickerPairs.slice(0,e.length);else if(e.length>this.itemPickerPairs.length){const t=e.length-this.itemPickerPairs.length;for(let e=0;e<t;e++)this.addNewPicker()}e.forEach(((e,t)=>this.itemPickerPairs[t].picker.setInputValue(e)))}actionEnabled(e){return!this.config.allowedActions||this.config.allowedActions.includes(e)}addHoverListeners(e){e.addEventListener("mouseenter",(()=>{e.classList.add("hover")}),{signal:this.signal}),e.addEventListener("mouseleave",(()=>{e.classList.remove("hover")}),{signal:this.signal})}addNewPicker(){const t=this.itemPickerPairs.length,a=document.createElement("div");a.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&a.classList.add("inline"),this.itemsDiv.appendChild(a);const i=document.createElement("div");i.classList.add("list-picker-item");const s=document.createElement("div");s.classList.add("list-picker-item-header");const n=document.createElement("div");n.classList.add("list-picker-item-popover"),n.setAttribute("popover","auto"),s.appendChild(n);let l=!1;if(this.config.inlineMenuBar)a.appendChild(i),a.appendChild(s);else if(a.appendChild(s),a.appendChild(i),this.config.itemLabel){const e=document.createElement("h6");e.classList.add("list-picker-item-title"),e.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,s.appendChild(e)}const r=this.config.newItemPicker(i,this,t,{changedEvent:this.config.changedEvent,getValue:()=>this.getSourceValue()[t],setValue:(e,a,i)=>{const s=this.getSourceValue();s[t]=i,this.config.setValue(e,a,s)}}),c={elem:a,picker:r,idx:t};if(this.actionEnabled("delete")&&(!this.config.minimumItems||t+1>this.config.minimumItems)){l=!0;const a=e.makeActionElem("list-picker-item-delete","fa-times");a.classList.add("link-danger"),n.appendChild(a);const i=Kn(a,{allowHTML:!1,content:`Delete ${this.config.itemLabel}`});a.addEventListener("click",(()=>{const e=this.config.getValue(this.modObject);e.splice(t,1),this.config.setValue(o.nextEventID(),this.modObject,e),i.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>i?.destroy())),this.addHoverListeners(a)}if(this.actionEnabled("copy")){l=!0;const a=e.makeActionElem("list-picker-item-copy","fa-copy");n.appendChild(a);const i=Kn(a,{allowHTML:!1,content:`Copy to New ${this.config.itemLabel}`});a.addEventListener("click",(()=>{const e=this.config.getValue(this.modObject).slice();e.splice(t,0,this.config.copyItem(e[t])),this.config.setValue(o.nextEventID(),this.modObject,e),i.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>i?.destroy())),this.addHoverListeners(a)}if(this.actionEnabled("move")){l=!0,a.classList.add("draggable"),this.config.itemLabel&&a.classList.add(this.config.itemLabel.toLowerCase().replace(" ","-"));const i=e.makeActionElem("list-picker-item-move","fa-arrows-up-down");n.appendChild(i);const s=Kn(i,{allowHTML:!1,content:"Move (Drag+Drop)"});i.addEventListener("click",(()=>{s.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>{s?.destroy()})),this.addHoverListeners(i),i.addEventListener("mousedown",(()=>{i.setAttribute("draggable","true"),a.setAttribute("draggable","true")}),{signal:this.signal}),i.addEventListener("mouseup",(()=>{i.removeAttribute("draggable"),a.removeAttribute("draggable")}),{signal:this.signal}),i.addEventListener("dragstart",(e=>{if(e.target==i){const t=n.getBoundingClientRect();e.dataTransfer.setDragImage(a,0,t.height/2),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",a.classList.add("dragfrom"),Ym={listPicker:this,item:c}}}),{signal:this.signal});const r=()=>Ym&&"Action"===this.config.itemLabel&&Ym.listPicker!==this,h=()=>Ym&&Ym.listPicker===this&&Ym.item.idx===t,m=()=>Ym&&Ym.item.elem.contains(a),d=(e=!0)=>!Ym||Ym.listPicker.config.itemLabel!==this.config.itemLabel||(!!r()||(!(!e||!h())||!(!e||!m())));let p=0;a.addEventListener("dragenter",(e=>{d()||(e.stopPropagation(),p++,a.classList.add("dragto"))}),{signal:this.signal}),a.addEventListener("dragleave",(e=>{d()||(e.preventDefault(),p--,p<=0&&a.classList.remove("dragto"))}),{signal:this.signal}),a.addEventListener("dragover",(e=>{d()?(r()||h())&&(e.dataTransfer.dropEffect="none"):(e.dataTransfer.dropEffect="move",e.stopPropagation(),e.preventDefault())}),{signal:this.signal});const u=()=>{Ym&&(i.removeAttribute("draggable"),a.removeAttribute("draggable"),Ym.item.elem.removeAttribute("draggable"),[...document.querySelectorAll(".dragfrom,.dragto")].forEach((e=>{e.classList.remove("dragfrom"),e.classList.remove("dragto")})))};a.addEventListener("dragend",(e=>{d(!1)||(e.stopPropagation(),u(),Ym=null)}),{signal:this.signal}),a.addEventListener("drop",(e=>{if(!Ym||d())return void(h()&&(e.stopPropagation(),u()));e.stopPropagation(),u();const i=Ym.item.idx;let s=t;const n=a.getBoundingClientRect();e.clientY>n.top+n.height/2&&s++;const l=this.config.getValue(this.modObject);let r;if(Ym.listPicker!==this){const e=Ym.listPicker.config.getValue(Ym.listPicker.modObject);r=e[i],e.splice(i,1),Ym.listPicker.config.setValue(o.nextEventID(),Ym.listPicker.modObject,e)}else r=l[i],l.splice(i,1);l.splice(s,0,r),this.config.setValue(o.nextEventID(),this.modObject,l),Ym=null}),{signal:this.signal})}if(l){const t=e.makeActionElem("list-picker-item-actions","fa-ellipsis");s.appendChild(t),t.addEventListener("mouseover",(()=>{n.showPopover();const e=t.getBoundingClientRect(),a=n.getBoundingClientRect(),i=(a.height-e.height)/2;n.style.top=e.top-i+"px",n.style.left=e.right-a.width+10+"px",n.classList.add("hover")}),{signal:this.signal}),n.addEventListener("mouseleave",(()=>{n.classList.remove("hover"),n.hidePopover()}),{signal:this.signal})}this.itemPickerPairs.push(c)}static makeActionElem(e,a){return t("button",{type:"button",className:u("list-picker-item-action",e)},t("i",{className:u("fa","fa-xl",a)}))}static getItemHeaderElem(e){const t=e.rootElem.parentElement,a=t.nextElementSibling||t.previousElementSibling;if(!a?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return a}static makeListItemValidations(t,a,i){const s=e.makeActionElem("apl-validations","fa-exclamation-triangle");s.setAttribute("data-bs-html","true");const n=Kn(s,{theme:"dropdown-tooltip",content:"Warnings"});t.appendChild(s);const o=s.querySelector("i"),l=async()=>{if(!Ye(s))return n?.destroy(),s?.remove(),void a.currentStatsEmitter.off(l);n.setContent("");const e=i(a);if(e.length){s.style.removeProperty("display");const t=await Promise.all(e.map((async e=>({...e,validation:await d.replaceAllInString(e.validation)}))));let a=qe.Undefined;const i=t.reduce(((e,t)=>{const i=t.logLevel;a=Math.max(i,a);const s=e.get(i);return s?s.push(t.validation):e.set(i,[t.validation]),e}),new Map);for(const[e,s]of this.logLevelDisplayData)o.classList.remove(s.icon);const l=this.logLevelDisplayData.get(a)?.icon;l&&o.classList.add(l);for(const[e,n]of Object.entries(qe))s.classList[n===a?"add":"remove"](`apl-validation-${e.toLowerCase()}`);let r="";for(const[e,s]of i)r+=`\n\t\t\t\t\t\t<p>${this.logLevelDisplayData.get(e)?.header}</p>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t${s.map((e=>`<li>${e}</li>`)).join("")}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t`;n.setContent(r)}else s.style.display="none"};l(),a.currentStatsEmitter.on(l)}};Km.logLevelDisplayData=new Map([[qe.Information,{icon:"fa-info-circle",header:"Additional Information&#58;"}],[qe.Warning,{icon:"fa-exclamation-triangle",header:"This action has warnings, and might not behave as expected."}],[qe.Error,{icon:"fa-exclamation-triangle",header:"This action has errors, and will not behave as expected."}]]);let $m=Km;class Jm extends s{constructor(e,t,a){super(e,"adaptive-string-picker-root",t,a),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.id=a.id,this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(o.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(e){this.inputElem.value=e,this.updateSize()}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const Zm={auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().map((e=>({value:e.id})))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.maxStacks>0)).map((e=>({value:e.id})))},icd_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasIcd)).map((e=>({value:e.id})))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasExclusiveEffect)).map((e=>({value:e.id})))},spells:{defaultLabel:"Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable)).map((e=>({value:e.id})))},castable_spells:{defaultLabel:"Spell",getActionIDs:async e=>{const t=e.getSpells().filter((e=>e.data.isCastable)),{spells:a,cooldowns:i}=ot(t,(e=>e.data.isMajorCooldown?"cooldowns":"spells")),s=[d.fromOtherId(lt.OtherActionPotion)];return[[{value:d.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(a||[]).map((e=>({value:e.id,submenu:["Spells"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}))),[{value:d.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(i||[]).map((e=>({value:e.id,submenu:["Cooldowns"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}))),[{value:d.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],s.map((e=>({value:e,submenu:["Placeholders"],tooltip:"The Prepull Potion if CurrentTime < 0, or the Combat Potion if combat has started."})))].flat()}},non_instant_spells:{defaultLabel:"Non-instant Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.hasCastTime)).map((e=>({value:e.id})))},friendly_spells:{defaultLabel:"Friendly Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isFriendly)).map((e=>({value:e.id})))},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isChanneled)).map((e=>({value:e.id})))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasDot)).filter(((e,t,a)=>a.findIndex((t=>t.id.anyId()===e.id.anyId()))===t)).map((e=>({value:e.id})))},castable_dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.hasDot)).map((e=>({value:e.id})))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasShield)).map((e=>({value:e.id})))}},Qm=new Ke;class Xm extends at{constructor(e,i,s){const n=Zm[s.actionIdSet];super(e,i,{...s,sourceToValue:e=>e?d.fromProto(e):d.fromEmpty(),valueToSource:e=>e.toProto(),defaultLabel:n.defaultLabel,equals:(e,t)=>null==e==(null==t)&&(!e||e.equals(t)),setOptionContent:(e,i)=>{const n=i.value,o=["auras","stackable_auras","icd_auras","exclusive_effect_auras"].includes(s.actionIdSet),l=`${n.toString()}${o}`,c=Qm.get(l)?.cloneNode(!0);c&&e.appendChild(c);const h=a(),m=t(r,null,t("a",{ref:h,className:"apl-actionid-item-icon",dataset:{whtticon:!1}}),n.name);e.appendChild(m),n.setBackgroundAndHref(h.value),n.setWowheadDataset(h.value,{useBuffAura:o}),Qm.set(l,m)},createMissingValue:e=>0==e.anyId()?new Promise((()=>{n.defaultLabel})):e.fill().then((e=>({value:e}))),values:[]});const o=s.getUnitRef,l="self"==s.defaultUnitRef?Je.create({type:it.Self}):Je.create({type:it.CurrentTarget}),c=n.getActionIDs,h=async()=>{const e=o(i),t=i.sim.getUnitMetadata(e,i,l);if(t){const e=await c(t);this.setOptions(e)}};h();const m=i.sim.unitMetadataEmitter.on(h),p=i.rotationChangeEmitter.on(h);this.addOnDisposeCallback((()=>{m.dispose(),p.dispose()}))}}const ed={aura_sources:{getUnits:e=>[void 0,e.getPetMetadatas().asList().map(((e,t)=>Je.create({type:it.Pet,index:t,owner:Je.create({type:it.Self})}))),Je.create({type:it.CurrentTarget}),e.sim.raid.getActivePlayers().filter((t=>t!=e)).map((e=>Je.create({type:it.Player,index:e.getRaidIndex()}))),e.sim.encounter.targetsMetadata.asList().map(((e,t)=>Je.create({type:it.Target,index:t})))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>Je.create({type:it.Target,index:t}))),Je.create({type:it.Self}),e.getPetMetadatas().asList().map(((e,t)=>Je.create({type:it.Pet,index:t,owner:Je.create({type:it.Self})})))].flat()},targets:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>Je.create({type:it.Target,index:t})))].flat()},players:{targetUI:!0,getUnits:e=>[void 0,e.sim.raid.getActivePlayers().map((e=>Je.create({type:it.Player,index:e.getRaidIndex()})))].flat()}};class td extends st{constructor(e,t,a){const i=!!ed[a.unitSet].targetUI;super(e,t,{...a,sourceToValue:e=>td.refToValue(e,t,i),valueToSource:e=>e.value,values:[],hideLabelWhenDefaultSelected:!0}),this.unitSet=a.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues();const s=t.sim.unitMetadataEmitter.on((()=>this.updateValues()));this.addOnDisposeCallback((()=>{s.dispose()}))}static refToValue(e,t,a){if(!e||e.type==it.Unknown)return{value:e,iconUrl:a?"fa-bullseye":"fa-user",text:a?"Current Target":"Self"};if(e.type==it.Self)return{value:e,iconUrl:"fa-user",text:"Self"};if(e.type==it.CurrentTarget)return{value:e,iconUrl:"fa-bullseye",text:"Current Target"};if(e.type==it.Player){const a=t.sim.raid.getPlayer(e.index);if(a)return{value:e,iconUrl:a.getSpecIcon(),text:`Player ${e.index+1}`}}else if(e.type==it.Target){if(t.sim.encounter.targetsMetadata.asList()[e.index])return{value:e,iconUrl:nt,text:`Target ${e.index+1}`}}else if(e.type==it.Pet){const a=t.sim.getUnitMetadata(e,t,Je.create({type:it.Self}));let i=`Pet ${e.index+1}`,s="fa-paw";if(a){const e=a.getName();if(e){const t=e.indexOf(" - ");i=e.substring(t+3),s=rt(i)||s}}return{value:e,iconUrl:s,text:i}}return{value:e}}updateValues(){const e=ed[this.unitSet],t=e.getUnits(this.modObject);this.setOptions(t.map((t=>{const a={value:td.refToValue(t,this.modObject,e.targetUI)};return t&&t.type==it.Pet&&(e.targetUI?a.submenu=[td.refToValue(t.owner,this.modObject,e.targetUI)]:a.submenu=[td.refToValue(void 0,this.modObject,e.targetUI)]),a})))}}class ad extends s{constructor(e,t,a){super(e,"apl-picker-builder-root",t,a),this.config=a,this.fieldPickers=a.fields.map((e=>ad.makeFieldPicker(this,e))),this.init()}static makeFieldPicker(e,t){const a=t.field,i=t.factory(e.rootElem,e.modObject,{label:t.label,labelTooltip:t.labelTooltip,id:He(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const i=e.getSourceValue();return i[a]||(i[a]=t.newValue()),i[a]},setValue:(t,i,s)=>{e.getSourceValue()[a]=s,i.rotationChangeEmitter.emit(t)}},(()=>e.getSourceValue()));return"vals"!==a&&"actions"!==a||i.rootElem.classList.add("apl-picker-builder-multi"),{...t,picker:i}}getInputElem(){return this.rootElem}getInputValue(){const e=this.config.newValue();return this.fieldPickers.forEach((t=>{e[t.field]=t.picker.getInputValue()})),e}setInputValue(e){this.fieldPickers.forEach((t=>{t.picker.setInputValue(e[t.field])}))}}function id(e,t,a,i,s){return{field:e,newValue:()=>$e.create(),factory:(e,s,n,o)=>new Xm(e,s,{id:He(),...n,actionIdSet:t,getUnitRef:()=>a?o()[a]:Je.create(),defaultUnitRef:i||"self"})}}function sd(e,t,a){return{field:e,newValue:()=>{},factory:(e,a,i)=>new td(e,a,{id:He(),...i,unitSet:t})}}function nd(e,t,a){return{field:e,newValue:()=>!1,factory:(e,t,a)=>(a.extraCssClasses=["input-inline"].concat(a.extraCssClasses||[]),new Te(e,t,{id:He(),...a})),...a||{},label:t}}function od(e,t,a){return{field:e,newValue:()=>0,factory:(e,a,i)=>{const s=i;return s.float=t,s.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new so(e,a,s)},...a||{}}}function ld(e,t){return{field:e,newValue:()=>"",factory:(e,t,a)=>(a.extraCssClasses=["input-inline"].concat(a.extraCssClasses||[]),new Jm(e,t,{id:He(),...a})),...t||{}}}function rd(e,t){const a=[{value:Qe.RuneBlood,label:"Blood"},{value:Qe.RuneFrost,label:"Frost"},{value:Qe.RuneUnholy,label:"Unholy"}];return t&&a.push({value:Qe.RuneDeath,label:"Death"}),{field:e,newValue:()=>Qe.RuneBlood,factory:(e,t,i)=>new Xe(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:a})}}function cd(e){return{field:e,newValue:()=>et.SlotLeftBlood,factory:(e,t,a)=>new Xe(e,t,{id:He(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:et.SlotLeftBlood,label:"Blood Left"},{value:et.SlotRightBlood,label:"Blood Right"},{value:et.SlotLeftFrost,label:"Frost Left"},{value:et.SlotRightFrost,label:"Frost Right"},{value:et.SlotLeftUnholy,label:"Unholy Left"},{value:et.SlotRightUnholy,label:"Unholy Right"}]})}}function hd(e){const t=P(l),a=[{value:-1,label:"None"}].concat(t.map((e=>({value:e,label:g(e)}))));return{field:e,label:"Buff Type",newValue:()=>0,factory:(e,t,i)=>new Xe(e,t,{id:He(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:a})}}const md=od("minIcdSeconds",!1,{label:"Min ICD",labelTooltip:"If non-zero, filter out any procs that either lack an ICD or for which the ICD is smaller than the specified value (in seconds). This can be useful for certain snapshotting checks, since procs with low ICDs are often too weak to snapshot."});function dd(e,t){return(a,i,s)=>new ad(a,i,{...s,newValue:e,fields:t})}class pd extends s{constructor(e,t,a){super(e,"apl-value-picker-root",t,a);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),s=Object.keys(wd).filter((e=>wd[e].includeIf?.(t,i)??!0));if(this.rootElem.parentElement.classList.contains("list-picker-item")){const e=$m.getItemHeaderElem(this)||this.rootElem;$m.makeListItemValidations(e,t,(e=>e.getCurrentStats().rotationStats?.uuidValidations?.find((e=>e.uuid?.value===this.rootElem.id))?.validations||[]))}this.kindPicker=new Xe(this.rootElem,t,{defaultLabel:"No Condition",id:He(),values:[{value:void 0,label:"<None>"}].concat(s.map((e=>{const a=wd[e],i=a.dynamicStringResolver||(e=>e);return{value:e,label:i(a.label,t),submenu:a.submenu,tooltip:a.fullDescription?`<p>${i(a.shortDescription,t)}</p> ${i(a.fullDescription,t)}`:i(a.shortDescription,t)}}))),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.value.oneofKind,setValue:(e,t,a)=>{const i=this.getSourceValue(),s=i?.value.oneofKind;if(s!=a){if(a){const t=wd[a];let n=this.makeAPLValue(a,t.newValue());i&&s&&this.valuePicker&&("not"==a?n.value.not.val=this.makeAPLValue(s,this.valuePicker.getInputValue()):"not"==i.value.oneofKind&&i.value.not.val?.value.oneofKind==a?n=i.value.not.val:"and"==a?"or"==i.value.oneofKind?n.value.and.vals=i.value.or.vals:n.value.and.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"or"==a?"and"==i.value.oneofKind?n.value.or.vals=i.value.and.vals:n.value.or.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"min"==a?"max"==i.value.oneofKind?n.value.min.vals=i.value.max.vals:n.value.min.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"max"==a?"min"==i.value.oneofKind?n.value.max.vals=i.value.min.vals:n.value.max.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"and"==i.value.oneofKind&&i.value.and.vals?.[0]?.value.oneofKind==a?n=i.value.and.vals[0]:"or"==i.value.oneofKind&&i.value.or.vals?.[0]?.value.oneofKind==a?n=i.value.or.vals[0]:"min"==i.value.oneofKind&&i.value.min.vals?.[0]?.value.oneofKind==a?n=i.value.min.vals[0]:"max"==i.value.oneofKind&&i.value.max.vals?.[0]?.value.oneofKind==a?n=i.value.max.vals[0]:"cmp"==a&&(n.value.cmp.lhs=this.makeAPLValue(s,this.valuePicker.getInputValue()))),i?i.value=n.value:this.setSourceValue(e,n)}else this.setSourceValue(e,void 0);t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return e?Xa.create({value:{oneofKind:e,...(()=>{const t={};return e&&this.valuePicker&&(t[e]=this.valuePicker.getInputValue()),t})()},uuid:{value:He()}}):void 0}setInputValue(e){const t=e?.value.oneofKind;this.updateValuePicker(t),t&&e&&this.valuePicker.setInputValue(e.value[t]),e&&(e.uuid&&""!=e.uuid.value||(e.uuid={value:He()}),this.rootElem.id=e.uuid.value)}makeAPLValue(e,t){if(!e)return Xa.create({uuid:{value:He()}});const a={oneofKind:e};return a[e]=t,Xa.create({value:a,uuid:{value:He()}})}updateValuePicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!e)return;this.kindPicker.setInputValue(e);const a=wd[e];this.valuePicker=a.factory(this.rootElem,this.modObject,{id:He(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const t=this.getSourceValue();return t&&t.value[e]||a.newValue()},setValue:(t,a,i)=>{const s=this.getSourceValue();s&&(s.value[e]=i),a.rotationChangeEmitter.emit(t)}})}}function ud(e,t){return{field:e,newValue:()=>Xa.create({uuid:{value:He()}}),factory:(e,t,a)=>new pd(e,t,a),...t||{}}}function gd(e){return{field:e,newValue:()=>[],factory:(e,t,a)=>new $m(e,t,{...a,setValue:(e,t,i)=>{a.setValue(e,t,i.map((e=>e||Xa.create({uuid:{value:He()}}))))},itemLabel:"Value",newItem:()=>Xa.create({uuid:{value:He()}}),copyItem:e=>e?Xa.clone(e):e,newItemPicker:(e,a,i,s)=>new pd(e,t,s),allowedActions:["copy","create","delete","move"],actions:{create:{useIcon:!0}}})}}function fd(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,newValue:e.newValue,includeIf:e.includeIf,factory:dd(e.newValue,e.fields),dynamicStringResolver:e.dynamicStringResolver}}const wd={const:fd({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:ct.create,fields:[ld("val")]}),cmp:fd({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:ht.create,fields:[ud("lhs"),(yd="op",{field:yd,newValue:()=>$a.OpEq,factory:(e,t,a)=>new Xe(e,t,{id:He(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:$a.OpEq,label:"=="},{value:$a.OpNe,label:"!="},{value:$a.OpGe,label:">="},{value:$a.OpGt,label:">"},{value:$a.OpLe,label:"<="},{value:$a.OpLt,label:"<"}]})}),ud("rhs")]}),math:fd({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:mt.create,fields:[ud("lhs"),function(e){return{field:e,newValue:()=>Ja.OpAdd,factory:(e,t,a)=>new Xe(e,t,{id:He(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Ja.OpAdd,label:"+"},{value:Ja.OpSub,label:"-"},{value:Ja.OpMul,label:"*"},{value:Ja.OpDiv,label:"/"}]})}}("op"),ud("rhs")]}),max:fd({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:dt.create,fields:[gd("vals")]}),min:fd({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:pt.create,fields:[gd("vals")]}),and:fd({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:ut.create,fields:[gd("vals")]}),or:fd({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:gt.create,fields:[gd("vals")]}),not:fd({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:ft.create,fields:[ud("val")]}),currentTime:fd({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:wt.create,fields:[]}),currentTimePercent:fd({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:yt.create,fields:[]}),remainingTime:fd({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:bt.create,fields:[]}),remainingTimePercent:fd({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:vt.create,fields:[]}),isExecutePhase:fd({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:St.create,fields:[function(e){return{field:e,newValue:()=>Za.E20,factory:(e,t,a)=>new Xe(e,t,{id:He(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Za.E20,label:"20%"},{value:Za.E25,label:"25%"},{value:Za.E35,label:"35%"},{value:Za.E90,label:"90%"}]})}}("threshold")]}),numberTargets:fd({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:It.create,fields:[]}),frontOfTarget:fd({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:Et.create,fields:[]}),bossSpellIsCasting:fd({label:"Spell is Casting",submenu:["Boss"],shortDescription:"",newValue:kt.create,fields:[sd("targetUnit","targets"),id("spellId","non_instant_spells","targetUnit","currentTarget")]}),bossSpellTimeToReady:fd({label:"Spell Time to Ready",submenu:["Boss"],shortDescription:"",newValue:Ct.create,fields:[sd("targetUnit","targets"),id("spellId","spells","targetUnit","currentTarget")]}),unitIsMoving:fd({label:"Is moving",submenu:["Unit"],shortDescription:"",newValue:_t.create,fields:[sd("sourceUnit","aura_sources")]}),currentHealth:fd({label:"Current Health",submenu:["Resources","Health"],shortDescription:"Amount of currently available Health.",newValue:xt.create,fields:[sd("sourceUnit","aura_sources")]}),currentHealthPercent:fd({label:"Current Health (%)",submenu:["Resources","Health"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:Tt.create,fields:[sd("sourceUnit","aura_sources")]}),currentMana:fd({label:"Current Mana",submenu:["Resources","Mana"],shortDescription:"Amount of currently available Mana.",newValue:Pt.create,includeIf(e,t){const a=e.getClass();return a!==se.ClassDeathKnight&&a!==se.ClassHunter&&a!==se.ClassRogue&&a!==se.ClassWarrior},fields:[]}),currentManaPercent:fd({label:"Current Mana (%)",submenu:["Resources","Mana"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:Rt.create,includeIf(e,t){const a=e.getClass();return a!==se.ClassDeathKnight&&a!==se.ClassHunter&&a!==se.ClassRogue&&a!==se.ClassWarrior},fields:[]}),currentRage:fd({label:"Rage",submenu:["Resources"],shortDescription:"Amount of currently available Rage.",newValue:Dt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===f.SpecFeralDruid||i===f.SpecGuardianDruid||a===se.ClassWarrior},fields:[]}),currentFocus:fd({label:"Current Focus",submenu:["Resources","Focus"],shortDescription:"Amount of currently available Focus.",newValue:Nt.create,includeIf:(e,t)=>e.getClass()==se.ClassHunter,fields:[]}),maxFocus:fd({label:"Max Focus",submenu:["Resources","Focus"],shortDescription:"Amount of maximum available Focus.",newValue:Gt.create,includeIf:(e,t)=>e.getClass()==se.ClassHunter,fields:[]}),focusRegenPerSecond:fd({label:"Focus Regen Per Second",submenu:["Resources","Focus"],shortDescription:"Focus regen per second.",newValue:Ut.create,includeIf:(e,t)=>e.getClass()==se.ClassHunter,fields:[]}),focusTimeToTarget:fd({label:"Estimated Time To Target Focus",submenu:["Resources","Focus"],shortDescription:"Estimated time until target Focus is reached, will return 0 if at or above target.",newValue:Ot.create,includeIf:(e,t)=>e.getClass()==se.ClassHunter,fields:[ud("targetFocus")]}),currentEnergy:fd({label:"Current Energy",submenu:["Resources","Energy"],shortDescription:"Amount of currently available Energy.",newValue:At.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===f.SpecFeralDruid||i===f.SpecGuardianDruid||a===se.ClassRogue||a===se.ClassMonk},fields:[]}),maxEnergy:fd({label:"Max Energy",submenu:["Resources","Energy"],shortDescription:"Amount of maximum available Energy.",newValue:Lt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===f.SpecFeralDruid||i===f.SpecGuardianDruid||a===se.ClassRogue||a===se.ClassMonk},fields:[]}),energyRegenPerSecond:fd({label:"Energy Regen Per Second",submenu:["Resources","Energy"],shortDescription:"Energy regen per second.",newValue:Vt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===f.SpecFeralDruid||i===f.SpecGuardianDruid||a===se.ClassRogue||a===se.ClassMonk},fields:[]}),energyTimeToTarget:fd({label:"Estimated Time To Target Energy",submenu:["Resources","Energy"],shortDescription:"Estimated time until target Energy is reached, will return 0 if at or above target.",newValue:Ft.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===f.SpecFeralDruid||i===f.SpecGuardianDruid||a===se.ClassRogue||a===se.ClassMonk},fields:[ud("targetEnergy")]}),currentComboPoints:fd({label:"Current Combo Points",submenu:["Resources","Combo Points"],shortDescription:"Amount of currently available Combo Points.",newValue:Mt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===f.SpecFeralDruid||i===f.SpecGuardianDruid||a===se.ClassRogue},fields:[]}),maxComboPoints:fd({label:"Max Combo Points",submenu:["Resources","Combo Points"],shortDescription:"Amount of maximum available Combo Points.",newValue:Wt.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===f.SpecFeralDruid||i===f.SpecGuardianDruid||a===se.ClassRogue},fields:[]}),monkCurrentChi:fd({label:"Current Chi",submenu:["Resources","Chi"],shortDescription:"Amount of currently available Chi.",newValue:zt.create,includeIf:(e,t)=>e.getClass()===se.ClassMonk,fields:[]}),monkMaxChi:fd({label:"Max Chi",submenu:["Resources","Chi"],shortDescription:"Amount of maximum available Chi.",newValue:jt.create,includeIf:(e,t)=>e.getClass()===se.ClassMonk,fields:[]}),currentRunicPower:fd({label:"Current Runic Power",submenu:["Resources","Runic Power"],shortDescription:"Amount of currently available Runic Power.",newValue:Bt.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[]}),maxRunicPower:fd({label:"Max Runic Power",submenu:["Resources","Runic Power"],shortDescription:"Amount of maximum available Runic Power.",newValue:Ht.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[]}),currentLunarEnergy:fd({label:"Solar Energy",submenu:["Resources","Eclipse"],shortDescription:"Amount of currently available Solar Energy.",newValue:qt.create,includeIf:(e,t)=>e.getSpec()==f.SpecBalanceDruid,fields:[]}),currentSolarEnergy:fd({label:"Lunar Energy",submenu:["Resources","Eclipse"],shortDescription:"Amount of currently available Lunar Energy",newValue:Yt.create,includeIf:(e,t)=>e.getSpec()==f.SpecBalanceDruid,fields:[]}),druidCurrentEclipsePhase:fd({label:"Current Eclipse Phase",submenu:["Resources","Eclipse"],shortDescription:"The eclipse phase the druid currently is in.",newValue:Kt.create,includeIf:(e,t)=>e.getSpec()==f.SpecBalanceDruid,fields:[function(e){const t=[{value:Ze.LunarPhase,label:"Lunar"},{value:Ze.SolarPhase,label:"Solar"},{value:Ze.NeutralPhase,label:"Neutral"}];return{field:e,newValue:()=>Qe.RuneBlood,factory:(e,a,i)=>new Xe(e,a,{id:He(),...i,defaultLabel:"Lunar",equals:(e,t)=>e==t,values:t})}}("eclipsePhase")]}),currentGenericResource:fd({label:"{GENERIC_RESOURCE}",submenu:["Resources"],shortDescription:"Amount of currently available {GENERIC_RESOURCE}.",newValue:$t.create,includeIf:(e,t)=>Jt.hasSecondaryResource(e.getSpec()),fields:[],dynamicStringResolver:(e,t)=>t.secondaryResource?.replaceResourceName(e)||""}),currentRuneCount:fd({label:"Num Runes",submenu:["Resources","Runes"],shortDescription:"Amount of currently available Runes of certain type including Death.",newValue:Zt.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[rd("runeType",!0)]}),currentNonDeathRuneCount:fd({label:"Num Non Death Runes",submenu:["Resources","Runes"],shortDescription:"Amount of currently available Runes of certain type ignoring Death",newValue:Qt.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[rd("runeType",!1)]}),currentRuneActive:fd({label:"Rune Is Ready",submenu:["Resources","Runes"],shortDescription:"Is the rune of a certain slot currently available.",newValue:Xt.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[cd("runeSlot")]}),currentRuneDeath:fd({label:"Rune Is Death",submenu:["Resources","Runes"],shortDescription:"Is the rune of a certain slot currently converted to Death.",newValue:ea.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[cd("runeSlot")]}),runeCooldown:fd({label:"Rune Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there is a rune available",newValue:ta.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[rd("runeType",!1)]}),nextRuneCooldown:fd({label:"Next Rune Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a 2nd rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there are 2 runes available",newValue:aa.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[rd("runeType",!1)]}),runeSlotCooldown:fd({label:"Rune Slot Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a rune of certain slot is ready to use.<br><b>NOTE:</b> Returns 0 if rune is ready",newValue:ia.create,includeIf:(e,t)=>e.getClass()==se.ClassDeathKnight,fields:[cd("runeSlot")]}),gcdIsReady:fd({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:sa.create,fields:[]}),gcdTimeToReady:fd({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:na.create,fields:[]}),autoTimeToNext:fd({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:oa.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return a!==se.ClassHunter&&a!==se.ClassMage&&a!==se.ClassPriest&&a!==se.ClassWarlock&&i!==f.SpecBalanceDruid&&i!==f.SpecElementalShaman},fields:[]}),spellIsKnown:fd({label:"Spell Known",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is currently known, otherwise <b>False</b>.",newValue:la.create,fields:[id("spellId","castable_spells","")]}),spellCurrentCost:fd({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:ra.create,fields:[id("spellId","castable_spells","")]}),spellCanCast:fd({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:ca.create,fields:[id("spellId","castable_spells","")]}),spellIsReady:fd({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:ha.create,fields:[id("spellId","castable_spells","")]}),spellTimeToReady:fd({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:ma.create,fields:[id("spellId","castable_spells","")]}),spellCastTime:fd({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:da.create,fields:[id("spellId","castable_spells","")]}),spellTravelTime:fd({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:pa.create,fields:[id("spellId","castable_spells","")]}),spellCpm:fd({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:ua.create,fields:[id("spellId","castable_spells","")]}),spellIsChanneling:fd({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:ga.create,fields:[id("spellId","channel_spells","")]}),spellChanneledTicks:fd({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:fa.create,fields:[id("spellId","channel_spells","")]}),channelClipDelay:fd({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:wa.create,fields:[]}),inputDelay:fd({label:"Input Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Input Dleay</b> setting.",newValue:ya.create,fields:[]}),auraIsKnown:fd({label:"Aura Known",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently known, otherwise <b>False</b>.",newValue:ba.create,fields:[sd("sourceUnit","aura_sources"),id("auraId","auras","sourceUnit")]}),auraIsActive:fd({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active, otherwise <b>False</b>.",newValue:va.create,fields:[sd("sourceUnit","aura_sources"),id("auraId","auras","sourceUnit")]}),auraIsActiveWithReactionTime:fd({label:"Aura Active (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Sa.create,fields:[sd("sourceUnit","aura_sources"),id("auraId","auras","sourceUnit")]}),auraIsInactiveWithReactionTime:fd({label:"Aura Inactive (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is not currently active AND it has been inactive for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Ia.create,fields:[sd("sourceUnit","aura_sources"),id("auraId","auras","sourceUnit")]}),auraRemainingTime:fd({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:Ea.create,fields:[sd("sourceUnit","aura_sources"),id("auraId","auras","sourceUnit")]}),auraNumStacks:fd({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:ka.create,fields:[sd("sourceUnit","aura_sources"),id("auraId","stackable_auras","sourceUnit")]}),auraInternalCooldown:fd({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:Ca.create,fields:[sd("sourceUnit","aura_sources"),id("auraId","icd_auras","sourceUnit")]}),auraIcdIsReadyWithReactionTime:fd({label:"Aura ICD Is Ready (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:_a.create,fields:[sd("sourceUnit","aura_sources"),id("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:fd({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>xa.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[sd("sourceUnit","aura_sources_targets_first"),id("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),ud("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),monkNextChiBrewRecharge:fd({label:"Next Chi Brew Recharge",submenu:["Aura"],shortDescription:"Returns the amount of time until the next Chi Brew stack will be ready.",newValue:Ta.create,includeIf:(e,t)=>e.getClass()==se.ClassMonk,fields:[]}),allTrinketStatProcsActive:fd({label:"All Item Proc Buffs Active",submenu:["Aura Sets"],shortDescription:"<b>True</b> if all item/enchant procs that buff the specified stat type(s) are currently active, otherwise <b>False</b>.",fullDescription:"\n\t\t<p>For stacking proc buffs, this condition also checks that the buff has been stacked to its maximum possible strength.</p>\n\t\t",newValue:()=>Pa.create({statType1:-1,statType2:-1,statType3:-1}),fields:[hd("statType1"),hd("statType2"),hd("statType3"),md]}),anyTrinketStatProcsActive:fd({label:"Any Item Proc Buff Active",submenu:["Aura Sets"],shortDescription:"<b>True</b> if any item/enchant procs that buff the specified stat type(s) are currently active, otherwise <b>False</b>.",fullDescription:"\n\t\t<p>For stacking proc buffs, this condition also checks that the buff has been stacked to its maximum possible strength.</p>\n\t\t",newValue:()=>Ra.create({statType1:-1,statType2:-1,statType3:-1}),fields:[hd("statType1"),hd("statType2"),hd("statType3"),md]}),trinketProcsMinRemainingTime:fd({label:"Item Procs Min Remaining Time",submenu:["Aura Sets"],shortDescription:"Shortest remaining duration on any active item/enchant procs that buff the specified stat type(s), or infinity if none are currently active.",newValue:()=>Da.create({statType1:-1,statType2:-1,statType3:-1}),fields:[hd("statType1"),hd("statType2"),hd("statType3"),md]}),trinketProcsMaxRemainingIcd:fd({label:"Item Procs Max Remaining ICD",submenu:["Aura Sets"],shortDescription:"Longest remaining ICD on any inactive item/enchant procs that buff the specified stat type(s), or 0 if all are currently active.",newValue:()=>Na.create({statType1:-1,statType2:-1,statType3:-1}),fields:[hd("statType1"),hd("statType2"),hd("statType3"),md]}),numEquippedStatProcTrinkets:fd({label:"Num Equipped Stat Proc Effects",submenu:["Aura Sets"],shortDescription:"Number of equipped passive item/enchant effects that buff the specified stat type(s) when they proc.",newValue:()=>Ga.create({statType1:-1,statType2:-1,statType3:-1}),fields:[hd("statType1"),hd("statType2"),hd("statType3"),md]}),numStatBuffCooldowns:fd({label:"Num Stat Buff Cooldowns",submenu:["Aura Sets"],shortDescription:"Number of registered Major Cooldowns that buff the specified stat type(s) when they are cast.",fullDescription:'\n\t\t<p>Both manually casted cooldowns as well as cooldowns controlled by "Cast All Stat Buff Cooldowns" and "Autocast Other Cooldowns" actions are included in the total count returned by this value.</p>\n\t\t',newValue:()=>Ua.create({statType1:-1,statType2:-1,statType3:-1}),fields:[hd("statType1"),hd("statType2"),hd("statType3")]}),dotIsActive:fd({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:Oa.create,fields:[sd("targetUnit","targets"),id("spellId","dot_spells","")]}),dotRemainingTime:fd({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:Aa.create,fields:[sd("targetUnit","targets"),id("spellId","dot_spells","")]}),dotTickFrequency:fd({label:"Dot Tick Frequency",submenu:["DoT"],shortDescription:"The time between each tick.",newValue:La.create,fields:[sd("targetUnit","targets"),id("spellId","dot_spells","")]}),sequenceIsComplete:fd({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:Va.create,fields:[ld("sequenceName")]}),sequenceIsReady:fd({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:Fa.create,fields:[ld("sequenceName")]}),sequenceTimeToReady:fd({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:Ma.create,fields:[ld("sequenceName")]}),totemRemainingTime:fd({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:Wa.create,includeIf:(e,t)=>e.getClass()==se.ClassShaman,fields:[function(e){return{field:e,newValue:()=>Qa.Water,factory:(e,t,a)=>new Xe(e,t,{id:He(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Qa.Earth,label:"Earth"},{value:Qa.Air,label:"Air"},{value:Qa.Fire,label:"Fire"},{value:Qa.Water,label:"Water"}]})}}("totemType")]}),shamanCanSnapshotStrongerFireElemental:fd({label:"Can snapshot stronger Fire Elemental",submenu:["Shaman"],shortDescription:"Returns true if a new Fire Elemental would be stronger than the current.",newValue:za.create,includeIf:(e,t)=>e.getClass()==se.ClassShaman,fields:[]}),shamanFireElementalDuration:fd({label:"Fire Elemental Total Duration",submenu:["Shaman"],shortDescription:"Returns the duration of Fire Elemental depending on if Totemic Focus is talented or not.",newValue:ja.create,includeIf:(e,t)=>e.getClass()==se.ClassShaman,fields:[]}),catExcessEnergy:fd({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:Ba.create,includeIf:(e,t)=>e.getSpec()==f.SpecFeralDruid,fields:[]}),catNewSavageRoarDuration:fd({label:"New Savage Roar Duration",submenu:["Feral Druid"],shortDescription:"Returns duration of savage roar based on current combo points",newValue:Ha.create,includeIf:(e,t)=>e.getSpec()==f.SpecFeralDruid,fields:[]}),warlockShouldRecastDrainSoul:fd({label:"Should Recast Drain Soul",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.",newValue:qa.create,includeIf:(e,t)=>e.getClass()==se.ClassWarlock,fields:[]}),warlockShouldRefreshCorruption:fd({label:"Should Refresh Corruption",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.",newValue:Ya.create,includeIf:(e,t)=>e.getClass()==se.ClassWarlock,fields:[sd("targetUnit","targets")]}),mageCurrentCombustionDotEstimate:fd({label:"Combustion Dot Value",submenu:["Mage"],shortDescription:"Returns the current estimated size of your Combustion Dot.",newValue:Ka.create,includeIf:(e,t)=>e.getSpec()==f.SpecFireMage,fields:[]})};var yd;class bd extends s{constructor(e,t,a){super(e,"apl-action-picker-root",t,a),this.conditionPicker=new pd(this.rootElem,this.modObject,{label:"If:",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.condition,setValue:(e,t,a)=>{const i=this.getSourceValue();i?(i.condition=a,t.rotationChangeEmitter.emit(e)):this.setSourceValue(e,vi.create({condition:a}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),s=Object.keys(Ed).filter((e=>Ed[e].includeIf?.(t,i)??!0));this.kindPicker=new Xe(this.actionDiv,t,{id:He(),defaultLabel:"Action",values:s.map((e=>{const t=Ed[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}})),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.action.oneofKind,setValue:(e,t,a)=>{const i=this.getSourceValue(),s=i?.action.oneofKind;if(s!=a){if(a){const t=Ed[a];let n=this.makeAPLAction(a,t.newValue());i&&s&&this.actionPicker&&("sequence"==a?"strictSequence"==i.action.oneofKind?n.action.sequence.actions=i.action.strictSequence.actions:n.action.sequence.actions=[this.makeAPLAction(s,this.actionPicker.getInputValue())]:"strictSequence"==a?"sequence"==i.action.oneofKind?n.action.strictSequence.actions=i.action.sequence.actions:n.action.strictSequence.actions=[this.makeAPLAction(s,this.actionPicker.getInputValue())]:"sequence"==i.action.oneofKind&&i.action.sequence.actions?.[0]?.action.oneofKind==a?n=i.action.sequence.actions[0]:"strictSequence"==i.action.oneofKind&&i.action.strictSequence.actions?.[0]?.action.oneofKind==a&&(n=i.action.strictSequence.actions[0])),i?i.action=n.action:this.setSourceValue(e,n)}else i.action={oneofKind:a};t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return vi.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:e,...(()=>{const t={};return e&&this.actionPicker&&(t[e]=this.actionPicker.getInputValue()),t})()}})}setInputValue(e){if(!e)return;this.conditionPicker.setInputValue(e.condition||Xa.create({uuid:{value:He()}}));const t=e.action.oneofKind;this.updateActionPicker(t),t&&this.actionPicker.setInputValue(e.action[t])}makeAPLAction(e,t){if(!e)return vi.create();const a={oneofKind:e};return a[e]=t,vi.create({action:a})}updateActionPicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!e)return;this.kindPicker.setInputValue(e);const a=Ed[e];this.actionPicker=a.factory(this.actionDiv,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[e]||a.newValue(),setValue:(t,a,i)=>{const s=this.getSourceValue();s&&((s?.action)[e]=i),a.rotationChangeEmitter.emit(t)}}),this.actionPicker.rootElem.classList.add("apl-action-"+e)}}function vd(e){return{field:e,newValue:()=>fi.Swap1,factory:(e,t,a)=>new Xe(e,t,{id:He(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:fi.Main,label:"Main"},{value:fi.Swap1,label:"Swapped"}]})}}function Sd(e){return{field:e,newValue:()=>[],factory:(e,t,a)=>new $m(e,t,{...a,setValue:(e,t,i)=>{a.setValue(e,t,i.map((e=>e||vi.create())))},itemLabel:"Action",newItem:vi.create,copyItem:e=>e?vi.clone(e):e,newItemPicker:(e,a,i,s)=>new bd(e,t,s),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function Id(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,includeIf:e.includeIf,newValue:e.newValue,factory:dd(e.newValue,e.fields)}}const Ed={castSpell:Id({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:ei.create,fields:[id("spellId","castable_spells",""),sd("target","targets")]}),castFriendlySpell:Id({label:"Cast at Player",shortDescription:"Casts a friendly spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:ti.create,fields:[id("spellId","friendly_spells",""),sd("target","players")],includeIf:(e,t)=>e.getRaid().size()>1}),multidot:Id({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t,newValue:()=>ai.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[id("spellId","castable_dot_spells",""),od("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),ud("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),strictMultidot:Id({label:"Strict Multi Dot",submenu:["Casting"],shortDescription:"Like a regular <b>Multi Dot</b>, except all Dots are applied immediately after each other. Keeps a DoT active on multiple targets by casting the specified spell. Will take Cast Time/GCD into account when refreshing subsequent DoTs.",includeIf:(e,t)=>!t,newValue:()=>ii.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[id("spellId","castable_dot_spells",""),od("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),ud("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:Id({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t&&e.getSpec().isHealingSpec,newValue:()=>si.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[id("spellId","shield_spells",""),od("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),ud("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:Id({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>ni.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[id("spellId","channel_spells",""),sd("target","targets"),ud("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),nd("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),castAllStatBuffCooldowns:Id({label:"Cast All Stat Buff Cooldowns",submenu:["Casting"],shortDescription:"Casts all cooldowns that buff the specified stat type(s).",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>By default, this action will cast such cooldowns greedily as they become available. However, when embedded in a sequence, the action will only fire when ALL cooldowns matching the specified buff type(s) are ready.</li>\n\t\t\t</ul>\n\t\t",newValue:()=>oi.create({statType1:-1,statType2:-1,statType3:-1}),fields:[hd("statType1"),hd("statType2"),hd("statType3")]}),autocastOtherCooldowns:Id({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(e,t)=>!t,newValue:li.create,fields:[]}),wait:Id({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(e,t)=>!t,newValue:()=>ri.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[ud("duration")]}),waitUntil:Id({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(e,t)=>!t,newValue:()=>ci.create(),fields:[ud("condition")]}),schedule:Id({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(e,t)=>!t,newValue:()=>hi.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[ld("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(e){return{field:e,newValue:()=>Xa.create({uuid:{value:He()}}),factory:(e,t,a)=>new bd(e,t,a)}}("innerAction")]}),sequence:Id({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:mi.create,fields:[ld("name"),Sd("actions")]}),resetSequence:Id({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:di.create,fields:[ld("sequenceName")]}),strictSequence:Id({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:pi.create,fields:[Sd("actions")]}),changeTarget:Id({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>Si.create(),fields:[sd("newTarget","targets")]}),activateAura:Id({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(e,t)=>t,newValue:()=>Ii.create(),fields:[id("auraId","auras")]}),activateAuraWithStacks:Id({label:"Activate Aura With Stacks",submenu:["Misc"],shortDescription:"Activates an aura with the specified number of stacks",includeIf:(e,t)=>t,newValue:()=>ui.create({numStacks:1}),fields:[id("auraId","stackable_auras"),od("numStacks",!1,{label:"stacks",labelTooltip:"Desired number of initial aura stacks."})]}),activateAllStatBuffProcAuras:Id({label:"Activate All Stat Buff Proc Auras",submenu:["Misc"],shortDescription:"Activates all item/enchant proc auras that buff the specified stat type(s) using the specified item set.",includeIf:(e,t)=>t,newValue:()=>gi.create({swapSet:fi.Main,statType1:-1,statType2:-1,statType3:-1}),fields:[vd("swapSet"),hd("statType1"),hd("statType2"),hd("statType3")]}),cancelAura:Id({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>Ei.create(),fields:[id("auraId","auras")]}),triggerIcd:Id({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(e,t)=>t,newValue:()=>ki.create(),fields:[id("auraId","icd_auras")]}),itemSwap:Id({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(e,t)=>bu.includes(e.getSpec()),newValue:()=>Ci.create(),fields:[vd("swapSet")]}),move:Id({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>wi.create(),fields:[ud("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),moveDuration:Id({label:"Move duration",submenu:["Misc"],shortDescription:"The characters moves for the given duration.",newValue:()=>yi.create(),fields:[ud("duration",{label:"Duration",labelTooltip:"Amount of time the character should move."})]}),customRotation:Id({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(e,t)=>!1,newValue:()=>_i.create(),fields:[]}),catOptimalRotationAction:Id({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded algorithm.",includeIf:(e,t)=>e.getSpec()==f.SpecFeralDruid,newValue:()=>bi.create({rotationType:tt.SingleTarget,maintainFaerieFire:!0,manualParams:!0,minRoarOffset:31,ripLeeway:1,useRake:!0,useBite:!0,biteTime:11,berserkBiteTime:6,biteDuringExecute:!0,allowAoeBerserk:!1,meleeWeave:!0,bearWeave:!0,snekWeave:!0,cancelPrimalMadness:!1}),fields:[function(e){const t=[{value:tt.SingleTarget,label:"Single Target"},{value:tt.Aoe,label:"AOE"}];return{field:e,label:"Type",newValue:()=>tt.SingleTarget,factory:(e,a,i)=>new Xe(e,a,{id:He(),...i,defaultLabel:"Single Target",equals:(e,t)=>e==t,values:t})}}("rotationType"),nd("maintainFaerieFire","Maintain Faerie Fire",{labelTooltip:"Maintain Faerie Fire debuff. Overwrites any external Sunder effects specified in settings."}),nd("meleeWeave","Enable leave-weaving",{labelTooltip:"Weave out of melee range for Stampede procs. Ignored for AoE rotation or if Stampede is not talented."}),nd("bearWeave","Enable bear-weaving",{labelTooltip:"Weave into Bear Form while pooling Energy. Ignored for AoE rotation."}),nd("snekWeave","Use Albino Snake",{labelTooltip:"Reset swing timer at the end of bear-weaves using Albino Snake pet. Ignored if not bear-weaving."}),nd("allowAoeBerserk","Allow AoE Berserk",{labelTooltip:"Allow Berserk usage in AoE rotation. Ignored for single target rotation."}),nd("manualParams","Manual Advanced Parameters",{labelTooltip:"Manually specify advanced parameters, otherwise will use preset defaults."}),od("minRoarOffset",!0,{label:"Roar Offset",labelTooltip:"Targeted offset in Rip/Roar timings. Ignored for AOE rotation or if not using manual advanced parameters."}),od("ripLeeway",!1,{label:"Rip Leeway",labelTooltip:"Rip leeway when optimizing Roar clips. Ignored for AOE rotation or if not using manual advanced parameters."}),nd("useRake","Use Rake",{labelTooltip:"Use Rake during rotation. Ignored for AOE rotation or if not using manual advanced parameters."}),nd("useBite","Bite during rotation",{labelTooltip:"Use Bite during rotation rather than exclusively at end of fight. Ignored for AOE rotation or if not using manual advanced parameters."}),od("biteTime",!0,{label:"Bite Time",labelTooltip:"Min seconds remaining on Rip/Roar to allow a Bite. Ignored if not Biting during rotation."}),od("berserkBiteTime",!0,{label:"Bite Time during Berserk",labelTooltip:"More aggressive threshold when Berserk is active."}),nd("biteDuringExecute","Bite during Execute phase",{labelTooltip:"Bite aggressively during Execute phase. Ignored if Blood in the Water is not talented, or if not using manual advanced parameters."}),nd("cancelPrimalMadness","Enable Primal Madness cancellation",{labelTooltip:"Click off Primal Madness buff when doing so will result in net Energy gains. Ignored if Primal Madness is not talented, or if not using manual advanced parameters."})]})};class kd extends e{constructor(e,t,a){super(e,"apl-rotation-picker-root"),new $m(this.rootElem,a,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.prepullActions,setValue:(e,t,a)=>{t.aplRotation.prepullActions=a,t.rotationChangeEmitter.emit(e)},newItem:()=>xi.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:e=>xi.clone(e),newItemPicker:(e,t,i,s)=>new Cd(e,a,s,i),inlineMenuBar:!0}),new $m(this.rootElem,a,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.priorityList,setValue:(e,t,a)=>{t.aplRotation.priorityList=a,t.rotationChangeEmitter.emit(e)},newItem:()=>Ti.create({action:{}}),copyItem:e=>Ti.clone(e),newItemPicker:(e,t,i,s)=>new _d(e,a,s,i),inlineMenuBar:!0})}}class Cd extends s{getItem(){return this.getSourceValue()||xi.create({action:{}})}constructor(e,t,a,i){a.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,a),this.player=t;const s=$m.getItemHeaderElem(this);$m.makeListItemValidations(s,t,(e=>e.getCurrentStats().rotationStats?.prepullActions[i]?.validations||[])),this.hidePicker=new xd(s,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,a)=>{this.getItem().hide=a,this.player.rotationChangeEmitter.emit(e)}}),this.doAtPicker=new Jm(this.rootElem,this.player,{id:He(),label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(e,t,a)=>{this.getItem().doAtValue=a?Xa.create({value:{oneofKind:"const",const:{val:a}},uuid:{value:He()}}):void 0,this.player.rotationChangeEmitter.emit(e)},inline:!0}),this.actionPicker=new bd(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,a)=>{this.getItem().action=a,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return xi.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.doAtPicker.setInputValue(e.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(e.action||vi.create()))}}class _d extends s{getItem(){return this.getSourceValue()||Ti.create({action:{}})}constructor(e,t,a,i){a.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,a),this.player=t;const s=$m.getItemHeaderElem(this);$m.makeListItemValidations(s,t,(e=>e.getCurrentStats().rotationStats?.priorityList[i]?.validations||[])),this.hidePicker=new xd(s,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,a)=>{this.getItem().hide=a,this.player.rotationChangeEmitter.emit(e)}}),this.actionPicker=new bd(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,a)=>{this.getItem().action=a,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return Ti.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.actionPicker.setInputValue(e.action||vi.create()))}}class xd extends s{constructor(e,t,a){super(e,"hide-picker-root",t,a),this.inputElem=$m.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.inputElem.addEventListener("click",(()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(o.nextEventID())}),{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.tooltip=Kn(this.inputElem,{content:"Enable/Disable"}),this.addOnDisposeCallback((()=>this.tooltip.destroy())),this.init()}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(e){e?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent("Enable Action")):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent("Disable Action"))}}class Td extends s{constructor(e,t,a){super(e,"number-list-picker-root",t,a),this.inputElem=document.createElement("input"),this.inputElem.id=a.id,this.inputElem.type="text",this.inputElem.placeholder=a.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(o.nextEventID())}),{signal:this.signal})}getInputElem(){return this.inputElem}getInputValue(){const e=this.inputElem.value;return e?e.split(",").map(parseFloat).filter((e=>!isNaN(e))):[]}setInputValue(e){Ae(this.getInputValue(),e)||(this.inputElem.value=e.map((e=>String(e))).join(","))}}class Pd extends e{constructor(e,t){super(e,"cooldowns-picker-root"),this.player=t,this.cooldownPickers=[];const a=o.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on((()=>{Ye(this.rootElem)?this.update():this.dispose()}));this.addOnDisposeCallback((()=>{this.rootElem.remove(),this.cooldownPickers.forEach((e=>e.remove())),a.dispose()})),this.update()}update(){this.rootElem.innerHTML="";const e=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let t=0;t<e.length+1;t++){const a=e[t],i=document.createElement("div");i.classList.add("cooldown-picker"),t==e.length&&i.classList.add("add-cooldown-picker"),this.rootElem.appendChild(i),this.makeActionPicker(i,t);const s=document.createElement("label");s.classList.add("cooldown-picker-label","form-label"),a&&a.id&&d.fromProto(a.id).fill(this.player.getRaidIndex()).then((e=>s.textContent=e.name)),i.appendChild(s),this.makeTimingsPicker(i,t);const n=document.createElement("fragment");n.innerHTML='\n\t\t\t\t<button class="delete-cooldown link-danger">\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</button>\n\t\t\t';const l=n.children[0],r=Kn(l,{content:"Delete Cooldown"});l.addEventListener("click",(()=>{const e=this.player.getSimpleCooldowns();e.cooldowns.splice(t,1),this.player.setSimpleCooldowns(o.nextEventID(),e),r.hide()})),i.appendChild(l),this.cooldownPickers.push(i)}}makeActionPicker(e,t){const a=this.player.getMetadata().getSpells().filter((e=>e.data.isMajorCooldown)).map((e=>e.id)).filter((e=>{const t=0!==e.spellId?e.spellId:e.itemId;return!this.player.hiddenMCDs.includes(t)}));this.rootElem.closest(".cooldown-settings")?.classList[a.length?"remove":"add"]("hide");return new Vm(e,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:$e.create()}].concat(a.map((e=>({actionId:e,value:e.toProto()})))),equals:(e,t)=>$e.equals(e,t),zeroValue:$e.create(),backupIconUrl:e=>d.fromProto(e),changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.id||$e.create(),setValue:(e,a,i)=>{if(!i.rawId.oneofKind)return;const s=a.getSimpleCooldowns();for(;s.cooldowns.length<t;)s.cooldowns.push(Pi.create());s.cooldowns[t]=Pi.create({id:i,timings:[]}),a.setSimpleCooldowns(e,s)}})}makeTimingsPicker(e,t){return new Td(e,this.player,{id:`cooldown-timings-${t}`,extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.timings||[],setValue:(e,a,i)=>{const s=a.getSimpleCooldowns();s.cooldowns[t].timings=i,a.setSimpleCooldowns(e,s)},enableWhen:e=>{const a=e.getSimpleCooldowns().cooldowns[t];return a&&!$e.equals(a.id,$e.create())}})}}class Rd extends ho{constructor(e,a){super(e,a,{identifier:"rotation-tab",title:"Rotation"}),this.leftCol=this.buildColumn(1,"rotation-tab-col"),this.simUI=a,this.leftPanel=t("div",{className:"rotation-tab-left tab-panel-left"}),this.rightPanel=t("div",{className:"rotation-tab-right tab-panel-right"}),this.leftPanel.appendChild(this.leftCol),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on((()=>this.updateSections()))}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildPresetConfigurationPicker(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto","rotation-type-simple","rotation-type-apl","rotation-type-legacy");let e="";switch(this.simUI.player.getRotationType()){case Fe.TypeAuto:e="rotation-type-auto";break;case Fe.TypeSimple:e="rotation-type-simple";break;case Fe.TypeAPL:e="rotation-type-apl"}this.rootElem.classList.add(e)}buildHeader(){const e=a(),i=a(),s=a();this.leftCol.appendChild(t("div",{ref:e,className:"rotation-tab-header d-flex justify-content-between align-items-baseline"},t("div",{ref:s}),t("button",{ref:i,className:"btn btn-sm btn-link btn-reset summary-table-reset-button"},t("i",{className:"fas fa-times me-1"}),"Reset APL"))),i.value.addEventListener("click",(()=>{this.simUI.applyEmptyAplRotation(o.nextEventID())})),this.simUI.player.rotationChangeEmitter.on((()=>{const e=this.simUI.player.getRotationType();i.value?.classList[e===Fe.TypeAPL?"remove":"add"]("hide")})),new Hm(s.value,this.simUI.player,{extraCssClasses:["w-auto"],id:"rotation-tab-rotation-type",label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:Fe.TypeAuto,name:"Auto"},{value:Fe.TypeSimple,name:"Simple"},{value:Fe.TypeAPL,name:"APL"}]:[{value:Fe.TypeAuto,name:"Auto"},{value:Fe.TypeAPL,name:"APL"}],changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getRotationType(),setValue:(e,t,a)=>{t.aplRotation.type=a,t.rotationChangeEmitter.emit(e)}})}buildAutoContent(){this.leftCol.appendChild(t("div",{className:"rotation-tab-auto"}))}buildAplContent(){const e=a();this.leftCol.appendChild(t("div",{ref:e,className:"rotation-tab-apl"})),new kd(e.value,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const e="rotation-tab-simple",t=new po(this.leftCol,"rotation-settings",{header:{title:"Rotation"}});t.rootElem.classList.add(e);const a=s.newGroupContainer();a.classList.add("rotation-icon-group","icon-group"),t.bodyElement.appendChild(a),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(a,this.simUI.individualConfig.rotationIconInputs.map((e=>Mm(a,this.simUI.player,e))),!0),this.configureInputSection(t.bodyElement,this.simUI.individualConfig.rotationInputs);const i=new po(this.leftCol,"cooldown-settings",{header:{title:"Cooldowns",tooltip:Ri}});i.rootElem.classList.add(e),new Pd(i.bodyElement,this.simUI.player)}configureInputSection(e,t){t.inputs.forEach((t=>{t.extraCssClasses=[...t.extraCssClasses||[],"input-inline"],"number"==t.type?new so(e,this.simUI.player,{...t,inline:!0}):"boolean"==t.type?new Te(e,this.simUI.player,{...t,inline:!0}):"enum"==t.type&&new Hm(e,this.simUI.player,{...t,inline:!0})}))}configureIconSection(e,t,a){t.length?a&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`)):e.classList.add("hide")}buildPresetConfigurationPicker(){new pm(this.rightPanel,this.simUI,["rotation"])}buildSavedDataPickers(){const e=new mm(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:e=>Di.create({rotation:Me.clone(e.aplRotation)}),setData:(e,t,a)=>{o.freezeAllAndDo((()=>{t.setAplRotation(e,a.rotation||Me.create())}))},changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter],equals:(e,t)=>Di.equals(e,t),toJson:e=>Di.toJson(e),fromJson:e=>Di.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach((t=>{const a=t.rotation;a.rotation||(a.rotation=Me.create()),e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:a,enableWhen:t.enableWhen,onLoad:t.onLoad})}))}))}}class Dd{constructor(e){this.duration=300,this.durationVariation=60,this.executeProportion20=.2,this.executeProportion25=.25,this.executeProportion35=.35,this.executeProportion90=.9,this.useHealth=!1,this.targetsChangeEmitter=new o,this.durationChangeEmitter=new o,this.executeProportionChangeEmitter=new o,this.changeEmitter=new o,this.sim=e,this.targets=[Dd.defaultTargetProto()],this.targetsMetadata=new Gu,[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach((e=>e.on((e=>this.changeEmitter.emit(e)))))}get primaryTarget(){return this.targets[0]}getDurationVariation(){return this.durationVariation}setDurationVariation(e,t){t!=this.durationVariation&&(this.durationVariation=t,this.durationChangeEmitter.emit(e))}getDuration(){return this.duration}setDuration(e,t){t!=this.duration&&(this.duration=t,this.durationChangeEmitter.emit(e))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(e,t){t!=this.executeProportion20&&(this.executeProportion20=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(e,t){t!=this.executeProportion25&&(this.executeProportion25=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(e,t){t!=this.executeProportion35&&(this.executeProportion35=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion90(){return this.executeProportion90}setExecuteProportion90(e,t){t!=this.executeProportion90&&(this.executeProportion90=t,this.executeProportionChangeEmitter.emit(e))}getUseHealth(){return this.useHealth}setUseHealth(e,t){t!=this.useHealth&&(this.useHealth=t,this.durationChangeEmitter.emit(e),this.executeProportionChangeEmitter.emit(e))}matchesPreset(e){return e.targets.length==this.targets.length&&this.targets.every(((t,a)=>Ni.equals(t,e.targets[a].target)))}applyPreset(e,t){this.targets=t.targets.map((e=>e.target||Ni.create())),this.targetsChangeEmitter.emit(e)}applyPresetTarget(e,t,a){this.targets[a]=t.target||Ni.create(),this.targetsChangeEmitter.emit(e)}toProto(){return We.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,executeProportion90:this.executeProportion90,useHealth:this.useHealth,targets:this.targets,apiVersion:Gi})}fromProto(e,t){Dd.updateProtoVersion(t),o.freezeAllAndDo((()=>{this.setDuration(e,t.duration),this.setDurationVariation(e,t.durationVariation),this.setExecuteProportion20(e,t.executeProportion20),this.setExecuteProportion25(e,t.executeProportion25),this.setExecuteProportion35(e,t.executeProportion35),this.setExecuteProportion90(e,t.executeProportion90),this.setUseHealth(e,t.useHealth),this.targets=t.targets,this.targetsChangeEmitter.emit(e)}))}applyDefaults(e){this.fromProto(e,We.create({duration:300,durationVariation:60,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,executeProportion90:.9,targets:[Dd.defaultTargetProto()],apiVersion:Gi}))}static defaultTargetProto(){return Ni.create({id:31146,name:"Raid Target",level:Ui,mobType:Oi.MobTypeMechanical,stats:h.fromMap({[l.StatArmor]:24835,[l.StatAttackPower]:650,[l.StatHealth]:120016403}).asProtoArray(),minBaseDamage:55e4,damageSpread:.4,tankIndex:0,swingSpeed:2,suppressDodge:!1,parryHaste:!1,dualWield:!1,dualWieldPenalty:!1,spellSchool:Ai.SpellSchoolPhysical,targetInputs:new Array(0)})}static updateProtoVersion(e){e.apiVersion}}class Nd extends e{constructor(e,t,a,i){super(e,"encounter-picker-root"),Ad(this.rootElem,t,a.showExecuteProportion),t.sim.waitForInit().then((()=>{const e=t.sim.db.getAllPresetTargets(),a=t.sim.db.getAllPresetEncounters();if(new Hm(this.rootElem,t,{id:"encounter-preset-encouter",label:"Encounter",extraCssClasses:["damage-metrics","npc-picker"],values:[{name:"Custom",value:-1}].concat(a.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:e=>a.findIndex((t=>e.matchesPreset(t))),setValue:(e,t,i)=>{-1!=i&&t.applyPreset(e,a[i])}}),i.isIndividualSim()&&i.player.canEnableTargetDummies()){const e=i.player;new so(this.rootElem,i.sim.raid,{id:"encounter-num-allies",label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:t=>o.onAny([t.targetDummiesChangeEmitter,e.itemSwapSettings.changeEmitter]),getValue:e=>e.getTargetDummies(),setValue:(e,t,a)=>{t.setTargetDummies(e,a)},showWhen:t=>{const a=e.shouldEnableTargetDummies();return a||t.setTargetDummies(o.nextEventID(),0),a}})}i.isIndividualSim()&&i.player.getPlayerSpec().isTankSpec&&new so(this.rootElem,t,{id:"encounter-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:e=>e.changeEmitter,getValue:e=>e.primaryTarget.minBaseDamage,setValue:(e,t,a)=>{t.primaryTarget.minBaseDamage=a,t.targetsChangeEmitter.emit(e)}});const s=e.findIndex((e=>t.primaryTarget.id==e.target?.id)),n=e[s]?.target?.targetInputs||[];(n.length!=t.primaryTarget.targetInputs.length||t.primaryTarget.targetInputs.some(((e,t)=>e.label!=n[t].label)))&&(t.primaryTarget.targetInputs=n,t.targetsChangeEmitter.emit(o.nextEventID())),Ld(this.rootElem,t,0);const l=new Gd(i.rootElem,i,t),r=document.createElement("button");r.classList.add("advanced-button","btn","btn-primary"),r.textContent="Advanced",r.addEventListener("click",(()=>l.open())),this.rootElem.appendChild(r)}))}}class Gd extends to{constructor(e,t,a){super(e,"advanced-encounter-picker-modal",{disposeOnClose:!1}),this.encounter=a,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const i=this.rootElem.getElementsByClassName("encounter-header")[0],s=this.rootElem.getElementsByClassName("encounter-targets")[0];Ad(i,this.encounter,!0),t.isIndividualSim()||new Te(i,a,{id:"aem-use-health",label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",inline:!0,changedEvent:e=>e.changeEmitter,getValue:e=>e.getUseHealth(),setValue:(e,t,a)=>{t.setUseHealth(e,a)}}),new $m(s,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets,setValue:(e,t,a)=>{t.targets=a,t.targetsChangeEmitter.emit(e)},newItem:()=>Dd.defaultTargetProto(),copyItem:e=>Ni.clone(e),newItemPicker:(e,t,i,s)=>new Ud(e,a,i,s),minimumItems:1})}addHeader(){const e=this.encounter.sim.db.getAllPresetEncounters();new Hm(this.header,this.encounter,{id:"aem-encounter-picker",label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2","order-first"],values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>t.matchesPreset(e))),setValue:(t,a,i)=>{-1!=i&&a.applyPreset(t,e[i])}})}}class Ud extends s{getTarget(){return this.encounter.targets[this.targetIndex]||Ni.create()}constructor(e,t,a,i){super(e,"target-picker-root",t,i),this.encounter=t,this.targetIndex=a,this.rootElem.innerHTML='\n\t\t\t<div class="picker-group target-picker-section target-picker-section1"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section2"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const s=this.rootElem.querySelector(".target-picker-section1"),n=this.rootElem.querySelector(".target-picker-section2"),o=this.rootElem.querySelector(".target-picker-section3"),l=t.sim.db.getAllPresetTargets();new Hm(s,null,{id:"target-picker-npc",extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(l.map(((e,t)=>({name:e.path,value:t})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>l.findIndex((e=>function(e,t){if(!!e!=!!t)return!1;if(!e)return!0;const a=Ni.clone(t);return a.targetInputs=e.targetInputs,Ni.equals(e,a)}(this.getTarget(),e.target))),setValue:(e,a,i)=>{-1!=i&&(t.applyPresetTarget(e,l[i],this.targetIndex),t.targetsChangeEmitter.emit(e))}}),this.aiPicker=new Hm(s,null,{id:"target-picker-ai",extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(l.map((e=>({name:e.path,value:e.target.id})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(e,a,i)=>{const s=this.getTarget();s.id=i,s.targetInputs=(l.find((e=>s.id==e.target?.id))?.target?.targetInputs||[]).map((e=>Li.clone(e))),t.targetsChangeEmitter.emit(e)}}),this.levelPicker=new Hm(s,null,{id:"target-picker-level",label:"Level",values:[{name:"85",value:85},{name:"93",value:93},{name:"92",value:92},{name:"91",value:91},{name:"90",value:90}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(e,a,i)=>{this.getTarget().level=i,t.targetsChangeEmitter.emit(e)}}),this.mobTypePicker=new Hm(s,null,{id:"target-picker-mob-type",label:"Mob Type",values:Fd,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(e,a,i)=>{this.getTarget().mobType=i,t.targetsChangeEmitter.emit(e)}}),this.tankIndexPicker=new Hm(s,null,{id:"target-picker-tanked-by",extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(e,a,i)=>{this.getTarget().tankIndex=i,t.targetsChangeEmitter.emit(e)}}),this.targetInputPickers=Ld(s,t,this.targetIndex),this.statPickers=Vd.map((e=>{const a=e.stat;return new so(n,null,{id:`target-${this.targetIndex}-picker-stats-${e.stat}`,inline:!0,extraCssClasses:e.extraCssClasses,label:g(a),labelTooltip:e.tooltip,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().stats[a],setValue:(e,i,s)=>{this.getTarget().stats[a]=s,t.targetsChangeEmitter.emit(e)}})})),this.swingSpeedPicker=new so(o,null,{id:`target-${this.targetIndex}-picker-swing-speed`,label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(e,a,i)=>{this.getTarget().swingSpeed=i,t.targetsChangeEmitter.emit(e)}}),this.minBaseDamagePicker=new so(o,null,{id:`target-${this.targetIndex}-picker-min-base-damage`,label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(e,a,i)=>{this.getTarget().minBaseDamage=i,t.targetsChangeEmitter.emit(e)}}),this.damageSpreadPicker=new so(o,null,{id:`target-${this.targetIndex}-picker-damage-spread`,label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(e,a,i)=>{this.getTarget().damageSpread=i,t.targetsChangeEmitter.emit(e)}}),this.dualWieldPicker=new Te(o,null,{id:`target-${this.targetIndex}-picker-dual-wield`,label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(e,a,i)=>{this.getTarget().dualWield=i,t.targetsChangeEmitter.emit(e)}}),this.dwMissPenaltyPicker=new Te(o,null,{id:`target-${this.targetIndex}-picker-dw-miss-penalty`,label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(e,a,i)=>{this.getTarget().dualWieldPenalty=i,t.targetsChangeEmitter.emit(e)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new Te(o,null,{id:`target-${this.targetIndex}-picker-parry-haste`,label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(e,a,i)=>{this.getTarget().parryHaste=i,t.targetsChangeEmitter.emit(e)}}),this.spellSchoolPicker=new Hm(o,null,{id:`target-${this.targetIndex}-picker-spell-school`,label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:Ai.SpellSchoolPhysical},{name:"Arcane",value:Ai.SpellSchoolArcane},{name:"Fire",value:Ai.SpellSchoolFire},{name:"Frost",value:Ai.SpellSchoolFrost},{name:"Holy",value:Ai.SpellSchoolHoly},{name:"Nature",value:Ai.SpellSchoolNature},{name:"Shadow",value:Ai.SpellSchoolShadow}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(e,a,i)=>{this.getTarget().spellSchool=i,t.targetsChangeEmitter.emit(e)}}),this.init()}getInputElem(){return null}getInputValue(){return Ni.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map((e=>e.getInputValue())).map(((e,t)=>(new h).withStat(Vd[t].stat,e))).reduce(((e,t)=>e.add(t))).asProtoArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(e){e&&(this.aiPicker.setInputValue(e.id),this.levelPicker.setInputValue(e.level),this.mobTypePicker.setInputValue(e.mobType),this.tankIndexPicker.setInputValue(e.tankIndex),this.swingSpeedPicker.setInputValue(e.swingSpeed),this.minBaseDamagePicker.setInputValue(e.minBaseDamage),this.dualWieldPicker.setInputValue(e.dualWield),this.dwMissPenaltyPicker.setInputValue(e.dualWieldPenalty),this.parryHastePicker.setInputValue(e.parryHaste),this.spellSchoolPicker.setInputValue(e.spellSchool),this.damageSpreadPicker.setInputValue(e.damageSpread),Vd.forEach(((t,a)=>this.statPickers[a].setInputValue(e.stats[t.stat]))),this.targetInputPickers.setInputValue(e.targetInputs))}}class Od extends s{getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||Li.create()}clearPickers(){this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.enumPicker&&(this.enumPicker.rootElem.remove(),this.enumPicker=null)}constructor(e,t,a,i,s){super(e,"target-input-picker-root",t,s),this.encounter=t,this.targetIndex=a,this.targetInputIndex=i,this.boolPicker=null,this.numberPicker=null,this.enumPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){return Li.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0,enumValue:this.enumPicker?this.enumPicker.getInputValue():void 0})}setInputValue(e){if(e)if(e.inputType==Vi.Number){if(this.numberPicker&&this.numberPicker.inputConfig.label===e.label)return;this.clearPickers(),this.numberPicker=new so(this.rootElem,null,{id:He(),float:!0,label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(e,t,a)=>{this.getTargetInput().numberValue=a,this.encounter.targetsChangeEmitter.emit(e)}})}else if(e.inputType==Vi.Bool){if(this.boolPicker&&this.boolPicker.inputConfig.label===e.label)return;this.clearPickers(),this.boolPicker=new Te(this.rootElem,null,{id:He(),label:e.label,labelTooltip:e.tooltip,extraCssClasses:["input-inline"],changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(e,t,a)=>{this.getTargetInput().boolValue=a,this.encounter.targetsChangeEmitter.emit(e)}})}else e.inputType==Vi.Enum&&(this.clearPickers(),this.enumPicker=new Hm(this.rootElem,null,{id:He(),label:e.label,values:e.enumOptions.map(((e,t)=>({value:t,name:e}))),changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().enumValue,setValue:(e,t,a)=>{this.getTargetInput().enumValue=a,this.encounter.targetsChangeEmitter.emit(e)}}))}}function Ad(e,t,a){const i=s.newGroupContainer();if(e.appendChild(i),new so(i,t,{id:"encounter-duration",label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDuration(),setValue:(e,t,a)=>{t.setDuration(e,a)},enableWhen:e=>!t.getUseHealth()}),new so(i,t,{id:"encounter-duration-variation",label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDurationVariation(),setValue:(e,t,a)=>{t.setDurationVariation(e,a)},enableWhen:e=>!t.getUseHealth()}),a){const a=s.newGroupContainer();a.classList.add("execute-group"),e.appendChild(a),new so(a,t,{id:"encounter-execute-proportion",label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion20(),setValue:(e,t,a)=>{t.setExecuteProportion20(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new so(a,t,{id:"encounter-execute-proportion-25",label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion25(),setValue:(e,t,a)=>{t.setExecuteProportion25(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new so(a,t,{id:"encounter-execute-proportion-35",label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion35(),setValue:(e,t,a)=>{t.setExecuteProportion35(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new so(a,t,{id:"encounter-execute-proportion-50",label:"Duration spent below high-HP regime (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets are considered out of range for effects like Hunter Careful Aim (<90% HP) or Druid Predatory Strikes (<80% HP).",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion90(),setValue:(e,t,a)=>{t.setExecuteProportion90(e,a/100)},enableWhen:e=>!t.getUseHealth()})}}function Ld(e,t,a){return new $m(e,t,{allowedActions:[],itemLabel:"Target Input",extraCssClasses:["mt-2"],isCompact:!0,changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets[a].targetInputs,setValue:(e,t,i)=>{t.targets[a].targetInputs=i,t.targetsChangeEmitter.emit(e)},newItem:()=>Li.create(),copyItem:e=>Li.clone(e),newItemPicker:(e,i,s,n)=>new Od(e,t,a,s,n)})}const Vd=[{stat:l.StatHealth,tooltip:"",extraCssClasses:[]},{stat:l.StatArmor,tooltip:"",extraCssClasses:[]},{stat:l.StatArcaneResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatFireResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatFrostResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatNatureResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatShadowResistance,tooltip:"",extraCssClasses:[]},{stat:l.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]}],Fd=[{name:"None",value:Oi.MobTypeUnknown},{name:"Beast",value:Oi.MobTypeBeast},{name:"Demon",value:Oi.MobTypeDemon},{name:"Dragonkin",value:Oi.MobTypeDragonkin},{name:"Elemental",value:Oi.MobTypeElemental},{name:"Giant",value:Oi.MobTypeGiant},{name:"Humanoid",value:Oi.MobTypeHumanoid},{name:"Mechanical",value:Oi.MobTypeMechanical},{name:"Undead",value:Oi.MobTypeUndead}];class Md extends e{constructor(e,i,s,n){super(e,"multi-icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.abortController=new AbortController,this.signal=this.abortController.signal,this.config=s,this.currentValue=null;const o=a(),l=a(),c=a();this.rootElem.replaceChildren(t(r,null,t("div",{className:"dropend"},t("a",{ref:o,className:"icon-picker-button",attributes:{role:"button","aria-expanded":!1},dataset:{bsToggle:"dropdown",disableWowheadTouchTtooltip:!0}}),t("ul",{ref:l,className:"dropdown-menu"})),t("label",{ref:c,className:"multi-icon-picker-label form-label"})));const h=c.value;s.label?h.textContent=s.label:h.remove(),this.buttonElem=o.value,this.dropdownMenu=l.value,this.buttonElem.addEventListener("hide.bs.dropdown",(e=>{e.hasOwnProperty("clickEvent")&&e.preventDefault()}),{signal:this.signal}),this.buttonElem.addEventListener("contextmenu",(e=>{e.preventDefault()}),{signal:this.signal}),this.buttonElem.addEventListener("mousedown",(e=>{O(e)&&this.clearPicker()}),{signal:this.signal}),this.buildBlankOption(),this.pickers=s.inputs.map(((e,t)=>{const a=document.createElement("li");return a.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(a),new Fm(a,i,e)})),n.sim.waitForInit().then((()=>this.updateButtonImage()));const m=n.changeEmitter.on((()=>{if(!Ye(this.rootElem)||!Ye(this.dropdownMenu)||!Ye(this.buttonElem))return void this.dispose();this.updateButtonImage();!this.config.showWhen||this.config.showWhen(n.sim.raid.getPlayer(0))?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")}));this.addOnDisposeCallback((()=>m.dispose()))}buildBlankOption(){const e=document.createElement("li");this.dropdownMenu.appendChild(e);const t=document.createElement("a");t.classList.add("icon-dropdown-option","dropdown-option"),e.appendChild(t);t.addEventListener("click",(()=>this.clearPicker()),{signal:this.signal})}clearPicker(){o.freezeAllAndDo((()=>{this.pickers.forEach((e=>{e.setInputValue(null),e.inputChanged(o.nextEventID())})),this.updateButtonImage()}))}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0,{signal:this.signal}):this.currentValue.fillAndSet(this.buttonElem,!1,!0,{signal:this.signal})):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0,{signal:this.signal}):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.map((e=>e.getActionId())).filter((e=>null!=e))[0]||null}}const Wd=fm([Wm({actionId:d.fromSpellId(20217),fieldName:"blessingOfKings"}),Wm({actionId:d.fromSpellId(1126),fieldName:"markOfTheWild"}),Wm({actionId:d.fromSpellId(90363),fieldName:"embraceOfTheShaleSpider"}),Wm({actionId:d.fromSpellId(115921),fieldName:"legacyOfTheEmperor"})],"Stats"),zd=fm([Wm({actionId:d.fromSpellId(19506),fieldName:"trueshotAura"}),Wm({actionId:d.fromSpellId(57330),fieldName:"hornOfWinter"}),Wm({actionId:d.fromSpellId(6673),fieldName:"battleShout"})],"Attack Power"),jd=fm([Wm({actionId:d.fromSpellId(55610),fieldName:"unholyAura"}),Wm({actionId:d.fromSpellId(128433),fieldName:"serpentsSwiftness"}),Wm({actionId:d.fromSpellId(113742),fieldName:"swiftbladesCunning"}),Wm({actionId:d.fromSpellId(30809),fieldName:"unleashedRage"}),Wm({actionId:d.fromSpellId(128432),fieldName:"cacklingHowl"})],"Attack Speed"),Bd=fm([Wm({actionId:d.fromSpellId(1459),fieldName:"arcaneBrilliance"}),Wm({actionId:d.fromSpellId(126309),fieldName:"stillWater"}),Wm({actionId:d.fromSpellId(77747),fieldName:"burningWrath"}),Wm({actionId:d.fromSpellId(109773),fieldName:"darkIntent"})],"Spell Power"),Hd=fm([Wm({actionId:d.fromSpellId(24907),fieldName:"moonkinAura"}),Wm({actionId:d.fromSpellId(49868),fieldName:"mindQuickening"}),Wm({actionId:d.fromSpellId(51470),fieldName:"elementalOath"})],"Spell Haste"),qd=fm([Wm({actionId:d.fromSpellId(17007),fieldName:"leaderOfThePack"}),Wm({actionId:d.fromSpellId(24604),fieldName:"furiousHowl"}),Wm({actionId:d.fromSpellId(90309),fieldName:"terrifyingRoar"}),Wm({actionId:d.fromSpellId(116781),fieldName:"legacyOfTheWhiteTiger"}),Wm({actionId:d.fromSpellId(1459),fieldName:"arcaneBrilliance"}),Wm({actionId:d.fromSpellId(126309),fieldName:"stillWater"})],"Crit %"),Yd=fm([Wm({actionId:d.fromSpellId(19740),fieldName:"blessingOfMight"}),Wm({actionId:d.fromSpellId(93435),fieldName:"roarOfCourage"}),Wm({actionId:d.fromSpellId(128997),fieldName:"spiritBeastBlessing"}),Wm({actionId:d.fromSpellId(116956),fieldName:"graceOfAir"})],"Mastery"),Kd=fm([Wm({actionId:d.fromSpellId(469),fieldName:"commandingShout"}),Wm({actionId:d.fromSpellId(109773),fieldName:"darkIntent"}),Wm({actionId:d.fromSpellId(21562),fieldName:"powerWordFortitude"}),Wm({actionId:d.fromSpellId(90364),fieldName:"qirajiFortitude"})],"Stamina"),$d=fm([Wm({actionId:d.fromSpellId(2825),fieldName:"bloodlust"}),Wm({actionId:d.fromSpellId(32182),fieldName:"heroism"}),Wm({actionId:d.fromSpellId(80353),fieldName:"timeWarp"})],"Major Haste"),Jd=fm([Bm({actionId:d.fromSpellId(6940),numStates:11,fieldName:"handOfSacrificeCount"}),Bm({actionId:d.fromSpellId(33206),numStates:11,fieldName:"painSuppressionCount"}),Bm({actionId:d.fromSpellId(97462),numStates:11,fieldName:"rallyingCryCount"})],"Defensive CDs"),Zd=jm({actionId:d.fromSpellId(16190),numStates:5,fieldName:"manaTideTotemCount"}),Qd=function(e,t,a,i){const s=Gm(e,t,i);return s.states=3,s.improvedId=a,s}({getModObject:e=>e,showWhen:e=>!Xd.faction||Xd.faction==e.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,a)=>t.setBuffs(e,a),changeEmitter:e=>o.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},(Xd={actionId:d.fromItemId(45767),impId:d.fromSpellId(57933),fieldName:"tricksOfTheTrade"}).actionId,Xd.impId,Xd.fieldName);var Xd;const ep=Bm({actionId:d.fromSpellId(49016),numStates:11,fieldName:"unholyFrenzyCount"}),tp=Bm({actionId:d.fromSpellId(64382),numStates:11,fieldName:"shatteringThrowCount"}),ap=jm({actionId:d.fromSpellId(114207),numStates:11,fieldName:"skullBannerCount"}),ip=jm({actionId:d.fromSpellId(120668),numStates:11,fieldName:"stormlashTotemCount"}),sp=zm({actionId:d.fromSpellId(113746),fieldName:"weakenedArmor"}),np=zm({actionId:d.fromSpellId(115798),fieldName:"weakenedBlows"}),op=fm([zm({actionId:d.fromSpellId(73975),fieldName:"necroticStrike"}),zm({actionId:d.fromSpellId(58604),fieldName:"lavaBreath"}),zm({actionId:d.fromSpellId(50274),fieldName:"sporeCloud"}),zm({actionId:d.fromSpellId(5761),fieldName:"mindNumbingPoison"}),zm({actionId:d.fromSpellId(31589),fieldName:"slow"}),zm({actionId:d.fromSpellId(109466),fieldName:"curseOfEnfeeblement"})],"Cast Speed"),lp=zm({actionId:d.fromSpellId(81326),fieldName:"physicalVulnerability"}),rp=fm([zm({actionId:d.fromSpellId(24844),fieldName:"lightningBreath"}),zm({actionId:d.fromSpellId(1490),fieldName:"curseOfElements"}),zm({actionId:d.fromSpellId(58410),fieldName:"masterPoisoner"}),zm({actionId:d.fromSpellId(34889),fieldName:"fireBreath"})],"Spell Dmg"),cp=[{config:Wd,picker:Md,stats:[l.StatStrength,l.StatAgility,l.StatIntellect]},{config:zd,picker:Md,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:jd,picker:Md,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:Bd,picker:Md,stats:[l.StatSpellPower]},{config:Hd,picker:Md,stats:[l.StatSpellPower]},{config:qd,picker:Md,stats:[l.StatCritRating]},{config:Yd,picker:Md,stats:[l.StatMasteryRating]},{config:Kd,picker:Md,stats:[l.StatStamina]},{config:$d,picker:Md,stats:[l.StatHasteRating]},{config:Jd,picker:Md,stats:[l.StatStamina]}],hp=[{config:ap,picker:Fm,stats:[l.StatAttackPower,l.StatRangedAttackPower,l.StatSpellPower]},{config:ip,picker:Fm,stats:[l.StatAttackPower,l.StatRangedAttackPower,l.StatSpellPower]},{config:Zd,picker:Fm,stats:[l.StatSpirit]},{config:Qd,picker:Fm,stats:[l.StatAttackPower,l.StatRangedAttackPower,l.StatSpellPower]},{config:ep,picker:Fm,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:tp,picker:Fm,stats:[l.StatAttackPower,l.StatRangedAttackPower]}],mp=[{config:sp,picker:Fm,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:lp,picker:Fm,stats:[l.StatAttackPower,l.StatRangedAttackPower]},{config:rp,picker:Md,stats:[l.StatAttackPower,l.StatRangedAttackPower,l.StatSpellPower]},{config:np,picker:Md,stats:[l.StatArmor]},{config:op,picker:Fm,stats:[l.StatArmor]}],dp=[];function pp(e,t){return e.filter((e=>0==e.stats.length||e.stats.some((e=>t.individualConfig.epStats.includes(e)))||t.individualConfig.includeBuffDebuffInputs.includes(e.config))).filter((e=>!t.individualConfig.excludeBuffDebuffInputs.includes(e.config)))}function up(e){return(t,a)=>{const i=t.map((e=>({actionId:e.config.actionId,value:e.config.value,showWhen:t=>(!e.config.showWhen||e.config.showWhen(t))&&(e.config.faction||t.getFaction())==t.getFaction()})));return{type:"iconEnum",tooltip:a,numColumns:t.length>5?2:1,values:[{value:0,iconUrl:"",tooltip:"None"}].concat(i),equals:(e,t)=>e==t,zeroValue:0,changedEvent:e=>o.onAny([e.consumesChangeEmitter,e.gearChangeEmitter,e.professionChangeEmitter]),showWhen:t=>(!e.showWhen||e.showWhen(t))&&i.some((e=>e.showWhen?.(t))),getValue:t=>t.getConsumes()[e.consumesFieldName],setValue:(t,a,i)=>{const s=a.getConsumes();s[e.consumesFieldName]!==i&&(s[e.consumesFieldName]=i,o.freezeAllAndDo((()=>{a.setConsumes(t,s),e.onSet&&e.onSet(t,a,i)})))}}}}const gp={actionId:d.fromItemId(12662),value:12662},fp={actionId:d.fromItemId(5512),value:5512},wp=[{config:{actionId:d.fromItemId(7676),value:7676,showWhen:e=>e.getClass()==se.ClassRogue},stats:[]},{config:fp,stats:[l.StatStamina]},{config:gp,stats:[l.StatIntellect]}],yp=up({consumesFieldName:"conjuredId"}),bp=[{config:{actionId:d.fromItemId(63396),value:89637,showWhen:e=>e.hasProfession(he.Engineering)},stats:[]},{config:{actionId:d.fromItemId(60223),value:82207,showWhen:e=>e.hasProfession(he.Engineering)},stats:[]}],vp=up({consumesFieldName:"explosiveId"}),Sp=[{config:{actionId:d.fromSpellId(82174),value:82174},stats:[]},{config:{actionId:d.fromSpellId(82176),value:82176},stats:[]},{config:{actionId:d.fromSpellId(82179),value:82179},stats:[]},{config:{actionId:d.fromSpellId(82184),value:82184},stats:[]},{config:{actionId:d.fromSpellId(82186),value:82186},stats:[]}],Ip=up({consumesFieldName:"tinkerId",showWhen:e=>e.hasProfession(he.Engineering)});function Ep(e,t,a){const i=e.map((e=>({value:e.id,iconUrl:e.icon,actionId:d.fromItemId(e.id),tooltip:e.name})));return{type:"iconEnum",tooltip:a,numColumns:e.length>5?2:1,values:[{value:0,iconUrl:"",tooltip:"None"}].concat(i),equals:(e,t)=>e===t,zeroValue:0,changedEvent:e=>e.consumesChangeEmitter,getValue:e=>e.getConsumes()[t.consumesFieldName],showWhen:e=>!!i.length,setValue:(e,a,i)=>{t.setValue&&t.setValue(e,a,i);const s={...a.getConsumes(),[t.consumesFieldName]:i};"flaskId"===t.consumesFieldName&&(s.guardianElixirId=0,s.battleElixirId=0),"battleElixirId"!==t.consumesFieldName&&"guardianElixirId"!==t.consumesFieldName||(s.flaskId=0),a.setConsumes(e,s)}}}class kp extends e{constructor(e,t,a,i){super(e,"consumes-picker-root"),this.settingsTab=t,this.simUI=a,this.db=i}static create(e,t,a){const i=new kp(e,t,a,D.getSync());return i.init(),i}init(){this.buildPotionsPicker(),this.buildElixirsPicker(),this.buildFoodPicker(),this.buildEngPicker(),this.buildPetPicker()}buildPotionsPicker(){const e=a(),i=this.rootElem.appendChild(t(Cp,{label:"Potions"},t("div",{ref:e,className:"picker-group icon-group consumes-row-inputs consumes-potions"}))),s=e.value,n=this.db.getConsumablesByTypeAndStats(Fi.ConsumableTypePotion,this.simUI.individualConfig.epStats),l=Ep(n,{consumesFieldName:"prepotId"},"Prepop Potion"),r=Ep(n,{consumesFieldName:"potId"},"Combat Potion"),c=Mm(s,this.simUI.player,l),h=Mm(s,this.simUI.player,r),m=yp(pp(wp,this.simUI)),d=Mm(s,this.simUI.player,m),p=o.onAny([this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(i,[h,d,c])));this.addOnDisposeCallback((()=>p.dispose())),this.updateRow(i,[h,d,c])}buildElixirsPicker(){const e=a(),i=a(),s=a();this.rootElem.appendChild(t(Cp,{label:"Elixirs"},t("div",{className:"picker-group icon-group consumes-row-inputs"},t("div",{ref:e,className:"consumes-flasks"}),t("span",{className:"elixir-space"},"or"),t("div",{ref:i,className:"consumes-battle-elixirs"}),t("div",{ref:s,className:"consumes-guardian-elixirs"}))));const n=e.value,o=i.value,l=s.value,r=Ep(this.db.getConsumablesByTypeAndStats(Fi.ConsumableTypeFlask,this.simUI.individualConfig.epStats),{consumesFieldName:"flaskId"},"");Mm(n,this.simUI.player,r);const c=Ep(this.db.getConsumablesByTypeAndStats(Fi.ConsumableTypeBattleElixir,this.simUI.individualConfig.epStats),{consumesFieldName:"battleElixirId"},""),h=Ep(this.db.getConsumablesByTypeAndStats(Fi.ConsumableTypeGuardianElixir,this.simUI.individualConfig.epStats),{consumesFieldName:"guardianElixirId"},"");Mm(o,this.simUI.player,c),Mm(l,this.simUI.player,h)}buildFoodPicker(){const e=a();this.rootElem.appendChild(t(Cp,{label:"Food"},t("div",{ref:e,className:"picker-group icon-group consumes-row-inputs consumes-food"})));const i=e.value,s=Ep(this.db.getConsumablesByTypeAndStats(Fi.ConsumableTypeFood,this.simUI.individualConfig.epStats),{consumesFieldName:"foodId"},"");Mm(i,this.simUI.player,s)}buildEngPicker(){const e=a(),i=this.rootElem.appendChild(t(Cp,{label:"Engineering"},t("div",{ref:e,className:"picker-group icon-group consumes-row-inputs consumes-engi"}))),s=e.value,n=Ip(pp(Sp,this.simUI),"Gloves Tinkers"),o=Mm(s,this.simUI.player,n),l=vp(pp(bp,this.simUI),"Explosives"),r=Mm(s,this.simUI.player,l),c=this.simUI.player.professionChangeEmitter.on((()=>this.updateRow(i,[r,o])));this.addOnDisposeCallback((()=>c.dispose())),this.updateRow(i,[r,o])}buildPetPicker(){if(this.simUI.individualConfig.petConsumeInputs?.length){const e=a();this.rootElem.appendChild(t(Cp,{label:"Pet"},t("div",{ref:e,className:"picker-group icon-group consumes-row-inputs consumes-pet"})));const i=e.value;this.simUI.individualConfig.petConsumeInputs.forEach((e=>Mm(i,this.simUI.player,e)))}}updateRow(e,t){e.classList[t.find((e=>e?.showWhen()))?"remove":"add"]("hide")}}const Cp=({label:e,children:a})=>t("div",{className:"consumes-row input-root input-inline"},t("label",{className:"form-label"},e),a);class _p extends ho{constructor(e,t){super(e,t,{identifier:"settings-tab",title:"Settings"}),this.column1=this.buildColumn(1,"settings-left-col"),this.column2=this.buildColumn(2,"settings-left-col"),this.column3=this.buildColumn(3,"settings-left-col"),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.simUI.sim.waitForInit().then((()=>{this.buildTabContent()}))}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.buildDebuffsSettings()),this.simUI.isWithinRaidSim||(this.buildPresetConfigurationPicker(),this.buildSavedDataPickers())}buildEncounterSettings(){const e=new po(this.column1,"encounter-settings",{header:{title:"Encounter"}});new Nd(e.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const e=this.column1,t=new po(e,"player-settings",{header:{title:"Player"}}),a=s.newGroupContainer();a.classList.add("player-icon-group","icon-group"),t.bodyElement.appendChild(a),this.configureIconSection(a,this.simUI.individualConfig.playerIconInputs.map((e=>Mm(a,this.simUI.player,e))),!0);const i=this.simUI.player.getPlayerClass().races;new Hm(t.bodyElement,this.simUI.player,{id:"simui-race",label:"Race",values:i.map((e=>({name:Le.get(e),value:e}))),changedEvent:e=>e.raceChangeEmitter,getValue:e=>e.getRace(),setValue:(e,t,a)=>t.setRace(e,a)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(t.bodyElement,this.simUI.individualConfig.playerInputs);const n=s.newGroupContainer();t.bodyElement.appendChild(n);const o=P(he).filter((e=>e!=he.Archeology));new Hm(n,this.simUI.player,{id:"simui-profession1",label:"Profession 1",values:o.map((e=>({name:Mi.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession1(),setValue:(e,t,a)=>t.setProfession1(e,a)}),new Hm(n,this.simUI.player,{id:"simui-profession2",label:"Profession 2",values:o.map((e=>({name:Mi.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession2(),setValue:(e,t,a)=>t.setProfession2(e,a)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach((e=>{e(this.column2,this.simUI).rootElem.classList.add("custom-section")}))}buildConsumesSection(){const e=this.simUI.isWithinRaidSim?this.column3:this.column2,t=new po(e,"consumes-settings",{header:{title:"Consumables"}});kp.create(t.bodyElement,this,this.simUI)}buildOtherSettings(){const e=this.simUI.individualConfig.otherInputs?.inputs.filter((e=>!e.extraCssClasses?.includes("within-raid-sim-hide")||!0)),t=this.simUI.individualConfig.itemSwapSlots||[];if(e.length>0||t.length>0){const a=new po(this.column2,"other-settings",{header:{title:"Other"}});e.length>0&&(this.configureInputSection(a.bodyElement,this.simUI.individualConfig.otherInputs),a.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}))),t.length>0&&new Du(a.bodyElement,this.simUI,this.simUI.player,{itemSlots:t})}}buildBuffsSettings(){const e=new po(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:Wi}}),t=pp(cp,this.simUI);this.configureIconSection(e.bodyElement,t.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))));const a=pp(hp,this.simUI);a.length>0&&new Md(e.bodyElement,this.simUI.player,{inputs:a.map((e=>e.config)),label:"Misc"},this.simUI)}buildDebuffsSettings(){const e=new po(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:zi}}),t=pp(mp,this.simUI);this.configureIconSection(e.bodyElement,t.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))));const a=pp(dp,this.simUI);a.length&&new Md(e.bodyElement,this.simUI.player,{inputs:a.map((e=>e.config)),label:"Misc"},this.simUI)}buildPresetConfigurationPicker(){new pm(this.rightPanel,this.simUI,["encounter","race"])}buildSavedDataPickers(){const e=new mm(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>ji.create({encounter:e.toProto()}),setData:(e,t,a)=>t.fromProto(e,a.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>ji.equals(e,t),toJson:e=>ji.toJson(e),fromJson:e=>ji.fromJson(e)}),t=new mm(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:()=>this.getCurrentSavedSettings(),setData:(e,t,a)=>{o.freezeAllAndDo((()=>{t.sim.raid.setBuffs(e,a.raidBuffs||Bi.create()),t.sim.raid.setDebuffs(e,a.debuffs||Hi.create());const i=t.player.getParty();i&&i.setBuffs(e,a.partyBuffs||qi.create()),t.player.setBuffs(e,a.playerBuffs||Yi.create()),t.player.setConsumes(e,a.consumables||Ki.create()),t.player.setRace(e,a.race),t.player.setProfessions(e,a.professions),t.player.itemSwapSettings.setItemSwapSettings(e,a.enableItemSwap,t.sim.db.lookupItemSwap(a.itemSwap||$i.create()),h.fromProto(a.itemSwap?.prepullBonusStats)),t.player.setReactionTime(e,a.reactionTimeMs),t.player.setChannelClipDelay(e,a.channelClipDelayMs),t.player.setInFrontOfTarget(e,a.inFrontOfTarget),t.player.setDistanceFromTarget(e,a.distanceFromTarget),t.player.setHealingModel(e,a.healingModel||ze.create()),t.player.setChallengeModeEnabled(e,a.challengeMode)}))},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapSettings.changeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(e,t)=>Ji.equals(e,t),toJson:e=>Ji.toJson(e),fromJson:e=>Ji.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),t.loadUserData(),this.simUI.individualConfig.presets.itemSwaps?.forEach((e=>{this.simUI.player,t.addSavedData({name:e.name,tooltip:e.tooltip,isPreset:!0,data:Ji.create({...this.getCurrentSavedSettings(),enableItemSwap:!0,itemSwap:e.itemSwap})})}))}))}getCurrentSavedSettings(){return Ji.create({raidBuffs:this.simUI.sim.raid.getBuffs(),partyBuffs:this.simUI.player.getParty()?.getBuffs()||qi.create(),playerBuffs:this.simUI.player.getBuffs(),debuffs:this.simUI.sim.raid.getDebuffs(),consumables:this.simUI.player.getConsumes(),race:this.simUI.player.getRace(),professions:this.simUI.player.getProfessions(),enableItemSwap:this.simUI.player.itemSwapSettings.getEnableItemSwap(),itemSwap:this.simUI.player.itemSwapSettings.toProto(),reactionTimeMs:this.simUI.player.getReactionTime(),channelClipDelayMs:this.simUI.player.getChannelClipDelay(),inFrontOfTarget:this.simUI.player.getInFrontOfTarget(),distanceFromTarget:this.simUI.player.getDistanceFromTarget(),healingModel:this.simUI.player.getHealingModel(),challengeMode:this.simUI.player.getChallengeModeEnabled()})}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new so(e,this.simUI.player,t):"boolean"==t.type?new Te(e,this.simUI.player,{...t,reverse:!0}):"enum"==t.type&&new Hm(e,this.simUI.player,t)}))}configureIconSection(e,t,a){0==t.length?e.classList.add("hide"):a&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}}class xp extends ho{constructor(e,a){super(e,a,{identifier:"talents-tab",title:"Talents"}),this.simUI=a,this.leftPanel=t("div",{className:"talents-tab-left tab-panel-left"}),this.rightPanel=t("div",{className:"talents-tab-right tab-panel-right within-raid-sim-hide"}),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildTalentsPicker(this.leftPanel),this.buildPresetConfigurationPicker(),this.buildSavedTalentsPicker()}buildTalentsPicker(e){new el(e,this.simUI.player,{playerClass:this.simUI.player.getClass(),playerSpec:this.simUI.player.getSpec(),tree:_l[this.simUI.player.getClass()],changedEvent:e=>e.talentsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,a)=>{t.setTalentsString(e,a)}})}buildPresetConfigurationPicker(){new pm(this.rightPanel,this.simUI,["talents"])}buildSavedTalentsPicker(){const e=new mm(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:e=>Re.create({talentsString:e.getTalentsString(),glyphs:e.getGlyphs()}),setData:(e,t,a)=>{o.freezeAllAndDo((()=>{t.setTalentsString(e,a.talentsString),t.setGlyphs(e,a.glyphs||me.create())}))},changeEmitters:[this.simUI.player.talentsChangeEmitter,this.simUI.player.glyphsChangeEmitter],equals:(e,t)=>Re.equals(e,t),toJson:e=>Re.toJson(e),fromJson:e=>Re.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.talents.forEach((t=>{t.isPreset=!0,e.addSavedData({name:t.name,isPreset:!0,data:t.data,onLoad:t.onLoad})}))}))}}const Tp={id:"input-delay",type:"number",label:"Input Delay",labelTooltip:"Player input delay, in milliseconds. Specifies the maximum delay on actions that cannot be spell queued, such as spell casts that are waiting on resource gains or waiting for a cooldown to expire. Also used with certain APL values (such as 'Aura Is Active With Reaction Time'). Roughly models the sum of reaction time + server latency.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getReactionTime(),setValue:(e,t,a)=>{t.setReactionTime(e,a)}},Pp={id:"challenge-mode",type:"boolean",label:"Challenge Mode",labelTooltip:"Enables Challenge Mode",changedEvent:e=>e.challengeModeChangeEmitter,getValue:e=>e.getChallengeModeEnabled(),setValue:(e,t,a)=>{t.setChallengeModeEnabled(e,a)}},Rp={id:"channel-clip-delay",type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getChannelClipDelay(),setValue:(e,t,a)=>{t.setChannelClipDelay(e,a)}},Dp={id:"in-front-of-target",type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:e=>e.inFrontOfTargetChangeEmitter,getValue:e=>e.getInFrontOfTarget(),setValue:(e,t,a)=>{t.setInFrontOfTarget(e,a)}},Np={id:"distance-from-target",type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:e=>e.distanceFromTargetChangeEmitter,getValue:e=>e.getDistanceFromTarget(),setValue:(e,t,a)=>{t.setDistanceFromTarget(e,a)}},Gp={id:"tank-assignment",type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:e=>e.getRaid().tanksChangeEmitter,getValue:e=>(e.getRaid()?.getTanks()||[]).findIndex((t=>Je.equals(t,e.makeUnitReference()))),setValue:(e,t,a)=>{const i=[];if(-1!=a){for(let e=0;e<a;e++)i.push(Zi());i.push(t.makeUnitReference())}t.getRaid().setTanks(e,i)}},Up={id:"incoming-hps",type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p>If set to 0, defaults to 25% of the primary target's base DPS.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().hps,setValue:(e,t,a)=>{const i=t.getHealingModel();i.hps=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>Je.equals(t,e.makeUnitReference())))},Op={id:"healing-cadence",type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p>If set to 0, default values for Healing Cadence and Cadence +/- are inferred from boss damage parameters.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceSeconds,setValue:(e,t,a)=>{const i=t.getHealingModel();i.cadenceSeconds=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>Je.equals(t,e.makeUnitReference())))},Ap={id:"healing-cadence-variation",type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p>The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceVariation,setValue:(e,t,a)=>{const i=t.getHealingModel();i.cadenceVariation=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>Je.equals(t,e.makeUnitReference())))},Lp={id:"healing-model-absorb-frac",type:"number",float:!0,label:"Absorb %",labelTooltip:"\n\t\t<p>% of each incoming heal 'tick' to model as an absorb shield rather than as a direct heal.</p>\n\t",changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().absorbFrac,setValue:(e,t,a)=>{const i=t.getHealingModel();i.absorbFrac=a/100,t.setHealingModel(e,i)}},Vp={id:"burst-window",type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().burstWindow,setValue:(e,t,a)=>{const i=t.getHealingModel();i.burstWindow=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>Je.equals(t,e.makeUnitReference())))},Fp={id:"hp-percent-for-defensives",type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:"\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p>If set to 0, this restriction is disabled.</p>\n\t",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>100*e.getSimpleCooldowns().hpPercentForDefensives,setValue:(e,t,a)=>{const i=t.getSimpleCooldowns();i.hpPercentForDefensives=a/100,t.setSimpleCooldowns(e,i)}},Mp=(e,t,a)=>{const i=new mm(e,t.player,{label:"EP Weights",header:{title:"Saved EP weights"},storageKey:t.getSavedEPWeightsStorageKey(),getData:e=>Qi.create({epWeights:e.getEpWeights().toProto()}),setData:(e,t,a)=>{o.freezeAllAndDo((()=>{t.setEpWeights(e,h.fromProto(a.epWeights))}))},changeEmitters:[t.player.epWeightsChangeEmitter],equals:(e,t)=>Qi.equals(e,t),toJson:e=>Qi.toJson(e),fromJson:e=>Qi.fromJson(e),...a});return t.sim.waitForInit().then((()=>{i.loadUserData(),t.individualConfig.presets.epWeights.forEach((({name:e,epWeights:t,enableWhen:a,onLoad:s})=>{i.addSavedData({name:e,isPreset:!0,data:Qi.create({epWeights:t.toProto()}),enableWhen:a,onLoad:s})}))})),i},Wp=e=>{const t={footer:!0,scrollContents:!0};return e.sim.getShowThreatMetrics()?{size:"xl",...t}:t},zp=class e extends to{constructor(e){super(e.rootElem,"ep-weights-menu",{...Wp(e),disposeOnClose:!1}),this.showAllStats=!1,this.header?.insertAdjacentElement("afterbegin",t("h5",{className:"modal-title"},"Calculate Stat Weights")),this.simUI=e,this.statsType="ep",this.epStats=this.simUI.individualConfig.epStats,this.epPseudoStats=this.simUI.individualConfig.epPseudoStats||[],this.epReferenceStat=this.simUI.individualConfig.epReferenceStat;const i=this.buildStatsTable(),s=a(),n=a(),l=a(),c=a(),m=a(),d=a(),p=a(),f=a(),w=a(),y=a(),b=a(),v=e=>void 0!==e?g(e):"??",S=e=>Object.values(this.epStats).find((t=>v(t)===e)),I=t(r,null,this.epStats.map((e=>t("option",null,v(e)))));this.body.appendChild(t("div",{className:"d-flex flex-column flex-lg-row align-items-lg-start gap-3"},t("div",{className:"ep-weights-content order-1 order-lg-0"},t("div",{className:"ep-weights-options row"},t("div",{className:"col col-sm-3"},t("select",{ref:f,className:"ep-type-select form-select"},t("option",{value:"ep"},"EP"),t("option",{value:"weight"},"Weights"))),t("div",{ref:b,className:"show-all-stats-container col col-sm-3"})),t("div",{className:"ep-reference-options row"},t("div",{className:"col col-sm-4 damage-metrics"},t("span",null,"DPS/TPS reference:"),t("select",{ref:m,className:"ref-stat-select form-select damage-metrics"},I.cloneNode(!0))),t("div",{className:"col col-sm-4 healing-metrics"},t("span",null,"Healing reference:"),t("select",{ref:d,className:"ref-stat-select form-select healing-metrics"},I.cloneNode(!0))),t("div",{className:"col col-sm-4 threat-metrics"},t("span",null,"Mitigation reference:"),t("select",{ref:p,className:"ref-stat-select form-select threat-metrics"},I.cloneNode(!0))),t("p",null,"The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.")),t("p",null,"The 'Current EP' column displays the values currently used by the item pickers to sort items.",t("br",null),"Use the ",t("button",{className:"fa fa-copy"})," icon above the EPs to use newly calculated EPs."),t("div",{ref:s,className:"results-ep-table-container modal-scroll-table"},t("table",{ref:l,className:"results-ep-table"},t("thead",null,t("tr",null,t("th",null,"Stat"),i.map((({metric:e,type:a,label:i,metricRef:s})=>{const n="action"===a;return t("th",{className:u(e&&`${e}-metrics`,n?"text-center":`type-${a}`)},t("span",null,i),t("button",{ref:s,className:"col-action"},t("i",{className:u("fas",n?"fa-arrows-rotate":"fa-copy")})))}))),t("tr",{className:"ep-ratios"},t("td",null,"EP Ratio"),i.filter((({type:e})=>"action"!==e)).map((({metric:e,type:a,ratioRef:i})=>t("td",{ref:i,className:u("type-ratio",`${e}-metrics`,`type-${a}`)}))),t("td",{className:"text-center align-middle"},t("button",{ref:w,className:"btn btn-primary compute-ep"},t("i",{className:"fas fa-calculator"}),t("span",{className:"not-tiny"},"Update "),"EP")))),t("tbody",{ref:c})))),t("div",{ref:n,className:"ep-weights-sidebar sticky-lg-top order-0 order-lg-1"}))),this.footer.appendChild(t(r,null,t("button",{ref:y,className:"btn btn-primary calc-weights"},t("i",{className:"fas fa-calculator me-1"}),"Calculate"))),this.container=s.value,this.sidebar=n.value,this.table=l.value,this.tableBody=c.value;const E=t("div",{className:"results-pending-overlay"});this.resultsViewer=new co(E);const k=()=>{"ep"===this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},C=f.value;C.addEventListener("input",(()=>{this.statsType=C.value,k()})),C.value=this.statsType,k();const _=()=>{this.simUI.player.epRefStatChangeEmitter.emit(o.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()},x=m.value;x&&(x.addEventListener("input",(()=>{this.simUI.dpsRefStat=S(x.value),_()})),x.value=v(this.getDpsEpRefStat()));const T=d.value;T&&(T.addEventListener("input",(()=>{this.simUI.healRefStat=S(T.value),_()})),T.value=v(this.getHealEpRefStat()));const P=p.value;P&&(P.addEventListener("input",(()=>{this.simUI.tankRefStat=S(P.value),_()})),P.value=v(this.getTankEpRefStat()));const R=y.value;let D=!1;R?.addEventListener("click",(async()=>{if(D)return;D=!0;try{await this.simUI.sim.signalManager.abortType(xe.All)}catch(s){return void console.error(s)}R.disabled=!0,this.simUI.rootElem.classList.add("blurred"),this.simUI.rootElem.insertAdjacentElement("afterend",E),this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const t=this.simUI.sim.getIterations();let a=!1;this.resultsViewer.addAbortButton((async()=>{if(!a)try{a=!0,await e.sim.signalManager.abortType(xe.StatWeights)}catch(s){console.error("Error on stat weight abort!"),console.error(s)}finally{a=!1,D||(R.disabled=!1)}}));const i=await this.simUI.player.computeStatWeights(o.nextEventID(),this.epStats,this.epPseudoStats,this.epReferenceStat,(e=>{this.setSimProgress(e)}));this.simUI.rootElem.classList.remove("blurred"),E.remove(),this.container.classList.remove("pending"),this.resultsViewer.hideAll(),D=!1,a||(R.disabled=!1),i&&(this.simUI.prevEpIterations=t,this.simUI.prevEpSimResult=this.calculateEp(i),this.updateTable())})),this.addOnHideCallback((()=>{this.simUI.sim.signalManager.abortType(xe.StatWeights).catch(console.error)}));const N=(e,t,a,i,s)=>{const n=e.previousElementSibling;Kn(n,{content:()=>{if(!s)return t;const e=v(s());return`${t} Normalized by ${e}.`}}),Kn(e,{content:a}),e.addEventListener("click",(()=>{this.simUI.player.setEpWeights(o.nextEventID(),h.fromProto(i())),this.updateTable()}))};i.forEach((({metricRef:e,labelTooltip:t,actionTooltip:a,getWeights:i,getEpRefStat:s})=>N(e.value,t,a,i,s))),new Te(b.value,this,{id:"ep-show-all-stats",label:"Show All Stats",inline:!0,changedEvent:()=>new o,getValue:()=>this.showAllStats,setValue:(e,t,a)=>{this.showAllStats=a,this.updateTable()}}),this.updateTable();const G=(e,t)=>{new so(e,this.simUI.player,{id:`ep-ratio-${t}`,float:!0,changedEvent:e=>e.epRatiosChangeEmitter,getValue:()=>this.simUI.player.getEpRatios()[t],setValue:(e,a,i)=>{const s=a.getEpRatios();s[t]=i,a.setEpRatios(e,s)}})};i.filter((({type:e,ratioRef:t})=>"ep"===e&&!!t?.value)).map((({ratioRef:e})=>e.value)).forEach(G),this.simUI.player.epRatiosChangeEmitter.on((e=>this.updateTable()));i.filter((({type:e,ratioRef:t})=>"weight"===e&&!!t?.value)).map((({ratioRef:e})=>e.value)).forEach(G);const U=w.value;Kn(U,{content:"Compute Weighted EP"}),U.addEventListener("click",(()=>{const e=this.getPrevSimResult(),t=this.simUI.player.getEpRatios();if("ep"===this.statsType){const a=h.fromProto(e.dps.epValues).scale(t[0]),i=h.fromProto(e.hps.epValues).scale(t[1]),s=h.fromProto(e.tps.epValues).scale(t[2]),n=h.fromProto(e.dtps.epValues).scale(t[3]),l=h.fromProto(e.tmi.epValues).scale(t[4]),r=h.fromProto(e.pDeath.epValues).scale(t[5]),c=a.add(i).add(s).add(n).add(l).add(r);this.simUI.player.setEpWeights(o.nextEventID(),c)}else{const a=h.fromProto(e.dps.weights).scale(t[0]),i=h.fromProto(e.hps.weights).scale(t[1]),s=h.fromProto(e.tps.weights).scale(t[2]),n=h.fromProto(e.dtps.weights).scale(t[3]),l=h.fromProto(e.tmi.weights).scale(t[4]),r=h.fromProto(e.pDeath.weights).scale(t[5]),c=a.add(i).add(s).add(n).add(l).add(r);this.simUI.player.setEpWeights(o.nextEventID(),c)}this.updateTable()})),this.buildSavedEPWeightsPicker()}setSimProgress(e){this.resultsViewer.setContent(t("div",{className:"results-sim"},t("div",null,e.completedSims," / ",e.totalSims,t("br",null),"simulations complete"),t("div",null,e.completedIterations," / ",e.totalIterations,t("br",null),"iterations complete")))}updateTable(){const a=t(r,null);e.epUnitStats.forEach((e=>{if(!this.showAllStats&&e.isStat()&&!this.epStats.includes(e.getStat())||e.isPseudoStat()&&!this.epPseudoStats.includes(e.getPseudoStat()))return;const t=this.makeTableRow(e);a.appendChild(t)})),this.tableBody.replaceChildren(a)}makeTableRow(e){const i=this.simUI.prevEpSimResult,s=this.simUI.player.getEpRatios(),n=((e,t,a)=>a?(a.dps?.epValues?t[0]*e.getProtoValue(a.dps.epValues):0)+(a.hps?.epValues?t[1]*e.getProtoValue(a.hps.epValues):0)+(a.tps?.epValues?t[2]*e.getProtoValue(a.tps.epValues):0)+(a.dtps?.epValues?t[3]*e.getProtoValue(a.dtps.epValues):0)+(a.tmi?.epValues?t[4]*e.getProtoValue(a.tmi.epValues):0)+(a.pDeath?.epValues?t[5]*e.getProtoValue(a.pDeath.epValues):0):0)(e,s,i),o=a(),l=t("tr",null,t("td",null,e.getFullName(this.simUI.player.getClass())),this.makeTableRowCells(e,i?.dps,"damage-metrics",n,s[0]),this.makeTableRowCells(e,i?.hps,"healing-metrics",n,s[1]),this.makeTableRowCells(e,i?.tps,"threat-metrics",n,s[2]),this.makeTableRowCells(e,i?.dtps,"threat-metrics",n,s[3]),this.makeTableRowCells(e,i?.tmi,"threat-metrics",n,s[4]),this.makeTableRowCells(e,i?.pDeath,"threat-metrics",n,s[5]),t("td",{ref:o,className:"current-ep"})),r=o.value;return new so(r,this.simUI.player,{id:`ep-weight-stat-${e}`,float:!0,changedEvent:e=>e.epWeightsChangeEmitter,getValue:()=>this.simUI.player.getEpWeights().getUnitStat(e),setValue:(t,a,i)=>{const s=a.getEpWeights().withUnitStat(e,i);a.setEpWeights(t,s)}}),l}makeTableRowCells(e,i,s,n,o){let l=null,c=null;const h=0===o,m=a(),d=a();if(i){const t=e.getProtoValue(i.weights),a=e.getProtoValue(i.weightsStdev);l=this.makeTableCellContents(t,a);const s=e.getProtoValue(i.epValues),n=e.getProtoValue(i.epValuesStdev);c=this.makeTableCellContents(s,n)}else l=t("span",{className:"results-avg notapplicable"},"N/A"),c=l.cloneNode(!0);const p=t(r,null,t("td",{ref:m,className:u("stdev-cell","type-weight",i&&h&&"unused-ep",s)},l),t("td",{ref:d,className:u("stdev-cell","type-ep",i&&h&&"unused-ep",s)},c));if(!i||h)return p;const g=n-this.simUI.player.getEpWeights().getUnitStat(e),f=d.value.querySelector(".type-ep .results-avg");return"0.00"===g.toFixed(2)||(g>0?f.classList.add("positive"):g<0&&f.classList.add("negative")),p}makeTableCellContents(e,a){const i=this.simUI.prevEpIterations||1;return t(r,null,t("span",{className:"results-avg"},e.toFixed(2)),t("span",{className:"results-stdev"},"(",t("i",{className:"fas fa-plus-minus fa-xs"}),Xi(a,i).toFixed(2),")"))}calculateEp(t){const a=es.clone(t);return void 0!==this.simUI.dpsRefStat&&(e.normaliseEpValue(this.simUI.dpsRefStat,a.dps),e.normaliseEpValue(this.simUI.dpsRefStat,a.tps)),void 0!==this.simUI.healRefStat&&e.normaliseEpValue(this.simUI.healRefStat,a.hps),void 0!==this.simUI.tankRefStat&&(e.normaliseEpValue(this.simUI.tankRefStat,a.dtps),e.normaliseEpValue(this.simUI.tankRefStat,a.tmi),e.normaliseEpValue(this.simUI.tankRefStat,a.pDeath)),a}static normaliseEpValue(t,a){const i=Ne.fromStat(t),s=i.getProtoValue(a.weights),n=i.getProtoValue(a.weightsStdev);e.epUnitStats.forEach((e=>{const t=e.getProtoValue(a.weights);e.setProtoValue(a.epValues,0===s?0:t/s);const i=e.getProtoValue(a.weightsStdev);e.setProtoValue(a.epValuesStdev,0===n?0:i/n)}))}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:l.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||es.create({dps:{weights:(new h).toProto(),weightsStdev:(new h).toProto(),epValues:(new h).toProto(),epValuesStdev:(new h).toProto()},hps:{weights:(new h).toProto(),weightsStdev:(new h).toProto(),epValues:(new h).toProto(),epValuesStdev:(new h).toProto()},tps:{weights:(new h).toProto(),weightsStdev:(new h).toProto(),epValues:(new h).toProto(),epValuesStdev:(new h).toProto()},dtps:{weights:(new h).toProto(),weightsStdev:(new h).toProto(),epValues:(new h).toProto(),epValuesStdev:(new h).toProto()},tmi:{weights:(new h).toProto(),weightsStdev:(new h).toProto(),epValues:(new h).toProto(),epValuesStdev:(new h).toProto()},pDeath:{weights:(new h).toProto(),weightsStdev:(new h).toProto(),epValues:(new h).toProto(),epValuesStdev:(new h).toProto()}})}buildSavedEPWeightsPicker(){Mp(this.sidebar,this.simUI)}buildStatsTable(){const e="Copy to Current EP",t=()=>({metricRef:a(),ratioRef:a()});return[{metric:"damage",type:"weight",label:"DPS Weight",labelTooltip:"Per-point increase in DPS (Damage Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dps.weights,...t()},{metric:"damage",type:"ep",label:"DPS EP",labelTooltip:"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dps.epValues,getEpRefStat:()=>this.getDpsEpRefStat(),...t()},{metric:"healing",type:"weight",label:"HPS Weight",labelTooltip:"Per-point increase in HPS (Healing Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().hps.weights,...t()},{metric:"healing",type:"ep",label:"HPS EP",labelTooltip:"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().hps.epValues,getEpRefStat:()=>this.getHealEpRefStat(),...t()},{metric:"threat",type:"weight",label:"TPS Weight",labelTooltip:"Per-point increase in TPS (Threat Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tps.weights,...t()},{metric:"threat",type:"ep",label:"TPS EP",labelTooltip:"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tps.epValues,getEpRefStat:()=>this.getDpsEpRefStat(),...t()},{metric:"threat",type:"weight",label:"DTPS Weight",labelTooltip:"Per-point increase in DTPS (Damage Taken Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dtps.weights,...t()},{metric:"threat",type:"ep",label:"DTPS EP",labelTooltip:"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dtps.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...t()},{metric:"threat",type:"weight",label:"TMI Weight",labelTooltip:"Per-point decrease in TMI (Theck-Meloree Index) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tmi.weights,...t()},{metric:"threat",type:"ep",label:"TMI EP",labelTooltip:"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tmi.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...t()},{metric:"threat",type:"weight",label:"Death Weight",labelTooltip:"Per-point decrease in p(death) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().pDeath.weights,...t()},{metric:"threat",type:"ep",label:"Death EP",labelTooltip:"EP (Equivalency Points) for p(death) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().pDeath.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...t()},{type:"action",label:"Current EP",labelTooltip:"Current EP Weights. Used to sort the gear selector menus.",actionTooltip:"Restore Default EP",getWeights:()=>this.simUI.individualConfig.defaults.epWeights.toProto(),...t()}]}};zp.epUnitStats=Ne.getAll().filter((e=>!!e.isStat()||[Ge.PseudoStatMainHandDps,Ge.PseudoStatOffHandDps,Ge.PseudoStatRangedDps,Ge.PseudoStatPhysicalHitPercent,Ge.PseudoStatSpellHitPercent,Ge.PseudoStatPhysicalCritPercent,Ge.PseudoStatSpellCritPercent].includes(e.getPseudoStat())));let jp=zp;var Bp=(e=>(e[e.Unlaunched=0]="Unlaunched",e[e.Alpha=1]="Alpha",e[e.Beta=2]="Beta",e[e.Launched=3]="Launched",e))(Bp||{});const Hp={phase:ts.Phase1,status:0},qp={[f.SpecUnknown]:{phase:ts.Phase1,status:0},[f.SpecBloodDeathKnight]:{phase:ts.Phase1,status:1},[f.SpecFrostDeathKnight]:{phase:ts.Phase1,status:1},[f.SpecUnholyDeathKnight]:{phase:ts.Phase1,status:1},[f.SpecBalanceDruid]:{phase:ts.Phase1,status:1},[f.SpecFeralDruid]:{phase:ts.Phase1,status:3},[f.SpecGuardianDruid]:{phase:ts.Phase1,status:3},[f.SpecRestorationDruid]:{phase:ts.Phase1,status:0},[f.SpecBeastMasteryHunter]:{phase:ts.Phase1,status:3},[f.SpecMarksmanshipHunter]:{phase:ts.Phase1,status:3},[f.SpecSurvivalHunter]:{phase:ts.Phase1,status:1},[f.SpecArcaneMage]:{phase:ts.Phase1,status:1},[f.SpecFireMage]:{phase:ts.Phase1,status:1},[f.SpecFrostMage]:{phase:ts.Phase1,status:0},[f.SpecBrewmasterMonk]:{phase:ts.Phase1,status:0},[f.SpecMistweaverMonk]:{phase:ts.Phase1,status:0},[f.SpecWindwalkerMonk]:{phase:ts.Phase1,status:1},[f.SpecHolyPaladin]:{phase:ts.Phase1,status:0},[f.SpecProtectionPaladin]:{phase:ts.Phase1,status:3},[f.SpecRetributionPaladin]:{phase:ts.Phase1,status:3},[f.SpecDisciplinePriest]:{phase:ts.Phase1,status:0},[f.SpecHolyPriest]:{phase:ts.Phase1,status:0},[f.SpecShadowPriest]:{phase:ts.Phase1,status:1},[f.SpecAssassinationRogue]:{phase:ts.Phase1,status:3},[f.SpecCombatRogue]:{phase:ts.Phase1,status:3},[f.SpecSubtletyRogue]:{phase:ts.Phase1,status:3},[f.SpecElementalShaman]:{phase:ts.Phase1,status:1},[f.SpecEnhancementShaman]:{phase:ts.Phase1,status:1},[f.SpecRestorationShaman]:{phase:ts.Phase1,status:0},[f.SpecAfflictionWarlock]:{phase:ts.Phase1,status:1},[f.SpecDemonologyWarlock]:{phase:ts.Phase1,status:1},[f.SpecDestructionWarlock]:{phase:ts.Phase1,status:1},[f.SpecArmsWarrior]:{phase:ts.Phase1,status:1},[f.SpecFuryWarrior]:{phase:ts.Phase1,status:1},[f.SpecProtectionWarrior]:{phase:ts.Phase1,status:1}};class Yp extends e{constructor(e){super(null),this.toast=null,this.container=e,this.hasSeenNotice||as()||is()||(this.render(),this.toast?.element.addEventListener("hide.bs.toast",(()=>{this.setHasSeenNotice()}),{once:!0}))}get settingsKey(){return`${ss}_notice-local-sim.v1`}get hasSeenNotice(){return window.localStorage.getItem(this.settingsKey)}setHasSeenNotice(){window.localStorage.setItem(this.settingsKey,"true")}render(){this.toast=new mo({additionalClasses:["toast-notice-local-download"],container:this.container,variant:"info",title:"Did you know?",autohide:!1,body:t(r,null,t("p",null,"You can download our local sim to speed up your simulations significantly?"),t("a",{href:Ce,className:"btn btn-outline-light",target:"_blank",onclick:()=>this.setHasSeenNotice()},"Download"))})}}class Kp extends to{constructor(e,i){super(e,"settings-menu",{title:"Options",footer:!0,disposeOnClose:!1}),this.simUI=i;const s=a(),n=a(),l=a(),r=a(),c=a(),h=a(),m=a(),d=a(),p=a(),u=a(),g=t("div",null,t("div",{className:"picker-group"},t("div",{className:"fixed-rng-seed-container"},t("div",{ref:n,className:"fixed-rng-seed"}),t("div",{className:"form-text"},t("span",null,"Last used RNG seed:")," ",t("span",{ref:l,className:"last-used-rng-seed"},"0"))),t("div",{ref:r,className:"language-picker within-raid-sim-hide"})),t("div",{ref:c,className:"show-threat-metrics-picker w-50 pe-2"}),t("div",{ref:h,className:"show-experimental-picker w-50 pe-2"}),t("div",{ref:m,className:"show-quick-swap-picker w-50 pe-2"}),t("div",{ref:d,className:"use-concurrency-container w-50 pe-2"},t("div",{ref:p,className:"use-concurrent-workers-picker"}),t("div",{ref:u,className:"form-text",hidden:!0})));this.body.innerHTML="",this.body.appendChild(g);const f=t("button",{ref:s,className:"restore-defaults-button btn btn-primary"},"Restore Defaults");if(this.footer&&(this.footer.innerHTML="",this.footer.appendChild(f)),s.value&&(Kn(s.value,{content:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),s.value.addEventListener("click",(()=>{this.simUI.applyDefaults(o.nextEventID()),new mo({variant:"success",body:"Restored to default settings."})}))),n.value&&new so(n.value,this.simUI.sim,{id:"simui-fixed-rng-seed",label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:e=>e.fixedRngSeedChangeEmitter,getValue:e=>e.getFixedRngSeed(),setValue:(e,t,a)=>{t.setFixedRngSeed(e,a)}}),l.value&&(l.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on((()=>{l.value&&(l.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()))}))),r.value){const e=Object.keys(ns),t=e.indexOf("en");new Hm(r.value,this.simUI.sim,{id:"simui-language-picker",label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:e.map(((e,t)=>({name:ns[e],value:t}))),changedEvent:e=>e.languageChangeEmitter,getValue:a=>{const i=e.indexOf(a.getLanguage());return-1==i?t:i},setValue:(t,a,i)=>{a.setLanguage(t,e[i]||"en"),os(e[i]||"en")}}).changeEmitter.on((()=>setTimeout((()=>location.reload()),100)))}if(c.value&&new Te(c.value,this.simUI.sim,{id:"simui-show-threat-metrics",label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:e=>e.showThreatMetricsChangeEmitter,getValue:e=>e.getShowThreatMetrics(),setValue:(e,t,a)=>{t.setShowThreatMetrics(e,a)}}),h.value&&new Te(h.value,this.simUI.sim,{id:"simui-show-experimental",label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:e=>e.showExperimentalChangeEmitter,getValue:e=>e.getShowExperimental(),setValue:(e,t,a)=>{t.setShowExperimental(e,a)}}),m.value&&new Te(m.value,this.simUI.sim,{id:"simui-show-quick-swap",label:"Show quick swap interface",labelTooltip:"Allows you to quickly swap between Gems/Enchants through your favorites. (Disabled on touch devices)",inline:!0,changedEvent:e=>e.showQuickSwapChangeEmitter,getValue:e=>e.getShowQuickSwap(),setValue:(e,t,a)=>{t.setShowQuickSwap(e,a)}}),d.value&&p.value){const e=[{value:0,name:"Off"}];for(let t=2;t<=navigator.hardwareConcurrency;t++)e.push({value:t,name:t.toString()});if(new Hm(p.value,this.simUI.sim,{id:"simui-concurrent-workers-picker",label:"Use Multiple CPU Cores",labelTooltip:"Use web workers to spread sim workload over multiple CPU cores.",changedEvent:e=>e.wasmConcurrencyChangeEmitter,getValue:e=>e.getWasmConcurrency(),setValue:(e,t,a)=>t.setWasmConcurrency(e,a),values:e}),u.value&&navigator.userAgent.toLowerCase().includes("firefox")){const e=u.value;e.hidden=!1,e.textContent="Too many workers can cause significant memory usage! If sim doesn't finish due to RAM running out use a lower number."}this.simUI.sim.isWasm().then((e=>{e||(d.value.hidden=!0)}))}}}class $p extends e{static buildDiscordLink(){const e=t("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank",className:"discord-link link-alt",dataset:{tippyContent:"Join us on Discord"}},t("i",{className:"fab fa-discord fa-lg"}));return Kn(e),e}static buildGitHubLink(){const e=t("a",{href:ls,target:"_blank",className:"github-link link-alt",dataset:{tippyContent:"Contribute on GitHub"}},t("i",{className:"fab fa-github fa-lg"}));return Kn(e),e}static buildPatreonLink(){const e=t("a",{href:"https://patreon.com/wowsims",target:"_blank",className:"patreon-link link-alt",dataset:{tippyContent:"Support us on Patreon"}},t("i",{className:"fab fa-patreon fa-lg"})," Patreon");return Kn(e),e}}class Jp extends e{constructor(e,a){super(e,"sim-header"),this.simUI=a,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=t("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver((([e])=>e.target.classList.toggle("stuck",e.intersectionRatio<1)),{threshold:[1]}).observe(this.rootElem)}activateTab(e){this.simTabsContainer.getElementsByClassName(e)[0].click()}addTab(e,a){const i=0==this.simTabsContainer.children.length;this.simTabsContainer.appendChild(t("li",{className:`${a} nav-item`,attributes:{role:"presentation","aria-controls":a}},t("button",{className:`nav-link ${i&&"active"}`,type:"button",dataset:{bsToggle:"tab",bsTarget:`#${a}`},attributes:{role:"tab","aria-selected":i}},e)))}addSimTabLink(e){const t=0==this.simTabsContainer.children.length;e.navLink.setAttribute("aria-selected",t.toString()),t&&e.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(e.navItem)}addImportLink(e,t,a,i=!1){this.addImportExportLink(".import-dropdown",e,t,a,i)}addExportLink(e,t,a,i=!1){this.addImportExportLink(".export-dropdown",e,t,a,i)}addImportExportLink(e,i,s,n,o){const l=this.rootElem.querySelector(e).querySelector(".dropdown-menu"),r=a();if(l.appendChild(t("li",null,t("button",{ref:r,className:u("dropdown-item",o&&"disabled")},i))),r.value){if(o)return void Kn(r.value,{content:"Currently unsupported"});r.value.addEventListener("click",(()=>s.open()))}}addToolbarLink({parent:e,tooltip:i,classes:s,onclick:n,text:o,...l}){const r=a();return e.appendChild(t(lo,{linkRef:r,buttonClassName:s,...l},o)),n&&r.value.addEventListener("click",n),i&&Kn(r.value,{content:i,placement:"bottom"}),r.value}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"})}addKnownIssue(e){const a=t("li",null);a.innerHTML=e,this.knownIssuesContent.appendChild(a),this.knownIssuesLink.classList.remove("hide"),this.knownIssuesLink._tippy?.setContent(this.knownIssuesContent)}addBugReportLink(){this.addToolbarLink({href:rs,parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){const e=Ce,t="fas fa-gauge-high fa-lg",a=this.simToolbar;as()?fetch("/version").then((i=>{i.json().then((i=>{2==i.outdated&&this.addToolbarLink({href:e,parent:a,icon:t,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})})).catch((e=>{console.warn("No version info found!")}))})).catch(T):this.addToolbarLink({href:e,parent:a,icon:t,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){const e=new Kp(this.simUI.rootElem,this.simUI);this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>e.open()})}addSocialLinks(){const e=t("div",{className:"sim-toolbar-socials"});this.simToolbar.appendChild(e),this.addDiscordLink(e),this.addGitHubLink(e),this.addPatreonLink(e)}addDiscordLink(e){e.appendChild(t(lo,null,$p.buildDiscordLink()))}addGitHubLink(e){e.appendChild(t(lo,null,$p.buildGitHubLink()))}addPatreonLink(e){e.appendChild(t(lo,null,$p.buildPatreonLink()))}customRootElement(){return t("header",{className:"sim-header"},t("div",{className:"sim-header-container"},t("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),t("div",{className:"import-export nav within-raid-sim-hide"},t("div",{className:"dropdown sim-dropdown-menu import-dropdown"},t("button",{className:"import-link",attributes:{"aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},t("i",{className:"fa fa-download"})," Import"),t("ul",{className:"dropdown-menu"})),t("div",{className:"dropdown sim-dropdown-menu export-dropdown"},t("button",{className:"export-link",attributes:{"aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},t("i",{className:"fa fa-right-from-bracket"})," Export"),t("ul",{className:"dropdown-menu"}))),t("div",{className:"sim-toolbar nav"})))}}class Zp extends e{constructor(e,i,s={}){super(e,"sim-title-dropdown-root");const n=i?{type:"Spec",spec:i}:{type:"Raid"},o=this.buildRootSimLink(n);if(s.noDropdown)return void this.rootElem.replaceChildren(o);const l=a();this.rootElem.replaceChildren(t("div",{className:"dropdown sim-link-dropdown"},o,t("ul",{ref:l,className:"dropdown-menu"}))),this.dropdownMenu=l.value,this.buildDropdown(),this.dropdownMenu.addEventListener("click",(e=>{e.target.closest("a")||(e.stopPropagation(),e.preventDefault())}))}buildDropdown(){Hp.status>=Bp.Alpha&&this.dropdownMenu?.appendChild(t("li",null,this.buildRaidLink())),cs.naturalOrder.forEach((e=>this.dropdownMenu?.appendChild(t("li",null,this.buildClassDropdown(e)))))}buildClassDropdown(e){return t("div",{className:"dropend sim-link-dropdown"},this.buildClassLink(e),t("ul",{className:"dropdown-menu"},Object.values(e.specs).map((e=>t("li",null,this.buildSpecLink(e))))))}buildRootSimLink(e){return t("button",{className:u("sim-link",this.getContextualKlass(e)),dataset:{bsToggle:"dropdown",bsTrigger:"click"},attributes:{"aria-expanded":"false"}},t("div",{className:"sim-link-content"},t("img",{src:this.getSimIconPath(e),className:"sim-link-icon"}),t("div",{className:"d-flex flex-column"},t("span",{className:"sim-link-label text-white"},"WoWSims - Mists of Pandaria"),t("span",{className:"sim-link-title"},"Raid"===e.type&&hs,"Spec"===e.type&&U.getFullSpecName(e.spec)),this.launchStatusLabel(e))))}buildRaidLink(){return t("a",{href:ms,className:u("sim-link",this.getContextualKlass({type:"Raid"}))},t("div",{className:"sim-link-content"},t("img",{src:this.getSimIconPath({type:"Raid"}),className:"sim-link-icon"}),t("div",{className:"d-flex flex-column"},t("span",{className:"sim-link-title"},hs),this.launchStatusLabel({type:"Raid"}))))}buildClassLink(e){return t("button",{className:u("sim-link",this.getContextualKlass({type:"Class",class:e})),dataset:{bsToggle:"dropdown"},attributes:{"aria-expanded":"false"}},t("div",{className:"sim-link-content"},t("img",{src:this.getSimIconPath({type:"Class",class:e}),className:"sim-link-icon"}),t("div",{className:"d-flex flex-column"},t("span",{className:"sim-link-title"},e.friendlyName))))}buildSpecLink(e){return t("a",{href:e.simLink,className:u("sim-link",this.getContextualKlass({type:"Spec",spec:e}))},t("div",{className:"sim-link-content"},t("img",{src:this.getSimIconPath({type:"Spec",spec:e}),className:"sim-link-icon"}),t("div",{className:"d-flex flex-column"},t("span",{className:"sim-link-label"},U.getPlayerClass(e).friendlyName),t("span",{className:"sim-link-title"},e.friendlyName),this.launchStatusLabel({type:"Spec",spec:e}))))}launchStatusLabel(e){if("Raid"===e.type&&Hp.status===Bp.Launched)return null;const a="Raid"===e.type?Hp.status:qp[e.spec.specID].status,i="Raid"===e.type?Hp.phase:qp[e.spec.specID].phase;return t("span",{className:"launch-status-label text-brand"},a===Bp.Unlaunched?t(r,null,"Not Yet Supported"):t(r,null,"Phase ",i," - ",Bp[a]))}getSimIconPath(e){let t="";switch(e.type){case"Raid":t=us;break;case"Class":t=e.class.getIcon("large");break;case"Spec":t=e.spec.getIcon("large")}return t}getContextualKlass(e){switch(e.type){case"Class":return ps(e.class);case"Spec":return ds(e.spec);default:return"text-white"}}}var Qp=(e=>(e.bulkSimAsync="bulkSimAsync",e.bulkSimCombos="bulkSimCombos",e.computeStats="computeStats",e.computeStatsJson="computeStatsJson",e.raidSim="raidSim",e.raidSimJson="raidSimJson",e.raidSimAsync="raidSimAsync",e.statWeights="statWeights",e.statWeightsAsync="statWeightsAsync",e.statWeightRequests="statWeightRequests",e.statWeightCompute="statWeightCompute",e.raidSimRequestSplit="raidSimRequestSplit",e.raidSimResultCombination="raidSimResultCombination",e.abortById="abortById",e))(Qp||{});const Xp=5;class eu{constructor(e,t){this.buffs=qi.create(),this.compChangeEmitter=new o,this.buffsChangeEmitter=new o,this.sim=t,this.raid=e,this.players=[...Array(5).keys()].map((e=>null)),this.playerChangeListener=e=>this.changeEmitter.emit(e),this.changeEmitter=o.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter((e=>null!=e)).length}isEmpty(){return 0==this.size()}clear(e){this.setBuffs(e,qi.create());for(let t=0;t<5;t++)this.setPlayer(e,t,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(e){return this.players[e]}setPlayer(e,t,a){if(t<0||t>=5)throw new Error("Invalid player index: "+t);a!=this.players[t]&&o.freezeAllAndDo((()=>{const i=this.players[t];if(null!=i&&(i.changeEmitter.off(this.playerChangeListener),i.setParty(null)),null!=a){const i=a.getParty();i&&i.setPlayer(e,a.getPartyIndex(),null),this.players[t]=a,a.changeEmitter.on(this.playerChangeListener),a.setParty(this)}else this.players[t]=null;this.compChangeEmitter.emit(e)}))}getBuffs(){return qi.clone(this.buffs)}setBuffs(e,t){qi.equals(this.buffs,t)||(this.buffs=qi.clone(t),this.buffsChangeEmitter.emit(e))}toProto(e,t){return gs.create({players:this.players.map((a=>null==a?fs.create():a.toProto(e,t))),buffs:this.buffs})}fromProto(e,t){o.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||qi.create());for(let a=0;a<5;a++){if(!t.players[a]||t.players[a].class==se.ClassUnknown){this.setPlayer(e,a,null);continue}const i=t.players[a],s=ws(i),n=this.players[a];if(n&&s.specID==n.getSpec())n.fromProto(e,i);else{const t=new Lu(s,this.sim);t.fromProto(e,i),this.setPlayer(e,a,t)}}}))}}const tu=5;class au{constructor(e){this.buffs=Bi.create(),this.debuffs=Hi.create(),this.tanks=[],this.targetDummies=0,this.numActiveParties=5,this.compChangeEmitter=new o,this.buffsChangeEmitter=new o,this.debuffsChangeEmitter=new o,this.tanksChangeEmitter=new o,this.targetDummiesChangeEmitter=new o,this.numActivePartiesChangeEmitter=new o,this.sim=e,this.parties=[...Array(5).keys()].map((t=>{const a=new eu(this,e);return a.compChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),a.changeEmitter.on((e=>this.changeEmitter.emit(e))),a})),this.activePlayers=[],this.numActivePartiesChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),this.changeEmitter=o.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on((()=>{this.activePlayers=[]}))}size(){return ys(this.parties.map((e=>e.size())))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(e){return this.parties[e]}getPlayers(){return this.parties.map((e=>e.getPlayers())).flat()}getPlayer(e){if(-1===e)return null;return this.parties[Math.floor(e/5)].getPlayer(e%5)}getPlayerFromUnitReference(e,t){return e&&e.type!=it.Unknown?e.type==it.Player?this.getPlayer(e.index):e.type==it.Self&&t||null:null}setPlayer(e,t,a){this.parties[Math.floor(t/5)].setPlayer(e,t%5,a)}getClassCount(e){return this.getPlayers().filter((t=>null!=t&&t.getClass()==e)).length}getBuffs(){return Bi.clone(this.buffs)}setBuffs(e,t){Bi.equals(this.buffs,t)||(this.buffs=Bi.clone(t),this.buffsChangeEmitter.emit(e))}getDebuffs(){return Hi.clone(this.debuffs)}setDebuffs(e,t){Hi.equals(this.debuffs,t)||(this.debuffs=Hi.clone(t),this.debuffsChangeEmitter.emit(e))}getTanks(){return this.tanks.map((e=>Je.clone(e)))}setTanks(e,t){this.tanks.length==t.length&&this.tanks.every(((e,a)=>Je.equals(e,t[a])))||(this.tanks=t.map((e=>Je.clone(e))),this.tanksChangeEmitter.emit(e))}getTargetDummies(){return this.targetDummies}setTargetDummies(e,t){this.targetDummies!=t&&(this.targetDummies=t,this.targetDummiesChangeEmitter.emit(e))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(e,t){t!=this.numActiveParties&&t>0&&(this.numActiveParties=t,this.numActivePartiesChangeEmitter.emit(e))}getActivePlayers(){if(0==this.activePlayers.length){const e=this.getParties().filter(((e,t)=>t<this.numActiveParties));this.activePlayers=e.map((e=>e.getPlayers())).flat().filter((e=>null!=e))}return this.activePlayers}toProto(e,t){return bs.create({parties:this.parties.map((a=>a.toProto(e,t))),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(e,t){o.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||Bi.create()),this.setDebuffs(e,t.debuffs||Hi.create()),this.setTanks(e,t.tanks),this.setTargetDummies(e,t.targetDummies),this.setNumActiveParties(e,t.numActiveParties||5);for(let a=0;a<5;a++)t.parties[a]?this.parties[a].fromProto(e,t.parties[a]):this.parties[a].clear(e)}))}clear(e){o.freezeAllAndDo((()=>{for(let t=0;t<5;t++)this.parties[t].clear(e)}))}}const iu=`/${As}/sim_worker.js`,su=e=>e+"-"+Array.from(Array(4)).map((()=>Math.floor(65536*Math.random()).toString(16))).join("");class nu{constructor(e){this.workers=[],this.workersDisabled=[],this.setNumWorkers(e)}setNumWorkers(e){if(e<this.workers.length){for(let t=this.workers.length-1;t>=e;t--)this.workers[t].disable(),this.workersDisabled[t]=this.workers[t];this.workers.length=e}else for(let t=0;t<e;t++)this.workers[t]||(this.workersDisabled[t]?(this.workers[t]=this.workersDisabled[t],delete this.workersDisabled[t],this.workers[t].enable()):this.workers[t]=new ou(t))}getNumWorkers(){return this.workers.length}getLeastBusyWorker(){return this.workers.reduce(((e,t)=>e.getSimTaskWorkAmount()<t.getSimTaskWorkAmount()?e:t))}async makeApiCall(e,t){return await this.getLeastBusyWorker().doApiCall(e,t,su(e))}async computeStats(e){const t=await this.makeApiCall(Qp.computeStats,vs.toBinary(e));return Ss.fromBinary(t)}getProgressName(e){return`${e}progress`}async statWeightsAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("Stat weights request: "+Is.toJsonString(e));const s=su(Qp.statWeightsAsync);a.abort.onTrigger((async()=>{await i.sendAbortById(s)}));const n=e.simOptions?e.simOptions.iterations*e.statsToWeigh.length:3e4,o=await this.doAsyncRequest(Qp.statWeightsAsync,Is.toBinary(e),s,i,t,n);return i.log("Stat weights result: "+es.toJsonString(o.finalWeightResult)),o.finalWeightResult}async statWeightRequests(e){const t=await this.makeApiCall(Qp.statWeightRequests,Is.toBinary(e));return Es.fromBinary(t)}async statWeightCompute(e){const t=await this.makeApiCall(Qp.statWeightCompute,ks.toBinary(e));return es.fromBinary(t)}async bulkSimAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("bulk sim request: "+Cs.toJsonString(e,{enumAsInteger:!0}));const s=su(Qp.bulkSimAsync);a.abort.onTrigger((async()=>{await i.sendAbortById(s)}));const n=e.baseSettings?.simOptions?.iterations??3e4,o=await this.doAsyncRequest(Qp.bulkSimAsync,Cs.toBinary(e),s,i,t,n),l=_s.toJson(o.finalBulkResult);return i.log("bulk sim result: "+JSON.stringify(l)),o.finalBulkResult}async bulkSimCombosAsync(e){const t=this.getLeastBusyWorker();t.log("bulk sim combinations request: "+xs.toJsonString(e,{enumAsInteger:!0}));const a=su(Qp.bulkSimCombos),i=await t.doApiCall(Qp.bulkSimCombos,xs.toBinary(e),a);return Ts.fromBinary(i)}async raidSimAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("Raid sim request: "+Ue.toJsonString(e));const s=e.requestId;a.abort.onTrigger((async()=>{await i.sendAbortById(s)}));const n=e.simOptions?.iterations??3e3,o=await this.doAsyncRequest(Qp.raidSimAsync,Ue.toBinary(e),s,i,t,n),l=Ps.toJson(o.finalRaidResult);return delete l.logs,i.log("Raid sim result: "+JSON.stringify(l)),o.finalRaidResult}async raidSimRequestSplit(e){const t=await this.makeApiCall(Qp.raidSimRequestSplit,Rs.toBinary(e));return Ds.fromBinary(t)}async raidSimResultCombination(e){const t=await this.makeApiCall(Qp.raidSimResultCombination,Ns.toBinary(e));return Ps.fromBinary(t)}isWasm(){return this.workers[0].isWasmWorker()}async doAsyncRequest(e,t,a,i,s,n){try{i.addSimTaskRunning(a,n),i.doApiCall(e,t,a);const o=new Promise((e=>{i.addPromiseFunc(this.getProgressName(a),this.newProgressHandler(a,i,s,(t=>e(t))),T)}));return await o}finally{i.updateSimTask(a,0)}}newProgressHandler(e,t,a,i){return s=>{const n=Gs.fromBinary(s);a(n),t.updateSimTask(e,Math.max(1,n.totalIterations-n.completedIterations)),null==n.finalRaidResult&&null==n.finalWeightResult&&null==n.finalBulkResult?t.addPromiseFunc(this.getProgressName(e),this.newProgressHandler(e,t,a,i),T):i(n)}}}class ou{constructor(e){this.workerId=e,this.simTasksRunning={},this.taskIdsToPromiseFuncs={},this.wasmWorker=!1,this.shouldDestroy=!1,this.onReady=new Promise(((e,t)=>{this.resolveReady=e})),this.setupWorker(),this.log("Created.")}setupWorker(){this.setTaskActive("setup",!0),this.onReady=new Promise(((e,t)=>{this.resolveReady=e})),this.worker=new window.Worker(iu),this.worker.addEventListener("message",(({data:e})=>{const{id:t,msg:a,outputData:i}=e;switch(a){case"ready":this.wasmWorker=!!i&&!!i[0],this.postMessage({msg:"setID",id:this.workerId.toString()}),this.resolveReady(),this.setTaskActive("setup",!1),this.log(`Ready, isWasm: ${this.wasmWorker}`);break;case"idConfirm":break;default:const e=this.taskIdsToPromiseFuncs[t];if(!e)return void console.warn(`Unrecognized result id ${t} for msg ${a}`);t.includes("progress")||this.setTaskActive(t,!1),delete this.taskIdsToPromiseFuncs[t],e[0](i)}}))}addSimTaskRunning(e,t){this.simTasksRunning[e]={workLeft:t},this.log(`Added work ${e}, current work amount: ${this.getSimTaskWorkAmount()}`)}updateSimTask(e,t){if(t<=0)return delete this.simTasksRunning[e],this.log(`Work ${e} done, current work amount: ${this.getSimTaskWorkAmount()}`),void(this.shouldDestroy&&0==this.getSimTaskWorkAmount()&&this.disable(!0));this.simTasksRunning[e].workLeft=t}getSimTaskWorkAmount(){let e=0;for(const t of Object.values(this.simTasksRunning))e+=t.workLeft;return e}hasTaskId(e){return!!this.simTasksRunning[e]}setTaskActive(e,t){t?this.addSimTaskRunning(e+"task",1):this.updateSimTask(e+"task",0)}async isWasmWorker(){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");return await this.onReady,this.wasmWorker}addPromiseFunc(e,t,a){this.taskIdsToPromiseFuncs[e]=[t,a]}async doApiCall(e,t,a){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");if(!a)throw new Error("ApiCall with empty id!");this.setTaskActive(a,!0),await this.onReady;const i=new Promise(((i,s)=>{this.taskIdsToPromiseFuncs[a]=[i,s],this.postMessage({msg:e,id:a,inputData:t})}));return await i}postMessage(e){if(!this.worker)throw new Error(`Worker ${this.workerId} postMessage while disabled!`);this.worker.postMessage(e)}disable(e=!1){this.shouldDestroy=!0,!this.worker||!e&&this.getSimTaskWorkAmount()||(this.worker.terminate(),delete this.worker,delete this.onReady,delete this.resolveReady,this.log("Disabled."))}enable(){this.shouldDestroy=!1,this.worker||(this.setupWorker(),this.log("Enabled."))}log(e){}async sendAbortById(e){const t=Us.toBinary(Us.create({requestId:e})),a=su(Qp.abortById),i=await this.doApiCall(Qp.abortById,t,a);return Os.fromBinary(i)}}class lu{constructor(e,t){this.concurrency=e,this.iterationsTotal=t,this.iterationsDone=Array(this.concurrency).fill(0),this.dpsValues=Array(this.concurrency).fill(0),this.hpsValues=Array(this.concurrency).fill(0),this.finalResults=Array(this.concurrency)}getIterationsDone(){let e=0;for(const t of this.iterationsDone)e+=t;return e}getDpsAvg(){let e=0;for(const t of this.dpsValues)e+=t;return e/this.concurrency}getHpsAvg(){let e=0;for(const t of this.hpsValues)e+=t;return e/this.concurrency}updateProgress(e,t){this.iterationsDone[e]=t.completedIterations,this.dpsValues[e]=t.dps,this.hpsValues[e]=t.hps,t.finalRaidResult&&(this.finalResults[e]=t.finalRaidResult)}makeProgressMetrics(){return Gs.create({totalIterations:this.iterationsTotal,completedIterations:this.getIterationsDone(),dps:this.getDpsAvg(),hps:this.getHpsAvg()})}}const ru=(e,t)=>{const a=Ps.create();return"string"==typeof e?(console.error(e),a.error=Ls.create({message:e})):(e.message&&console.error(e.message),a.error=e),t(Gs.create({finalRaidResult:a})),a},cu=async(e,t,a,i)=>{console.log(`Sending requests split for ${t.getNumWorkers()} splits.`);const s=await t.raidSimRequestSplit(Rs.create({splitCount:t.getNumWorkers(),request:e}));if(s.errorResult)return ru(s.errorResult,a);if(i.abort.isTriggered())return ru(Ls.create({type:ke.ErrorOutcomeAborted}),a);console.log(`Running ${e.simOptions.iterations} iterations on ${s.splitsDone} concurrent sims...`);const n=await((e,t,a,i,s)=>new Promise((n=>{const o=new lu(e.length,t);let l=0,r=e.length;const c=(e,t)=>{if(r&&(o.updateProgress(e,t),l++,l%r==0&&i(o.makeProgressMetrics()),t.finalRaidResult)){let a;if(r--,t.finalRaidResult.error&&(t.finalRaidResult.error.type==ke.ErrorOutcomeError&&console.error(`Worker ${e} had an error!`),a=t.finalRaidResult,s.abort.trigger()),a||0==r){r=0;const e=o.makeProgressMetrics();return e.finalRaidResult=a,i(e),void n({errorResult:a,results:o.finalResults,progressMetricsFinal:e})}}};for(let t=0;t<e.length;t++)a.raidSimAsync(e[t],(e=>c(t,e)),s)})))(s.requests,e.simOptions.iterations,t,a,i);if(n.errorResult&&n.errorResult.error)return ru(n.errorResult.error,a);if(i.abort.isTriggered())return ru(Ls.create({type:ke.ErrorOutcomeAborted}),a);console.log(`All ${s.splitsDone} sims finished successfully. Combining ${n.results.length} results.`);const o=await t.raidSimResultCombination(Ns.create({results:n.results}));return o.error?ru(o.error,a):(n.progressMetricsFinal.finalRaidResult=o,a(n.progressMetricsFinal),o)},hu=(e,t)=>{const a=Ps.create();return"string"==typeof e?(console.error(e),a.error=Ls.create({message:e})):(e.message&&console.error(e.message),a.error=e),t(Gs.create({finalWeightResult:a})),a},mu=`${ss}_wasmconcurrency`,du=class e{constructor({type:t}={}){this.iterations=12500,this.phase=Fs,this.faction=Ms.Alliance,this.fixedRngSeed=0,this.filters=e.defaultFilters(),this.showDamageMetrics=!0,this.showThreatMetrics=!1,this.showHealingMetrics=!1,this.showExperimental=!1,this.wasmConcurrency=0,this.showQuickSwap=!1,this.showEPValues=!1,this.useCustomEPValues=!1,this.useSoftCapBreakpoints=!0,this.language="",this.db_=null,this.iterationsChangeEmitter=new o,this.phaseChangeEmitter=new o,this.factionChangeEmitter=new o,this.fixedRngSeedChangeEmitter=new o,this.lastUsedRngSeedChangeEmitter=new o,this.filtersChangeEmitter=new o,this.showDamageMetricsChangeEmitter=new o,this.showThreatMetricsChangeEmitter=new o,this.showHealingMetricsChangeEmitter=new o,this.showExperimentalChangeEmitter=new o,this.wasmConcurrencyChangeEmitter=new o,this.showQuickSwapChangeEmitter=new o,this.showEPValuesChangeEmitter=new o,this.useCustomEPValuesChangeEmitter=new o,this.useSoftCapBreakpointsChangeEmitter=new o,this.languageChangeEmitter=new o,this.crashEmitter=new o,this.unitMetadataEmitter=new o("UnitMetadata"),this.simResultEmitter=new o,this.bulkSimStartEmitter=new o,this.bulkSimResultEmitter=new o,this.lastUsedRngSeed=0,this.modifyRaidProto=T,this.type=t??Ws.SimTypeIndividual,this.workerPool=new nu(1),this.wasmConcurrencyChangeEmitter.on((async()=>{if(await this.workerPool.isWasm()){const e=Math.max(1,Math.min(this.wasmConcurrency,navigator.hardwareConcurrency));this.workerPool.setNumWorkers(e)}}));let a=parseInt(window.localStorage.getItem(mu)??"NaN");isNaN(a)&&(a=0,navigator.hardwareConcurrency>1&&(a=Math.min(4,Math.floor(navigator.hardwareConcurrency/2)))),this.setWasmConcurrency(o.nextEventID(),a),this.signalManager=new zs,this._initPromise=D.get().then((e=>{this.db_=e})),this.raid=new au(this),this.encounter=new Dd(this),this.settingsChangeEmitter=o.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.wasmConcurrencyChangeEmitter,this.showQuickSwapChangeEmitter,this.showEPValuesChangeEmitter,this.useCustomEPValuesChangeEmitter,this.useSoftCapBreakpointsChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=o.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),o.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on((e=>this.updateCharacterStats(e))),this.language=js()}waitForInit(){return this._initPromise}isWasm(){return this.workerPool.isWasm()}async shouldUseWasmConcurrency(){return await this.isWasm()&&this.getWasmConcurrency()>=2&&this.workerPool.getNumWorkers()>=2}get db(){return this.db_}setModifyRaidProto(e){this.modifyRaidProto=e}getModifiedRaidProto(){const e=this.raid.toProto(!1,!0);return this.modifyRaidProto(e),e.parties.forEach((e=>{e.players.forEach((e=>{if(!e.equipment)return;let t=this.db.lookupEquipmentSpec(e.equipment),a=!1;const i=[e.profession1,e.profession2].includes(he.Blacksmithing);t.hasInactiveMetaGem(i)&&(t=t.withoutMetaGem(),a=!0),i||(t=t.withoutBlacksmithSockets(),a=!0),a&&(e.equipment=t.asSpec());const s=e.database,n=[],o=[],l=new Set,r=new Set;Object.values(e.consumables??[]).forEach((e=>{if(!e||l.has(e))return;const t=this.db.getConsumable(e);if(t){l.add(t.id),n.push(t);for(const e of t.effectIds){if(r.has(e))continue;const t=this.db.getSpellEffect(e);t&&(r.add(t.id),o.push(t))}}})),s.consumables=n,s.spellEffects=o,e.database=s}))})),e}makeRaidSimRequest(e){const t=this.getModifiedRaidProto(),a=this.encounter.toProto();return Ue.create({requestId:su(Qp.raidSimAsync),type:this.type,raid:t,encounter:a,simOptions:Bs.create({iterations:e?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(e,t,a){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=Cs.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=i.baseSettings&&null!=i.baseSettings.simOptions&&(i.baseSettings.simOptions.debugFirstIteration=!1),!i.baseSettings?.raid||0==i.baseSettings?.raid?.parties.length||0==i.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const s=i.baseSettings.raid.parties[0].players[0].database;s.items.push(...t.items),s.enchants.push(...t.enchants),s.gems.push(...t.gems),s.reforgeStats.push(...t.reforgeStats),s.randomSuffixes.push(...t.randomSuffixes),s.consumables.push(...t.consumables),s.spellEffects.push(...t.spellEffects),this.bulkSimStartEmitter.emit(o.nextEventID(),i);const n=this.signalManager.registerRunning(xe.BulkSim);try{const e=await this.workerPool.bulkSimAsync(i,a,n);if(e.error){if(e.error.type!=ke.ErrorOutcomeError)return e;throw new uu(e.error.message)}return this.bulkSimResultEmitter.emit(o.nextEventID(),e),e}catch(l){if(l instanceof uu)throw l;throw console.log(l),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(n)}}async calculateBulkCombinations(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const a=xs.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=a.baseSettings&&null!=a.baseSettings.simOptions&&(a.baseSettings.simOptions.debugFirstIteration=!1),!a.baseSettings?.raid||0==a.baseSettings?.raid?.parties.length||0==a.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const i=a.baseSettings.raid.parties[0].players[0].database;i.items.push(...t.items),i.enchants.push(...t.enchants),i.gems.push(...t.gems),i.reforgeStats.push(...t.reforgeStats),i.randomSuffixes.push(...t.randomSuffixes),this.bulkSimStartEmitter.emit(o.nextEventID(),a);try{const e=await this.workerPool.bulkSimCombosAsync(a);if(""!=e.errorResult)throw new uu(e.errorResult);return e}catch(s){if(s instanceof uu)throw s;throw console.log(s),new Error("Something went wrong running your raid sim. Reload the page and try again.")}}async runRaidSim(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");const a=this.signalManager.registerRunning(xe.RaidSim);try{await this.waitForInit();const i=this.makeRaidSimRequest(!1);let s;if(s=await this.shouldUseWasmConcurrency()?await cu(i,this.workerPool,t,a):await this.workerPool.raidSimAsync(i,t,a),s.error){if(s.error.type!=ke.ErrorOutcomeError)return s.error;throw new uu(s.error.message)}const n=await Hs.makeNew(i,s);return this.simResultEmitter.emit(e,n),n}catch(i){if(i instanceof uu)throw i;throw console.error(i),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(a)}}async runRaidSimWithLogs(e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");const t=this.signalManager.registerRunning(xe.RaidSim);try{await this.waitForInit();const a=this.makeRaidSimRequest(!0),i=await this.workerPool.raidSimAsync(a,T,t);if(i.error)throw new uu(i.error.message);const s=await Hs.makeNew(a,i);return this.simResultEmitter.emit(e,s),s}catch(a){if(a instanceof uu)throw a;throw console.error(a),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(t)}}async updateCharacterStats(e){if(0==e)return;e=o.nextEventID(),await this.waitForInit();const t=this.raid.getPlayers(),a=vs.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),i=await this.workerPool.computeStats(a);""==i.errorResult?o.freezeAllAndDo((async()=>{const a=i.raidStats.parties.map(((a,i)=>a.players.map(((a,s)=>{const n=t[5*i+s];return n?(n.setCurrentStats(e,a),n.updateMetadata()):null})))).flat().filter((e=>null!=e)),s=this.encounter.targetsMetadata.update(i.encounterStats.targets.map((e=>e.metadata)));(await Promise.all(a.concat([s]))).some((e=>e))&&this.unitMetadataEmitter.emit(e)})):this.crashEmitter.emit(e,new uu(i.errorResult))}async statWeights(e,t,a,i,s){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==e.getParty())return console.warn("Trying to get stat weights without a party!"),es.create();{const o=this.raid.getTanks().map((e=>e.index)).includes(e.getRaidIndex())?[Je.create({type:it.Player,index:0})]:[],l=Is.create({player:e.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:e.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:Bs.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:o,statsToWeigh:t,pseudoStatsToWeigh:a,epReferenceStat:i}),r=this.signalManager.registerRunning(xe.StatWeights);try{let e;if(e=await this.shouldUseWasmConcurrency()?await(async(e,t,a,i)=>{console.log("Getting stat weight sim requests.");const s=su(Qp.statWeightsAsync),n=await t.statWeightRequests(e);if(n.baseRequest.requestId=s,i.abort.isTriggered())return hu(Ls.create({type:ke.ErrorOutcomeAborted}),a);let o=n.baseRequest.simOptions.iterations,l=0,r=1,c=0;for(const g of n.statSimRequests)g.requestLow.requestId=s,g.requestHigh.requestId=s,o+=g.requestLow.simOptions.iterations+g.requestHigh.simOptions.iterations,r+=2;console.log(`Need to run a total of ${r} sims and ${o} iterations.`);let h=0;const m=e=>{l+=e.completedIterations-h,h=e.completedIterations,a(Gs.create({totalIterations:o,completedIterations:l,totalSims:r,completedSims:c})),e.finalRaidResult&&c++},d=await cu(n.baseRequest,t,m,i);if(d.error)return hu(d.error,a);const p=ks.create({baseResult:d,epReferenceStat:n.epReferenceStat,statSimResults:[]});for(const g of n.statSimRequests){if(i.abort.isTriggered())return hu(Ls.create({type:ke.ErrorOutcomeAborted}),a);h=0;const e=await cu(g.requestLow,t,m,i);if(e.error)return hu(e.error,a);h=0;const s=await cu(g.requestHigh,t,m,i);if(s.error)return hu(s.error,a);p.statSimResults.push(Vs.create({statData:g.statData,resultLow:e,resultHigh:s}))}console.log(`All ${r} sims finished successfully. Computing weights.`);const u=await t.statWeightCompute(p);return u.error?hu(u.error,a):(a(Gs.create({finalWeightResult:u})),u)})(l,this.workerPool,s,r):await this.workerPool.statWeightsAsync(l,s,r),e.error){if(e.error.type!=ke.ErrorOutcomeError)return e;throw new uu(e.error.message)}return e}catch(n){if(n instanceof uu)throw n;throw console.error(n),new Error("Something went wrong calculating your stat weights. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(r)}}}getUnitMetadata(e,t,a){if(!e||e.type==it.Unknown)return this.getUnitMetadata(a,t,a);if(e.type==it.Player)return this.raid.getPlayerFromUnitReference(e)?.getMetadata();if(e.type==it.Target)return this.encounter.targetsMetadata.asList()[e.index];if(e.type==it.Pet){const a=this.raid.getPlayerFromUnitReference(e.owner,t);return a?a.getPetMetadatas().asList()[e.index]:void 0}return e.type==it.Self?t?.getMetadata():e.type==it.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(e,t){t!=this.phase&&(this.phase=t,this.phaseChangeEmitter.emit(e))}getFaction(){return this.faction}setFaction(e,t){t!=this.faction&&t&&(this.faction=t,this.factionChangeEmitter.emit(e))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(e,t){t!=this.fixedRngSeed&&(this.fixedRngSeed=t,this.fixedRngSeedChangeEmitter.emit(e))}nextRngSeed(){let t=0;return t=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*e.MAX_RNG_SEED),this.lastUsedRngSeed=t,this.lastUsedRngSeedChangeEmitter.emit(o.nextEventID()),t}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return qs.clone(this.filters)}setFilters(e,t){qs.equals(t,this.filters)||(this.filters=qs.clone(t),this.filtersChangeEmitter.emit(e))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(e,t){t!=this.showDamageMetrics&&(this.showDamageMetrics=t,this.showDamageMetricsChangeEmitter.emit(e))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(e,t){t!=this.showThreatMetrics&&(this.showThreatMetrics=t,this.showThreatMetricsChangeEmitter.emit(e))}getShowHealingMetrics(){return this.showHealingMetrics||this.showThreatMetrics&&this.raid.getPlayer(0)?.playerSpec.specID==f.SpecBloodDeathKnight}setShowHealingMetrics(e,t){t!=this.showHealingMetrics&&(this.showHealingMetrics=t,this.showHealingMetricsChangeEmitter.emit(e))}getShowExperimental(){return this.showExperimental}setShowExperimental(e,t){t!=this.showExperimental&&(this.showExperimental=t,this.showExperimentalChangeEmitter.emit(e))}getWasmConcurrency(){return this.wasmConcurrency}setWasmConcurrency(e,t){t!=this.wasmConcurrency&&(this.wasmConcurrency=t,window.localStorage.setItem(mu,t.toString()),this.wasmConcurrencyChangeEmitter.emit(e))}getShowQuickSwap(){return!Xn()&&this.showQuickSwap}setShowQuickSwap(e,t){t!=this.showQuickSwap&&(this.showQuickSwap=t,this.showQuickSwapChangeEmitter.emit(e))}getShowEPValues(){return this.showEPValues}setShowEPValues(e,t){t!=this.showEPValues&&(this.showEPValues=t,this.showEPValuesChangeEmitter.emit(e))}getUseCustomEPValues(){return this.useCustomEPValues}setUseCustomEPValues(e,t){t!==this.useCustomEPValues&&(this.useCustomEPValues=t,this.useCustomEPValuesChangeEmitter.emit(e))}getUseSoftCapBreakpoints(){return this.useSoftCapBreakpoints}setUseSoftCapBreakpoints(e,t){t!==this.useSoftCapBreakpoints&&(this.useSoftCapBreakpoints=t,this.useSoftCapBreakpointsChangeEmitter.emit(e))}getLanguage(){return this.language}setLanguage(e,t){(t=t||Ys())!=this.language&&(this.language=t,os(this.language),Ks(this.language),this.languageChangeEmitter.emit(e))}getIterations(){return this.iterations}setIterations(e,t){t!=this.iterations&&(this.iterations=t,this.iterationsChangeEmitter.emit(e))}toProto(){const t=this.getFilters();return t.armorTypes.length==e.ALL_ARMOR_TYPES.length&&(t.armorTypes=[]),t.weaponTypes.length==e.ALL_WEAPON_TYPES.length&&(t.weaponTypes=[]),t.rangedWeaponTypes.length==e.ALL_RANGED_WEAPON_TYPES.length&&(t.rangedWeaponTypes=[]),t.sources.length==e.ALL_SOURCES.length&&(t.sources=[]),t.raids.length==e.ALL_RAIDS.length&&(t.raids=[]),$s.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showQuickSwap:this.getShowQuickSwap(),showEpValues:this.getShowEPValues(),useCustomEpValues:this.getUseCustomEPValues(),useSoftCapBreakpoints:this.getUseSoftCapBreakpoints(),language:this.getLanguage(),faction:this.getFaction(),filters:t})}fromProto(t,a){o.freezeAllAndDo((()=>{this.setIterations(t,a.iterations||12500),this.setPhase(t,a.phase||Fs),this.setFixedRngSeed(t,Number(a.fixedRngSeed)),this.setShowDamageMetrics(t,a.showDamageMetrics),this.setShowThreatMetrics(t,a.showThreatMetrics),this.setShowHealingMetrics(t,a.showHealingMetrics),this.setShowExperimental(t,a.showExperimental),this.setShowQuickSwap(t,a.showQuickSwap),this.setShowEPValues(t,a.showEpValues),this.setUseCustomEPValues(t,a.useCustomEpValues),this.setUseSoftCapBreakpoints(t,a.useSoftCapBreakpoints),this.setLanguage(t,a.language),this.setFaction(t,a.faction||Ms.Alliance);const i=a.filters||e.defaultFilters();0==i.armorTypes.length&&(this.type==Ws.SimTypeIndividual?i.armorTypes=[this.raid.getActivePlayers()[0].getPlayerClass().armorTypes[0]]:i.armorTypes=e.ALL_ARMOR_TYPES.slice()),0==i.weaponTypes.length&&(i.weaponTypes=e.ALL_WEAPON_TYPES.slice()),0==i.rangedWeaponTypes.length&&(i.rangedWeaponTypes=e.ALL_RANGED_WEAPON_TYPES.slice()),0==i.sources.length&&(i.sources=e.ALL_SOURCES.slice()),0==i.raids.length&&(i.raids=e.ALL_RAIDS.slice()),this.setFilters(t,i)}))}applyDefaults(t,a,i){this.fromProto(t,$s.create({iterations:12500,phase:Fs,faction:Ms.Alliance,showDamageMetrics:!i,showThreatMetrics:a,showHealingMetrics:i,language:this.getLanguage(),filters:e.defaultFilters(),showEpValues:!1,useSoftCapBreakpoints:!0}))}static defaultFilters(){return qs.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};du.MAX_RNG_SEED=Math.pow(2,32)-1,du.ALL_ARMOR_TYPES=P(Js).filter((e=>0!=e)),du.ALL_WEAPON_TYPES=P(Zs).filter((e=>0!=e)),du.ALL_RANGED_WEAPON_TYPES=P(Qs).filter((e=>0!=e)),du.ALL_SOURCES=P(Xs).filter((e=>0!=e)),du.ALL_RAIDS=P(en).filter((e=>0!=e));let pu=du;class uu extends Error{constructor(e){super(e),this.errorStr=e}}const gu=[];class fu extends e{constructor(e,a,i){super(e,"sim-ui"),this.sim=a,this.cssClass=i.cssClass,this.cssScheme=i.cssScheme,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim");const s=t(r,null,t("div",{className:"sim-root"},t("div",{className:"sim-bg"}),i.noticeText?t("div",{className:"notices-banner alert border-bottom mb-0 text-center within-raid-sim-hide"},i.noticeText):null,t("div",{className:"sim-container"},t("aside",{className:"sim-sidebar"},t("div",{className:"sim-title"}),t("div",{className:"sim-sidebar-content"},t("div",{className:"sim-sidebar-actions within-raid-sim-hide"}),t("div",{className:"sim-sidebar-results within-raid-sim-hide"}),t("div",{className:"sim-sidebar-stats"}),t("div",{className:"sim-sidebar-socials"}))),t("div",{className:"sim-content container-fluid"}))),t("div",{className:"sim-toast-container p-3 bottom-0 right-0",id:"toastContainer"}));this.rootElem.appendChild(s),this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new Jp(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=o.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on(((e,t)=>this.handleCrash(t)));const n=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};n(),this.sim.showDamageMetricsChangeEmitter.on(n);const l=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};l(),this.sim.showThreatMetricsChangeEmitter.on(l);const c=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};c(),this.sim.showHealingMetricsChangeEmitter.on(c);const h=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};h(),this.sim.showDamageMetricsChangeEmitter.on(h),this.sim.showHealingMetricsChangeEmitter.on(h),this.sim.showThreatMetricsChangeEmitter.on(h);const m=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};m(),this.sim.showExperimentalChangeEmitter.on(m),this.addKnownIssues(i);const d=this.rootElem.querySelector(".sim-title");new Zp(d,i.spec,{noDropdown:this.isWithinRaidSim}),this.simActionsContainer=this.rootElem.querySelector(".sim-sidebar-actions"),this.addNoticeForLocalSim(),this.iterationsPicker=new so(this.simActionsContainer,this.sim,{id:"simui-iterations",label:"Iterations",extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:e=>e.iterationsChangeEmitter,getValue:e=>e.getIterations(),setValue:(e,t,a)=>{t.setIterations(e,a)}}).rootElem;const p=this.rootElem.querySelector(".sim-sidebar-results");this.resultsViewer=new co(p);const u=this.rootElem.querySelector(".sim-sidebar-socials");u.appendChild($p.buildDiscordLink()),u.appendChild($p.buildGitHubLink()),u.appendChild($p.buildPatreonLink()),this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",(async e=>{"runOnce"==e.data&&this.runSimOnce()}))}addNoticeForLocalSim(){new Yp(this.simActionsContainer)}addAction(e,i,s){const n=a();return this.simActionsContainer.appendChild(t("button",{ref:n,className:u("sim-sidebar-action-button btn btn-primary w-100",i),onclick:s},e,t("span",{className:"sim-sidebar-action-button-loading-icon"},t("i",{className:"fas fa-spinner fa-spin"})))),n.value}addActionGroup(e,i={}){const s=[],n=a(),{cssClass:o}=i;return this.simActionsContainer.appendChild(t("div",{ref:n,className:u("d-flex btn-group w-100",o),attributes:{role:"group"}},e.map((({label:e,cssClass:a,children:i,onClick:n})=>t("button",{ref:e=>s.push(e),onclick:n,className:u("sim-sidebar-action-button btn btn-primary",a)},e,i,t("span",{className:"sim-sidebar-action-button-loading-icon"},t("i",{className:"fas fa-spinner fa-spin"}))))))),{group:n.value,children:s}}addTab(e,a,i){const s=a.replace(/\s+/g,"-")+"-tab",n=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(e,s),this.simTabContentsContainer.appendChild(t("div",{id:s,className:u("tab-pane fade",n&&"active show")},i))}addSimTab(e){this.simHeader.addSimTabLink(e)}addWarning(e){this.resultsViewer.addWarning(e)}addKnownIssues(e){let t="";switch(e.simStatus.status){case Bp.Unlaunched:t="This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.";break;case Bp.Alpha:t="This sim is in ALPHA. Bugs are expected; please let us know if you find one!";break;case Bp.Beta:t="This sim is in BETA. There may still be a few bugs; please let us know if you find one!"}t&&(e.knownIssues=[t].concat(e.knownIssues||[])),e.knownIssues?.forEach((e=>this.simHeader.addKnownIssue(e))),gu?.forEach((e=>this.simHeader.addKnownIssue(e)))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(e){this.resultsViewer.setPending();try{await this.sim.signalManager.abortType(xe.All);const t=await this.sim.runRaidSim(o.nextEventID(),e);t instanceof Hs||t.type!=ke.ErrorOutcomeAborted||new mo({variant:"info",body:"Raid sim cancelled."})}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(o.nextEventID())}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async handleCrash(e){if(!(e instanceof uu))return void(e.message?new mo({variant:"error",body:e.message}):alert(e));new mo({variant:"error",body:"The Simulation failed. Generated an error report."});const t=e.errorStr;if(t.startsWith("[USER_ERROR] ")){let e=t.substring(13);return e=await d.replaceAllInString(e),void alert(e)}if(window.confirm("Simulation Failure:\n"+t+"\nPress Ok to file crash report")){const e=this.hashCode(t),a=this.toLink(),i=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/mop+"+e).then((s=>{s.json().then((s=>{if(s.total_count>0)window.open(s.items[0].html_url,"_blank");else{const s=new URL(tn);s.searchParams.append("title",`Crash Report ${e}`),s.searchParams.append("assignees",""),s.searchParams.append("labels","");const n=2048-s.toString().length;let o=`Link:\n${a}\n\nRNG Seed: ${i}\n\n${t}`;a.includes("/raid/")&&(o=`${t}\nRNG Seed: ${i}\nLink:\n${a}`);let l=!1;for(;o.length>n-(l?3:0);)o=o.slice(0,o.lastIndexOf("%")),l=!0;l&&(o+="...",new wu(this.rootElem,a).open()),s.searchParams.append("body",o),window.open(s.toString(),"_blank")}}))})).catch((e=>{alert("Failed to file report... try again another time:"+e)}))}}hashCode(e){let t=0;for(let a=0,i=e.length;a<i;a++){t=(t<<5)-t+e.charCodeAt(a),t|=0}return t}}class wu extends to{constructor(e,a){super(e,"crash",{title:"Extra Crash Information"}),this.body.appendChild(t("div",{className:"sim-crash-report"},t("h3",{className:"sim-crash-report-header"},"Please append the following complete link to the issue you just created. This will simplify debugging the issue."),t("textarea",{className:"sim-crash-report-text form-control"},a)))}}function yu(e,t){return function(e,t){Uu[e]=t}(e,t),t}const bu=[];class vu extends fu{constructor(e,t,a){super(e,t.sim,{cssClass:a.cssClass,cssScheme:a.cssScheme,spec:t.getPlayerSpec(),knownIssues:a.knownIssues,simStatus:qp[t.getSpec()]}),this.epWeightsModal=null,this.bt=null,this.rootElem.classList.add("individual-sim-ui"),this.player=t,this.individualConfig=this.applyDefaultConfigOptions(a),this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null,(e=>qp[e.getSpec()].status)(this.player)!==Bp.Unlaunched?((a.itemSwapSlots||[]).length>0&&!bu.includes(t.getSpec())&&bu.push(t.getSpec()),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>{if(!this.player.getGear().hasInactiveMetaGem(this.player.isBlacksmithing()))return"";const e=this.player.getGear().getMetaGem();return`Meta gem disabled (${e.name}): ${an(e)}`}}),this.addWarning({updateOn:o.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const e=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==e.length?"":e.map((e=>`${e.name} requires ${Mi.get(e.requiredProfession)}, but it is not selected.`))}}),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>{const e=this.player.getGear().getJCGems(this.player.isBlacksmithing());return e.length<=3?"":`Only 3 Jewelcrafting Gems are allowed, but ${e.length} are equipped.`}}),this.addWarning({updateOn:this.player.talentsChangeEmitter,getContent:()=>{const e=sn(this.player.getTalentsString());return 0==e?"":e<6?"Unspent talent points.":""}}),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>this.player.armorSpecializationArmorType&&this.player.hasArmorSpecializationBonus()?`Equip ${nn.get(this.player.armorSpecializationArmorType)} gear in each slot for the Armor Specialization (5% primary stat) effect.`:""}),this.addWarning({updateOn:o.onAny([this.player.gearChangeEmitter,this.player.talentsChangeEmitter]),getContent:()=>this.player.canDualWield2H()||(this.player.getEquippedItem(w.ItemSlotMainHand)?.item.handType!=on.HandTypeTwoHand||null==this.player.getEquippedItem(w.ItemSlotOffHand))&&this.player.getEquippedItem(w.ItemSlotOffHand)?.item.handType!=on.HandTypeTwoHand?"":"Dual wielding two-handed weapon(s) without Titan's Grip spec."}),(a.warnings||[]).forEach((e=>this.addWarning(e(this)))),this.isWithinRaidSim||this.sim.waitForInit().then((()=>{ko.registerSetBonusNotices(this.sim.db),this.loadSettings(),this.player.getPlayerSpec().isHealingSpec&&alert(ln)})),this.addSidebarComponents(),this.addGearTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.addTopbarComponents()):this.handleSimUnlaunched()}applyDefaultConfigOptions(e){return e.otherInputs.inputs=[Pp,...e.otherInputs.inputs],e}loadSettings(){const e=o.nextEventID();o.freezeAllAndDo((()=>{this.applyDefaults(e);const t=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=t)try{const a=de.fromJsonString(t,{ignoreUnknownFields:!0});this.fromProto(e,a)}catch(a){console.warn("Failed to parse saved settings: "+a)}try{const t=Hh.tryParseUrlLocation(window.location);t&&this.fromProto(e,t.settings,t.categories)}catch(a){console.warn("Failed to parse link settings: "+a)}window.location.hash="",this.player.setName(e,"Player"),this.changeEmitter.on((e=>{const t=de.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),t)}))}))}addSidebarComponents(){this.raidSimResultsManager=rn(this),this.sim.waitForInit().then((()=>{this.epWeightsModal=(e=>{const t=new jp(e);return e.addAction("Stat Weights","ep-weights-action",(()=>{t.open()})),t})(this)})),new no(this.rootElem.querySelector(".sim-sidebar-stats"),this.player,this.individualConfig.displayStats,this.individualConfig.modifyDisplayStats,this.individualConfig.overwriteDisplayStats)}handleSimUnlaunched(){this.rootElem.classList.add("sim-ui--is-unlaunched"),this.simMain?.replaceChildren(t("div",{className:"sim-ui-unlaunched-container d-flex flex-column align-items-center text-center mt-auto mb-auto ms-auto me-auto"},t("i",{className:"fas fa-ban fa-3x"}),t("p",{className:"mt-4"},"This sim is currently not supported.",t("br",null),"Want to contribute? Make sure to join our"," ",t("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank"},"Discord"),"!"),t("p",null,"You can check out our other sims ",t("a",{href:"/mop/"},"here"))))}addGearTab(){new gm(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){const e=new Zh(this.simTabContentsContainer,this);return e.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on((()=>{e.navLink.hidden=!this.sim.getShowExperimental()})),e}addSettingsTab(){new _p(this.simTabContentsContainer,this)}addTalentsTab(){new xp(this.simTabContentsContainer,this)}addRotationTab(){new Rd(this.simTabContentsContainer,this)}addDetailedResultsTab(){const e=t("div",{className:"detailed-results"});this.addTab("Results","detailed-results-tab",e),new cn(e,this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",new Dl(this.rootElem,this),!0),this.simHeader.addImportLink("WoWHead",new Jh(this.rootElem,this),!1,!1),this.simHeader.addImportLink("Addon",new Pl(this.rootElem,this),!0),this.simHeader.addExportLink("Link",new sm(this.rootElem,this),!1),this.simHeader.addExportLink("JSON",new im(this.rootElem,this),!0),this.simHeader.addExportLink("WoWHead",new hm(this.rootElem,this),!1,!1),this.simHeader.addExportLink("Pawn EP",new om(this.rootElem,this),!1),this.simHeader.addExportLink("CLI",new am(this.rootElem,this),!0)}applyDefaultRotation(e){o.freezeAllAndDo((()=>{const t=this.individualConfig.defaults.rotationType||Fe.TypeAuto;if(this.player.setAplRotation(e,Me.create({type:t})),!this.individualConfig.defaults.simpleRotation)return;const a=this.individualConfig.defaults.simpleRotation||this.player.specTypeFunctions.rotationCreate();this.player.setSimpleRotation(e,a),this.player.setSimpleCooldowns(e,hn.create({hpPercentForDefensives:this.player.playerSpec.isTankSpec?.4:0}))}))}applyEmptyAplRotation(e){o.freezeAllAndDo((()=>{this.player.setAplRotation(e,Me.create({type:Fe.TypeAPL}))}))}applyDefaults(e){o.freezeAllAndDo((()=>{const t=this.player.getPlayerSpec().isTankSpec,a=this.player.getPlayerSpec().isHealingSpec;this.player.applySharedDefaults(e),this.player.setRace(e,this.player.getPlayerClass().races[0]),this.player.setGear(e,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.player.setConsumes(e,this.individualConfig.defaults.consumables),this.applyDefaultRotation(e),this.player.setTalentsString(e,this.individualConfig.defaults.talents.talentsString),this.player.setGlyphs(e,this.individualConfig.defaults.talents.glyphs||me.create()),this.player.setSpecOptions(e,this.individualConfig.defaults.specOptions),this.player.setBuffs(e,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(e,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(e,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(e,this.individualConfig.defaults.epWeights),this.individualConfig.defaults.itemSwap&&this.player.itemSwapSettings.setItemSwapSettings(e,!0,this.sim.db.lookupItemSwap(this.individualConfig.defaults.itemSwap||$i.create()));const i=this.player.getDefaultEpRatios(t,a);this.player.setEpRatios(e,i),this.individualConfig.defaults.statCaps&&this.player.setStatCaps(e,this.individualConfig.defaults.statCaps),this.individualConfig.defaults.softCapBreakpoints&&this.player.setSoftCapBreakpoints(e,this.individualConfig.defaults.softCapBreakpoints),this.player.setBreakpointLimits(e,new h),this.player.setProfession1(e,this.individualConfig.defaults.other?.profession1||he.Engineering),void 0===this.individualConfig.defaults.other?.profession2?this.player.setProfession2(e,he.Jewelcrafting):this.player.setProfession2(e,this.individualConfig.defaults.other.profession2),this.player.setDistanceFromTarget(e,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(e,this.individualConfig.defaults.other?.channelClipDelay||0),this.isWithinRaidSim?this.sim.raid.setTargetDummies(e,0):(this.sim.raid.setTargetDummies(e,a?9:0),this.sim.encounter.applyDefaults(e),this.sim.encounter.setExecuteProportion90(e,this.individualConfig.defaults.other?.highHpThreshold||.9),this.sim.raid.setDebuffs(e,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(e,t,a),this.individualConfig.defaults.other?.iterationCount&&this.sim.setIterations(e,this.individualConfig.defaults.other.iterationCount),t?this.sim.raid.setTanks(e,[this.player.makeUnitReference()]):this.sim.raid.setTanks(e,[]))}))}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedEPWeightsStorageKey(){return this.getStorageKey("__savedEPWeights__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(e){return U.getLocalStorageKey(this.player.getPlayerSpec())+e}toProto(e){const t=t=>!e||0==e.length||e.includes(t),a=de.create({player:this.player.toProto(!0,!1,e)});return t(jo.Miscellaneous)&&de.mergePartial(a,{tanks:this.sim.raid.getTanks()}),t(jo.Encounter)&&de.mergePartial(a,{encounter:this.sim.encounter.toProto()}),t(jo.External)&&de.mergePartial(a,{partyBuffs:this.player.getParty()?.getBuffs()||qi.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),t(jo.UISettings)&&de.mergePartial(a,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),statCaps:this.player.getStatCaps().toProto(),breakpointLimits:this.player.getBreakpointLimits().toProto(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),a}toLink(){return sm.createLink(this)}fromProto(e,t,a){const i=e=>!a||0==a.length||a.includes(e),s=this.player.getPlayerSpec().isTankSpec,n=this.player.getPlayerSpec().isHealingSpec;o.freezeAllAndDo((()=>{if(t.player){if(this.player.fromProto(e,t.player,a),i(jo.Miscellaneous)&&this.sim.raid.setTanks(e,t.tanks||[]),i(jo.External)){this.sim.raid.setBuffs(e,t.raidBuffs||Bi.create()),this.sim.raid.setDebuffs(e,t.debuffs||Hi.create());const a=this.player.getParty();a&&a.setBuffs(e,t.partyBuffs||qi.create()),this.sim.raid.setTargetDummies(e,t.targetDummies)}if(i(jo.Encounter)&&this.sim.encounter.fromProto(e,t.encounter||We.create()),i(jo.UISettings)){t.epWeightsStats?this.player.setEpWeights(e,h.fromProto(t.epWeightsStats)):this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const a=this.player.getDefaultEpRatios(s,n);if(t.epRatios){const i=new Array(a.length-t.epRatios.length).fill(0);this.player.setEpRatios(e,t.epRatios.concat(i))}else this.player.setEpRatios(e,a);t.statCaps&&this.player.setStatCaps(e,h.fromProto(t.statCaps)),t.breakpointLimits&&this.player.setBreakpointLimits(e,h.fromProto(t.breakpointLimits)),t.dpsRefStat&&(this.dpsRefStat=t.dpsRefStat),t.healRefStat&&(this.healRefStat=t.healRefStat),t.tankRefStat&&(this.tankRefStat=t.tankRefStat),t.settings?this.sim.fromProto(e,t.settings):this.sim.applyDefaults(e,s,n)}}}))}hasCapForPseudoStat(e){const t=this.individualConfig.defaults.statCaps||new h,a=this.player.getStatCaps(),i=this.individualConfig.defaults.softCapBreakpoints||[];return mn(e,a.add(t),i)}hasDisplayPseudoStat(e){for(const t of this.individualConfig.displayStats)if(t.equalsPseudoStat(e))return!0;return!1}}let Su={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function Iu(e,t){return window.getComputedStyle(t)[e]}class Eu{constructor(e,t){this.last_cluster=0,this.scroll_debounce=0,this.pointer_events_set=!1,this.resize_debounce=0,this.cache={},this.options={rows_in_block:void 0!==t.rows_in_block?t.rows_in_block:Su.rows_in_block,blocks_in_cluster:void 0!==t.blocks_in_cluster?t.blocks_in_cluster:Su.blocks_in_cluster,show_no_data_row:void 0!==t.show_no_data_row?t.show_no_data_row:Su.show_no_data_row,no_data_class:void 0!==t.no_data_class?t.no_data_class:Su.no_data_class,no_data_text:void 0!==t.no_data_text?t.no_data_text:Su.no_data_text,keep_parity:void 0!==t.keep_parity?t.keep_parity:Su.keep_parity,tag:void 0!==t.tag?t.tag:Su.tag,callbacks:void 0!==t.callbacks?t.callbacks:Su.callbacks,cluster_height:0,item_height:void 0!==t.item_height?t.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=e,this.displayedRows=t.rows,this.scroll_elem=t.scroll_elem,this.content_elem=t.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");let a=this.scroll_elem.scrollTop;this.getRowsHeight(t.rows),this.insertToDom(t.rows,this.cache),this.scroll_elem.scrollTop=a,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(e){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),e&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(e){(this.getRowsHeight(this.displayedRows)||e)&&this.update()}update(){let e=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<e&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=e}elementUpdate(e){for(let t of this.displayedRows)e(t)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout((()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1}),50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);let a=this.generate(),i=a.rows;this.displayedRows=a.rows;let s=this.checkChanges("data",i,t),n=this.checkChanges("top",a.top_offset,t),o=this.checkChanges("bottom",a.bottom_offset,t),l=this.options.callbacks,r=[];if(s||n){if(a.top_offset){if(this.options.keep_parity){let e=this.renderExtraTag("keep-parity");e.hidden=!0,r.push(e)}r.push(this.renderExtraTag("top-space",a.top_offset))}r.push(...i),a.bottom_offset&&r.push(this.renderExtraTag("bottom-space",a.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",a.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(a.rows_above-1),l.clusterChanged&&l.clusterChanged()}else o&&(this.content_elem.lastChild.style.height=a.bottom_offset+"px")}exploreEnvironment(e,t){let a=this.options;a.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([e[0],e[0],e[0]]),a.tag||(a.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))}setContentElemRows(e){this.content_elem.innerHTML="",this.content_elem.append(...e)}getRowsHeight(e){let t=this.options,a=t.item_height;t.cluster_height=0;let i=this.content_elem.children;if(e.length&&i.length){let e=i[Math.floor(i.length/2)];if(t.item_height=e.offsetHeight,"tr"==t.tag&&"collapse"!=Iu("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(Iu("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){let a=parseInt(Iu("marginTop",e),10)||0,i=parseInt(Iu("marginBottom",e),10)||0;t.item_height+=Math.max(a,i)}}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,a!=t.item_height}generate(){let e=this.options,t=this.ds.getNumberOfRows();if(t<e.rows_in_block){let e=this.ds.generateRows(0,t);return{top_offset:0,bottom_offset:0,rows_above:0,rows:t?e:this.generateEmptyRow()}}let a=Math.max((e.rows_in_cluster-e.rows_in_block)*this.getClusterNum(t),0),i=a+e.rows_in_cluster,s=Math.max(a*e.item_height,0),n=Math.max((t-i)*e.item_height,0),o=[],l=a;return s<1&&l++,o=this.ds.generateRows(a,i),{top_offset:s,bottom_offset:n,rows_above:l,rows:o}}generateEmptyRow(){let e=this.options;if(!e.tag||!e.show_no_data_row)return[];let t,a=document.createElement(e.tag),i=document.createTextNode(e.no_data_text);return a.className=e.no_data_class,"tr"==e.tag&&(t=document.createElement("td"),t.colSpan=100,t.appendChild(i)),a.appendChild(t||i),[a]}getClusterNum(e){let t=this.options;t.scroll_top=this.scroll_elem.scrollTop;let a=Math.max(t.cluster_height-t.block_height,1),i=Math.floor(t.scroll_top/a),s=Math.floor(e*t.item_height/a);return Math.min(i,s)}renderExtraTag(e,t){let a=document.createElement(this.options.tag),i="clusterize-";return a.className=[i+"extra-row",i+e].join(" "),a.style.marginTop="0",a.style.marginBottom="0",t&&(a.style.height=t+"px"),a}checkChanges(e,t,a){var i=t!=a[e];return a[e]=t,i}}const ku={[C.UNSPECIFIED]:"None",[C.ALLIANCE_ONLY]:"Alliance only",[C.HORDE_ONLY]:"Horde only"};class Cu extends to{constructor(e,a,i){super(e,"filters-menu",{size:"md",title:"Filters",disposeOnClose:!1});const s=this.newSection("General"),n=t("div",{className:"ilvl-filters"});s.appendChild(n),new so(n,a.sim,{id:"filters-min-ilvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minIlvl,setValue:(e,t,a)=>{const i=t.getFilters();i.minIlvl=a,t.setFilters(e,i)}}),n.appendChild(t("span",{className:"ilvl-filters-separator"},"-")),new so(n,a.sim,{id:"filters-max-ilvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxIlvl,setValue:(e,t,a)=>{const i=t.getFilters();i.maxIlvl=a,t.setFilters(e,i)}}),new Hm(s,a.sim,{id:"filters-faction-restriction",label:"Faction Restrictions",values:[C.UNSPECIFIED,C.ALLIANCE_ONLY,C.HORDE_ONLY].map((e=>({name:ku[e],value:e}))),changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().factionRestriction,setValue:(e,t,a)=>{const i=t.getFilters();i.factionRestriction=a,t.setFilters(e,i)}});const o=this.newSection("Source");o.classList.add("filters-menu-section-bool-list");pu.ALL_SOURCES.filter((e=>e!=Xs.SourceUnknown)).forEach((e=>{new Te(o,a.sim,{id:`filters-source-${e}`,label:dn.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().sources.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.sources.push(e):s.sources=s.sources.filter((t=>t!=e)),a.setFilters(t,s)}})}));const l=this.newSection("Raids");l.classList.add("filters-menu-section-bool-list");if(pu.ALL_RAIDS.filter((e=>e!=en.RaidUnknown)).forEach((e=>{new Te(l,a.sim,{id:`filters-raid-${e}`,label:pn.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().raids.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.raids.push(e):s.raids=s.raids.filter((t=>t!=e)),a.setFilters(t,s)}})})),Lu.ARMOR_SLOTS.includes(i)){const e=a.getPlayerClass().armorTypes;if(e.length>1){const t=this.newSection("Armor Type");t.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new Te(t,a.sim,{id:`filters-armor-type-${e}`,label:nn.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().armorTypes.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.armorTypes.push(e):s.armorTypes=s.armorTypes.filter((t=>t!=e)),a.setFilters(t,s)}})}))}}else if(Lu.WEAPON_SLOTS.includes(i)){if(a.getPlayerClass().weaponTypes.length>0){const e=this.newSection("Weapon Type");e.classList.add("filters-menu-section-bool-list");a.getPlayerClass().weaponTypes.map((e=>e.weaponType)).forEach((t=>{new Te(e,a.sim,{id:`filters-weapon-type-${t}`,label:un.get(t),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().weaponTypes.includes(t),setValue:(e,a,i)=>{const s=a.getFilters();i?s.weaponTypes.push(t):s.weaponTypes=s.weaponTypes.filter((e=>e!=t)),a.setFilters(e,s)}})}));const t=this.newSection("Weapon Speed");t.classList.add("filters-menu-section-number-list"),new so(t,a.sim,{id:"filters-min-weapon-speed",label:"Min MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minMhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minMhWeaponSpeed=a,t.setFilters(e,i)}}),new so(t,a.sim,{id:"filters-max-weapon-speed",label:"Max MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxMhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxMhWeaponSpeed=a,t.setFilters(e,i)}}),a.getPlayerSpec().canDualWield&&(new so(t,a.sim,{id:"filters-min-oh-weapon-speed",label:"Min OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minOhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minOhWeaponSpeed=a,t.setFilters(e,i)}}),new so(t,a.sim,{id:"filters-max-oh-weapon-speed",label:"Max OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxOhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxOhWeaponSpeed=a,t.setFilters(e,i)}}))}const e=a.getPlayerClass().rangedWeaponTypes;if(e.length<1)return;const t=this.newSection("Ranged Weapon Type");t.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new Te(t,a.sim,{id:`filter-ranged-weapon-type-${e}`,label:gn.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().rangedWeaponTypes.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.rangedWeaponTypes.push(e):s.rangedWeaponTypes=s.rangedWeaponTypes.filter((t=>t!=e)),a.setFilters(t,s)}})}));const i=this.newSection("Ranged Weapon Speed");i.classList.add("filters-menu-section-number-list"),new so(i,a.sim,{id:"filters-min-ranged-weapon-speed",label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minRangedWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minRangedWeaponSpeed=a,t.setFilters(e,i)}}),new so(i,a.sim,{id:"filters-max-ranged-weapon-speed",label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxRangedWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxRangedWeaponSpeed=a,t.setFilters(e,i)}})}}newSection(e){const t=document.createElement("div");return t.classList.add("menu-section",`${e.toLowerCase().replaceAll(" ","-")}-section`),this.body.appendChild(t),t.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${e}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,t.getElementsByClassName("menu-section-content")[0]}}class _u{constructor(e,i,s,n,l,r,c,h,m,d,p,u,g,f){this.sortBy=1,this.sortDirection=fn.DESC,this.id=e,this.label=c,this.simUI=s,this.player=r,this.itemData=m,this.socketColor=d,this.computeEP=p,this.equippedToItemFn=u,this.onItemClick=f,this.slot=n,this.gearData=h,this.currentFilters=this.player.sim.getFilters();const y=c===l,b=c===xu.Reforging?"Reforge":"Item",v=a(),S=a(),I=a(),E=a(),k=a(),C=a(),_=a(),x=a(),T=a(),P=a(),R=a(),D=![w.ItemSlotTrinket1,w.ItemSlotTrinket2].includes(n);if(this.tabContent=t("div",{id:this.id,className:"selector-modal-tab-pane tab-pane fade "+(y?"active show":"")},t("div",{className:"selector-modal-filters"},t("input",{ref:v,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),c===xu.Items&&t("button",{ref:I,className:"selector-modal-filters-button btn btn-primary"},"Filters"),t("div",{ref:k,className:"selector-modal-phase-selector"}),t("div",{ref:_,className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons hide"}),t("div",{ref:x,className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons hide"}),t("div",{ref:C,className:"sim-input selector-modal-boolean-option selector-modal-show-matching-gems"}),D&&t("div",{ref:E,className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),t("button",{ref:P,className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),t("div",{className:"selector-modal-list-labels"},t("span",{className:"item-label"},t("small",null,b)),c===xu.Items&&t("label",{className:"source-label"},t("small",null,"Source")),(c===xu.Items||c===xu.Upgrades)&&t("label",{className:"ilvl-label interactive",onclick:e=>{e.preventDefault(),this.sort(1)}},t("small",null,"ILvl")),D&&t("span",{className:"ep-label interactive",onclick:e=>{e.preventDefault(),this.sort(0)}},t("small",null,"EP"),t("i",{className:"fa-solid fa-plus-minus fa-2xs"}),t("button",{ref:S,className:"btn btn-link p-0 ms-1"},t("i",{className:"far fa-question-circle fa-lg"}))),t("span",{className:"favorite-label"}),t("span",{ref:R,className:"compare-label hide"})),t("ul",{ref:T,className:"selector-modal-list"})),i.appendChild(this.tabContent),this.label===xu.Items&&this.bindToggleCompare(R.value),c===xu.Items&&r.getPlayerClass().weaponTypes.length>0&&(n===w.ItemSlotMainHand||n===w.ItemSlotOffHand&&r.getClass()===se.ClassWarrior)&&(_.value&&function(e,t){e.classList.remove("hide"),new Te(e,t,{id:"show-1h-weapons-selector",extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().oneHandedWeapons,setValue:(e,t,a)=>{const i=t.getFilters();i.oneHandedWeapons=a,t.setFilters(e,i)}})}(_.value,r.sim),x.value&&function(e,t){e.classList.remove("hide"),new Te(e,t,{id:"show-2h-weapons-selector",extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().twoHandedWeapons,setValue:(e,t,a)=>{const i=t.getFilters();i.twoHandedWeapons=a,t.setFilters(e,i)}})}(x.value,r.sim)),D&&(E.value&&function(e,t){new Te(e,t,{id:"show-ep-values-selector",extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:e=>e.showEPValuesChangeEmitter,getValue:e=>e.getShowEPValues(),setValue:(e,t,a)=>{t.setShowEPValues(e,a)}})}(E.value,r.sim),Kn(S.value,{content:wn})),C.value&&(!function(e,t){new Te(e,t,{id:"show-matching-gems-selector",extraCssClasses:["show-matching-gems-selector","input-inline","mb-0"],label:"Match Socket",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().matchingGemsOnly,setValue:(e,t,a)=>{const i=t.getFilters();i.matchingGemsOnly=a,t.setFilters(e,i)}})}(C.value,r.sim),c.startsWith("Gem")||C.value?.classList.add("hide")),k.value&&function(e,t){new Hm(e,t,{id:"phase-selector",extraCssClasses:["phase-selector"],values:[{name:"Phase 1 (Tier 14)",value:1},{name:"Phase 2 (Tier 15)",value:2},{name:"Phase 3 (Tier 16)",value:3}],changedEvent:e=>e.phaseChangeEmitter,getValue:e=>e.getPhase(),setValue:(e,t,a)=>{t.setPhase(e,a)}})}(k.value,r.sim),c===xu.Items){const e=new Cu(i,r,n);I.value?.addEventListener("click",(()=>e.open()))}this.listElem=T.value,this.itemsToDisplay=[],this.scroller=new Eu({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(e,t)=>{const a=[];for(let i=e;i<t&&!(i>=this.itemsToDisplay.length);++i)a.push(this.createItemElem({idx:this.itemsToDisplay[i],data:this.itemData[this.itemsToDisplay[i]]}));return a}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const N=P.value;if(N)switch(N.addEventListener("click",(e=>{g(o.nextEventID())})),c){case xu.Enchants:N.textContent="Remove Enchant";break;case xu.Reforging:N.textContent="Remove Reforge";break;case xu.RandomSuffixes:N.textContent="Remove Random Suffix";break;case xu.Upgrades:N.textContent="Remove Upgrade";break;case xu.Gem1:case xu.Gem2:case xu.Gem3:N.textContent="Remove Gem"}this.updateSelected(),this.searchInput=v.value,this.searchInput.addEventListener("input",(()=>this.applyFilters()))}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}getItemIdByItemType(e){switch(this.label){case xu.Enchants:return e?.effectId;case xu.Reforging:return e?.reforge.id;case xu.Items:case xu.Gem1:case xu.Gem2:case xu.Gem3:case xu.RandomSuffixes:return e?.id;case xu.Upgrades:return e;default:return null}}updateSelected(){const e=this.gearData.getEquippedItem(),t=this.equippedToItemFn(e),a=this.getItemIdByItemType(t),i=null!=t?this.computeEP(t):0;this.scroller.elementUpdate((e=>{const t=e.dataset.idx,s=this.itemData[parseFloat(t)];s.id===a?e.classList.add("active"):e.classList.remove("active");const n=e.querySelector(".selector-modal-list-item-ep-delta");if(n&&(n.textContent="",null!==s.item)){const e=this.computeEP(s.item);i!==e&&x(n,i,e,0)}}))}applyFilters(){this.currentFilters=this.player.sim.getFilters();let e=new Array(this.itemData.length);for(let a=0;a<this.itemData.length;++a)e[a]=a;const t=this.player.getEquippedItem(this.slot);this.label===xu.Items?e=this.player.filterItemData(e,(e=>this.itemData[e].item),this.slot):this.label===xu.Enchants?e=this.player.filterEnchantData(e,(e=>this.itemData[e].item),this.slot,t):this.label!==xu.Gem1&&this.label!==xu.Gem2&&this.label!==xu.Gem3||(e=this.player.filterGemData(e,(e=>this.itemData[e].item),this.slot,this.socketColor)),e=e.filter((e=>{const t=this.itemData[e];if(t.phase>this.player.sim.getPhase())return!1;if(this.searchInput.value.length){const e=e=>e.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,""),a=e(this.searchInput.value).split(" "),i=e(t.name.toString());let s=!0;if(a.some((e=>{i.includes(e)||(s=!1)})),!s)return!1}return!0})),[w.ItemSlotTrinket1,w.ItemSlotTrinket2].includes(this.slot)?this.sortBy=1:this.sortBy=0,e=this.sortIdxs(e),this.itemsToDisplay=e,this.scroller.update(),this.hideOrShowEPValues()}sort(e){this.sortBy===e?this.sortDirection=1-this.sortDirection:this.sortDirection=fn.DESC,this.sortBy=e,this.itemsToDisplay=this.sortIdxs(this.itemsToDisplay),this.scroller.update()}sortIdxs(e){let t=(e,t)=>{const a=this.sortDirection===fn.DESC?t:e,i=this.sortDirection===fn.DESC?e:t,s=this.computeEP(a)-this.computeEP(i);return Math.abs(s)<.01?(a.scalingOptions?.[b.Base].ilvl||a.ilvl)-(i.scalingOptions?.[b.Base].ilvl||i.ilvl):s};if(1===this.sortBy)t=(e,t)=>{const a=this.sortDirection===fn.DESC?t:e,i=this.sortDirection===fn.DESC?e:t;return(a.scalingOptions?.[b.Base].ilvl||a.ilvl)-(i.scalingOptions?.[b.Base].ilvl||i.ilvl)};return e.sort(((e,a)=>{const i=this.itemData[e],s=this.itemData[a];return this.isItemFavorited(i)&&!this.isItemFavorited(s)?-1:this.isItemFavorited(s)&&!this.isItemFavorited(i)?1:t(i.item,s.item)}))}hideOrShowEPValues(){const e=this.tabContent.querySelectorAll(".ep-label"),t=this.tabContent.querySelectorAll(".selector-modal-list"),a=this.player.sim.getShowEPValues(),i=a?"":"none";for(const s of e)s.style.display=i;for(const s of t)a?s.classList.remove("hide-ep"):s.classList.add("hide-ep")}createItemElem(e){const i=e.data,s=this.computeEP(i.item),n=this.equippedToItemFn(this.gearData.getEquippedItem()),l=null!=n,c=this.getItemIdByItemType(n),h=l?this.computeEP(n):0,m=a(),d=a(),p=a(),u=a(),g=a(),f=a(),y=a(),b=a(),v=t("li",{className:"selector-modal-list-item "+(c===i.id?"active":""),dataset:{idx:e.idx.toString()}},t("div",{className:"selector-modal-list-label-cell gap-1",ref:m},t("a",{className:"selector-modal-list-item-link",ref:p,dataset:{whtticon:"false"}},t("img",{className:"selector-modal-list-item-icon",ref:u}),t("label",{className:"selector-modal-list-item-name",ref:d},"string"==typeof i.name?i.name:i.name.cloneNode(!0),i.heroic&&Po()))),this.label===xu.Items&&t("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(i.item,this.player.sim)),(this.label===xu.Items||this.label===xu.Upgrades)&&t("div",{className:"selector-modal-list-item-ilvl-container"},i.ilvl||i.item.ilvl),![w.ItemSlotTrinket1,w.ItemSlotTrinket2].includes(this.slot)&&t("div",{className:"selector-modal-list-item-ep"},t("span",{className:"selector-modal-list-item-ep-value"},s<9.95?s.toFixed(1).toString():Math.round(s).toString()),t("span",{className:"selector-modal-list-item-ep-delta",ref:e=>l&&h!==s&&x(e,h,s,0)})),t("div",{className:"selector-modal-list-item-favorite-container"},t("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:g},t("i",{ref:f,className:"far fa-star fa-xl"}))),t("div",{ref:y,className:"selector-modal-list-item-compare-container hide"},t("button",{className:"selector-modal-list-item-compare btn btn-link p-0",ref:b},t("i",{className:"fas fa-arrow-right-arrow-left fa-xl"})))),S=e=>{const t=this.player.sim.getFilters();let a,s;switch(this.label){case xu.Items:a="favoriteItems",s=i.id;break;case xu.Enchants:a="favoriteEnchants",s=Eo(i.item);break;case xu.Gem1:case xu.Gem2:case xu.Gem3:a="favoriteGems",s=i.id;break;case xu.RandomSuffixes:a="favoriteRandomSuffixes",s=i.id;break;case xu.Reforging:a="favoriteReforges",s=i.id;break;default:return}if(e)t[a].push(s);else{const e=t[a].indexOf(s);-1!==e&&t[a].splice(e,1)}g.value.classList.toggle("text-brand"),f.value.classList.toggle("fas"),f.value.classList.toggle("far"),v.dataset.fav=e.toString(),this.player.sim.setFilters(o.nextEventID(),t)};g.value.addEventListener("click",(()=>S("false"===v.dataset.fav)));this.isItemFavorited(i)?(g.value.classList.add("text-brand"),f.value?.classList.add("fas"),v.dataset.fav="true"):(f.value?.classList.add("far"),v.dataset.fav="false");const I=Kn(g.value);var E;if(E="true"===v.dataset.fav,I.setContent(E?"Remove from favorites":"Add to favorites"),this.label===xu.Items){const e=Kn(b.value);this.bindToggleCompare(y.value);const a=this.simUI instanceof vu?this.simUI:null;if(a){const s=()=>a.bt?.hasItem(_.create({id:i.id})),n=()=>{const t=s();e.setContent(t?"Remove from Batch Sim":"Add to Batch Sim"),b.value.classList[t?"add":"remove"]("text-brand")};n(),a.bt?.itemsChangedEmitter.on((()=>{n()})),b.value.addEventListener("click",(()=>{const e=s();a.bt?.[e?"removeItem":"addItem"](_.create({id:i.id})),new mo({delay:1e3,variant:"success",body:t(r,null,t("strong",null,i.name)," was ",t(r,null,e?"removed from the batch":"added to the batch"),".")})}))}}p.value.addEventListener("click",(e=>{if(e.preventDefault(),e.target===g.value)return!1;this.onItemClick(i)})),i.actionId.fill().then((e=>{e.setWowheadHref(p.value),u.value.src=e.iconUrl})),io(d.value,i.quality);const k=new ko(this.player,{itemId:i.id});return k.hasNotice&&m.value?.appendChild(k.rootElem),v}isItemFavorited(e){return this.label===xu.Items?this.currentFilters.favoriteItems.includes(e.id):this.label===xu.Enchants?this.currentFilters.favoriteEnchants.includes(Eo(e.item)):this.label.startsWith("Gem")?this.currentFilters.favoriteGems.includes(e.id):this.label===xu.RandomSuffixes?this.currentFilters.favoriteRandomSuffixes.includes(e.id):this.label===xu.Reforging&&this.currentFilters.favoriteReforges.includes(e.id)}getSourceInfo(e,a){const i=(e,a)=>t("a",{href:e,target:"_blank",dataset:{whtticon:"false"}},t("small",null,a));if(!e.sources?.length){if(e.randomSuffixOptions.length)return i(`${d.makeItemUrl(e.id)}#dropped-by`,"World Drop");if(yn(e)){const a=bn(e);return a?i(d.makeItemUrl(e.id),t("span",null,a,t("br",null),"PVP")):t(r,null)}return t(r,null)}let s=e.sources[0];if("crafted"===s.source.oneofKind){const t=s.source.crafted;return t.spellId?i(d.makeSpellUrl(t.spellId),Mi.get(t.profession)??"Unknown"):i(d.makeItemUrl(e.id),Mi.get(t.profession)??"Unknown")}if("drop"===s.source.oneofKind){const n=s.source.drop,o=a.db.getZone(n.zoneId),l=a.db.getNpc(n.npcId);if(!o)return console.error("No zone found for item:",e),t(r,null);const c=n.category?` - ${n.category}`:"";return l?i(d.makeNpcUrl(l.id),t("span",null,o.name," (",vn.get(n.difficulty)??"Unknown",")",t("br",null),l.name+c)):n.otherName?i(d.makeZoneUrl(o.id),t("span",null,o.name,t("br",null),n.otherName)):i(d.makeZoneUrl(o.id),o.name)}if("quest"===s.source.oneofKind&&s.source.quest.name){const a=s.source.quest;return i(d.makeQuestUrl(a.id),t("span",null,"Quest",e.factionRestriction===C.ALLIANCE_ONLY&&t("img",{src:"/mop/assets/img/alliance.png",className:"ms-1",width:"15",height:"15"}),e.factionRestriction===C.HORDE_ONLY&&t("img",{src:"/mop/assets/img/horde.png",className:"ms-1",width:"15",height:"15"}),t("br",null),a.name))}if("rep"===(s=e.sources.find((e=>"rep"===e.source.oneofKind))??s).source.oneofKind){const a=e.sources.filter((e=>"rep"===e.source.oneofKind)).map((e=>"rep"===e.source.oneofKind?Sn[e.source.rep.repFactionId]:Sn[In.RepFactionUnknown])),n=s.source.rep,o=En[n.repFactionId];return i(d.makeNpcUrl(o),t(r,null,a.map((a=>t("span",null,a,e.factionRestriction===C.ALLIANCE_ONLY&&t("img",{src:"/mop/assets/img/alliance.png",className:"ms-1",width:"15",height:"15"}),e.factionRestriction===C.HORDE_ONLY&&t("img",{src:"/mop/assets/img/horde.png",className:"ms-1",width:"15",height:"15"}),t("br",null)))),t("span",null,kn[n.repLevel])))}if(yn(e)){const a=bn(e);return a?i(d.makeItemUrl(e.id),t("span",null,a,t("br",null),"PVP")):t(r,null)}if("soldBy"===s.source.oneofKind){const e=s.source.soldBy;return i(d.makeNpcUrl(e.npcId),t("span",null,"Sold by",t("br",null),e.npcName))}return t(r,null)}bindToggleCompare(e){const t=()=>e.classList[this.player.sim.getShowExperimental()?"remove":"add"]("hide");t(),this.player.sim.showExperimentalChangeEmitter.on((()=>{t()}))}}var xu=(e=>(e.Items="Items",e.RandomSuffixes="Random Suffix",e.Enchants="Enchants",e.Reforging="Reforging",e.Upgrades="Upgrades",e.Gem1="Gem1",e.Gem2="Gem2",e.Gem3="Gem3",e))(xu||{});class Tu extends to{constructor(e,a,i,s,n){super(e,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.ilists=[],this.itemSlotTabElems=[],this.currentSlot=w.ItemSlotHead,this.currentTab="Items",this.disabledTabs=[],this.simUI=a,this.player=i,this.gearPicker=s,this.options={id:He(),...n},this.disabledTabs=this.options.disabledTabs||[],this.addItemSlotTabs(),this.header.insertAdjacentElement("afterbegin",t("div",null,t("h6",{className:"selector-modal-title"}),t("ul",{className:"nav nav-tabs selector-modal-tabs"}))),this.body.appendChild(t("div",{className:"tab-content selector-modal-tab-content"})),this.titleElem=this.rootElem.querySelector(".selector-modal-title"),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.body.appendChild(t("div",{className:"d-flex align-items-center form-text"},t("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),t("span",null,"If gear is missing, check the selected phase and your gear filters.",t("br",null),"If the problem persists, save any un-saved data, click the",t("i",{className:"fas fa-cog mx-1"}),'to open your sim options, then click the "Restore Defaults".')))}openTab(e,t,a){this.titleElem.textContent=I.get(e)??"",this.setData(e,t,a),this.setActiveItemSlotTab(e),this.open()}onShow(){if(this.gearPicker){const e=this.switchToPreviousItemSlotTab.bind(this),t=this.switchToNextItemSlotTab.bind(this);document.addEventListener("keydown",e),document.addEventListener("keydown",t),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>document.removeEventListener("keydown",t)))}}setData(e,t,a){this.tabsElem.innerText="",this.contentElem.innerText="",this.ilists=[];const i=a.getEquippedItem(),s=this.player.getItems(e),n=this.player.getEnchants(e),o=!!i?.item&&!!this.player.getAvailableReforgings(i).length,l=!(this.player.getChallengeModeEnabled()||!i?.item)&&i.hasUpgradeOptions();("Enchants"===t&&!n.length||"Reforging"===t&&!o||"Upgrades"===t&&!l||["Gem1","Gem2","Gem3"].includes(t)&&0===i?.numSockets(this.player.isBlacksmithing()))&&(t="Items"),this.currentTab=t,this.currentSlot=e;!this.disabledTabs?.includes("Items")&&this.addTab({id:Cn(`${this.options.id}-Items`),label:"Items",gearData:a,itemData:s.map((e=>{const t=new _n({item:e,challengeMode:this.player.getChallengeModeEnabled()});return{item:e,id:e.id,actionId:t.asActionId(),ilvl:e.scalingOptions?.[b.Base].ilvl||e.ilvl,name:e.name,quality:e.quality,heroic:e.heroic,phase:e.phase,ignoreEPFilter:!1,onEquip:(e,t)=>{const i=a.getEquippedItem();i?a.equipItem(e,i.withItem(t)):a.equipItem(e,new _n({item:t}))}}})),computeEP:t=>this.player.computeItemEP(t,e),equippedToItemFn:e=>e?.item,onRemove:e=>{a.equipItem(e,null),this.removeTabs("Enchants"),this.removeTabs("Random Suffix"),this.removeTabs("Reforging"),this.removeTabs("Upgrades"),this.removeTabs("Gem")}});!this.disabledTabs?.includes("Enchants")&&this.addTab({id:Cn(`${this.options.id}-Enchants`),label:"Enchants",gearData:a,itemData:n.map((e=>({item:e,id:e.effectId,actionId:e.itemId?d.fromItemId(e.itemId):d.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,ignoreEPFilter:!0,heroic:!1,onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withEnchant(t))}}))),computeEP:e=>this.player.computeEnchantEP(e),equippedToItemFn:e=>e?.enchant,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withEnchant(null))}});!this.disabledTabs?.includes("Random Suffix")&&this.addRandomSuffixTab(i,a);!(this.player.getChallengeModeEnabled()||this.disabledTabs?.includes("Upgrades"))&&this.addUpgradesTab(i,a);!this.disabledTabs?.includes("Reforging")&&this.addReforgingTab(i,a);!["Gem1","Gem2","Gem3"].some((e=>this.disabledTabs?.includes(e)))&&this.addGemTabs(e,i,a),this.ilists.find((e=>t===e.label))?.sizeRefresh()}addItemSlotTabs(){this.gearPicker&&this.dialog.prepend(t("div",{className:"gear-picker-modal-slots"},this.gearPicker.itemPickers.map((e=>{const i=a(),s=t("div",{className:"item-picker-icon-wrapper",dataset:{slot:e.slot}},t("a",{ref:i,className:"item-picker-icon",href:"javascript:void(0)",onclick:t=>{t.preventDefault(),e.slot!=this.currentSlot&&e.openSelectorModal(this.currentTab)},dataset:{whtticon:"false"}})),n=()=>{e.item?(this.player.setWowheadData(e.item,i.value),e.item.asActionId().fill().then((e=>{e.setBackgroundAndHref(i.value)}))):i.value.style.backgroundImage=`url('${To(e.slot)}')`};return n(),e.onUpdate((()=>n())),Kn(i.value,{content:`Edit ${I.get(e.slot)}`,placement:"left"}),this.itemSlotTabElems.push(s),s}))))}setActiveItemSlotTab(e){this.itemSlotTabElems.forEach((t=>{t.dataset.slot===e.toString()?t.classList.add("active"):t.classList.contains("active")&&t.classList.remove("active")}))}switchToPreviousItemSlotTab(e){if("ArrowUp"===e.key&&this.gearPicker){e.preventDefault();const t=xn(this.currentSlot-1,Object.keys(w).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}switchToNextItemSlotTab(e){if("ArrowDown"===e.key&&this.gearPicker){e.preventDefault();const t=xn(this.currentSlot+1,Object.keys(w).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}addGemTabs(e,t,a){if(!t)return;const i=this.player.computeStatsEP(new h(t.item.socketBonus))/(t.item.gemSockets.length||1);t.curSocketColors(this.player.isBlacksmithing()).forEach(((e,t)=>{const s=xu[`Gem${t+1}`];this.addTab({id:Cn(`${this.options.id}-${s}`),label:s,gearData:a,itemData:this.player.getGems(e).map((e=>({item:e,id:e.id,actionId:d.fromItemId(e.id),name:e.name,quality:e.quality,phase:e.phase,heroic:!1,ignoreEPFilter:!0,onEquip:(e,i)=>{const s=a.getEquippedItem();s&&a.equipItem(e,s.withGem(i,t))}}))),computeEP:t=>{let a=this.player.computeGemEP(t);return Tn(t,e)&&(a+=i),a},equippedToItemFn:e=>e?.gems[t],onRemove:e=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withGem(null,t))},setTabContent:i=>{const s=Ro(e,null,t);i.appendChild(s),i.classList.add("selector-modal-tab-gem");const n=i.querySelector(".gem-icon"),o=y(e),l=()=>{const e=a.getEquippedItem(),i=e?.gems[t];i?(n.classList.remove("hide"),d.fromItemId(i.id).fill().then((e=>{n.setAttribute("src",e.iconUrl)}))):(n.classList.add("hide"),n.setAttribute("src",o))};a.changeEvent.on(l),this.addOnDisposeCallback((()=>a.changeEvent.off(l))),l()},socketColor:e})}))}addRandomSuffixTab(e,t){if(!e||!e.item.randomSuffixOptions.length)return;const a=e.item;this.addTab({id:Cn(`${this.options.id}-Random Suffix`),label:"Random Suffix",gearData:t,itemData:this.player.getRandomSuffixes(a).map((e=>({item:e,id:e.id,actionId:d.fromRandomSuffix(a,e),name:e.name,quality:a.quality,phase:a.phase,heroic:!1,ignoreEPFilter:!0,onEquip:(e,a)=>{const i=t.getEquippedItem();i&&t.equipItem(e,i.withItem(i.item).withRandomSuffix(a))}}))),computeEP:e=>this.player.computeRandomSuffixEP(e),equippedToItemFn:e=>e?.randomSuffix,onRemove:e=>{const a=t.getEquippedItem();a&&t.equipItem(e,a.withItem(a.item).withRandomSuffix(null)),this.removeTabs("Reforging"),this.removeTabs("Upgrades")}})}addReforgingTab(e,a){if(!e||e.hasRandomSuffixOptions()&&!e.randomSuffix)return;const s=e.item;this.addTab({id:Cn(`${this.options.id}-Reforging`),label:"Reforging",gearData:a,itemData:this.player.getAvailableReforgings(e).map((e=>({item:e,id:e.id,actionId:d.fromReforge(s,e.reforge),name:t("div",null,t("span",{className:"reforge-value negative"},e.fromAmount," ",v.get(e.fromStat)),t("span",{className:"reforge-value positive"},"+",e.toAmount," ",v.get(e.toStat))),quality:i.ItemQualityCommon,phase:s.phase,heroic:!1,ignoreEPFilter:!0,onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withReforge(t.reforge))}}))),computeEP:e=>this.player.computeReforgingEP(e),equippedToItemFn:e=>e?.getReforgeData()||null,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withItem(t.item).withRandomSuffix(t._randomSuffix))}})}addUpgradesTab(e,a){if(!e||!e.hasUpgradeOptions()||e.hasRandomSuffixOptions()&&!e.randomSuffix)return;const s=e.item,n=e.getUpgrades(),o=Object.entries(n),l=o.length-1;this.addTab({id:Cn(`${this.options.id}-Upgrades`),label:"Upgrades",gearData:a,itemData:o.map((([n,o],c)=>{const h=Number(n),m=e.withUpgrade(h);return{item:Number(h),id:Number(h),actionId:d.fromItemId(s.id,0,e._randomSuffix?.id,0,h),name:t(r,null,c>0?t(r,null,"+ ",m.ilvlFromPrevious*c):t(r,null,"Base")," ",t("div",{className:"selector-modal-list-item-upgrade-step-container ms-2"},`(${h}/${l})`)),ilvl:o.ilvl,quality:i.ItemQualityCommon,phase:s.phase,heroic:!1,ignoreEPFilter:!0,onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withUpgrade(t))}}})),computeEP:t=>this.player.computeUpgradeEP(e,t,this.currentSlot),equippedToItemFn:e=>e?._upgrade,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withUpgrade(b.Base))}})}addTab({id:e,label:i,gearData:s,itemData:n,computeEP:l,equippedToItemFn:r,onRemove:c,setTabContent:h,socketColor:m}){if(!n.length)return;const d=i===this.currentTab,p=a();this.tabsElem.appendChild(t("li",{className:"nav-item"},t("button",{ref:p,className:u("nav-link selector-modal-item-tab",d&&"active"),dataset:{label:i,bsToggle:"tab",bsTarget:`#${e}`},attributes:{role:"tab","aria-selected":d}}))),h?h(p.value):p.value.textContent=i;const g=new _u(e,this.contentElem,this.simUI,this.currentSlot,this.currentTab,this.player,i,s,n,m||Pe.GemColorUnknown,l,r,c,(e=>{const t=s.getEquippedItem(),a=e;e.onEquip(o.nextEventID(),a.item);const i=be.is(a.item),n=s.getEquippedItem()||null,l=t?._randomSuffix?.id!==n?.randomSuffix?.id;(i||l)&&(l||(this.removeTabs("Random Suffix"),this.addRandomSuffixTab(n,s)),this.removeTabs("Upgrades"),this.addUpgradesTab(n,s),this.removeTabs("Reforging"),this.addReforgingTab(n,s),this.removeTabs("Gem"),this.addGemTabs(this.currentSlot,n,s))})),f=()=>{g.updateSelected()},w=()=>{g.applyFilters()},y=()=>{g.hideOrShowEPValues()};s.changeEvent.on(f),this.player.sim.phaseChangeEmitter.on(w),this.player.sim.filtersChangeEmitter.on(w),this.player.sim.showEPValuesChangeEmitter.on(y),this.addOnDisposeCallback((()=>{s.changeEvent.off(f),this.player.sim.phaseChangeEmitter.off(w),this.player.sim.filtersChangeEmitter.off(w),this.player.sim.showEPValuesChangeEmitter.off(y),g.dispose()})),p.value.addEventListener("click",(e=>{this.currentTab=i})),p.value.addEventListener("shown.bs.tab",(e=>{g.sizeRefresh()})),this.ilists.push(g)}removeTabs(e){const t=[...this.tabsElem.querySelectorAll(".selector-modal-item-tab")].filter((t=>t.dataset?.label?.includes(e))),a=t.map((e=>document.querySelector(e.dataset.bsTarget))).filter((e=>Boolean(e)));t.forEach((e=>e.parentElement?.remove())),a.forEach((e=>e.remove()))}}class Pu extends e{constructor(e,i,s,n){super(e,"icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.player=s,this.slot=n;const o=a(),l=a();this.rootElem.prepend(t("a",{ref:o,className:"icon-picker-button",href:"#",attributes:{role:"button"}},t("div",{ref:l,className:"item-picker-sockets-container"}))),this.iconAnchor=o.value,this.socketsContainerElem=l.value;const r=new Tu(i.rootElem,i,this.player);s.sim.waitForInit().then((()=>{this.iconAnchor.addEventListener("click",(e=>{e.preventDefault(),r.openTab(this.slot,xu.Items,this.createGearData())}))})),s.itemSwapSettings.changeEmitter.on((()=>{this.update(s.itemSwapSettings.getGear().getEquippedItem(n))}))}update(e){this.iconAnchor.style.backgroundImage=`url('${To(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#",e?(e.asActionId().fillAndSet(this.iconAnchor,!0,!0),this.player.setWowheadData(e,this.iconAnchor),this.socketsContainerElem.replaceChildren(t(r,null,e.allSocketColors().map(((t,a)=>{const i=Ro(t,e.gems[a],a);if(a===e.numPossibleSockets-1&&[S.ItemTypeWrist,S.ItemTypeHands].includes(e.item.type)){const e=()=>{i.classList[this.player.isBlacksmithing()?"remove":"add"]("hide")};this.player.professionChangeEmitter.on(e),e()}return i})))),this.iconAnchor.classList.add("active")):(this.socketsContainerElem.replaceChildren(),this.iconAnchor.classList.remove("active"))}createGearData(){return{equipItem:(e,t)=>{this.player.itemSwapSettings.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.itemSwapSettings.getItem(this.slot),changeEvent:this.player.itemSwapSettings.changeEmitter}}}class Ru{constructor(e){this.changeEmitter=new o("PlayerItemSwap"),this.enableItemSwap=!1,this.gear=new Pn({}),this.bonusStats=new h,this.player=e}setItemSwapSettings(e,t,a,i){this.enableItemSwap=t,this.gear=a,this.bonusStats=i||new h,this.changeEmitter.emit(e)}setBonusStats(e,t){this.bonusStats=t,this.changeEmitter.emit(e)}getBonusStats(){return this.bonusStats}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(e,t){t!=this.enableItemSwap&&(this.enableItemSwap=t,this.changeEmitter.emit(e))}equipItem(e,t,a){this.setGear(e,this.gear.withEquippedItem(t,a,this.player.canDualWield2H()))}getItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.changeEmitter.emit(e))}toProto(){return $i.create({prepullBonusStats:this.bonusStats.toProto(),items:this.gear.asArray().map((e=>e?e.asSpec():_.create()))})}}class Du extends e{constructor(e,i,n,l){super(e,"item-swap-picker-root"),this.itemSlots=l.itemSlots,new Te(this.rootElem,n,{id:"enable-item-swap",reverse:!0,label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:e=>e.itemSwapSettings.getEnableItemSwap(),setValue(e,t,a){t.itemSwapSettings.setEnableItemSwap(e,a)},changedEvent:e=>e.itemSwapSettings.changeEmitter});const c=a(),h=a(),m=a(),d=s.newGroupContainer("icon-group");this.rootElem.appendChild(t(r,null,t("div",{ref:c,className:"input-root input-inline input-item-swap-container"},t("label",{className:"form-label"},"Item Swap"),t("button",{ref:h,className:"gear-swap-icon"},t("i",{className:"fas fa-arrows-rotate me-1"})),d),l.note&&t("p",{ref:m,className:"form-text"},l.note)));const p=()=>{n.itemSwapSettings.getEnableItemSwap()?(c.value?.classList.remove("hide"),m.value?.classList.remove("hide")):(c.value?.classList.add("hide"),m.value?.classList.add("hide"))};n.itemSwapSettings.changeEmitter.on(p),p(),h.value&&(h.value.addEventListener("click",(e=>this.swapWithGear(o.nextEventID(),n))),Kn(h.value,{content:"Swap with equipped items"}));const u=t(r,null);this.itemSlots.forEach((e=>{new Pu(u,i,n,e)})),d.appendChild(u)}swapWithGear(e,t){let a=t.getGear(),i=t.itemSwapSettings.getGear();this.itemSlots.forEach((e=>{const s=t.getGear().getEquippedItem(e),n=t.itemSwapSettings.getGear().getEquippedItem(e);a=a.withEquippedItem(e,n,t.canDualWield2H()),i=i.withEquippedItem(e,s,t.canDualWield2H())})),o.freezeAllAndDo((()=>{t.setGear(e,a),t.itemSwapSettings.setGear(e,i)}))}}class Nu{constructor(){this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(e){let t=e.spells.map((e=>({data:e,id:d.fromProto(e.id)}))),a=e.auras.map((e=>({data:e,id:d.fromProto(e.id)})));await Promise.all([...t,...a].map((e=>e.id.fill().then((t=>e.id=t))))),t=t.sort(((e,t)=>G(e.id.name,t.id.name))),a=a.sort(((e,t)=>G(e.id.name,t.id.name)));let i=!1;return e.name!=this.name&&(this.name=e.name,i=!0),(t.length!=this.spells.length||t.some(((e,t)=>!e.id.equals(this.spells[t].id))))&&(this.spells=t,i=!0),(a.length!=this.auras.length||a.some(((e,t)=>!e.id.equals(this.auras[t].id))))&&(this.auras=a,i=!0),i}}class Gu{constructor(){this.metadatas=[]}async update(e){const t=this.metadatas.length;if(e.length>t)for(let i=t;i<e.length;i++)this.metadatas.push(new Nu);else e.length<t&&(this.metadatas=this.metadatas.slice(0,e.length));const a=await Promise.all(e.map(((e,t)=>this.metadatas[t].update(e))));return t!=this.metadatas.length||a.some((e=>e))}asList(){return this.metadatas.slice()}}const Uu={};function Ou(e){const t=Uu[e];if(t.secondaryResource=Jt.create(e),!t)throw new Error("No config registered for Spec: "+e);return t}const Au=class e{constructor(t,a){this.name="",this.buffs=Yi.create(),this.consumables=Ki.create(),this.bonusStats=new h,this.gear=new Rn({}),this.profession1=0,this.profession2=0,this.aplRotation=Me.create(),this.talentsString="",this.glyphs=me.create(),this.reactionTime=0,this.channelClipDelay=0,this.inFrontOfTarget=!1,this.distanceFromTarget=0,this.healingModel=ze.create(),this.healingEnabled=!1,this.challengeModeEnabled=!1,this.autoRotationGenerator=null,this.simpleRotationGenerator=null,this.itemEPCache=new Array,this.gemEPCache=new Map,this.randomSuffixEPCache=new Map,this.enchantEPCache=new Map,this.upgradeEPCache=new Map,this.talents=null,this.epRatios=new Array(e.numEpRatios).fill(0),this.epWeights=new h,this.statCaps=new h,this.softCapBreakpoints=[],this.breakpointLimits=new h,this.currentStats=Dn.create(),this.metadata=new Nu,this.petMetadatas=new Gu,this.nameChangeEmitter=new o("PlayerName"),this.buffsChangeEmitter=new o("PlayerBuffs"),this.consumesChangeEmitter=new o("PlayerConsumes"),this.bonusStatsChangeEmitter=new o("PlayerBonusStats"),this.gearChangeEmitter=new o("PlayerGear"),this.professionChangeEmitter=new o("PlayerProfession"),this.raceChangeEmitter=new o("PlayerRace"),this.rotationChangeEmitter=new o("PlayerRotation"),this.talentsChangeEmitter=new o("PlayerTalents"),this.glyphsChangeEmitter=new o("PlayerGlyphs"),this.specOptionsChangeEmitter=new o("PlayerSpecOptions"),this.inFrontOfTargetChangeEmitter=new o("PlayerInFrontOfTarget"),this.distanceFromTargetChangeEmitter=new o("PlayerDistanceFromTarget"),this.healingModelChangeEmitter=new o("PlayerHealingModel"),this.epWeightsChangeEmitter=new o("PlayerEpWeights"),this.statCapsChangeEmitter=new o("StatCaps"),this.softCapBreakpointsChangeEmitter=new o("SoftCapBreakpoints"),this.breakpointLimitsChangeEmitter=new o("BreakpointLimits"),this.miscOptionsChangeEmitter=new o("PlayerMiscOptions"),this.challengeModeChangeEmitter=new o("ChallengeMode"),this.currentStatsEmitter=new o("PlayerCurrentStats"),this.epRatiosChangeEmitter=new o("PlayerEpRatios"),this.epRefStatChangeEmitter=new o("PlayerEpRefStat"),this.sim=a,this.party=null,this.raid=null,this.playerSpec=t,this.playerClass=U.getPlayerClass(t),this.race=this.playerClass.races[0],this.specTypeFunctions=ne[this.getSpec()],this.specOptions=this.specTypeFunctions.optionsCreate();const i=Ou(this.getSpec());this.secondaryResource=i.secondaryResource,this.autoRotationGenerator=i.autoRotation,i.simpleRotation?this.simpleRotationGenerator=i.simpleRotation:this.simpleRotationGenerator=null,this.hiddenMCDs=i.hiddenMCDs||new Array;for(let e=0;e<w.ItemSlotOffHand+1;++e)this.itemEPCache[e]=new Map;this.itemSwapSettings=new Ru(this),this.bindChallengeModeChange(),this.changeEmitter=o.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.glyphsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter,this.statCapsChangeEmitter,this.breakpointLimitsChangeEmitter,this.challengeModeChangeEmitter],"PlayerChange")}bindChallengeModeChange(){this.challengeModeChangeEmitter.on((()=>{this.setGear(o.nextEventID(),this.gear.withChallengeMode(this.challengeModeEnabled))}))}getSpecIcon(){return this.playerSpec.getIcon("medium")}getPlayerSpec(){return this.playerSpec}getSpec(){return this.getPlayerSpec().specID}getPlayerClass(){return this.playerClass}getClass(){return this.playerSpec.classID}getClassColor(){return this.playerClass.hexColor}canEnableTargetDummies(){return[se.ClassDruid,se.ClassPaladin,se.ClassPriest,se.ClassShaman].includes(this.getClass())}shouldEnableTargetDummies(){if(this.getPlayerSpec().isHealingSpec)return!0;if(!this.itemSwapSettings.getEnableItemSwap())return!1;return this.itemSwapSettings.getGear().hasTrinketFromOptions([72898,77969,77204,77989])}isSpec(e){return this.getSpec()==e}isClass(e){return this.getClass()==e}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null==this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null==this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(e){null==e?(this.party=null,this.raid=null):(this.party=e,this.raid=e.raid)}getOtherPartyMembers(){return null==this.party?[]:this.party.getPlayers().filter((e=>null!=e&&e!=this))}getItems(e){return this.sim.db.getItems(e).filter((t=>k(t,this.playerSpec,e)))}getRandomSuffixes(e){return e.randomSuffixOptions.map((e=>this.sim.db.getRandomSuffixById(e))).filter((e=>!!e&&this.computeRandomSuffixEP(e)>0))}getAvailableReforgings(e){return this.sim.db.getAvailableReforges(e.item).map((t=>e.getReforgeData(t)))}getReforge(e){return this.sim.db.getReforgeById(e)}getEnchants(e){return this.sim.db.getEnchants(e).filter((e=>Nn(e,this.playerSpec)))}getGems(e){return this.sim.db.getGems(e)}getEpWeights(){return this.epWeights}setEpWeights(e,t){this.epWeights=t,this.epWeightsChangeEmitter.emit(e),this.gemEPCache=new Map,this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map,this.upgradeEPCache=new Map;for(let a=0;a<w.ItemSlotOffHand+1;++a)this.itemEPCache[a]=new Map}getStatCaps(){return this.statCaps}setStatCaps(e,t){this.statCaps=t,this.statCapsChangeEmitter.emit(e)}getSoftCapBreakpoints(){return this.softCapBreakpoints}setSoftCapBreakpoints(e,t){this.softCapBreakpoints=t,this.softCapBreakpointsChangeEmitter.emit(e)}getBreakpointLimits(){return this.breakpointLimits}setBreakpointLimits(e,t){this.breakpointLimits=t,this.breakpointLimitsChangeEmitter.emit(e)}getDefaultEpRatios(t,a){const i=new Array(e.numEpRatios).fill(0);return a?i[1]=1:t?(i[2]=1,i[3]=1,this.getSpec()==f.SpecBloodDeathKnight&&(i[1]=1)):i[0]=1,i}getEpRatios(){return this.epRatios.slice()}setEpRatios(e,t){this.epRatios=t,this.epRatiosChangeEmitter.emit(e)}async computeStatWeights(e,t,a,i,s){try{const e=await this.sim.statWeights(this,t,a,i,s);return e.error?(e.error.type==ke.ErrorOutcomeAborted&&new mo({variant:"info",body:"Statweight sim cancelled."}),null):e}catch(n){return console.error(n),new mo({variant:"error",body:n?.message||"Something went wrong calculating your stat weights. Reload the page and try again."}),null}}getCurrentStats(){return Dn.clone(this.currentStats)}setCurrentStats(e,t){this.currentStats=t,this.currentStatsEmitter.emit(e)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const e=this.metadata.update(this.currentStats.metadata),t=this.petMetadatas.update(this.currentStats.pets.map((e=>e.metadata))),a=await e,i=await t;return a||i}getName(){return this.name}setName(e,t){t!=this.name&&(this.name=t,this.nameChangeEmitter.emit(e))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(e,t){t!=this.race&&(this.race=t,this.raceChangeEmitter.emit(e))}getProfession1(){return this.profession1}setProfession1(e,t){t!=this.profession1&&(this.profession1=t,this.professionChangeEmitter.emit(e))}getProfession2(){return this.profession2}setProfession2(e,t){t!=this.profession2&&(this.profession2=t,this.professionChangeEmitter.emit(e))}getProfessions(){return[this.profession1,this.profession2].filter((e=>e!=he.ProfessionUnknown))}setProfessions(e,t){o.freezeAllAndDo((()=>{this.setProfession1(e,t[0]||he.ProfessionUnknown),this.setProfession2(e,t[1]||he.ProfessionUnknown)}))}hasProfession(e){return this.getProfessions().includes(e)}isBlacksmithing(){return this.hasProfession(he.Blacksmithing)}getFaction(){return Gn[this.getRace()]}getBuffs(){return Yi.clone(this.buffs)}setBuffs(e,t){Yi.equals(this.buffs,t)||(this.buffs=Yi.clone(t),this.buffsChangeEmitter.emit(e))}getConsumes(){return Ki.clone(this.consumables)}setConsumes(e,t){Ki.equals(this.consumables,t)||(this.consumables=Ki.clone(t),this.consumesChangeEmitter.emit(e))}canDualWield2H(){return this.getSpec()==f.SpecFuryWarrior}equipItem(e,t,a){this.setGear(e,this.gear.withEquippedItem(t,a,this.canDualWield2H()))}getEquippedItem(e){return this.gear.getEquippedItem(e)}getEquippedItems(){return this.gear.getEquippedItems()}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.gearChangeEmitter.emit(e))}getBonusStats(){return this.bonusStats}setBonusStats(e,t){t.equals(this.bonusStats)||(this.bonusStats=t,this.bonusStatsChangeEmitter.emit(e))}getMeleeCritCapInfo(){const e=this.currentStats.finalStats?.pseudoStats[Ge.PseudoStatPhysicalCritPercent]||0,t=this.currentStats.finalStats?.pseudoStats[Ge.PseudoStatPhysicalHitPercent]||0,a=(this.currentStats.finalStats?.stats[l.StatExpertiseRating]||0)/Un/4,i=void 0!==this.getGear().getEquippedItem(w.ItemSlotOffHand)?.item.weaponSpeed,s=i&&this.getClass()!=se.ClassWarrior?27:8,n=this.getInFrontOfTarget()?14:0,o=6.5+n,r=Math.max(s-t,0),c=Math.max(6.5-a,0)+Math.max(n-a,0),h=80.8-r-c-0;return{meleeCrit:e,meleeHit:t,expertise:a,suppression:4.8,glancing:24,hasOffhandWeapon:i,meleeHitCap:s,expertiseCap:o,remainingMeleeHitCap:r,remainingExpertiseCap:c,baseCritCap:h,specSpecificOffset:0,playerCritCapDelta:e-h}}getMeleeCritCap(){return this.getMeleeCritCapInfo().playerCritCapDelta}setAplRotation(e,t){Me.equals(t,this.aplRotation)||(this.aplRotation=Me.clone(t),this.rotationChangeEmitter.emit(e))}getSimpleRotation(){const e=this.aplRotation.simple?.specRotationJson||"";if(!e)return this.specTypeFunctions.rotationCreate();try{const t=JSON.parse(e);return this.specTypeFunctions.rotationFromJson(t)}catch(t){return console.warn(`Error parsing rotation spec options: ${t}\n\nSpec options: '${e}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(e,t){this.specTypeFunctions.rotationEquals(t,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=On.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(t)),this.rotationChangeEmitter.emit(e))}getSimpleCooldowns(){return hn.clone(this.aplRotation.simple?.cooldowns||hn.create())}setSimpleCooldowns(e,t){hn.equals(this.getSimpleCooldowns(),t)||(this.aplRotation.simple||(this.aplRotation.simple=On.create()),this.aplRotation.simple.cooldowns=t,this.rotationChangeEmitter.emit(e))}getRotationType(){return this.aplRotation.type==Fe.TypeUnknown?Fe.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!=this.simpleRotationGenerator}getResolvedAplRotation(){const e=this.getRotationType();if(e==Fe.TypeAuto&&this.autoRotationGenerator){const e=Me.clone(this.autoRotationGenerator(this));return e.type=Fe.TypeAuto,e}if(e==Fe.TypeSimple&&this.simpleRotationGenerator){const e=this.getSimpleRotation(),t=Me.clone(this.simpleRotationGenerator(this,e,this.getSimpleCooldowns()));return t.simple=this.aplRotation.simple,t.type=Fe.TypeSimple,t}return this.aplRotation}getTalents(){return null==this.talents&&(this.talents=Tl(this.playerSpec,this.talentsString)),this.talents}getTalentsString(){return this.talentsString}setTalentsString(e,t){t!=this.talentsString&&(this.talentsString=t,this.talents=null,this.talentsChangeEmitter.emit(e))}getTalentTreePoints(){return An(this.getTalentsString())}getTalentTreeIcon(){return this.playerSpec.getIcon("medium")}getGlyphs(){return me.clone(this.glyphs)}setGlyphs(e,t){me.equals(this.glyphs,t)||(this.glyphs=me.clone(t),this.glyphsChangeEmitter.emit(e))}getMajorGlyphs(){return[this.glyphs.major1,this.glyphs.major2,this.glyphs.major3].filter((e=>0!=e))}getMinorGlyphs(){return[this.glyphs.minor1,this.glyphs.minor2,this.glyphs.minor3].filter((e=>0!=e))}getAllGlyphs(){return this.getMajorGlyphs().concat(this.getMinorGlyphs())}getClassOptions(){return this.getSpecOptions().classOptions}setClassOptions(e,t){const a=this.getSpecOptions();a.classOptions=t,this.specTypeFunctions.optionsEquals(a,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(a),this.specOptionsChangeEmitter.emit(e))}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(e,t){this.specTypeFunctions.optionsEquals(t,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(t),this.specOptionsChangeEmitter.emit(e))}getReactionTime(){return this.reactionTime}setReactionTime(e,t){t!=this.reactionTime&&(this.reactionTime=t,this.miscOptionsChangeEmitter.emit(e))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(e,t){t!=this.channelClipDelay&&(this.channelClipDelay=t,this.miscOptionsChangeEmitter.emit(e))}getChallengeModeEnabled(){return this.challengeModeEnabled}setChallengeModeEnabled(e,t){t!==this.challengeModeEnabled&&(this.challengeModeEnabled=t,this.challengeModeChangeEmitter.emit(e))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(e,t){t!=this.inFrontOfTarget&&(this.inFrontOfTarget=t,this.inFrontOfTargetChangeEmitter.emit(e))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(e,t){t!=this.distanceFromTarget&&(this.distanceFromTarget=t,this.distanceFromTargetChangeEmitter.emit(e))}setDefaultHealingParams(e){const t=this.sim.encounter.primaryTarget,a=t.dualWield;if(0==e.cadenceSeconds){let i=1.5*t.swingSpeed;a&&(i/=2),e.cadenceSeconds=.4,e.cadenceVariation=i-e.cadenceSeconds}0==e.hps&&(e.hps=.25*t.minBaseDamage/t.swingSpeed,a&&(e.hps*=1.5))}enableHealing(){this.healingEnabled=!0;const e=this.getHealingModel();0!=e.cadenceSeconds&&0!=e.hps||(this.setDefaultHealingParams(e),this.setHealingModel(0,e))}getHealingModel(){return ze.clone(this.healingModel)}setHealingModel(e,t){ze.equals(this.healingModel,t)||(this.healingModel=ze.clone(t),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(e))}computeStatsEP(e){return null==e?0:e.computeEP(this.epWeights)}computeGemEP(e){if(this.gemEPCache.has(e.id))return this.gemEPCache.get(e.id);const t=this.computeStatsEP(new h(e.stats)),a=Ln(this.playerSpec,e,h.fromProto(this.currentStats.finalStats));let i=0;e.unique&&(i-=.01);const s=t+a+i;return this.gemEPCache.set(e.id,s),s}computeEnchantEP(e){if(this.enchantEPCache.has(e.effectId))return this.enchantEPCache.get(e.effectId);const t=this.computeStatsEP(new h(e.stats));return this.enchantEPCache.set(e.effectId,t),t}computeRandomSuffixEP(e){if(this.randomSuffixEPCache.has(e.id))return this.randomSuffixEPCache.get(e.id);const t=this.computeStatsEP(new h(e.stats));return this.randomSuffixEPCache.set(e.id,t),t}computeReforgingEP(e){let t=new h([]);return t=t.addStat(e.fromStat,e.fromAmount),t=t.addStat(e.toStat,e.toAmount),this.computeStatsEP(t)}computeUpgradeEP(e,t,a){const i=`${e.id}-${a}-${e.randomSuffix?.id}-${t}`;if(this.upgradeEPCache.has(i))return this.upgradeEPCache.get(i);const s=e.withUpgrade(t).calcStats(a),n=this.computeStatsEP(s);return this.upgradeEPCache.set(i,n),n}computeItemEP(e,t){if(null==e)return 0;const a=`${e.id}-${this.challengeModeEnabled}`,i=this.itemEPCache[t].get(a);if(void 0!==i)return i;const s=new _n({item:e,challengeMode:this.challengeModeEnabled}).withDynamicStats(),n=s.calcStats(t);let o=0;if(e.randomSuffixOptions.length>0){const e=s.item.randomSuffixOptions.map((e=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(e)||0)));o=Math.max(...e)*s.item.randPropPoints/1e4}let l=n.computeEP(this.epWeights)+o;e.unique&&(l-=.01);const r=ys(e.gemSockets.map((e=>{const t=this.sim.db.getGems(e).filter((e=>Vn(e,this.sim.getPhase())));return t.length>0?Math.max(...t.map((e=>this.computeGemEP(e)))):0}))),c=ys(e.gemSockets.map((e=>{const t=this.sim.db.getGems(e).filter((t=>Vn(t,this.sim.getPhase())&&Tn(t,e)));return t.length>0?Math.max(...t.map((e=>this.computeGemEP(e)))):0})))+this.computeStatsEP(new h(e.socketBonus));return l+=Math.max(c,r),this.itemEPCache[t].set(a,l),l}async setWowheadData(e,t){const a=this.hasProfession(he.Blacksmithing),i=e.gems.length?e.curGems(a).map((e=>e?e.id:0)):[];e.asActionId().setWowheadDataset(t,{gemIds:i,itemLevel:Number(e.ilvl),enchantId:e.enchant?.effectId,reforgeId:e.reforge?.id,randomEnchantmentId:e.randomSuffix?.id,setPieceIds:this.gear.asArray().filter((e=>null!=e)).map((e=>e.item.id)),hasExtraSocket:e.hasExtraSocket(a),upgradeStep:e.upgrade}),t.dataset.whtticon="false"}get armorSpecializationArmorType(){return this.playerClass.armorTypes[0]}hasArmorSpecializationBonus(){return[w.ItemSlotHead,w.ItemSlotShoulder,w.ItemSlotChest,w.ItemSlotWrist,w.ItemSlotHands,w.ItemSlotWaist,w.ItemSlotLegs,w.ItemSlotFeet].some((e=>{const t=this.getEquippedItem(e)?.item;if(!t)return!1;return t.armorType!==this.armorSpecializationArmorType}))}filterItemData(t,a,i){const s=this.sim.getFilters(),n=(e,t)=>e.filter((e=>t(a(e))));0!=s.minIlvl&&(t=n(t,(e=>(e.scalingOptions?.[b.Base].ilvl||e.ilvl)>=s.minIlvl))),0!=s.maxIlvl&&(t=n(t,(e=>(e.scalingOptions?.[b.Base].ilvl||e.ilvl)<=s.maxIlvl))),s.factionRestriction!=C.UNSPECIFIED&&(t=n(t,(e=>e.factionRestriction==s.factionRestriction||e.factionRestriction==C.UNSPECIFIED))),s.sources.includes(Xs.SourceCrafting)||(t=n(t,(e=>!e.sources.some((e=>"crafted"==e.source.oneofKind))))),s.sources.includes(Xs.SourceQuest)||(t=n(t,(e=>!e.sources.some((e=>"quest"==e.source.oneofKind))))),s.sources.includes(Xs.SourceReputation)||(t=n(t,(e=>!e.sources.some((e=>"rep"==e.source.oneofKind))))),s.sources.includes(Xs.SourcePvp)||(t=n(t,(e=>!yn(e))));for(const[o,l]of Object.entries(e.DIFFICULTY_SRCS)){const a=parseInt(o);if(!s.sources.includes(a)&&(t=n(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.difficulty==l)))),l==Fn.DifficultyRaid10H||l==Fn.DifficultyRaid25H)){const a=e.HEROIC_TO_NORMAL[l];t=n(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.difficulty==a&&e.source.drop.category==Hn))))}}for(const[o,l]of Object.entries(e.RAID_IDS)){const e=parseInt(o);s.raids.includes(e)||(t=n(t,(e=>!e.sources.some((e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==l)))))}return e.ARMOR_SLOTS.includes(i)?t=n(t,(e=>!!s.armorTypes.includes(e.armorType))):e.WEAPON_SLOTS.includes(i)&&(t=n(t,(e=>{if(e.handType==on.HandTypeUnknown&&e.rangedWeaponType==Qs.RangedWeaponTypeUnknown)return!1;if(!s.weaponTypes.includes(e.weaponType)&&e.handType>on.HandTypeUnknown)return!1;if(!s.oneHandedWeapons&&e.handType!=on.HandTypeTwoHand)return!1;if(!s.twoHandedWeapons&&e.handType==on.HandTypeTwoHand)return!1;if(!s.rangedWeaponTypes.includes(e.rangedWeaponType)&&e.rangedWeaponType>Qs.RangedWeaponTypeUnknown)return!1;let t=i==w.ItemSlotMainHand?s.minMhWeaponSpeed:s.minOhWeaponSpeed,a=i==w.ItemSlotMainHand?s.maxMhWeaponSpeed:s.maxOhWeaponSpeed;return e.rangedWeaponType>0&&(t=s.minRangedWeaponSpeed,a=s.maxRangedWeaponSpeed),!(t>0&&e.weaponSpeed<t)&&!(a>0&&e.weaponSpeed>a)}))),t}filterEnchantData(e,t,a,i){return i?e.filter((e=>{const a=t(e);return!!Mn(a,i.item)})):e}filterGemData(e,t,a,i){const s=this.sim.getFilters(),n=this.hasProfession(he.Jewelcrafting);return e.filter((e=>{const a=t(e);return!(!n&&a.requiredProfession==he.Jewelcrafting)&&!(s.matchingGemsOnly&&!Tn(a,i))}))}makeUnitReference(){return null==this.party?Zi():Wn(this.getRaidIndex())}toDatabase(){const e=this.getGear().toDatabase(this.sim.db),t=this.itemSwapSettings.getGear().toDatabase(this.sim.db);return D.mergeSimDatabases(e,t)}toProto(e,t,a){const i=e=>!a||0==a.length||a.includes(e),s=this.getGear(),n=t?this.getResolvedAplRotation():zn(this.aplRotation,["uuid"]);let o=fs.create({class:this.getClass(),database:e?void 0:this.toDatabase()});return i(jo.Gear)&&fs.mergePartial(o,{equipment:s.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.itemSwapSettings.getEnableItemSwap(),itemSwap:this.itemSwapSettings.toProto()}),i(jo.Talents)&&fs.mergePartial(o,{talentsString:this.getTalentsString(),glyphs:this.getGlyphs()}),i(jo.Rotation)&&fs.mergePartial(o,{cooldowns:hn.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:n}),i(jo.Consumes)&&fs.mergePartial(o,{consumables:this.getConsumes()}),i(jo.Miscellaneous)&&(fs.mergePartial(o,{name:this.getName(),race:this.getRace(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel(),challengeMode:this.getChallengeModeEnabled()}),o=jn(this.getSpec(),o,this.getSpecOptions())),i(jo.External)&&fs.mergePartial(o,{buffs:this.getBuffs()}),o}fromProto(t,a,i){o.freezeAllAndDo((()=>{e.updateProtoVersion(a);const s=e=>!i||0==i.length||i.includes(e);t=o.nextEventID(),s(jo.Gear)&&(this.setGear(t,a.equipment?this.sim.db.lookupEquipmentSpec(a.equipment):new Rn({})),this.itemSwapSettings.setItemSwapSettings(t,a.enableItemSwap,a.itemSwap?this.sim.db.lookupItemSwap(a.itemSwap):new Pn({}),h.fromProto(a.itemSwap?.prepullBonusStats)),this.setBonusStats(t,h.fromProto(a.bonusStats||Be.create()))),s(jo.Talents)&&(this.setTalentsString(t,a.talentsString),this.setGlyphs(t,a.glyphs||me.create())),s(jo.Rotation)&&(a.rotation?.type==Fe.TypeUnknown&&(a.rotation||(a.rotation=Me.create()),a.rotation.type=Fe.TypeAuto),this.setAplRotation(t,a.rotation||Me.create())),s(jo.Consumes)&&this.setConsumes(t,a.consumables||Ki.create()),s(jo.Miscellaneous)&&(this.setSpecOptions(t,this.specTypeFunctions.optionsFromPlayer(a)),this.setName(t,a.name),this.setRace(t,a.race),this.setProfession1(t,a.profession1),this.setProfession2(t,a.profession2),this.setReactionTime(t,a.reactionTimeMs),this.setChannelClipDelay(t,a.channelClipDelayMs),this.setInFrontOfTarget(t,a.inFrontOfTarget),this.setDistanceFromTarget(t,a.distanceFromTarget),this.setHealingModel(t,a.healingModel||ze.create()),this.setChallengeModeEnabled(t,a.challengeMode)),s(jo.External)&&this.setBuffs(t,a.buffs||Yi.create())}))}clone(t){const a=new e(this.playerSpec,this.sim);return a.fromProto(t,this.toProto()),a}applySharedDefaults(e){o.freezeAllAndDo((()=>{this.setReactionTime(e,100),this.setInFrontOfTarget(e,this.playerSpec.isTankSpec),this.setHealingModel(e,ze.create({burstWindow:this.playerSpec.isTankSpec?6:0})),this.setSimpleCooldowns(e,hn.create({hpPercentForDefensives:this.playerSpec.isTankSpec?.4:0})),this.setBonusStats(e,new h)}))}getBaseMastery(){switch(this.playerSpec.specID){case f.SpecFrostMage:case f.SpecFuryWarrior:return 2;default:return 8}}getMasteryPerPointModifier(){return Bn.get(this.getSpec())||0}static updateProtoVersion(e){e.apiVersion}};Au.numEpRatios=6,Au.ARMOR_SLOTS=[w.ItemSlotHead,w.ItemSlotShoulder,w.ItemSlotChest,w.ItemSlotWrist,w.ItemSlotHands,w.ItemSlotLegs,w.ItemSlotWaist,w.ItemSlotFeet],Au.WEAPON_SLOTS=[w.ItemSlotMainHand,w.ItemSlotOffHand],Au.DIFFICULTY_SRCS={[Xs.SourceDungeon]:Fn.DifficultyNormal,[Xs.SourceDungeonH]:Fn.DifficultyHeroic,[Xs.SourceRaidRF]:Fn.DifficultyRaid25RF,[Xs.SourceRaid]:Fn.DifficultyRaid25,[Xs.SourceRaidH]:Fn.DifficultyRaid25H},Au.HEROIC_TO_NORMAL={[Fn.DifficultyHeroic]:Fn.DifficultyNormal,[Fn.DifficultyRaid10H]:Fn.DifficultyRaid10,[Fn.DifficultyRaid25H]:Fn.DifficultyRaid25},Au.RAID_IDS={[en.RaidIcecrownCitadel]:4812,[en.RaidRubySanctum]:4987,[en.RaidBlackwingDescent]:5094,[en.RaidTheBastionOfTwilight]:5334,[en.RaidBaradinHold]:5600,[en.RaidThroneOfTheFourWinds]:5638,[en.RaidFirelands]:5723,[en.RaidDragonSoul]:5892};let Lu=Au;const Vu=(e,t,a)=>{const i=N.fromJson(t);return Fu(e,i,a||{})},Fu=(e,t,a)=>{const i=[];return void 0!==a.faction&&i.push((e=>e.getFaction()==a.faction)),void 0!==a.customCondition&&i.push(a.customCondition),{name:e,tooltip:a.tooltip||qn,gear:t,enableWhen:i.length?e=>i.every((t=>t(e))):void 0,onLoad:a?.onLoad}},Mu=(e,t,a)=>Wu(e,t,a||{}),Wu=(e,t,a)=>{const i=[];return void 0!==a?.customCondition&&i.push(a.customCondition),{name:e,epWeights:t,enableWhen:i.length?e=>i.every((t=>t(e))):void 0,onLoad:a?.onLoad}},zu=(e,t,a)=>{const i=Di.create({rotation:Me.fromJson(t)});return Bu(e,i,a)},ju=(e,t,a,i)=>{const s=t==f.SpecBloodDeathKnight||t==f.SpecGuardianDruid||t==f.SpecProtectionPaladin||t==f.SpecProtectionWarrior,n=Di.create({rotation:{type:Fe.TypeSimple,simple:{specRotationJson:JSON.stringify(ne[t].rotationToJson(a)),cooldowns:hn.create({hpPercentForDefensives:s?.4:0})}}});return Bu(e,n,i)},Bu=(e,t,a)=>{const i=[];return null!=a?.talents&&i.push((e=>(a.talents||[]).join("")===e.getTalentTreePoints().join(""))),{name:e,rotation:t,enableWhen:i.length?e=>i.every((t=>t(e))):void 0,onLoad:a?.onLoad}},Hu=(e,t,a)=>{let i,s,n,o,l,r;if("string"==typeof t){const e=Hh.tryParseUrlLocation(new URL(t)),a=e?.settings;a?.encounter&&Dd.updateProtoVersion(a.encounter),t=a?.encounter,i=a?.player?.healingModel,s=a?.tanks,n=a?.raidBuffs,o=a?.debuffs,l=a?.player?.buffs,r=a?.player?.consumables}return{name:e,encounter:t,tanks:s,healingModel:i,raidBuffs:n,debuffs:o,buffs:l,consumes:r,...a}},qu=(e,t)=>{const a=$i.fromJson(t);return Yu(e,a)},Yu=(e,t)=>({name:e,itemSwap:t}),Ku=(e,{gear:t,itemSwap:a,talents:i,rotation:s,rotationType:n,epWeights:o,encounter:l,race:r})=>({name:e,itemSwap:a,gear:t,talents:i,rotation:s,rotationType:n,epWeights:o,encounter:l,race:r}),$u=(e,a,i)=>{const s=e.map((({condition:e,message:t})=>e(a)&&t)).filter((e=>!!e));s.length&&new mo({variant:"warning",body:t(r,null,s.map((e=>t("p",null,e)))),delay:5e3*s.length,...i})};export{ym as $,Up as A,to as B,qd as C,Op as D,Qh as E,Ap as F,Lp as G,Fp as H,Dp as I,Vp as J,$u as K,np as L,sp as M,op as N,km as O,Lu as P,qu as Q,Np as R,pu as S,Gp as T,bm as U,vm as V,_m as W,ju as X,Hu as Y,Nm as Z,Kd as _,Mu as a,Am as a0,Rp as a1,Lm as a2,Tm as a3,so as a4,Mp as a5,$o as a6,mo as a7,Tp as b,vu as c,zu as d,Hd as e,Ho as f,Ou as g,Dd as h,tu as i,Hm as j,Xp as k,ho as l,Vu as m,mm as n,Vm as o,po as p,Nd as q,yu as r,Fm as s,fu as t,Hp as u,Bh as v,Cm as w,Pm as x,Ku as y,rp as z};
